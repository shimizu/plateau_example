/*! For license information please see app.js.LICENSE.txt */
(()=>{var t,e,n,i,r={187:t=>{"use strict";function e(t,e,i){i=i||2;var s,o,a,l,h,d,p,g=e&&e.length,m=g?e[0]*i:t.length,v=n(t,0,m,i,!0),y=[];if(!v||v.next===v.prev)return y;if(g&&(v=function(t,e,i,r){var s,o,a,l=[];for(s=0,o=e.length;s<o;s++)(a=n(t,e[s]*r,s<o-1?e[s+1]*r:t.length,r,!1))===a.next&&(a.steiner=!0),l.push(f(a));for(l.sort(c),s=0;s<l.length;s++)i=u(l[s],i);return i}(t,e,v,i)),t.length>80*i){s=a=t[0],o=l=t[1];for(var b=i;b<m;b+=i)(h=t[b])<s&&(s=h),(d=t[b+1])<o&&(o=d),h>a&&(a=h),d>l&&(l=d);p=0!==(p=Math.max(a-s,l-o))?32767/p:0}return r(v,y,i,s,o,p,0),y}function n(t,e,n,i,r){var s,o;if(r===T(t,e,n,i)>0)for(s=e;s<n;s+=i)o=C(s,t[s],t[s+1],o);else for(s=n-i;s>=e;s-=i)o=C(s,t[s],t[s+1],o);return o&&v(o,o.next)&&(E(o),o=o.next),o}function i(t,e){if(!t)return t;e||(e=t);var n,i=t;do{if(n=!1,i.steiner||!v(i,i.next)&&0!==m(i.prev,i,i.next))i=i.next;else{if(E(i),(i=e=i.prev)===i.next)break;n=!0}}while(n||i!==e);return e}function r(t,e,n,c,u,h,f){if(t){!f&&h&&function(t,e,n,i){var r=t;do{0===r.z&&(r.z=d(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e,n,i,r,s,o,a,l,c=1;do{for(n=t,t=null,s=null,o=0;n;){for(o++,i=n,a=0,e=0;e<c&&(a++,i=i.nextZ);e++);for(l=c;a>0||l>0&&i;)0!==a&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,l--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;n=i}s.nextZ=null,c*=2}while(o>1)}(r)}(t,c,u,h);for(var p,g,m=t;t.prev!==t.next;)if(p=t.prev,g=t.next,h?o(t,c,u,h):s(t))e.push(p.i/n|0),e.push(t.i/n|0),e.push(g.i/n|0),E(t),t=g.next,m=g.next;else if((t=g)===m){f?1===f?r(t=a(i(t),e,n),e,n,c,u,h,2):2===f&&l(t,e,n,c,u,h):r(i(t),e,n,c,u,h,1);break}}}function s(t){var e=t.prev,n=t,i=t.next;if(m(e,n,i)>=0)return!1;for(var r=e.x,s=n.x,o=i.x,a=e.y,l=n.y,c=i.y,u=r<s?r<o?r:o:s<o?s:o,h=a<l?a<c?a:c:l<c?l:c,d=r>s?r>o?r:o:s>o?s:o,f=a>l?a>c?a:c:l>c?l:c,g=i.next;g!==e;){if(g.x>=u&&g.x<=d&&g.y>=h&&g.y<=f&&p(r,a,s,l,o,c,g.x,g.y)&&m(g.prev,g,g.next)>=0)return!1;g=g.next}return!0}function o(t,e,n,i){var r=t.prev,s=t,o=t.next;if(m(r,s,o)>=0)return!1;for(var a=r.x,l=s.x,c=o.x,u=r.y,h=s.y,f=o.y,g=a<l?a<c?a:c:l<c?l:c,v=u<h?u<f?u:f:h<f?h:f,y=a>l?a>c?a:c:l>c?l:c,b=u>h?u>f?u:f:h>f?h:f,_=d(g,v,e,n,i),A=d(y,b,e,n,i),w=t.prevZ,C=t.nextZ;w&&w.z>=_&&C&&C.z<=A;){if(w.x>=g&&w.x<=y&&w.y>=v&&w.y<=b&&w!==r&&w!==o&&p(a,u,l,h,c,f,w.x,w.y)&&m(w.prev,w,w.next)>=0)return!1;if(w=w.prevZ,C.x>=g&&C.x<=y&&C.y>=v&&C.y<=b&&C!==r&&C!==o&&p(a,u,l,h,c,f,C.x,C.y)&&m(C.prev,C,C.next)>=0)return!1;C=C.nextZ}for(;w&&w.z>=_;){if(w.x>=g&&w.x<=y&&w.y>=v&&w.y<=b&&w!==r&&w!==o&&p(a,u,l,h,c,f,w.x,w.y)&&m(w.prev,w,w.next)>=0)return!1;w=w.prevZ}for(;C&&C.z<=A;){if(C.x>=g&&C.x<=y&&C.y>=v&&C.y<=b&&C!==r&&C!==o&&p(a,u,l,h,c,f,C.x,C.y)&&m(C.prev,C,C.next)>=0)return!1;C=C.nextZ}return!0}function a(t,e,n){var r=t;do{var s=r.prev,o=r.next.next;!v(s,o)&&y(s,r,r.next,o)&&A(s,o)&&A(o,s)&&(e.push(s.i/n|0),e.push(r.i/n|0),e.push(o.i/n|0),E(r),E(r.next),r=t=o),r=r.next}while(r!==t);return i(r)}function l(t,e,n,s,o,a){var l=t;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&g(l,c)){var u=w(l,c);return l=i(l,l.next),u=i(u,u.next),r(l,e,n,s,o,a,0),void r(u,e,n,s,o,a,0)}c=c.next}l=l.next}while(l!==t)}function c(t,e){return t.x-e.x}function u(t,e){var n=function(t,e){var n,i=e,r=t.x,s=t.y,o=-1/0;do{if(s<=i.y&&s>=i.next.y&&i.next.y!==i.y){var a=i.x+(s-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=r&&a>o&&(o=a,n=i.x<i.next.x?i:i.next,a===r))return n}i=i.next}while(i!==e);if(!n)return null;var l,c=n,u=n.x,d=n.y,f=1/0;i=n;do{r>=i.x&&i.x>=u&&r!==i.x&&p(s<d?r:o,s,u,d,s<d?o:r,s,i.x,i.y)&&(l=Math.abs(s-i.y)/(r-i.x),A(i,t)&&(l<f||l===f&&(i.x>n.x||i.x===n.x&&h(n,i)))&&(n=i,f=l)),i=i.next}while(i!==c);return n}(t,e);if(!n)return e;var r=w(n,t);return i(r,r.next),i(n,n.next)}function h(t,e){return m(t.prev,t,e.prev)<0&&m(e.next,t,t.next)<0}function d(t,e,n,i,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function f(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function p(t,e,n,i,r,s,o,a){return(r-o)*(e-a)>=(t-o)*(s-a)&&(t-o)*(i-a)>=(n-o)*(e-a)&&(n-o)*(s-a)>=(r-o)*(i-a)}function g(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&y(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(A(t,e)&&A(e,t)&&function(t,e){var n=t,i=!1,r=(t.x+e.x)/2,s=(t.y+e.y)/2;do{n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==t);return i}(t,e)&&(m(t.prev,t,e.prev)||m(t,e.prev,e))||v(t,e)&&m(t.prev,t,t.next)>0&&m(e.prev,e,e.next)>0)}function m(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function v(t,e){return t.x===e.x&&t.y===e.y}function y(t,e,n,i){var r=_(m(t,e,n)),s=_(m(t,e,i)),o=_(m(n,i,t)),a=_(m(n,i,e));return r!==s&&o!==a||!(0!==r||!b(t,n,e))||!(0!==s||!b(t,i,e))||!(0!==o||!b(n,t,i))||!(0!==a||!b(n,e,i))}function b(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function _(t){return t>0?1:t<0?-1:0}function A(t,e){return m(t.prev,t,t.next)<0?m(t,e,t.next)>=0&&m(t,t.prev,e)>=0:m(t,e,t.prev)<0||m(t,t.next,e)<0}function w(t,e){var n=new x(t.i,t.x,t.y),i=new x(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function C(t,e,n,i){var r=new x(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function E(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function x(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function T(t,e,n,i){for(var r=0,s=e,o=n-i;s<n;s+=i)r+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return r}t.exports=e,t.exports.default=e,e.deviation=function(t,e,n,i){var r=e&&e.length,s=r?e[0]*n:t.length,o=Math.abs(T(t,0,s,n));if(r)for(var a=0,l=e.length;a<l;a++){var c=e[a]*n,u=a<l-1?e[a+1]*n:t.length;o-=Math.abs(T(t,c,u,n))}var h=0;for(a=0;a<i.length;a+=3){var d=i[a]*n,f=i[a+1]*n,p=i[a+2]*n;h+=Math.abs((t[d]-t[p])*(t[f+1]-t[d+1])-(t[d]-t[f])*(t[p+1]-t[d+1]))}return 0===o&&0===h?0:Math.abs((h-o)/o)},e.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},i=0,r=0;r<t.length;r++){for(var s=0;s<t[r].length;s++)for(var o=0;o<e;o++)n.vertices.push(t[r][s][o]);r>0&&(i+=t[r-1].length,n.holes.push(i))}return n}},797:(t,e,n)=>{var i;!function(r,s,o,a){"use strict";var l,c=["","webkit","Moz","MS","ms","o"],u=s.createElement("div"),h="function",d=Math.round,f=Math.abs,p=Date.now;function g(t,e,n){return setTimeout(w(t,n),e)}function m(t,e,n){return!!Array.isArray(t)&&(v(t,n[e],n),!0)}function v(t,e,n){var i;if(t)if(t.forEach)t.forEach(e,n);else if(t.length!==a)for(i=0;i<t.length;)e.call(n,t[i],i,t),i++;else for(i in t)t.hasOwnProperty(i)&&e.call(n,t[i],i,t)}function y(t,e,n){var i="DEPRECATED METHOD: "+e+"\n"+n+" AT \n";return function(){var e=new Error("get-stack-trace"),n=e&&e.stack?e.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",s=r.console&&(r.console.warn||r.console.log);return s&&s.call(r.console,i,n),t.apply(this,arguments)}}l="function"!=typeof Object.assign?function(t){if(t===a||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var i=arguments[n];if(i!==a&&null!==i)for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])}return e}:Object.assign;var b=y((function(t,e,n){for(var i=Object.keys(e),r=0;r<i.length;)(!n||n&&t[i[r]]===a)&&(t[i[r]]=e[i[r]]),r++;return t}),"extend","Use `assign`."),_=y((function(t,e){return b(t,e,!0)}),"merge","Use `assign`.");function A(t,e,n){var i,r=e.prototype;(i=t.prototype=Object.create(r)).constructor=t,i._super=r,n&&l(i,n)}function w(t,e){return function(){return t.apply(e,arguments)}}function C(t,e){return typeof t==h?t.apply(e&&e[0]||a,e):t}function E(t,e){return t===a?e:t}function x(t,e,n){v(P(e),(function(e){t.addEventListener(e,n,!1)}))}function T(t,e,n){v(P(e),(function(e){t.removeEventListener(e,n,!1)}))}function S(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function B(t,e){return t.indexOf(e)>-1}function P(t){return t.trim().split(/\s+/g)}function M(t,e,n){if(t.indexOf&&!n)return t.indexOf(e);for(var i=0;i<t.length;){if(n&&t[i][n]==e||!n&&t[i]===e)return i;i++}return-1}function I(t){return Array.prototype.slice.call(t,0)}function L(t,e,n){for(var i=[],r=[],s=0;s<t.length;){var o=e?t[s][e]:t[s];M(r,o)<0&&i.push(t[s]),r[s]=o,s++}return n&&(i=e?i.sort((function(t,n){return t[e]>n[e]})):i.sort()),i}function O(t,e){for(var n,i,r=e[0].toUpperCase()+e.slice(1),s=0;s<c.length;){if((i=(n=c[s])?n+r:e)in t)return i;s++}return a}var R=1;function F(t){var e=t.ownerDocument||t;return e.defaultView||e.parentWindow||r}var k="ontouchstart"in r,D=O(r,"PointerEvent")!==a,N=k&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),U="touch",z="mouse",G=25,j=1,V=4,H=8,W=1,J=2,q=4,K=8,X=16,Q=J|q,Y=K|X,Z=Q|Y,$=["x","y"],tt=["clientX","clientY"];function et(t,e){var n=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){C(t.options.enable,[t])&&n.handler(e)},this.init()}function nt(t,e,n){var i=n.pointers.length,r=n.changedPointers.length,s=e&j&&i-r==0,o=e&(V|H)&&i-r==0;n.isFirst=!!s,n.isFinal=!!o,s&&(t.session={}),n.eventType=e,function(t,e){var n=t.session,i=e.pointers,r=i.length;n.firstInput||(n.firstInput=it(e)),r>1&&!n.firstMultiple?n.firstMultiple=it(e):1===r&&(n.firstMultiple=!1);var s=n.firstInput,o=n.firstMultiple,l=o?o.center:s.center,c=e.center=rt(i);e.timeStamp=p(),e.deltaTime=e.timeStamp-s.timeStamp,e.angle=lt(l,c),e.distance=at(l,c),function(t,e){var n=e.center,i=t.offsetDelta||{},r=t.prevDelta||{},s=t.prevInput||{};e.eventType!==j&&s.eventType!==V||(r=t.prevDelta={x:s.deltaX||0,y:s.deltaY||0},i=t.offsetDelta={x:n.x,y:n.y}),e.deltaX=r.x+(n.x-i.x),e.deltaY=r.y+(n.y-i.y)}(n,e),e.offsetDirection=ot(e.deltaX,e.deltaY);var u,h,d=st(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=d.x,e.overallVelocityY=d.y,e.overallVelocity=f(d.x)>f(d.y)?d.x:d.y,e.scale=o?(u=o.pointers,at((h=i)[0],h[1],tt)/at(u[0],u[1],tt)):1,e.rotation=o?function(t,e){return lt(e[1],e[0],tt)+lt(t[1],t[0],tt)}(o.pointers,i):0,e.maxPointers=n.prevInput?e.pointers.length>n.prevInput.maxPointers?e.pointers.length:n.prevInput.maxPointers:e.pointers.length,function(t,e){var n,i,r,s,o=t.lastInterval||e,l=e.timeStamp-o.timeStamp;if(e.eventType!=H&&(l>G||o.velocity===a)){var c=e.deltaX-o.deltaX,u=e.deltaY-o.deltaY,h=st(l,c,u);i=h.x,r=h.y,n=f(h.x)>f(h.y)?h.x:h.y,s=ot(c,u),t.lastInterval=e}else n=o.velocity,i=o.velocityX,r=o.velocityY,s=o.direction;e.velocity=n,e.velocityX=i,e.velocityY=r,e.direction=s}(n,e);var g=t.element;S(e.srcEvent.target,g)&&(g=e.srcEvent.target),e.target=g}(t,n),t.emit("hammer.input",n),t.recognize(n),t.session.prevInput=n}function it(t){for(var e=[],n=0;n<t.pointers.length;)e[n]={clientX:d(t.pointers[n].clientX),clientY:d(t.pointers[n].clientY)},n++;return{timeStamp:p(),pointers:e,center:rt(e),deltaX:t.deltaX,deltaY:t.deltaY}}function rt(t){var e=t.length;if(1===e)return{x:d(t[0].clientX),y:d(t[0].clientY)};for(var n=0,i=0,r=0;r<e;)n+=t[r].clientX,i+=t[r].clientY,r++;return{x:d(n/e),y:d(i/e)}}function st(t,e,n){return{x:e/t||0,y:n/t||0}}function ot(t,e){return t===e?W:f(t)>=f(e)?t<0?J:q:e<0?K:X}function at(t,e,n){n||(n=$);var i=e[n[0]]-t[n[0]],r=e[n[1]]-t[n[1]];return Math.sqrt(i*i+r*r)}function lt(t,e,n){n||(n=$);var i=e[n[0]]-t[n[0]],r=e[n[1]]-t[n[1]];return 180*Math.atan2(r,i)/Math.PI}et.prototype={handler:function(){},init:function(){this.evEl&&x(this.element,this.evEl,this.domHandler),this.evTarget&&x(this.target,this.evTarget,this.domHandler),this.evWin&&x(F(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&T(this.element,this.evEl,this.domHandler),this.evTarget&&T(this.target,this.evTarget,this.domHandler),this.evWin&&T(F(this.element),this.evWin,this.domHandler)}};var ct={mousedown:j,mousemove:2,mouseup:V},ut="mousedown",ht="mousemove mouseup";function dt(){this.evEl=ut,this.evWin=ht,this.pressed=!1,et.apply(this,arguments)}A(dt,et,{handler:function(t){var e=ct[t.type];e&j&&0===t.button&&(this.pressed=!0),2&e&&1!==t.which&&(e=V),this.pressed&&(e&V&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:z,srcEvent:t}))}});var ft={pointerdown:j,pointermove:2,pointerup:V,pointercancel:H,pointerout:H},pt={2:U,3:"pen",4:z,5:"kinect"},gt="pointerdown",mt="pointermove pointerup pointercancel";function vt(){this.evEl=gt,this.evWin=mt,et.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}r.MSPointerEvent&&!r.PointerEvent&&(gt="MSPointerDown",mt="MSPointerMove MSPointerUp MSPointerCancel"),A(vt,et,{handler:function(t){var e=this.store,n=!1,i=t.type.toLowerCase().replace("ms",""),r=ft[i],s=pt[t.pointerType]||t.pointerType,o=s==U,a=M(e,t.pointerId,"pointerId");r&j&&(0===t.button||o)?a<0&&(e.push(t),a=e.length-1):r&(V|H)&&(n=!0),a<0||(e[a]=t,this.callback(this.manager,r,{pointers:e,changedPointers:[t],pointerType:s,srcEvent:t}),n&&e.splice(a,1))}});var yt={touchstart:j,touchmove:2,touchend:V,touchcancel:H};function bt(){this.evTarget="touchstart",this.evWin="touchstart touchmove touchend touchcancel",this.started=!1,et.apply(this,arguments)}function _t(t,e){var n=I(t.touches),i=I(t.changedTouches);return e&(V|H)&&(n=L(n.concat(i),"identifier",!0)),[n,i]}A(bt,et,{handler:function(t){var e=yt[t.type];if(e===j&&(this.started=!0),this.started){var n=_t.call(this,t,e);e&(V|H)&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:U,srcEvent:t})}}});var At={touchstart:j,touchmove:2,touchend:V,touchcancel:H},wt="touchstart touchmove touchend touchcancel";function Ct(){this.evTarget=wt,this.targetIds={},et.apply(this,arguments)}function Et(t,e){var n=I(t.touches),i=this.targetIds;if(e&(2|j)&&1===n.length)return i[n[0].identifier]=!0,[n,n];var r,s,o=I(t.changedTouches),a=[],l=this.target;if(s=n.filter((function(t){return S(t.target,l)})),e===j)for(r=0;r<s.length;)i[s[r].identifier]=!0,r++;for(r=0;r<o.length;)i[o[r].identifier]&&a.push(o[r]),e&(V|H)&&delete i[o[r].identifier],r++;return a.length?[L(s.concat(a),"identifier",!0),a]:void 0}A(Ct,et,{handler:function(t){var e=At[t.type],n=Et.call(this,t,e);n&&this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:U,srcEvent:t})}});var xt=2500;function Tt(){et.apply(this,arguments);var t=w(this.handler,this);this.touch=new Ct(this.manager,t),this.mouse=new dt(this.manager,t),this.primaryTouch=null,this.lastTouches=[]}function St(t,e){t&j?(this.primaryTouch=e.changedPointers[0].identifier,Bt.call(this,e)):t&(V|H)&&Bt.call(this,e)}function Bt(t){var e=t.changedPointers[0];if(e.identifier===this.primaryTouch){var n={x:e.clientX,y:e.clientY};this.lastTouches.push(n);var i=this.lastTouches;setTimeout((function(){var t=i.indexOf(n);t>-1&&i.splice(t,1)}),xt)}}function Pt(t){for(var e=t.srcEvent.clientX,n=t.srcEvent.clientY,i=0;i<this.lastTouches.length;i++){var r=this.lastTouches[i],s=Math.abs(e-r.x),o=Math.abs(n-r.y);if(s<=25&&o<=25)return!0}return!1}A(Tt,et,{handler:function(t,e,n){var i=n.pointerType==U,r=n.pointerType==z;if(!(r&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(i)St.call(this,e,n);else if(r&&Pt.call(this,n))return;this.callback(t,e,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Mt=O(u.style,"touchAction"),It=Mt!==a,Lt="compute",Ot="auto",Rt="manipulation",Ft="none",kt="pan-x",Dt="pan-y",Nt=function(){if(!It)return!1;var t={},e=r.CSS&&r.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(n){t[n]=!e||r.CSS.supports("touch-action",n)})),t}();function Ut(t,e){this.manager=t,this.set(e)}Ut.prototype={set:function(t){t==Lt&&(t=this.compute()),It&&this.manager.element.style&&Nt[t]&&(this.manager.element.style[Mt]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return v(this.manager.recognizers,(function(e){C(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))})),function(t){if(B(t,Ft))return Ft;var e=B(t,kt),n=B(t,Dt);return e&&n?Ft:e||n?e?kt:Dt:B(t,Rt)?Rt:Ot}(t.join(" "))},preventDefaults:function(t){var e=t.srcEvent,n=t.offsetDirection;if(this.manager.session.prevented)e.preventDefault();else{var i=this.actions,r=B(i,Ft)&&!Nt[Ft],s=B(i,Dt)&&!Nt[Dt],o=B(i,kt)&&!Nt[kt];if(r){var a=1===t.pointers.length,l=t.distance<2,c=t.deltaTime<250;if(a&&l&&c)return}if(!o||!s)return r||s&&n&Q||o&&n&Y?this.preventSrc(e):void 0}},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};var zt=1,Gt=32;function jt(t){this.options=l({},this.defaults,t||{}),this.id=R++,this.manager=null,this.options.enable=E(this.options.enable,!0),this.state=zt,this.simultaneous={},this.requireFail=[]}function Vt(t){return 16&t?"cancel":8&t?"end":4&t?"move":2&t?"start":""}function Ht(t){return t==X?"down":t==K?"up":t==J?"left":t==q?"right":""}function Wt(t,e){var n=e.manager;return n?n.get(t):t}function Jt(){jt.apply(this,arguments)}function qt(){Jt.apply(this,arguments),this.pX=null,this.pY=null}function Kt(){Jt.apply(this,arguments)}function Xt(){jt.apply(this,arguments),this._timer=null,this._input=null}function Qt(){Jt.apply(this,arguments)}function Yt(){Jt.apply(this,arguments)}function Zt(){jt.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function $t(t,e){return(e=e||{}).recognizers=E(e.recognizers,$t.defaults.preset),new te(t,e)}function te(t,e){this.options=l({},$t.defaults,e||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=new(this.options.inputClass||(D?vt:N?Ct:k?Tt:dt))(this,nt),this.touchAction=new Ut(this,this.options.touchAction),ee(this,!0),v(this.options.recognizers,(function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])}),this)}function ee(t,e){var n,i=t.element;i.style&&(v(t.options.cssProps,(function(r,s){n=O(i.style,s),e?(t.oldCssProps[n]=i.style[n],i.style[n]=r):i.style[n]=t.oldCssProps[n]||""})),e||(t.oldCssProps={}))}jt.prototype={defaults:{},set:function(t){return l(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(m(t,"recognizeWith",this))return this;var e=this.simultaneous;return e[(t=Wt(t,this)).id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return m(t,"dropRecognizeWith",this)||(t=Wt(t,this),delete this.simultaneous[t.id]),this},requireFailure:function(t){if(m(t,"requireFailure",this))return this;var e=this.requireFail;return-1===M(e,t=Wt(t,this))&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(m(t,"dropRequireFailure",this))return this;t=Wt(t,this);var e=M(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){var e=this,n=this.state;function i(n){e.manager.emit(n,t)}n<8&&i(e.options.event+Vt(n)),i(e.options.event),t.additionalEvent&&i(t.additionalEvent),n>=8&&i(e.options.event+Vt(n))},tryEmit:function(t){if(this.canEmit())return this.emit(t);this.state=Gt},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(this.requireFail[t].state&(Gt|zt)))return!1;t++}return!0},recognize:function(t){var e=l({},t);if(!C(this.options.enable,[this,e]))return this.reset(),void(this.state=Gt);56&this.state&&(this.state=zt),this.state=this.process(e),30&this.state&&this.tryEmit(e)},process:function(t){},getTouchAction:function(){},reset:function(){}},A(Jt,jt,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,n=t.eventType,i=6&e,r=this.attrTest(t);return i&&(n&H||!r)?16|e:i||r?n&V?8|e:2&e?4|e:2:Gt}}),A(qt,Jt,{defaults:{event:"pan",threshold:10,pointers:1,direction:Z},getTouchAction:function(){var t=this.options.direction,e=[];return t&Q&&e.push(Dt),t&Y&&e.push(kt),e},directionTest:function(t){var e=this.options,n=!0,i=t.distance,r=t.direction,s=t.deltaX,o=t.deltaY;return r&e.direction||(e.direction&Q?(r=0===s?W:s<0?J:q,n=s!=this.pX,i=Math.abs(t.deltaX)):(r=0===o?W:o<0?K:X,n=o!=this.pY,i=Math.abs(t.deltaY))),t.direction=r,n&&i>e.threshold&&r&e.direction},attrTest:function(t){return Jt.prototype.attrTest.call(this,t)&&(2&this.state||!(2&this.state)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=Ht(t.direction);e&&(t.additionalEvent=this.options.event+e),this._super.emit.call(this,t)}}),A(Kt,Jt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Ft]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||2&this.state)},emit:function(t){if(1!==t.scale){var e=t.scale<1?"in":"out";t.additionalEvent=this.options.event+e}this._super.emit.call(this,t)}}),A(Xt,jt,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Ot]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,i=t.distance<e.threshold,r=t.deltaTime>e.time;if(this._input=t,!i||!n||t.eventType&(V|H)&&!r)this.reset();else if(t.eventType&j)this.reset(),this._timer=g((function(){this.state=8,this.tryEmit()}),e.time,this);else if(t.eventType&V)return 8;return Gt},reset:function(){clearTimeout(this._timer)},emit:function(t){8===this.state&&(t&&t.eventType&V?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=p(),this.manager.emit(this.options.event,this._input)))}}),A(Qt,Jt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Ft]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||2&this.state)}}),A(Yt,Jt,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Q|Y,pointers:1},getTouchAction:function(){return qt.prototype.getTouchAction.call(this)},attrTest:function(t){var e,n=this.options.direction;return n&(Q|Y)?e=t.overallVelocity:n&Q?e=t.overallVelocityX:n&Y&&(e=t.overallVelocityY),this._super.attrTest.call(this,t)&&n&t.offsetDirection&&t.distance>this.options.threshold&&t.maxPointers==this.options.pointers&&f(e)>this.options.velocity&&t.eventType&V},emit:function(t){var e=Ht(t.offsetDirection);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),A(Zt,jt,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Rt]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,i=t.distance<e.threshold,r=t.deltaTime<e.time;if(this.reset(),t.eventType&j&&0===this.count)return this.failTimeout();if(i&&r&&n){if(t.eventType!=V)return this.failTimeout();var s=!this.pTime||t.timeStamp-this.pTime<e.interval,o=!this.pCenter||at(this.pCenter,t.center)<e.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,o&&s?this.count+=1:this.count=1,this._input=t,0==this.count%e.taps)return this.hasRequireFailures()?(this._timer=g((function(){this.state=8,this.tryEmit()}),e.interval,this),2):8}return Gt},failTimeout:function(){return this._timer=g((function(){this.state=Gt}),this.options.interval,this),Gt},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),$t.VERSION="2.0.7",$t.defaults={domEvents:!1,touchAction:Lt,enable:!0,inputTarget:null,inputClass:null,preset:[[Qt,{enable:!1}],[Kt,{enable:!1},["rotate"]],[Yt,{direction:Q}],[qt,{direction:Q},["swipe"]],[Zt],[Zt,{event:"doubletap",taps:2},["tap"]],[Xt]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},te.prototype={set:function(t){return l(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?2:1},recognize:function(t){var e=this.session;if(!e.stopped){var n;this.touchAction.preventDefaults(t);var i=this.recognizers,r=e.curRecognizer;(!r||r&&8&r.state)&&(r=e.curRecognizer=null);for(var s=0;s<i.length;)n=i[s],2===e.stopped||r&&n!=r&&!n.canRecognizeWith(r)?n.reset():n.recognize(t),!r&&14&n.state&&(r=e.curRecognizer=n),s++}},get:function(t){if(t instanceof jt)return t;for(var e=this.recognizers,n=0;n<e.length;n++)if(e[n].options.event==t)return e[n];return null},add:function(t){if(m(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(m(t,"remove",this))return this;if(t=this.get(t)){var e=this.recognizers,n=M(e,t);-1!==n&&(e.splice(n,1),this.touchAction.update())}return this},on:function(t,e){if(t!==a&&e!==a){var n=this.handlers;return v(P(t),(function(t){n[t]=n[t]||[],n[t].push(e)})),this}},off:function(t,e){if(t!==a){var n=this.handlers;return v(P(t),(function(t){e?n[t]&&n[t].splice(M(n[t],e),1):delete n[t]})),this}},emit:function(t,e){this.options.domEvents&&function(t,e){var n=s.createEvent("Event");n.initEvent(t,!0,!0),n.gesture=e,e.target.dispatchEvent(n)}(t,e);var n=this.handlers[t]&&this.handlers[t].slice();if(n&&n.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var i=0;i<n.length;)n[i](e),i++}},destroy:function(){this.element&&ee(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},l($t,{INPUT_START:j,INPUT_MOVE:2,INPUT_END:V,INPUT_CANCEL:H,STATE_POSSIBLE:zt,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:Gt,DIRECTION_NONE:W,DIRECTION_LEFT:J,DIRECTION_RIGHT:q,DIRECTION_UP:K,DIRECTION_DOWN:X,DIRECTION_HORIZONTAL:Q,DIRECTION_VERTICAL:Y,DIRECTION_ALL:Z,Manager:te,Input:et,TouchAction:Ut,TouchInput:Ct,MouseInput:dt,PointerEventInput:vt,TouchMouseInput:Tt,SingleTouchInput:bt,Recognizer:jt,AttrRecognizer:Jt,Tap:Zt,Pan:qt,Swipe:Yt,Pinch:Kt,Rotate:Qt,Press:Xt,on:x,off:T,each:v,merge:_,extend:b,assign:l,inherit:A,bindFn:w,prefixed:O}),(void 0!==r?r:"undefined"!=typeof self?self:{}).Hammer=$t,(i=function(){return $t}.call(e,n,e,t))===a||(t.exports=i)}(window,document)},448:(t,e,n)=>{"use strict";var i=n(294),r=n(840);function s(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,a={};function l(t,e){c(t,e),c(t+"Capture",e)}function c(t,e){for(a[t]=e,t=0;t<e.length;t++)o.add(e[t])}var u=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),h=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f={},p={};function g(t,e,n,i,r,s,o){this.acceptsBooleans=2===e||3===e||4===e,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var m={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(t){m[t]=new g(t,0,!1,t,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(t){var e=t[0];m[e]=new g(e,1,!1,t[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(t){m[t]=new g(t,2,!1,t.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(t){m[t]=new g(t,2,!1,t,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(t){m[t]=new g(t,3,!1,t.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(t){m[t]=new g(t,3,!0,t,null,!1,!1)})),["capture","download"].forEach((function(t){m[t]=new g(t,4,!1,t,null,!1,!1)})),["cols","rows","size","span"].forEach((function(t){m[t]=new g(t,6,!1,t,null,!1,!1)})),["rowSpan","start"].forEach((function(t){m[t]=new g(t,5,!1,t.toLowerCase(),null,!1,!1)}));var v=/[\-:]([a-z])/g;function y(t){return t[1].toUpperCase()}function b(t,e,n,i){var r=m.hasOwnProperty(e)?m[e]:null;(null!==r?0!==r.type:i||!(2<e.length)||"o"!==e[0]&&"O"!==e[0]||"n"!==e[1]&&"N"!==e[1])&&(function(t,e,n,i){if(null==e||function(t,e,n,i){if(null!==n&&0===n.type)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return!i&&(null!==n?!n.acceptsBooleans:"data-"!==(t=t.toLowerCase().slice(0,5))&&"aria-"!==t);default:return!1}}(t,e,n,i))return!0;if(i)return!1;if(null!==n)switch(n.type){case 3:return!e;case 4:return!1===e;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}(e,n,r,i)&&(n=null),i||null===r?function(t){return!!h.call(p,t)||!h.call(f,t)&&(d.test(t)?p[t]=!0:(f[t]=!0,!1))}(e)&&(null===n?t.removeAttribute(e):t.setAttribute(e,""+n)):r.mustUseProperty?t[r.propertyName]=null===n?3!==r.type&&"":n:(e=r.attributeName,i=r.attributeNamespace,null===n?t.removeAttribute(e):(n=3===(r=r.type)||4===r&&!0===n?"":""+n,i?t.setAttributeNS(i,e,n):t.setAttribute(e,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(t){var e=t.replace(v,y);m[e]=new g(e,1,!1,t,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(t){var e=t.replace(v,y);m[e]=new g(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(t){var e=t.replace(v,y);m[e]=new g(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(t){m[t]=new g(t,1,!1,t.toLowerCase(),null,!1,!1)})),m.xlinkHref=new g("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(t){m[t]=new g(t,1,!1,t.toLowerCase(),null,!0,!0)}));var _=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,A=Symbol.for("react.element"),w=Symbol.for("react.portal"),C=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),x=Symbol.for("react.profiler"),T=Symbol.for("react.provider"),S=Symbol.for("react.context"),B=Symbol.for("react.forward_ref"),P=Symbol.for("react.suspense"),M=Symbol.for("react.suspense_list"),I=Symbol.for("react.memo"),L=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var O=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var R=Symbol.iterator;function F(t){return null===t||"object"!=typeof t?null:"function"==typeof(t=R&&t[R]||t["@@iterator"])?t:null}var k,D=Object.assign;function N(t){if(void 0===k)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);k=e&&e[1]||""}return"\n"+k+t}var U=!1;function z(t,e){if(!t||U)return"";U=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(e,[])}catch(t){var i=t}Reflect.construct(t,[],e)}else{try{e.call()}catch(t){i=t}t.call(e.prototype)}else{try{throw Error()}catch(t){i=t}t()}}catch(e){if(e&&i&&"string"==typeof e.stack){for(var r=e.stack.split("\n"),s=i.stack.split("\n"),o=r.length-1,a=s.length-1;1<=o&&0<=a&&r[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(r[o]!==s[a]){if(1!==o||1!==a)do{if(o--,0>--a||r[o]!==s[a]){var l="\n"+r[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}}while(1<=o&&0<=a);break}}}finally{U=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?N(t):""}function G(t){switch(t.tag){case 5:return N(t.type);case 16:return N("Lazy");case 13:return N("Suspense");case 19:return N("SuspenseList");case 0:case 2:case 15:return z(t.type,!1);case 11:return z(t.type.render,!1);case 1:return z(t.type,!0);default:return""}}function j(t){if(null==t)return null;if("function"==typeof t)return t.displayName||t.name||null;if("string"==typeof t)return t;switch(t){case C:return"Fragment";case w:return"Portal";case x:return"Profiler";case E:return"StrictMode";case P:return"Suspense";case M:return"SuspenseList"}if("object"==typeof t)switch(t.$$typeof){case S:return(t.displayName||"Context")+".Consumer";case T:return(t._context.displayName||"Context")+".Provider";case B:var e=t.render;return(t=t.displayName)||(t=""!==(t=e.displayName||e.name||"")?"ForwardRef("+t+")":"ForwardRef"),t;case I:return null!==(e=t.displayName||null)?e:j(t.type)||"Memo";case L:e=t._payload,t=t._init;try{return j(t(e))}catch(t){}}return null}function V(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=(t=e.render).displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return j(e);case 8:return e===E?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e}return null}function H(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":case"object":return t;default:return""}}function W(t){var e=t.type;return(t=t.nodeName)&&"input"===t.toLowerCase()&&("checkbox"===e||"radio"===e)}function J(t){t._valueTracker||(t._valueTracker=function(t){var e=W(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&void 0!==n&&"function"==typeof n.get&&"function"==typeof n.set){var r=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(t){i=""+t,s.call(this,t)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(t){i=""+t},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}(t))}function q(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=W(t)?t.checked?"true":"false":t.value),(t=i)!==n&&(e.setValue(t),!0)}function K(t){if(void 0===(t=t||("undefined"!=typeof document?document:void 0)))return null;try{return t.activeElement||t.body}catch(e){return t.body}}function X(t,e){var n=e.checked;return D({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:t._wrapperState.initialChecked})}function Q(t,e){var n=null==e.defaultValue?"":e.defaultValue,i=null!=e.checked?e.checked:e.defaultChecked;n=H(null!=e.value?e.value:n),t._wrapperState={initialChecked:i,initialValue:n,controlled:"checkbox"===e.type||"radio"===e.type?null!=e.checked:null!=e.value}}function Y(t,e){null!=(e=e.checked)&&b(t,"checked",e,!1)}function Z(t,e){Y(t,e);var n=H(e.value),i=e.type;if(null!=n)"number"===i?(0===n&&""===t.value||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if("submit"===i||"reset"===i)return void t.removeAttribute("value");e.hasOwnProperty("value")?tt(t,e.type,n):e.hasOwnProperty("defaultValue")&&tt(t,e.type,H(e.defaultValue)),null==e.checked&&null!=e.defaultChecked&&(t.defaultChecked=!!e.defaultChecked)}function $(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!("submit"!==i&&"reset"!==i||void 0!==e.value&&null!==e.value))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}""!==(n=t.name)&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,""!==n&&(t.name=n)}function tt(t,e,n){"number"===e&&K(t.ownerDocument)===t||(null==n?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var et=Array.isArray;function nt(t,e,n,i){if(t=t.options,e){e={};for(var r=0;r<n.length;r++)e["$"+n[r]]=!0;for(n=0;n<t.length;n++)r=e.hasOwnProperty("$"+t[n].value),t[n].selected!==r&&(t[n].selected=r),r&&i&&(t[n].defaultSelected=!0)}else{for(n=""+H(n),e=null,r=0;r<t.length;r++){if(t[r].value===n)return t[r].selected=!0,void(i&&(t[r].defaultSelected=!0));null!==e||t[r].disabled||(e=t[r])}null!==e&&(e.selected=!0)}}function it(t,e){if(null!=e.dangerouslySetInnerHTML)throw Error(s(91));return D({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function rt(t,e){var n=e.value;if(null==n){if(n=e.children,e=e.defaultValue,null!=n){if(null!=e)throw Error(s(92));if(et(n)){if(1<n.length)throw Error(s(93));n=n[0]}e=n}null==e&&(e=""),n=e}t._wrapperState={initialValue:H(n)}}function st(t,e){var n=H(e.value),i=H(e.defaultValue);null!=n&&((n=""+n)!==t.value&&(t.value=n),null==e.defaultValue&&t.defaultValue!==n&&(t.defaultValue=n)),null!=i&&(t.defaultValue=""+i)}function ot(t){var e=t.textContent;e===t._wrapperState.initialValue&&""!==e&&null!==e&&(t.value=e)}function at(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lt(t,e){return null==t||"http://www.w3.org/1999/xhtml"===t?at(e):"http://www.w3.org/2000/svg"===t&&"foreignObject"===e?"http://www.w3.org/1999/xhtml":t}var ct,ut,ht=(ut=function(t,e){if("http://www.w3.org/2000/svg"!==t.namespaceURI||"innerHTML"in t)t.innerHTML=e;else{for((ct=ct||document.createElement("div")).innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=ct.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}},"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(t,e,n,i){MSApp.execUnsafeLocalFunction((function(){return ut(t,e)}))}:ut);function dt(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&3===n.nodeType)return void(n.nodeValue=e)}t.textContent=e}var ft={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},pt=["Webkit","ms","Moz","O"];function gt(t,e,n){return null==e||"boolean"==typeof e||""===e?"":n||"number"!=typeof e||0===e||ft.hasOwnProperty(t)&&ft[t]?(""+e).trim():e+"px"}function mt(t,e){for(var n in t=t.style,e)if(e.hasOwnProperty(n)){var i=0===n.indexOf("--"),r=gt(n,e[n],i);"float"===n&&(n="cssFloat"),i?t.setProperty(n,r):t[n]=r}}Object.keys(ft).forEach((function(t){pt.forEach((function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),ft[e]=ft[t]}))}));var vt=D({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function yt(t,e){if(e){if(vt[t]&&(null!=e.children||null!=e.dangerouslySetInnerHTML))throw Error(s(137,t));if(null!=e.dangerouslySetInnerHTML){if(null!=e.children)throw Error(s(60));if("object"!=typeof e.dangerouslySetInnerHTML||!("__html"in e.dangerouslySetInnerHTML))throw Error(s(61))}if(null!=e.style&&"object"!=typeof e.style)throw Error(s(62))}}function bt(t,e){if(-1===t.indexOf("-"))return"string"==typeof e.is;switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var _t=null;function At(t){return(t=t.target||t.srcElement||window).correspondingUseElement&&(t=t.correspondingUseElement),3===t.nodeType?t.parentNode:t}var wt=null,Ct=null,Et=null;function xt(t){if(t=br(t)){if("function"!=typeof wt)throw Error(s(280));var e=t.stateNode;e&&(e=Ar(e),wt(t.stateNode,t.type,e))}}function Tt(t){Ct?Et?Et.push(t):Et=[t]:Ct=t}function St(){if(Ct){var t=Ct,e=Et;if(Et=Ct=null,xt(t),e)for(t=0;t<e.length;t++)xt(e[t])}}function Bt(t,e){return t(e)}function Pt(){}var Mt=!1;function It(t,e,n){if(Mt)return t(e,n);Mt=!0;try{return Bt(t,e,n)}finally{Mt=!1,(null!==Ct||null!==Et)&&(Pt(),St())}}function Lt(t,e){var n=t.stateNode;if(null===n)return null;var i=Ar(n);if(null===i)return null;n=i[e];t:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(t=t.type)||"input"===t||"select"===t||"textarea"===t)),t=!i;break t;default:t=!1}if(t)return null;if(n&&"function"!=typeof n)throw Error(s(231,e,typeof n));return n}var Ot=!1;if(u)try{var Rt={};Object.defineProperty(Rt,"passive",{get:function(){Ot=!0}}),window.addEventListener("test",Rt,Rt),window.removeEventListener("test",Rt,Rt)}catch(ut){Ot=!1}function Ft(t,e,n,i,r,s,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(n,c)}catch(t){this.onError(t)}}var kt=!1,Dt=null,Nt=!1,Ut=null,zt={onError:function(t){kt=!0,Dt=t}};function Gt(t,e,n,i,r,s,o,a,l){kt=!1,Dt=null,Ft.apply(zt,arguments)}function jt(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do{0!=(4098&(e=t).flags)&&(n=e.return),t=e.return}while(t)}return 3===e.tag?n:null}function Vt(t){if(13===t.tag){var e=t.memoizedState;if(null===e&&null!==(t=t.alternate)&&(e=t.memoizedState),null!==e)return e.dehydrated}return null}function Ht(t){if(jt(t)!==t)throw Error(s(188))}function Wt(t){return null!==(t=function(t){var e=t.alternate;if(!e){if(null===(e=jt(t)))throw Error(s(188));return e!==t?null:t}for(var n=t,i=e;;){var r=n.return;if(null===r)break;var o=r.alternate;if(null===o){if(null!==(i=r.return)){n=i;continue}break}if(r.child===o.child){for(o=r.child;o;){if(o===n)return Ht(r),t;if(o===i)return Ht(r),e;o=o.sibling}throw Error(s(188))}if(n.return!==i.return)n=r,i=o;else{for(var a=!1,l=r.child;l;){if(l===n){a=!0,n=r,i=o;break}if(l===i){a=!0,i=r,n=o;break}l=l.sibling}if(!a){for(l=o.child;l;){if(l===n){a=!0,n=o,i=r;break}if(l===i){a=!0,i=o,n=r;break}l=l.sibling}if(!a)throw Error(s(189))}}if(n.alternate!==i)throw Error(s(190))}if(3!==n.tag)throw Error(s(188));return n.stateNode.current===n?t:e}(t))?Jt(t):null}function Jt(t){if(5===t.tag||6===t.tag)return t;for(t=t.child;null!==t;){var e=Jt(t);if(null!==e)return e;t=t.sibling}return null}var qt=r.unstable_scheduleCallback,Kt=r.unstable_cancelCallback,Xt=r.unstable_shouldYield,Qt=r.unstable_requestPaint,Yt=r.unstable_now,Zt=r.unstable_getCurrentPriorityLevel,$t=r.unstable_ImmediatePriority,te=r.unstable_UserBlockingPriority,ee=r.unstable_NormalPriority,ne=r.unstable_LowPriority,ie=r.unstable_IdlePriority,re=null,se=null,oe=Math.clz32?Math.clz32:function(t){return 0===(t>>>=0)?32:31-(ae(t)/le|0)|0},ae=Math.log,le=Math.LN2,ce=64,ue=4194304;function he(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&t;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&t;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function de(t,e){var n=t.pendingLanes;if(0===n)return 0;var i=0,r=t.suspendedLanes,s=t.pingedLanes,o=268435455&n;if(0!==o){var a=o&~r;0!==a?i=he(a):0!=(s&=o)&&(i=he(s))}else 0!=(o=n&~r)?i=he(o):0!==s&&(i=he(s));if(0===i)return 0;if(0!==e&&e!==i&&0==(e&r)&&((r=i&-i)>=(s=e&-e)||16===r&&0!=(4194240&s)))return e;if(0!=(4&i)&&(i|=16&n),0!==(e=t.entangledLanes))for(t=t.entanglements,e&=i;0<e;)r=1<<(n=31-oe(e)),i|=t[n],e&=~r;return i}function fe(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;default:return-1}}function pe(t){return 0!=(t=-1073741825&t.pendingLanes)?t:1073741824&t?1073741824:0}function ge(){var t=ce;return 0==(4194240&(ce<<=1))&&(ce=64),t}function me(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function ve(t,e,n){t.pendingLanes|=e,536870912!==e&&(t.suspendedLanes=0,t.pingedLanes=0),(t=t.eventTimes)[e=31-oe(e)]=n}function ye(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-oe(n),r=1<<i;r&e|t[i]&e&&(t[i]|=e),n&=~r}}var be=0;function _e(t){return 1<(t&=-t)?4<t?0!=(268435455&t)?16:536870912:4:1}var Ae,we,Ce,Ee,xe,Te=!1,Se=[],Be=null,Pe=null,Me=null,Ie=new Map,Le=new Map,Oe=[],Re="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Fe(t,e){switch(t){case"focusin":case"focusout":Be=null;break;case"dragenter":case"dragleave":Pe=null;break;case"mouseover":case"mouseout":Me=null;break;case"pointerover":case"pointerout":Ie.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Le.delete(e.pointerId)}}function ke(t,e,n,i,r,s){return null===t||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:i,nativeEvent:s,targetContainers:[r]},null!==e&&null!==(e=br(e))&&we(e),t):(t.eventSystemFlags|=i,e=t.targetContainers,null!==r&&-1===e.indexOf(r)&&e.push(r),t)}function De(t){var e=yr(t.target);if(null!==e){var n=jt(e);if(null!==n)if(13===(e=n.tag)){if(null!==(e=Vt(n)))return t.blockedOn=e,void xe(t.priority,(function(){Ce(n)}))}else if(3===e&&n.stateNode.current.memoizedState.isDehydrated)return void(t.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}t.blockedOn=null}function Ne(t){if(null!==t.blockedOn)return!1;for(var e=t.targetContainers;0<e.length;){var n=Xe(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(null!==n)return null!==(e=br(n))&&we(e),t.blockedOn=n,!1;var i=new(n=t.nativeEvent).constructor(n.type,n);_t=i,n.target.dispatchEvent(i),_t=null,e.shift()}return!0}function Ue(t,e,n){Ne(t)&&n.delete(e)}function ze(){Te=!1,null!==Be&&Ne(Be)&&(Be=null),null!==Pe&&Ne(Pe)&&(Pe=null),null!==Me&&Ne(Me)&&(Me=null),Ie.forEach(Ue),Le.forEach(Ue)}function Ge(t,e){t.blockedOn===e&&(t.blockedOn=null,Te||(Te=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,ze)))}function je(t){function e(e){return Ge(e,t)}if(0<Se.length){Ge(Se[0],t);for(var n=1;n<Se.length;n++){var i=Se[n];i.blockedOn===t&&(i.blockedOn=null)}}for(null!==Be&&Ge(Be,t),null!==Pe&&Ge(Pe,t),null!==Me&&Ge(Me,t),Ie.forEach(e),Le.forEach(e),n=0;n<Oe.length;n++)(i=Oe[n]).blockedOn===t&&(i.blockedOn=null);for(;0<Oe.length&&null===(n=Oe[0]).blockedOn;)De(n),null===n.blockedOn&&Oe.shift()}var Ve=_.ReactCurrentBatchConfig,He=!0;function We(t,e,n,i){var r=be,s=Ve.transition;Ve.transition=null;try{be=1,qe(t,e,n,i)}finally{be=r,Ve.transition=s}}function Je(t,e,n,i){var r=be,s=Ve.transition;Ve.transition=null;try{be=4,qe(t,e,n,i)}finally{be=r,Ve.transition=s}}function qe(t,e,n,i){if(He){var r=Xe(t,e,n,i);if(null===r)Hi(t,e,i,Ke,n),Fe(t,i);else if(function(t,e,n,i,r){switch(e){case"focusin":return Be=ke(Be,t,e,n,i,r),!0;case"dragenter":return Pe=ke(Pe,t,e,n,i,r),!0;case"mouseover":return Me=ke(Me,t,e,n,i,r),!0;case"pointerover":var s=r.pointerId;return Ie.set(s,ke(Ie.get(s)||null,t,e,n,i,r)),!0;case"gotpointercapture":return s=r.pointerId,Le.set(s,ke(Le.get(s)||null,t,e,n,i,r)),!0}return!1}(r,t,e,n,i))i.stopPropagation();else if(Fe(t,i),4&e&&-1<Re.indexOf(t)){for(;null!==r;){var s=br(r);if(null!==s&&Ae(s),null===(s=Xe(t,e,n,i))&&Hi(t,e,i,Ke,n),s===r)break;r=s}null!==r&&i.stopPropagation()}else Hi(t,e,i,null,n)}}var Ke=null;function Xe(t,e,n,i){if(Ke=null,null!==(t=yr(t=At(i))))if(null===(e=jt(t)))t=null;else if(13===(n=e.tag)){if(null!==(t=Vt(e)))return t;t=null}else if(3===n){if(e.stateNode.current.memoizedState.isDehydrated)return 3===e.tag?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Ke=t,null}function Qe(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Zt()){case $t:return 1;case te:return 4;case ee:case ne:return 16;case ie:return 536870912;default:return 16}default:return 16}}var Ye=null,Ze=null,$e=null;function tn(){if($e)return $e;var t,e,n=Ze,i=n.length,r="value"in Ye?Ye.value:Ye.textContent,s=r.length;for(t=0;t<i&&n[t]===r[t];t++);var o=i-t;for(e=1;e<=o&&n[i-e]===r[s-e];e++);return $e=r.slice(t,1<e?1-e:void 0)}function en(t){var e=t.keyCode;return"charCode"in t?0===(t=t.charCode)&&13===e&&(t=13):t=e,10===t&&(t=13),32<=t||13===t?t:0}function nn(){return!0}function rn(){return!1}function sn(t){function e(e,n,i,r,s){for(var o in this._reactName=e,this._targetInst=i,this.type=n,this.nativeEvent=r,this.target=s,this.currentTarget=null,t)t.hasOwnProperty(o)&&(e=t[o],this[o]=e?e(r):r[o]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return D(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():"unknown"!=typeof t.returnValue&&(t.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():"unknown"!=typeof t.cancelBubble&&(t.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),e}var on,an,ln,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},un=sn(cn),hn=D({},cn,{view:0,detail:0}),dn=sn(hn),fn=D({},hn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:xn,button:0,buttons:0,relatedTarget:function(t){return void 0===t.relatedTarget?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==ln&&(ln&&"mousemove"===t.type?(on=t.screenX-ln.screenX,an=t.screenY-ln.screenY):an=on=0,ln=t),on)},movementY:function(t){return"movementY"in t?t.movementY:an}}),pn=sn(fn),gn=sn(D({},fn,{dataTransfer:0})),mn=sn(D({},hn,{relatedTarget:0})),vn=sn(D({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),yn=D({},cn,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),bn=sn(yn),_n=sn(D({},cn,{data:0})),An={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Cn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function En(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):!!(t=Cn[t])&&!!e[t]}function xn(){return En}var Tn=D({},hn,{key:function(t){if(t.key){var e=An[t.key]||t.key;if("Unidentified"!==e)return e}return"keypress"===t.type?13===(t=en(t))?"Enter":String.fromCharCode(t):"keydown"===t.type||"keyup"===t.type?wn[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:xn,charCode:function(t){return"keypress"===t.type?en(t):0},keyCode:function(t){return"keydown"===t.type||"keyup"===t.type?t.keyCode:0},which:function(t){return"keypress"===t.type?en(t):"keydown"===t.type||"keyup"===t.type?t.keyCode:0}}),Sn=sn(Tn),Bn=sn(D({},fn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Pn=sn(D({},hn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:xn})),Mn=sn(D({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),In=D({},fn,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Ln=sn(In),On=[9,13,27,32],Rn=u&&"CompositionEvent"in window,Fn=null;u&&"documentMode"in document&&(Fn=document.documentMode);var kn=u&&"TextEvent"in window&&!Fn,Dn=u&&(!Rn||Fn&&8<Fn&&11>=Fn),Nn=String.fromCharCode(32),Un=!1;function zn(t,e){switch(t){case"keyup":return-1!==On.indexOf(e.keyCode);case"keydown":return 229!==e.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Gn(t){return"object"==typeof(t=t.detail)&&"data"in t?t.data:null}var jn=!1,Vn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Hn(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return"input"===e?!!Vn[t.type]:"textarea"===e}function Wn(t,e,n,i){Tt(i),0<(e=Ji(e,"onChange")).length&&(n=new un("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var Jn=null,qn=null;function Kn(t){Ni(t,0)}function Xn(t){if(q(_r(t)))return t}function Qn(t,e){if("change"===t)return e}var Yn=!1;if(u){var Zn;if(u){var $n="oninput"in document;if(!$n){var ti=document.createElement("div");ti.setAttribute("oninput","return;"),$n="function"==typeof ti.oninput}Zn=$n}else Zn=!1;Yn=Zn&&(!document.documentMode||9<document.documentMode)}function ei(){Jn&&(Jn.detachEvent("onpropertychange",ni),qn=Jn=null)}function ni(t){if("value"===t.propertyName&&Xn(qn)){var e=[];Wn(e,qn,t,At(t)),It(Kn,e)}}function ii(t,e,n){"focusin"===t?(ei(),qn=n,(Jn=e).attachEvent("onpropertychange",ni)):"focusout"===t&&ei()}function ri(t){if("selectionchange"===t||"keyup"===t||"keydown"===t)return Xn(qn)}function si(t,e){if("click"===t)return Xn(e)}function oi(t,e){if("input"===t||"change"===t)return Xn(e)}var ai="function"==typeof Object.is?Object.is:function(t,e){return t===e&&(0!==t||1/t==1/e)||t!=t&&e!=e};function li(t,e){if(ai(t,e))return!0;if("object"!=typeof t||null===t||"object"!=typeof e||null===e)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!h.call(e,r)||!ai(t[r],e[r]))return!1}return!0}function ci(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function ui(t,e){var n,i=ci(t);for(t=0;i;){if(3===i.nodeType){if(n=t+i.textContent.length,t<=e&&n>=e)return{node:i,offset:e-t};t=n}t:{for(;i;){if(i.nextSibling){i=i.nextSibling;break t}i=i.parentNode}i=void 0}i=ci(i)}}function hi(t,e){return!(!t||!e)&&(t===e||(!t||3!==t.nodeType)&&(e&&3===e.nodeType?hi(t,e.parentNode):"contains"in t?t.contains(e):!!t.compareDocumentPosition&&!!(16&t.compareDocumentPosition(e))))}function di(){for(var t=window,e=K();e instanceof t.HTMLIFrameElement;){try{var n="string"==typeof e.contentWindow.location.href}catch(t){n=!1}if(!n)break;e=K((t=e.contentWindow).document)}return e}function fi(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&("input"===e&&("text"===t.type||"search"===t.type||"tel"===t.type||"url"===t.type||"password"===t.type)||"textarea"===e||"true"===t.contentEditable)}function pi(t){var e=di(),n=t.focusedElem,i=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&hi(n.ownerDocument.documentElement,n)){if(null!==i&&fi(n))if(e=i.start,void 0===(t=i.end)&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if((t=(e=n.ownerDocument||document)&&e.defaultView||window).getSelection){t=t.getSelection();var r=n.textContent.length,s=Math.min(i.start,r);i=void 0===i.end?s:Math.min(i.end,r),!t.extend&&s>i&&(r=i,i=s,s=r),r=ui(n,s);var o=ui(n,i);r&&o&&(1!==t.rangeCount||t.anchorNode!==r.node||t.anchorOffset!==r.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&((e=e.createRange()).setStart(r.node,r.offset),t.removeAllRanges(),s>i?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}for(e=[],t=n;t=t.parentNode;)1===t.nodeType&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for("function"==typeof n.focus&&n.focus(),n=0;n<e.length;n++)(t=e[n]).element.scrollLeft=t.left,t.element.scrollTop=t.top}}var gi=u&&"documentMode"in document&&11>=document.documentMode,mi=null,vi=null,yi=null,bi=!1;function _i(t,e,n){var i=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;bi||null==mi||mi!==K(i)||(i="selectionStart"in(i=mi)&&fi(i)?{start:i.selectionStart,end:i.selectionEnd}:{anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},yi&&li(yi,i)||(yi=i,0<(i=Ji(vi,"onSelect")).length&&(e=new un("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=mi)))}function Ai(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var wi={animationend:Ai("Animation","AnimationEnd"),animationiteration:Ai("Animation","AnimationIteration"),animationstart:Ai("Animation","AnimationStart"),transitionend:Ai("Transition","TransitionEnd")},Ci={},Ei={};function xi(t){if(Ci[t])return Ci[t];if(!wi[t])return t;var e,n=wi[t];for(e in n)if(n.hasOwnProperty(e)&&e in Ei)return Ci[t]=n[e];return t}u&&(Ei=document.createElement("div").style,"AnimationEvent"in window||(delete wi.animationend.animation,delete wi.animationiteration.animation,delete wi.animationstart.animation),"TransitionEvent"in window||delete wi.transitionend.transition);var Ti=xi("animationend"),Si=xi("animationiteration"),Bi=xi("animationstart"),Pi=xi("transitionend"),Mi=new Map,Ii="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Li(t,e){Mi.set(t,e),l(e,[t])}for(var Oi=0;Oi<Ii.length;Oi++){var Ri=Ii[Oi];Li(Ri.toLowerCase(),"on"+(Ri[0].toUpperCase()+Ri.slice(1)))}Li(Ti,"onAnimationEnd"),Li(Si,"onAnimationIteration"),Li(Bi,"onAnimationStart"),Li("dblclick","onDoubleClick"),Li("focusin","onFocus"),Li("focusout","onBlur"),Li(Pi,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Fi="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),ki=new Set("cancel close invalid load scroll toggle".split(" ").concat(Fi));function Di(t,e,n){var i=t.type||"unknown-event";t.currentTarget=n,function(t,e,n,i,r,o,a,l,c){if(Gt.apply(this,arguments),kt){if(!kt)throw Error(s(198));var u=Dt;kt=!1,Dt=null,Nt||(Nt=!0,Ut=u)}}(i,e,void 0,t),t.currentTarget=null}function Ni(t,e){e=0!=(4&e);for(var n=0;n<t.length;n++){var i=t[n],r=i.event;i=i.listeners;t:{var s=void 0;if(e)for(var o=i.length-1;0<=o;o--){var a=i[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&r.isPropagationStopped())break t;Di(r,a,c),s=l}else for(o=0;o<i.length;o++){if(l=(a=i[o]).instance,c=a.currentTarget,a=a.listener,l!==s&&r.isPropagationStopped())break t;Di(r,a,c),s=l}}}if(Nt)throw t=Ut,Nt=!1,Ut=null,t}function Ui(t,e){var n=e[gr];void 0===n&&(n=e[gr]=new Set);var i=t+"__bubble";n.has(i)||(Vi(e,t,2,!1),n.add(i))}function zi(t,e,n){var i=0;e&&(i|=4),Vi(n,t,i,e)}var Gi="_reactListening"+Math.random().toString(36).slice(2);function ji(t){if(!t[Gi]){t[Gi]=!0,o.forEach((function(e){"selectionchange"!==e&&(ki.has(e)||zi(e,!1,t),zi(e,!0,t))}));var e=9===t.nodeType?t:t.ownerDocument;null===e||e[Gi]||(e[Gi]=!0,zi("selectionchange",!1,e))}}function Vi(t,e,n,i){switch(Qe(e)){case 1:var r=We;break;case 4:r=Je;break;default:r=qe}n=r.bind(null,e,n,t),r=void 0,!Ot||"touchstart"!==e&&"touchmove"!==e&&"wheel"!==e||(r=!0),i?void 0!==r?t.addEventListener(e,n,{capture:!0,passive:r}):t.addEventListener(e,n,!0):void 0!==r?t.addEventListener(e,n,{passive:r}):t.addEventListener(e,n,!1)}function Hi(t,e,n,i,r){var s=i;if(0==(1&e)&&0==(2&e)&&null!==i)t:for(;;){if(null===i)return;var o=i.tag;if(3===o||4===o){var a=i.stateNode.containerInfo;if(a===r||8===a.nodeType&&a.parentNode===r)break;if(4===o)for(o=i.return;null!==o;){var l=o.tag;if((3===l||4===l)&&((l=o.stateNode.containerInfo)===r||8===l.nodeType&&l.parentNode===r))return;o=o.return}for(;null!==a;){if(null===(o=yr(a)))return;if(5===(l=o.tag)||6===l){i=s=o;continue t}a=a.parentNode}}i=i.return}It((function(){var i=s,r=At(n),o=[];t:{var a=Mi.get(t);if(void 0!==a){var l=un,c=t;switch(t){case"keypress":if(0===en(n))break t;case"keydown":case"keyup":l=Sn;break;case"focusin":c="focus",l=mn;break;case"focusout":c="blur",l=mn;break;case"beforeblur":case"afterblur":l=mn;break;case"click":if(2===n.button)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=pn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=gn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Pn;break;case Ti:case Si:case Bi:l=vn;break;case Pi:l=Mn;break;case"scroll":l=dn;break;case"wheel":l=Ln;break;case"copy":case"cut":case"paste":l=bn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Bn}var u=0!=(4&e),h=!u&&"scroll"===t,d=u?null!==a?a+"Capture":null:a;u=[];for(var f,p=i;null!==p;){var g=(f=p).stateNode;if(5===f.tag&&null!==g&&(f=g,null!==d&&null!=(g=Lt(p,d))&&u.push(Wi(p,g,f))),h)break;p=p.return}0<u.length&&(a=new l(a,c,null,n,r),o.push({event:a,listeners:u}))}}if(0==(7&e)){if(l="mouseout"===t||"pointerout"===t,(!(a="mouseover"===t||"pointerover"===t)||n===_t||!(c=n.relatedTarget||n.fromElement)||!yr(c)&&!c[pr])&&(l||a)&&(a=r.window===r?r:(a=r.ownerDocument)?a.defaultView||a.parentWindow:window,l?(l=i,null!==(c=(c=n.relatedTarget||n.toElement)?yr(c):null)&&(c!==(h=jt(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=i),l!==c)){if(u=pn,g="onMouseLeave",d="onMouseEnter",p="mouse","pointerout"!==t&&"pointerover"!==t||(u=Bn,g="onPointerLeave",d="onPointerEnter",p="pointer"),h=null==l?a:_r(l),f=null==c?a:_r(c),(a=new u(g,p+"leave",l,n,r)).target=h,a.relatedTarget=f,g=null,yr(r)===i&&((u=new u(d,p+"enter",c,n,r)).target=f,u.relatedTarget=h,g=u),h=g,l&&c)t:{for(d=c,p=0,f=u=l;f;f=qi(f))p++;for(f=0,g=d;g;g=qi(g))f++;for(;0<p-f;)u=qi(u),p--;for(;0<f-p;)d=qi(d),f--;for(;p--;){if(u===d||null!==d&&u===d.alternate)break t;u=qi(u),d=qi(d)}u=null}else u=null;null!==l&&Ki(o,a,l,u,!1),null!==c&&null!==h&&Ki(o,h,c,u,!0)}if("select"===(l=(a=i?_r(i):window).nodeName&&a.nodeName.toLowerCase())||"input"===l&&"file"===a.type)var m=Qn;else if(Hn(a))if(Yn)m=oi;else{m=ri;var v=ii}else(l=a.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===a.type||"radio"===a.type)&&(m=si);switch(m&&(m=m(t,i))?Wn(o,m,n,r):(v&&v(t,a,i),"focusout"===t&&(v=a._wrapperState)&&v.controlled&&"number"===a.type&&tt(a,"number",a.value)),v=i?_r(i):window,t){case"focusin":(Hn(v)||"true"===v.contentEditable)&&(mi=v,vi=i,yi=null);break;case"focusout":yi=vi=mi=null;break;case"mousedown":bi=!0;break;case"contextmenu":case"mouseup":case"dragend":bi=!1,_i(o,n,r);break;case"selectionchange":if(gi)break;case"keydown":case"keyup":_i(o,n,r)}var y;if(Rn)t:{switch(t){case"compositionstart":var b="onCompositionStart";break t;case"compositionend":b="onCompositionEnd";break t;case"compositionupdate":b="onCompositionUpdate";break t}b=void 0}else jn?zn(t,n)&&(b="onCompositionEnd"):"keydown"===t&&229===n.keyCode&&(b="onCompositionStart");b&&(Dn&&"ko"!==n.locale&&(jn||"onCompositionStart"!==b?"onCompositionEnd"===b&&jn&&(y=tn()):(Ze="value"in(Ye=r)?Ye.value:Ye.textContent,jn=!0)),0<(v=Ji(i,b)).length&&(b=new _n(b,t,null,n,r),o.push({event:b,listeners:v}),(y||null!==(y=Gn(n)))&&(b.data=y))),(y=kn?function(t,e){switch(t){case"compositionend":return Gn(e);case"keypress":return 32!==e.which?null:(Un=!0,Nn);case"textInput":return(t=e.data)===Nn&&Un?null:t;default:return null}}(t,n):function(t,e){if(jn)return"compositionend"===t||!Rn&&zn(t,e)?(t=tn(),$e=Ze=Ye=null,jn=!1,t):null;switch(t){case"paste":default:return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Dn&&"ko"!==e.locale?null:e.data}}(t,n))&&0<(i=Ji(i,"onBeforeInput")).length&&(r=new _n("onBeforeInput","beforeinput",null,n,r),o.push({event:r,listeners:i}),r.data=y)}Ni(o,e)}))}function Wi(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Ji(t,e){for(var n=e+"Capture",i=[];null!==t;){var r=t,s=r.stateNode;5===r.tag&&null!==s&&(r=s,null!=(s=Lt(t,n))&&i.unshift(Wi(t,s,r)),null!=(s=Lt(t,e))&&i.push(Wi(t,s,r))),t=t.return}return i}function qi(t){if(null===t)return null;do{t=t.return}while(t&&5!==t.tag);return t||null}function Ki(t,e,n,i,r){for(var s=e._reactName,o=[];null!==n&&n!==i;){var a=n,l=a.alternate,c=a.stateNode;if(null!==l&&l===i)break;5===a.tag&&null!==c&&(a=c,r?null!=(l=Lt(n,s))&&o.unshift(Wi(n,l,a)):r||null!=(l=Lt(n,s))&&o.push(Wi(n,l,a))),n=n.return}0!==o.length&&t.push({event:e,listeners:o})}var Xi=/\r\n?/g,Qi=/\u0000|\uFFFD/g;function Yi(t){return("string"==typeof t?t:""+t).replace(Xi,"\n").replace(Qi,"")}function Zi(t,e,n){if(e=Yi(e),Yi(t)!==e&&n)throw Error(s(425))}function $i(){}var tr=null,er=null;function nr(t,e){return"textarea"===t||"noscript"===t||"string"==typeof e.children||"number"==typeof e.children||"object"==typeof e.dangerouslySetInnerHTML&&null!==e.dangerouslySetInnerHTML&&null!=e.dangerouslySetInnerHTML.__html}var ir="function"==typeof setTimeout?setTimeout:void 0,rr="function"==typeof clearTimeout?clearTimeout:void 0,sr="function"==typeof Promise?Promise:void 0,or="function"==typeof queueMicrotask?queueMicrotask:void 0!==sr?function(t){return sr.resolve(null).then(t).catch(ar)}:ir;function ar(t){setTimeout((function(){throw t}))}function lr(t,e){var n=e,i=0;do{var r=n.nextSibling;if(t.removeChild(n),r&&8===r.nodeType)if("/$"===(n=r.data)){if(0===i)return t.removeChild(r),void je(e);i--}else"$"!==n&&"$?"!==n&&"$!"!==n||i++;n=r}while(n);je(e)}function cr(t){for(;null!=t;t=t.nextSibling){var e=t.nodeType;if(1===e||3===e)break;if(8===e){if("$"===(e=t.data)||"$!"===e||"$?"===e)break;if("/$"===e)return null}}return t}function ur(t){t=t.previousSibling;for(var e=0;t;){if(8===t.nodeType){var n=t.data;if("$"===n||"$!"===n||"$?"===n){if(0===e)return t;e--}else"/$"===n&&e++}t=t.previousSibling}return null}var hr=Math.random().toString(36).slice(2),dr="__reactFiber$"+hr,fr="__reactProps$"+hr,pr="__reactContainer$"+hr,gr="__reactEvents$"+hr,mr="__reactListeners$"+hr,vr="__reactHandles$"+hr;function yr(t){var e=t[dr];if(e)return e;for(var n=t.parentNode;n;){if(e=n[pr]||n[dr]){if(n=e.alternate,null!==e.child||null!==n&&null!==n.child)for(t=ur(t);null!==t;){if(n=t[dr])return n;t=ur(t)}return e}n=(t=n).parentNode}return null}function br(t){return!(t=t[dr]||t[pr])||5!==t.tag&&6!==t.tag&&13!==t.tag&&3!==t.tag?null:t}function _r(t){if(5===t.tag||6===t.tag)return t.stateNode;throw Error(s(33))}function Ar(t){return t[fr]||null}var wr=[],Cr=-1;function Er(t){return{current:t}}function xr(t){0>Cr||(t.current=wr[Cr],wr[Cr]=null,Cr--)}function Tr(t,e){Cr++,wr[Cr]=t.current,t.current=e}var Sr={},Br=Er(Sr),Pr=Er(!1),Mr=Sr;function Ir(t,e){var n=t.type.contextTypes;if(!n)return Sr;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r,s={};for(r in n)s[r]=e[r];return i&&((t=t.stateNode).__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function Lr(t){return null!=t.childContextTypes}function Or(){xr(Pr),xr(Br)}function Rr(t,e,n){if(Br.current!==Sr)throw Error(s(168));Tr(Br,e),Tr(Pr,n)}function Fr(t,e,n){var i=t.stateNode;if(e=e.childContextTypes,"function"!=typeof i.getChildContext)return n;for(var r in i=i.getChildContext())if(!(r in e))throw Error(s(108,V(t)||"Unknown",r));return D({},n,i)}function kr(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Sr,Mr=Br.current,Tr(Br,t),Tr(Pr,Pr.current),!0}function Dr(t,e,n){var i=t.stateNode;if(!i)throw Error(s(169));n?(t=Fr(t,e,Mr),i.__reactInternalMemoizedMergedChildContext=t,xr(Pr),xr(Br),Tr(Br,t)):xr(Pr),Tr(Pr,n)}var Nr=null,Ur=!1,zr=!1;function Gr(t){null===Nr?Nr=[t]:Nr.push(t)}function jr(){if(!zr&&null!==Nr){zr=!0;var t=0,e=be;try{var n=Nr;for(be=1;t<n.length;t++){var i=n[t];do{i=i(!0)}while(null!==i)}Nr=null,Ur=!1}catch(e){throw null!==Nr&&(Nr=Nr.slice(t+1)),qt($t,jr),e}finally{be=e,zr=!1}}return null}var Vr=[],Hr=0,Wr=null,Jr=0,qr=[],Kr=0,Xr=null,Qr=1,Yr="";function Zr(t,e){Vr[Hr++]=Jr,Vr[Hr++]=Wr,Wr=t,Jr=e}function $r(t,e,n){qr[Kr++]=Qr,qr[Kr++]=Yr,qr[Kr++]=Xr,Xr=t;var i=Qr;t=Yr;var r=32-oe(i)-1;i&=~(1<<r),n+=1;var s=32-oe(e)+r;if(30<s){var o=r-r%5;s=(i&(1<<o)-1).toString(32),i>>=o,r-=o,Qr=1<<32-oe(e)+r|n<<r|i,Yr=s+t}else Qr=1<<s|n<<r|i,Yr=t}function ts(t){null!==t.return&&(Zr(t,1),$r(t,1,0))}function es(t){for(;t===Wr;)Wr=Vr[--Hr],Vr[Hr]=null,Jr=Vr[--Hr],Vr[Hr]=null;for(;t===Xr;)Xr=qr[--Kr],qr[Kr]=null,Yr=qr[--Kr],qr[Kr]=null,Qr=qr[--Kr],qr[Kr]=null}var ns=null,is=null,rs=!1,ss=null;function os(t,e){var n=Lc(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,null===(e=t.deletions)?(t.deletions=[n],t.flags|=16):e.push(n)}function as(t,e){switch(t.tag){case 5:var n=t.type;return null!==(e=1!==e.nodeType||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e)&&(t.stateNode=e,ns=t,is=cr(e.firstChild),!0);case 6:return null!==(e=""===t.pendingProps||3!==e.nodeType?null:e)&&(t.stateNode=e,ns=t,is=null,!0);case 13:return null!==(e=8!==e.nodeType?null:e)&&(n=null!==Xr?{id:Qr,overflow:Yr}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},(n=Lc(18,null,null,0)).stateNode=e,n.return=t,t.child=n,ns=t,is=null,!0);default:return!1}}function ls(t){return 0!=(1&t.mode)&&0==(128&t.flags)}function cs(t){if(rs){var e=is;if(e){var n=e;if(!as(t,e)){if(ls(t))throw Error(s(418));e=cr(n.nextSibling);var i=ns;e&&as(t,e)?os(i,n):(t.flags=-4097&t.flags|2,rs=!1,ns=t)}}else{if(ls(t))throw Error(s(418));t.flags=-4097&t.flags|2,rs=!1,ns=t}}}function us(t){for(t=t.return;null!==t&&5!==t.tag&&3!==t.tag&&13!==t.tag;)t=t.return;ns=t}function hs(t){if(t!==ns)return!1;if(!rs)return us(t),rs=!0,!1;var e;if((e=3!==t.tag)&&!(e=5!==t.tag)&&(e="head"!==(e=t.type)&&"body"!==e&&!nr(t.type,t.memoizedProps)),e&&(e=is)){if(ls(t))throw ds(),Error(s(418));for(;e;)os(t,e),e=cr(e.nextSibling)}if(us(t),13===t.tag){if(!(t=null!==(t=t.memoizedState)?t.dehydrated:null))throw Error(s(317));t:{for(t=t.nextSibling,e=0;t;){if(8===t.nodeType){var n=t.data;if("/$"===n){if(0===e){is=cr(t.nextSibling);break t}e--}else"$"!==n&&"$!"!==n&&"$?"!==n||e++}t=t.nextSibling}is=null}}else is=ns?cr(t.stateNode.nextSibling):null;return!0}function ds(){for(var t=is;t;)t=cr(t.nextSibling)}function fs(){is=ns=null,rs=!1}function ps(t){null===ss?ss=[t]:ss.push(t)}var gs=_.ReactCurrentBatchConfig;function ms(t,e){if(t&&t.defaultProps){for(var n in e=D({},e),t=t.defaultProps)void 0===e[n]&&(e[n]=t[n]);return e}return e}var vs=Er(null),ys=null,bs=null,_s=null;function As(){_s=bs=ys=null}function ws(t){var e=vs.current;xr(vs),t._currentValue=e}function Cs(t,e,n){for(;null!==t;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,null!==i&&(i.childLanes|=e)):null!==i&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function Es(t,e){ys=t,_s=bs=null,null!==(t=t.dependencies)&&null!==t.firstContext&&(0!=(t.lanes&e)&&(_a=!0),t.firstContext=null)}function xs(t){var e=t._currentValue;if(_s!==t)if(t={context:t,memoizedValue:e,next:null},null===bs){if(null===ys)throw Error(s(308));bs=t,ys.dependencies={lanes:0,firstContext:t}}else bs=bs.next=t;return e}var Ts=null;function Ss(t){null===Ts?Ts=[t]:Ts.push(t)}function Bs(t,e,n,i){var r=e.interleaved;return null===r?(n.next=n,Ss(e)):(n.next=r.next,r.next=n),e.interleaved=n,Ps(t,i)}function Ps(t,e){t.lanes|=e;var n=t.alternate;for(null!==n&&(n.lanes|=e),n=t,t=t.return;null!==t;)t.childLanes|=e,null!==(n=t.alternate)&&(n.childLanes|=e),n=t,t=t.return;return 3===n.tag?n.stateNode:null}var Ms=!1;function Is(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Ls(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Os(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Rs(t,e,n){var i=t.updateQueue;if(null===i)return null;if(i=i.shared,0!=(2&Pl)){var r=i.pending;return null===r?e.next=e:(e.next=r.next,r.next=e),i.pending=e,Ps(t,n)}return null===(r=i.interleaved)?(e.next=e,Ss(i)):(e.next=r.next,r.next=e),i.interleaved=e,Ps(t,n)}function Fs(t,e,n){if(null!==(e=e.updateQueue)&&(e=e.shared,0!=(4194240&n))){var i=e.lanes;n|=i&=t.pendingLanes,e.lanes=n,ye(t,n)}}function ks(t,e){var n=t.updateQueue,i=t.alternate;if(null!==i&&n===(i=i.updateQueue)){var r=null,s=null;if(null!==(n=n.firstBaseUpdate)){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===s?r=s=o:s=s.next=o,n=n.next}while(null!==n);null===s?r=s=e:s=s.next=e}else r=s=e;return n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,effects:i.effects},void(t.updateQueue=n)}null===(t=n.lastBaseUpdate)?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Ds(t,e,n,i){var r=t.updateQueue;Ms=!1;var s=r.firstBaseUpdate,o=r.lastBaseUpdate,a=r.shared.pending;if(null!==a){r.shared.pending=null;var l=a,c=l.next;l.next=null,null===o?s=c:o.next=c,o=l;var u=t.alternate;null!==u&&(a=(u=u.updateQueue).lastBaseUpdate)!==o&&(null===a?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l)}if(null!==s){var h=r.baseState;for(o=0,u=c=l=null,a=s;;){var d=a.lane,f=a.eventTime;if((i&d)===d){null!==u&&(u=u.next={eventTime:f,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});t:{var p=t,g=a;switch(d=e,f=n,g.tag){case 1:if("function"==typeof(p=g.payload)){h=p.call(f,h,d);break t}h=p;break t;case 3:p.flags=-65537&p.flags|128;case 0:if(null==(d="function"==typeof(p=g.payload)?p.call(f,h,d):p))break t;h=D({},h,d);break t;case 2:Ms=!0}}null!==a.callback&&0!==a.lane&&(t.flags|=64,null===(d=r.effects)?r.effects=[a]:d.push(a))}else f={eventTime:f,lane:d,tag:a.tag,payload:a.payload,callback:a.callback,next:null},null===u?(c=u=f,l=h):u=u.next=f,o|=d;if(null===(a=a.next)){if(null===(a=r.shared.pending))break;a=(d=a).next,d.next=null,r.lastBaseUpdate=d,r.shared.pending=null}}if(null===u&&(l=h),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=u,null!==(e=r.shared.interleaved)){r=e;do{o|=r.lane,r=r.next}while(r!==e)}else null===s&&(r.shared.lanes=0);Dl|=o,t.lanes=o,t.memoizedState=h}}function Ns(t,e,n){if(t=e.effects,e.effects=null,null!==t)for(e=0;e<t.length;e++){var i=t[e],r=i.callback;if(null!==r){if(i.callback=null,i=n,"function"!=typeof r)throw Error(s(191,r));r.call(i)}}}var Us=(new i.Component).refs;function zs(t,e,n,i){n=null==(n=n(i,e=t.memoizedState))?e:D({},e,n),t.memoizedState=n,0===t.lanes&&(t.updateQueue.baseState=n)}var Gs={isMounted:function(t){return!!(t=t._reactInternals)&&jt(t)===t},enqueueSetState:function(t,e,n){t=t._reactInternals;var i=ec(),r=nc(t),s=Os(i,r);s.payload=e,null!=n&&(s.callback=n),null!==(e=Rs(t,s,r))&&(ic(e,t,r,i),Fs(e,t,r))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=ec(),r=nc(t),s=Os(i,r);s.tag=1,s.payload=e,null!=n&&(s.callback=n),null!==(e=Rs(t,s,r))&&(ic(e,t,r,i),Fs(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=ec(),i=nc(t),r=Os(n,i);r.tag=2,null!=e&&(r.callback=e),null!==(e=Rs(t,r,i))&&(ic(e,t,i,n),Fs(e,t,i))}};function js(t,e,n,i,r,s,o){return"function"==typeof(t=t.stateNode).shouldComponentUpdate?t.shouldComponentUpdate(i,s,o):!(e.prototype&&e.prototype.isPureReactComponent&&li(n,i)&&li(r,s))}function Vs(t,e,n){var i=!1,r=Sr,s=e.contextType;return"object"==typeof s&&null!==s?s=xs(s):(r=Lr(e)?Mr:Br.current,s=(i=null!=(i=e.contextTypes))?Ir(t,r):Sr),e=new e(n,s),t.memoizedState=null!==e.state&&void 0!==e.state?e.state:null,e.updater=Gs,t.stateNode=e,e._reactInternals=t,i&&((t=t.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=s),e}function Hs(t,e,n,i){t=e.state,"function"==typeof e.componentWillReceiveProps&&e.componentWillReceiveProps(n,i),"function"==typeof e.UNSAFE_componentWillReceiveProps&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&Gs.enqueueReplaceState(e,e.state,null)}function Ws(t,e,n,i){var r=t.stateNode;r.props=n,r.state=t.memoizedState,r.refs=Us,Is(t);var s=e.contextType;"object"==typeof s&&null!==s?r.context=xs(s):(s=Lr(e)?Mr:Br.current,r.context=Ir(t,s)),r.state=t.memoizedState,"function"==typeof(s=e.getDerivedStateFromProps)&&(zs(t,e,s,n),r.state=t.memoizedState),"function"==typeof e.getDerivedStateFromProps||"function"==typeof r.getSnapshotBeforeUpdate||"function"!=typeof r.UNSAFE_componentWillMount&&"function"!=typeof r.componentWillMount||(e=r.state,"function"==typeof r.componentWillMount&&r.componentWillMount(),"function"==typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),e!==r.state&&Gs.enqueueReplaceState(r,r.state,null),Ds(t,n,r,i),r.state=t.memoizedState),"function"==typeof r.componentDidMount&&(t.flags|=4194308)}function Js(t,e,n){if(null!==(t=n.ref)&&"function"!=typeof t&&"object"!=typeof t){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(s(309));var i=n.stateNode}if(!i)throw Error(s(147,t));var r=i,o=""+t;return null!==e&&null!==e.ref&&"function"==typeof e.ref&&e.ref._stringRef===o?e.ref:(e=function(t){var e=r.refs;e===Us&&(e=r.refs={}),null===t?delete e[o]:e[o]=t},e._stringRef=o,e)}if("string"!=typeof t)throw Error(s(284));if(!n._owner)throw Error(s(290,t))}return t}function qs(t,e){throw t=Object.prototype.toString.call(e),Error(s(31,"[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Ks(t){return(0,t._init)(t._payload)}function Xs(t){function e(e,n){if(t){var i=e.deletions;null===i?(e.deletions=[n],e.flags|=16):i.push(n)}}function n(n,i){if(!t)return null;for(;null!==i;)e(n,i),i=i.sibling;return null}function i(t,e){for(t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function r(t,e){return(t=Rc(t,e)).index=0,t.sibling=null,t}function o(e,n,i){return e.index=i,t?null!==(i=e.alternate)?(i=i.index)<n?(e.flags|=2,n):i:(e.flags|=2,n):(e.flags|=1048576,n)}function a(e){return t&&null===e.alternate&&(e.flags|=2),e}function l(t,e,n,i){return null===e||6!==e.tag?((e=Nc(n,t.mode,i)).return=t,e):((e=r(e,n)).return=t,e)}function c(t,e,n,i){var s=n.type;return s===C?h(t,e,n.props.children,i,n.key):null!==e&&(e.elementType===s||"object"==typeof s&&null!==s&&s.$$typeof===L&&Ks(s)===e.type)?((i=r(e,n.props)).ref=Js(t,e,n),i.return=t,i):((i=Fc(n.type,n.key,n.props,null,t.mode,i)).ref=Js(t,e,n),i.return=t,i)}function u(t,e,n,i){return null===e||4!==e.tag||e.stateNode.containerInfo!==n.containerInfo||e.stateNode.implementation!==n.implementation?((e=Uc(n,t.mode,i)).return=t,e):((e=r(e,n.children||[])).return=t,e)}function h(t,e,n,i,s){return null===e||7!==e.tag?((e=kc(n,t.mode,i,s)).return=t,e):((e=r(e,n)).return=t,e)}function d(t,e,n){if("string"==typeof e&&""!==e||"number"==typeof e)return(e=Nc(""+e,t.mode,n)).return=t,e;if("object"==typeof e&&null!==e){switch(e.$$typeof){case A:return(n=Fc(e.type,e.key,e.props,null,t.mode,n)).ref=Js(t,null,e),n.return=t,n;case w:return(e=Uc(e,t.mode,n)).return=t,e;case L:return d(t,(0,e._init)(e._payload),n)}if(et(e)||F(e))return(e=kc(e,t.mode,n,null)).return=t,e;qs(t,e)}return null}function f(t,e,n,i){var r=null!==e?e.key:null;if("string"==typeof n&&""!==n||"number"==typeof n)return null!==r?null:l(t,e,""+n,i);if("object"==typeof n&&null!==n){switch(n.$$typeof){case A:return n.key===r?c(t,e,n,i):null;case w:return n.key===r?u(t,e,n,i):null;case L:return f(t,e,(r=n._init)(n._payload),i)}if(et(n)||F(n))return null!==r?null:h(t,e,n,i,null);qs(t,n)}return null}function p(t,e,n,i,r){if("string"==typeof i&&""!==i||"number"==typeof i)return l(e,t=t.get(n)||null,""+i,r);if("object"==typeof i&&null!==i){switch(i.$$typeof){case A:return c(e,t=t.get(null===i.key?n:i.key)||null,i,r);case w:return u(e,t=t.get(null===i.key?n:i.key)||null,i,r);case L:return p(t,e,n,(0,i._init)(i._payload),r)}if(et(i)||F(i))return h(e,t=t.get(n)||null,i,r,null);qs(e,i)}return null}function g(r,s,a,l){for(var c=null,u=null,h=s,g=s=0,m=null;null!==h&&g<a.length;g++){h.index>g?(m=h,h=null):m=h.sibling;var v=f(r,h,a[g],l);if(null===v){null===h&&(h=m);break}t&&h&&null===v.alternate&&e(r,h),s=o(v,s,g),null===u?c=v:u.sibling=v,u=v,h=m}if(g===a.length)return n(r,h),rs&&Zr(r,g),c;if(null===h){for(;g<a.length;g++)null!==(h=d(r,a[g],l))&&(s=o(h,s,g),null===u?c=h:u.sibling=h,u=h);return rs&&Zr(r,g),c}for(h=i(r,h);g<a.length;g++)null!==(m=p(h,r,g,a[g],l))&&(t&&null!==m.alternate&&h.delete(null===m.key?g:m.key),s=o(m,s,g),null===u?c=m:u.sibling=m,u=m);return t&&h.forEach((function(t){return e(r,t)})),rs&&Zr(r,g),c}function m(r,a,l,c){var u=F(l);if("function"!=typeof u)throw Error(s(150));if(null==(l=u.call(l)))throw Error(s(151));for(var h=u=null,g=a,m=a=0,v=null,y=l.next();null!==g&&!y.done;m++,y=l.next()){g.index>m?(v=g,g=null):v=g.sibling;var b=f(r,g,y.value,c);if(null===b){null===g&&(g=v);break}t&&g&&null===b.alternate&&e(r,g),a=o(b,a,m),null===h?u=b:h.sibling=b,h=b,g=v}if(y.done)return n(r,g),rs&&Zr(r,m),u;if(null===g){for(;!y.done;m++,y=l.next())null!==(y=d(r,y.value,c))&&(a=o(y,a,m),null===h?u=y:h.sibling=y,h=y);return rs&&Zr(r,m),u}for(g=i(r,g);!y.done;m++,y=l.next())null!==(y=p(g,r,m,y.value,c))&&(t&&null!==y.alternate&&g.delete(null===y.key?m:y.key),a=o(y,a,m),null===h?u=y:h.sibling=y,h=y);return t&&g.forEach((function(t){return e(r,t)})),rs&&Zr(r,m),u}return function t(i,s,o,l){if("object"==typeof o&&null!==o&&o.type===C&&null===o.key&&(o=o.props.children),"object"==typeof o&&null!==o){switch(o.$$typeof){case A:t:{for(var c=o.key,u=s;null!==u;){if(u.key===c){if((c=o.type)===C){if(7===u.tag){n(i,u.sibling),(s=r(u,o.props.children)).return=i,i=s;break t}}else if(u.elementType===c||"object"==typeof c&&null!==c&&c.$$typeof===L&&Ks(c)===u.type){n(i,u.sibling),(s=r(u,o.props)).ref=Js(i,u,o),s.return=i,i=s;break t}n(i,u);break}e(i,u),u=u.sibling}o.type===C?((s=kc(o.props.children,i.mode,l,o.key)).return=i,i=s):((l=Fc(o.type,o.key,o.props,null,i.mode,l)).ref=Js(i,s,o),l.return=i,i=l)}return a(i);case w:t:{for(u=o.key;null!==s;){if(s.key===u){if(4===s.tag&&s.stateNode.containerInfo===o.containerInfo&&s.stateNode.implementation===o.implementation){n(i,s.sibling),(s=r(s,o.children||[])).return=i,i=s;break t}n(i,s);break}e(i,s),s=s.sibling}(s=Uc(o,i.mode,l)).return=i,i=s}return a(i);case L:return t(i,s,(u=o._init)(o._payload),l)}if(et(o))return g(i,s,o,l);if(F(o))return m(i,s,o,l);qs(i,o)}return"string"==typeof o&&""!==o||"number"==typeof o?(o=""+o,null!==s&&6===s.tag?(n(i,s.sibling),(s=r(s,o)).return=i,i=s):(n(i,s),(s=Nc(o,i.mode,l)).return=i,i=s),a(i)):n(i,s)}}var Qs=Xs(!0),Ys=Xs(!1),Zs={},$s=Er(Zs),to=Er(Zs),eo=Er(Zs);function no(t){if(t===Zs)throw Error(s(174));return t}function io(t,e){switch(Tr(eo,e),Tr(to,t),Tr($s,Zs),t=e.nodeType){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:lt(null,"");break;default:e=lt(e=(t=8===t?e.parentNode:e).namespaceURI||null,t=t.tagName)}xr($s),Tr($s,e)}function ro(){xr($s),xr(to),xr(eo)}function so(t){no(eo.current);var e=no($s.current),n=lt(e,t.type);e!==n&&(Tr(to,t),Tr($s,n))}function oo(t){to.current===t&&(xr($s),xr(to))}var ao=Er(0);function lo(t){for(var e=t;null!==e;){if(13===e.tag){var n=e.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return e}else if(19===e.tag&&void 0!==e.memoizedProps.revealOrder){if(0!=(128&e.flags))return e}else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break;for(;null===e.sibling;){if(null===e.return||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var co=[];function uo(){for(var t=0;t<co.length;t++)co[t]._workInProgressVersionPrimary=null;co.length=0}var ho=_.ReactCurrentDispatcher,fo=_.ReactCurrentBatchConfig,po=0,go=null,mo=null,vo=null,yo=!1,bo=!1,_o=0,Ao=0;function wo(){throw Error(s(321))}function Co(t,e){if(null===e)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!ai(t[n],e[n]))return!1;return!0}function Eo(t,e,n,i,r,o){if(po=o,go=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,ho.current=null===t||null===t.memoizedState?aa:la,t=n(i,r),bo){o=0;do{if(bo=!1,_o=0,25<=o)throw Error(s(301));o+=1,vo=mo=null,e.updateQueue=null,ho.current=ca,t=n(i,r)}while(bo)}if(ho.current=oa,e=null!==mo&&null!==mo.next,po=0,vo=mo=go=null,yo=!1,e)throw Error(s(300));return t}function xo(){var t=0!==_o;return _o=0,t}function To(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===vo?go.memoizedState=vo=t:vo=vo.next=t,vo}function So(){if(null===mo){var t=go.alternate;t=null!==t?t.memoizedState:null}else t=mo.next;var e=null===vo?go.memoizedState:vo.next;if(null!==e)vo=e,mo=t;else{if(null===t)throw Error(s(310));t={memoizedState:(mo=t).memoizedState,baseState:mo.baseState,baseQueue:mo.baseQueue,queue:mo.queue,next:null},null===vo?go.memoizedState=vo=t:vo=vo.next=t}return vo}function Bo(t,e){return"function"==typeof e?e(t):e}function Po(t){var e=So(),n=e.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=t;var i=mo,r=i.baseQueue,o=n.pending;if(null!==o){if(null!==r){var a=r.next;r.next=o.next,o.next=a}i.baseQueue=r=o,n.pending=null}if(null!==r){o=r.next,i=i.baseState;var l=a=null,c=null,u=o;do{var h=u.lane;if((po&h)===h)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),i=u.hasEagerState?u.eagerState:t(i,u.action);else{var d={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=d,a=i):c=c.next=d,go.lanes|=h,Dl|=h}u=u.next}while(null!==u&&u!==o);null===c?a=i:c.next=l,ai(i,e.memoizedState)||(_a=!0),e.memoizedState=i,e.baseState=a,e.baseQueue=c,n.lastRenderedState=i}if(null!==(t=n.interleaved)){r=t;do{o=r.lane,go.lanes|=o,Dl|=o,r=r.next}while(r!==t)}else null===r&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Mo(t){var e=So(),n=e.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=t;var i=n.dispatch,r=n.pending,o=e.memoizedState;if(null!==r){n.pending=null;var a=r=r.next;do{o=t(o,a.action),a=a.next}while(a!==r);ai(o,e.memoizedState)||(_a=!0),e.memoizedState=o,null===e.baseQueue&&(e.baseState=o),n.lastRenderedState=o}return[o,i]}function Io(){}function Lo(t,e){var n=go,i=So(),r=e(),o=!ai(i.memoizedState,r);if(o&&(i.memoizedState=r,_a=!0),i=i.queue,Ho(Fo.bind(null,n,i,t),[t]),i.getSnapshot!==e||o||null!==vo&&1&vo.memoizedState.tag){if(n.flags|=2048,Uo(9,Ro.bind(null,n,i,r,e),void 0,null),null===Ml)throw Error(s(349));0!=(30&po)||Oo(n,e,r)}return r}function Oo(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},null===(e=go.updateQueue)?(e={lastEffect:null,stores:null},go.updateQueue=e,e.stores=[t]):null===(n=e.stores)?e.stores=[t]:n.push(t)}function Ro(t,e,n,i){e.value=n,e.getSnapshot=i,ko(e)&&Do(t)}function Fo(t,e,n){return n((function(){ko(e)&&Do(t)}))}function ko(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!ai(t,n)}catch(t){return!0}}function Do(t){var e=Ps(t,1);null!==e&&ic(e,t,1,-1)}function No(t){var e=To();return"function"==typeof t&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Bo,lastRenderedState:t},e.queue=t,t=t.dispatch=na.bind(null,go,t),[e.memoizedState,t]}function Uo(t,e,n,i){return t={tag:t,create:e,destroy:n,deps:i,next:null},null===(e=go.updateQueue)?(e={lastEffect:null,stores:null},go.updateQueue=e,e.lastEffect=t.next=t):null===(n=e.lastEffect)?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t),t}function zo(){return So().memoizedState}function Go(t,e,n,i){var r=To();go.flags|=t,r.memoizedState=Uo(1|e,n,void 0,void 0===i?null:i)}function jo(t,e,n,i){var r=So();i=void 0===i?null:i;var s=void 0;if(null!==mo){var o=mo.memoizedState;if(s=o.destroy,null!==i&&Co(i,o.deps))return void(r.memoizedState=Uo(e,n,s,i))}go.flags|=t,r.memoizedState=Uo(1|e,n,s,i)}function Vo(t,e){return Go(8390656,8,t,e)}function Ho(t,e){return jo(2048,8,t,e)}function Wo(t,e){return jo(4,2,t,e)}function Jo(t,e){return jo(4,4,t,e)}function qo(t,e){return"function"==typeof e?(t=t(),e(t),function(){e(null)}):null!=e?(t=t(),e.current=t,function(){e.current=null}):void 0}function Ko(t,e,n){return n=null!=n?n.concat([t]):null,jo(4,4,qo.bind(null,e,t),n)}function Xo(){}function Qo(t,e){var n=So();e=void 0===e?null:e;var i=n.memoizedState;return null!==i&&null!==e&&Co(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function Yo(t,e){var n=So();e=void 0===e?null:e;var i=n.memoizedState;return null!==i&&null!==e&&Co(e,i[1])?i[0]:(t=t(),n.memoizedState=[t,e],t)}function Zo(t,e,n){return 0==(21&po)?(t.baseState&&(t.baseState=!1,_a=!0),t.memoizedState=n):(ai(n,e)||(n=ge(),go.lanes|=n,Dl|=n,t.baseState=!0),e)}function $o(t,e){var n=be;be=0!==n&&4>n?n:4,t(!0);var i=fo.transition;fo.transition={};try{t(!1),e()}finally{be=n,fo.transition=i}}function ta(){return So().memoizedState}function ea(t,e,n){var i=nc(t);n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},ia(t)?ra(e,n):null!==(n=Bs(t,e,n,i))&&(ic(n,t,i,ec()),sa(n,e,i))}function na(t,e,n){var i=nc(t),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(ia(t))ra(e,r);else{var s=t.alternate;if(0===t.lanes&&(null===s||0===s.lanes)&&null!==(s=e.lastRenderedReducer))try{var o=e.lastRenderedState,a=s(o,n);if(r.hasEagerState=!0,r.eagerState=a,ai(a,o)){var l=e.interleaved;return null===l?(r.next=r,Ss(e)):(r.next=l.next,l.next=r),void(e.interleaved=r)}}catch(t){}null!==(n=Bs(t,e,r,i))&&(ic(n,t,i,r=ec()),sa(n,e,i))}}function ia(t){var e=t.alternate;return t===go||null!==e&&e===go}function ra(t,e){bo=yo=!0;var n=t.pending;null===n?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function sa(t,e,n){if(0!=(4194240&n)){var i=e.lanes;n|=i&=t.pendingLanes,e.lanes=n,ye(t,n)}}var oa={readContext:xs,useCallback:wo,useContext:wo,useEffect:wo,useImperativeHandle:wo,useInsertionEffect:wo,useLayoutEffect:wo,useMemo:wo,useReducer:wo,useRef:wo,useState:wo,useDebugValue:wo,useDeferredValue:wo,useTransition:wo,useMutableSource:wo,useSyncExternalStore:wo,useId:wo,unstable_isNewReconciler:!1},aa={readContext:xs,useCallback:function(t,e){return To().memoizedState=[t,void 0===e?null:e],t},useContext:xs,useEffect:Vo,useImperativeHandle:function(t,e,n){return n=null!=n?n.concat([t]):null,Go(4194308,4,qo.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Go(4194308,4,t,e)},useInsertionEffect:function(t,e){return Go(4,2,t,e)},useMemo:function(t,e){var n=To();return e=void 0===e?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var i=To();return e=void 0!==n?n(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=ea.bind(null,go,t),[i.memoizedState,t]},useRef:function(t){return t={current:t},To().memoizedState=t},useState:No,useDebugValue:Xo,useDeferredValue:function(t){return To().memoizedState=t},useTransition:function(){var t=No(!1),e=t[0];return t=$o.bind(null,t[1]),To().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var i=go,r=To();if(rs){if(void 0===n)throw Error(s(407));n=n()}else{if(n=e(),null===Ml)throw Error(s(349));0!=(30&po)||Oo(i,e,n)}r.memoizedState=n;var o={value:n,getSnapshot:e};return r.queue=o,Vo(Fo.bind(null,i,o,t),[t]),i.flags|=2048,Uo(9,Ro.bind(null,i,o,n,e),void 0,null),n},useId:function(){var t=To(),e=Ml.identifierPrefix;if(rs){var n=Yr;e=":"+e+"R"+(n=(Qr&~(1<<32-oe(Qr)-1)).toString(32)+n),0<(n=_o++)&&(e+="H"+n.toString(32)),e+=":"}else e=":"+e+"r"+(n=Ao++).toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},la={readContext:xs,useCallback:Qo,useContext:xs,useEffect:Ho,useImperativeHandle:Ko,useInsertionEffect:Wo,useLayoutEffect:Jo,useMemo:Yo,useReducer:Po,useRef:zo,useState:function(){return Po(Bo)},useDebugValue:Xo,useDeferredValue:function(t){return Zo(So(),mo.memoizedState,t)},useTransition:function(){return[Po(Bo)[0],So().memoizedState]},useMutableSource:Io,useSyncExternalStore:Lo,useId:ta,unstable_isNewReconciler:!1},ca={readContext:xs,useCallback:Qo,useContext:xs,useEffect:Ho,useImperativeHandle:Ko,useInsertionEffect:Wo,useLayoutEffect:Jo,useMemo:Yo,useReducer:Mo,useRef:zo,useState:function(){return Mo(Bo)},useDebugValue:Xo,useDeferredValue:function(t){var e=So();return null===mo?e.memoizedState=t:Zo(e,mo.memoizedState,t)},useTransition:function(){return[Mo(Bo)[0],So().memoizedState]},useMutableSource:Io,useSyncExternalStore:Lo,useId:ta,unstable_isNewReconciler:!1};function ua(t,e){try{var n="",i=e;do{n+=G(i),i=i.return}while(i);var r=n}catch(t){r="\nError generating stack: "+t.message+"\n"+t.stack}return{value:t,source:e,stack:r,digest:null}}function ha(t,e,n){return{value:t,source:null,stack:null!=n?n:null,digest:null!=e?e:null}}function da(t,e){try{console.error(e.value)}catch(t){setTimeout((function(){throw t}))}}var fa="function"==typeof WeakMap?WeakMap:Map;function pa(t,e,n){(n=Os(-1,n)).tag=3,n.payload={element:null};var i=e.value;return n.callback=function(){Wl||(Wl=!0,Jl=i),da(0,e)},n}function ga(t,e,n){(n=Os(-1,n)).tag=3;var i=t.type.getDerivedStateFromError;if("function"==typeof i){var r=e.value;n.payload=function(){return i(r)},n.callback=function(){da(0,e)}}var s=t.stateNode;return null!==s&&"function"==typeof s.componentDidCatch&&(n.callback=function(){da(0,e),"function"!=typeof i&&(null===ql?ql=new Set([this]):ql.add(this));var t=e.stack;this.componentDidCatch(e.value,{componentStack:null!==t?t:""})}),n}function ma(t,e,n){var i=t.pingCache;if(null===i){i=t.pingCache=new fa;var r=new Set;i.set(e,r)}else void 0===(r=i.get(e))&&(r=new Set,i.set(e,r));r.has(n)||(r.add(n),t=Tc.bind(null,t,e,n),e.then(t,t))}function va(t){do{var e;if((e=13===t.tag)&&(e=null===(e=t.memoizedState)||null!==e.dehydrated),e)return t;t=t.return}while(null!==t);return null}function ya(t,e,n,i,r){return 0==(1&t.mode)?(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((e=Os(-1,1)).tag=2,Rs(n,e,1))),n.lanes|=1),t):(t.flags|=65536,t.lanes=r,t)}var ba=_.ReactCurrentOwner,_a=!1;function Aa(t,e,n,i){e.child=null===t?Ys(e,null,n,i):Qs(e,t.child,n,i)}function wa(t,e,n,i,r){n=n.render;var s=e.ref;return Es(e,r),i=Eo(t,e,n,i,s,r),n=xo(),null===t||_a?(rs&&n&&ts(e),e.flags|=1,Aa(t,e,i,r),e.child):(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,Wa(t,e,r))}function Ca(t,e,n,i,r){if(null===t){var s=n.type;return"function"!=typeof s||Oc(s)||void 0!==s.defaultProps||null!==n.compare||void 0!==n.defaultProps?((t=Fc(n.type,null,i,e,e.mode,r)).ref=e.ref,t.return=e,e.child=t):(e.tag=15,e.type=s,Ea(t,e,s,i,r))}if(s=t.child,0==(t.lanes&r)){var o=s.memoizedProps;if((n=null!==(n=n.compare)?n:li)(o,i)&&t.ref===e.ref)return Wa(t,e,r)}return e.flags|=1,(t=Rc(s,i)).ref=e.ref,t.return=e,e.child=t}function Ea(t,e,n,i,r){if(null!==t){var s=t.memoizedProps;if(li(s,i)&&t.ref===e.ref){if(_a=!1,e.pendingProps=i=s,0==(t.lanes&r))return e.lanes=t.lanes,Wa(t,e,r);0!=(131072&t.flags)&&(_a=!0)}}return Sa(t,e,n,i,r)}function xa(t,e,n){var i=e.pendingProps,r=i.children,s=null!==t?t.memoizedState:null;if("hidden"===i.mode)if(0==(1&e.mode))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Tr(Rl,Ol),Ol|=n;else{if(0==(1073741824&n))return t=null!==s?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Tr(Rl,Ol),Ol|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=null!==s?s.baseLanes:n,Tr(Rl,Ol),Ol|=i}else null!==s?(i=s.baseLanes|n,e.memoizedState=null):i=n,Tr(Rl,Ol),Ol|=i;return Aa(t,e,r,n),e.child}function Ta(t,e){var n=e.ref;(null===t&&null!==n||null!==t&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Sa(t,e,n,i,r){var s=Lr(n)?Mr:Br.current;return s=Ir(e,s),Es(e,r),n=Eo(t,e,n,i,s,r),i=xo(),null===t||_a?(rs&&i&&ts(e),e.flags|=1,Aa(t,e,n,r),e.child):(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,Wa(t,e,r))}function Ba(t,e,n,i,r){if(Lr(n)){var s=!0;kr(e)}else s=!1;if(Es(e,r),null===e.stateNode)Ha(t,e),Vs(e,n,i),Ws(e,n,i,r),i=!0;else if(null===t){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=n.contextType;c="object"==typeof c&&null!==c?xs(c):Ir(e,c=Lr(n)?Mr:Br.current);var u=n.getDerivedStateFromProps,h="function"==typeof u||"function"==typeof o.getSnapshotBeforeUpdate;h||"function"!=typeof o.UNSAFE_componentWillReceiveProps&&"function"!=typeof o.componentWillReceiveProps||(a!==i||l!==c)&&Hs(e,o,i,c),Ms=!1;var d=e.memoizedState;o.state=d,Ds(e,i,o,r),l=e.memoizedState,a!==i||d!==l||Pr.current||Ms?("function"==typeof u&&(zs(e,n,u,i),l=e.memoizedState),(a=Ms||js(e,n,a,i,d,l,c))?(h||"function"!=typeof o.UNSAFE_componentWillMount&&"function"!=typeof o.componentWillMount||("function"==typeof o.componentWillMount&&o.componentWillMount(),"function"==typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"==typeof o.componentDidMount&&(e.flags|=4194308)):("function"==typeof o.componentDidMount&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=l),o.props=i,o.state=l,o.context=c,i=a):("function"==typeof o.componentDidMount&&(e.flags|=4194308),i=!1)}else{o=e.stateNode,Ls(t,e),a=e.memoizedProps,c=e.type===e.elementType?a:ms(e.type,a),o.props=c,h=e.pendingProps,d=o.context,l="object"==typeof(l=n.contextType)&&null!==l?xs(l):Ir(e,l=Lr(n)?Mr:Br.current);var f=n.getDerivedStateFromProps;(u="function"==typeof f||"function"==typeof o.getSnapshotBeforeUpdate)||"function"!=typeof o.UNSAFE_componentWillReceiveProps&&"function"!=typeof o.componentWillReceiveProps||(a!==h||d!==l)&&Hs(e,o,i,l),Ms=!1,d=e.memoizedState,o.state=d,Ds(e,i,o,r);var p=e.memoizedState;a!==h||d!==p||Pr.current||Ms?("function"==typeof f&&(zs(e,n,f,i),p=e.memoizedState),(c=Ms||js(e,n,c,i,d,p,l)||!1)?(u||"function"!=typeof o.UNSAFE_componentWillUpdate&&"function"!=typeof o.componentWillUpdate||("function"==typeof o.componentWillUpdate&&o.componentWillUpdate(i,p,l),"function"==typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(i,p,l)),"function"==typeof o.componentDidUpdate&&(e.flags|=4),"function"==typeof o.getSnapshotBeforeUpdate&&(e.flags|=1024)):("function"!=typeof o.componentDidUpdate||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),"function"!=typeof o.getSnapshotBeforeUpdate||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=p),o.props=i,o.state=p,o.context=l,i=c):("function"!=typeof o.componentDidUpdate||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),"function"!=typeof o.getSnapshotBeforeUpdate||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),i=!1)}return Pa(t,e,n,i,s,r)}function Pa(t,e,n,i,r,s){Ta(t,e);var o=0!=(128&e.flags);if(!i&&!o)return r&&Dr(e,n,!1),Wa(t,e,s);i=e.stateNode,ba.current=e;var a=o&&"function"!=typeof n.getDerivedStateFromError?null:i.render();return e.flags|=1,null!==t&&o?(e.child=Qs(e,t.child,null,s),e.child=Qs(e,null,a,s)):Aa(t,e,a,s),e.memoizedState=i.state,r&&Dr(e,n,!0),e.child}function Ma(t){var e=t.stateNode;e.pendingContext?Rr(0,e.pendingContext,e.pendingContext!==e.context):e.context&&Rr(0,e.context,!1),io(t,e.containerInfo)}function Ia(t,e,n,i,r){return fs(),ps(r),e.flags|=256,Aa(t,e,n,i),e.child}var La,Oa,Ra,Fa,ka={dehydrated:null,treeContext:null,retryLane:0};function Da(t){return{baseLanes:t,cachePool:null,transitions:null}}function Na(t,e,n){var i,r=e.pendingProps,o=ao.current,a=!1,l=0!=(128&e.flags);if((i=l)||(i=(null===t||null!==t.memoizedState)&&0!=(2&o)),i?(a=!0,e.flags&=-129):null!==t&&null===t.memoizedState||(o|=1),Tr(ao,1&o),null===t)return cs(e),null!==(t=e.memoizedState)&&null!==(t=t.dehydrated)?(0==(1&e.mode)?e.lanes=1:"$!"===t.data?e.lanes=8:e.lanes=1073741824,null):(l=r.children,t=r.fallback,a?(r=e.mode,a=e.child,l={mode:"hidden",children:l},0==(1&r)&&null!==a?(a.childLanes=0,a.pendingProps=l):a=Dc(l,r,0,null),t=kc(t,r,n,null),a.return=e,t.return=e,a.sibling=t,e.child=a,e.child.memoizedState=Da(n),e.memoizedState=ka,t):Ua(e,l));if(null!==(o=t.memoizedState)&&null!==(i=o.dehydrated))return function(t,e,n,i,r,o,a){if(n)return 256&e.flags?(e.flags&=-257,za(t,e,a,i=ha(Error(s(422))))):null!==e.memoizedState?(e.child=t.child,e.flags|=128,null):(o=i.fallback,r=e.mode,i=Dc({mode:"visible",children:i.children},r,0,null),(o=kc(o,r,a,null)).flags|=2,i.return=e,o.return=e,i.sibling=o,e.child=i,0!=(1&e.mode)&&Qs(e,t.child,null,a),e.child.memoizedState=Da(a),e.memoizedState=ka,o);if(0==(1&e.mode))return za(t,e,a,null);if("$!"===r.data){if(i=r.nextSibling&&r.nextSibling.dataset)var l=i.dgst;return i=l,za(t,e,a,i=ha(o=Error(s(419)),i,void 0))}if(l=0!=(a&t.childLanes),_a||l){if(null!==(i=Ml)){switch(a&-a){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}0!==(r=0!=(r&(i.suspendedLanes|a))?0:r)&&r!==o.retryLane&&(o.retryLane=r,Ps(t,r),ic(i,t,r,-1))}return mc(),za(t,e,a,i=ha(Error(s(421))))}return"$?"===r.data?(e.flags|=128,e.child=t.child,e=Bc.bind(null,t),r._reactRetry=e,null):(t=o.treeContext,is=cr(r.nextSibling),ns=e,rs=!0,ss=null,null!==t&&(qr[Kr++]=Qr,qr[Kr++]=Yr,qr[Kr++]=Xr,Qr=t.id,Yr=t.overflow,Xr=e),(e=Ua(e,i.children)).flags|=4096,e)}(t,e,l,r,i,o,n);if(a){a=r.fallback,l=e.mode,i=(o=t.child).sibling;var c={mode:"hidden",children:r.children};return 0==(1&l)&&e.child!==o?((r=e.child).childLanes=0,r.pendingProps=c,e.deletions=null):(r=Rc(o,c)).subtreeFlags=14680064&o.subtreeFlags,null!==i?a=Rc(i,a):(a=kc(a,l,n,null)).flags|=2,a.return=e,r.return=e,r.sibling=a,e.child=r,r=a,a=e.child,l=null===(l=t.child.memoizedState)?Da(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},a.memoizedState=l,a.childLanes=t.childLanes&~n,e.memoizedState=ka,r}return t=(a=t.child).sibling,r=Rc(a,{mode:"visible",children:r.children}),0==(1&e.mode)&&(r.lanes=n),r.return=e,r.sibling=null,null!==t&&(null===(n=e.deletions)?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function Ua(t,e){return(e=Dc({mode:"visible",children:e},t.mode,0,null)).return=t,t.child=e}function za(t,e,n,i){return null!==i&&ps(i),Qs(e,t.child,null,n),(t=Ua(e,e.pendingProps.children)).flags|=2,e.memoizedState=null,t}function Ga(t,e,n){t.lanes|=e;var i=t.alternate;null!==i&&(i.lanes|=e),Cs(t.return,e,n)}function ja(t,e,n,i,r){var s=t.memoizedState;null===s?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=n,s.tailMode=r)}function Va(t,e,n){var i=e.pendingProps,r=i.revealOrder,s=i.tail;if(Aa(t,e,i.children,n),0!=(2&(i=ao.current)))i=1&i|2,e.flags|=128;else{if(null!==t&&0!=(128&t.flags))t:for(t=e.child;null!==t;){if(13===t.tag)null!==t.memoizedState&&Ga(t,n,e);else if(19===t.tag)Ga(t,n,e);else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break t;for(;null===t.sibling;){if(null===t.return||t.return===e)break t;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(Tr(ao,i),0==(1&e.mode))e.memoizedState=null;else switch(r){case"forwards":for(n=e.child,r=null;null!==n;)null!==(t=n.alternate)&&null===lo(t)&&(r=n),n=n.sibling;null===(n=r)?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),ja(e,!1,r,n,s);break;case"backwards":for(n=null,r=e.child,e.child=null;null!==r;){if(null!==(t=r.alternate)&&null===lo(t)){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}ja(e,!0,n,null,s);break;case"together":ja(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Ha(t,e){0==(1&e.mode)&&null!==t&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Wa(t,e,n){if(null!==t&&(e.dependencies=t.dependencies),Dl|=e.lanes,0==(n&e.childLanes))return null;if(null!==t&&e.child!==t.child)throw Error(s(153));if(null!==e.child){for(n=Rc(t=e.child,t.pendingProps),e.child=n,n.return=e;null!==t.sibling;)t=t.sibling,(n=n.sibling=Rc(t,t.pendingProps)).return=e;n.sibling=null}return e.child}function Ja(t,e){if(!rs)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;null!==e;)null!==e.alternate&&(n=e),e=e.sibling;null===n?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?e||null===t.tail?t.tail=null:t.tail.sibling=null:i.sibling=null}}function qa(t){var e=null!==t.alternate&&t.alternate.child===t.child,n=0,i=0;if(e)for(var r=t.child;null!==r;)n|=r.lanes|r.childLanes,i|=14680064&r.subtreeFlags,i|=14680064&r.flags,r.return=t,r=r.sibling;else for(r=t.child;null!==r;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function Ka(t,e,n){var i=e.pendingProps;switch(es(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qa(e),null;case 1:case 17:return Lr(e.type)&&Or(),qa(e),null;case 3:return i=e.stateNode,ro(),xr(Pr),xr(Br),uo(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==t&&null!==t.child||(hs(e)?e.flags|=4:null===t||t.memoizedState.isDehydrated&&0==(256&e.flags)||(e.flags|=1024,null!==ss&&(ac(ss),ss=null))),Oa(t,e),qa(e),null;case 5:oo(e);var r=no(eo.current);if(n=e.type,null!==t&&null!=e.stateNode)Ra(t,e,n,i,r),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(null===e.stateNode)throw Error(s(166));return qa(e),null}if(t=no($s.current),hs(e)){i=e.stateNode,n=e.type;var o=e.memoizedProps;switch(i[dr]=e,i[fr]=o,t=0!=(1&e.mode),n){case"dialog":Ui("cancel",i),Ui("close",i);break;case"iframe":case"object":case"embed":Ui("load",i);break;case"video":case"audio":for(r=0;r<Fi.length;r++)Ui(Fi[r],i);break;case"source":Ui("error",i);break;case"img":case"image":case"link":Ui("error",i),Ui("load",i);break;case"details":Ui("toggle",i);break;case"input":Q(i,o),Ui("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!o.multiple},Ui("invalid",i);break;case"textarea":rt(i,o),Ui("invalid",i)}for(var l in yt(n,o),r=null,o)if(o.hasOwnProperty(l)){var c=o[l];"children"===l?"string"==typeof c?i.textContent!==c&&(!0!==o.suppressHydrationWarning&&Zi(i.textContent,c,t),r=["children",c]):"number"==typeof c&&i.textContent!==""+c&&(!0!==o.suppressHydrationWarning&&Zi(i.textContent,c,t),r=["children",""+c]):a.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&Ui("scroll",i)}switch(n){case"input":J(i),$(i,o,!0);break;case"textarea":J(i),ot(i);break;case"select":case"option":break;default:"function"==typeof o.onClick&&(i.onclick=$i)}i=r,e.updateQueue=i,null!==i&&(e.flags|=4)}else{l=9===r.nodeType?r:r.ownerDocument,"http://www.w3.org/1999/xhtml"===t&&(t=at(n)),"http://www.w3.org/1999/xhtml"===t?"script"===n?((t=l.createElement("div")).innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):"string"==typeof i.is?t=l.createElement(n,{is:i.is}):(t=l.createElement(n),"select"===n&&(l=t,i.multiple?l.multiple=!0:i.size&&(l.size=i.size))):t=l.createElementNS(t,n),t[dr]=e,t[fr]=i,La(t,e,!1,!1),e.stateNode=t;t:{switch(l=bt(n,i),n){case"dialog":Ui("cancel",t),Ui("close",t),r=i;break;case"iframe":case"object":case"embed":Ui("load",t),r=i;break;case"video":case"audio":for(r=0;r<Fi.length;r++)Ui(Fi[r],t);r=i;break;case"source":Ui("error",t),r=i;break;case"img":case"image":case"link":Ui("error",t),Ui("load",t),r=i;break;case"details":Ui("toggle",t),r=i;break;case"input":Q(t,i),r=X(t,i),Ui("invalid",t);break;case"option":default:r=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},r=D({},i,{value:void 0}),Ui("invalid",t);break;case"textarea":rt(t,i),r=it(t,i),Ui("invalid",t)}for(o in yt(n,r),c=r)if(c.hasOwnProperty(o)){var u=c[o];"style"===o?mt(t,u):"dangerouslySetInnerHTML"===o?null!=(u=u?u.__html:void 0)&&ht(t,u):"children"===o?"string"==typeof u?("textarea"!==n||""!==u)&&dt(t,u):"number"==typeof u&&dt(t,""+u):"suppressContentEditableWarning"!==o&&"suppressHydrationWarning"!==o&&"autoFocus"!==o&&(a.hasOwnProperty(o)?null!=u&&"onScroll"===o&&Ui("scroll",t):null!=u&&b(t,o,u,l))}switch(n){case"input":J(t),$(t,i,!1);break;case"textarea":J(t),ot(t);break;case"option":null!=i.value&&t.setAttribute("value",""+H(i.value));break;case"select":t.multiple=!!i.multiple,null!=(o=i.value)?nt(t,!!i.multiple,o,!1):null!=i.defaultValue&&nt(t,!!i.multiple,i.defaultValue,!0);break;default:"function"==typeof r.onClick&&(t.onclick=$i)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break t;case"img":i=!0;break t;default:i=!1}}i&&(e.flags|=4)}null!==e.ref&&(e.flags|=512,e.flags|=2097152)}return qa(e),null;case 6:if(t&&null!=e.stateNode)Fa(t,e,t.memoizedProps,i);else{if("string"!=typeof i&&null===e.stateNode)throw Error(s(166));if(n=no(eo.current),no($s.current),hs(e)){if(i=e.stateNode,n=e.memoizedProps,i[dr]=e,(o=i.nodeValue!==n)&&null!==(t=ns))switch(t.tag){case 3:Zi(i.nodeValue,n,0!=(1&t.mode));break;case 5:!0!==t.memoizedProps.suppressHydrationWarning&&Zi(i.nodeValue,n,0!=(1&t.mode))}o&&(e.flags|=4)}else(i=(9===n.nodeType?n:n.ownerDocument).createTextNode(i))[dr]=e,e.stateNode=i}return qa(e),null;case 13:if(xr(ao),i=e.memoizedState,null===t||null!==t.memoizedState&&null!==t.memoizedState.dehydrated){if(rs&&null!==is&&0!=(1&e.mode)&&0==(128&e.flags))ds(),fs(),e.flags|=98560,o=!1;else if(o=hs(e),null!==i&&null!==i.dehydrated){if(null===t){if(!o)throw Error(s(318));if(!(o=null!==(o=e.memoizedState)?o.dehydrated:null))throw Error(s(317));o[dr]=e}else fs(),0==(128&e.flags)&&(e.memoizedState=null),e.flags|=4;qa(e),o=!1}else null!==ss&&(ac(ss),ss=null),o=!0;if(!o)return 65536&e.flags?e:null}return 0!=(128&e.flags)?(e.lanes=n,e):((i=null!==i)!=(null!==t&&null!==t.memoizedState)&&i&&(e.child.flags|=8192,0!=(1&e.mode)&&(null===t||0!=(1&ao.current)?0===Fl&&(Fl=3):mc())),null!==e.updateQueue&&(e.flags|=4),qa(e),null);case 4:return ro(),Oa(t,e),null===t&&ji(e.stateNode.containerInfo),qa(e),null;case 10:return ws(e.type._context),qa(e),null;case 19:if(xr(ao),null===(o=e.memoizedState))return qa(e),null;if(i=0!=(128&e.flags),null===(l=o.rendering))if(i)Ja(o,!1);else{if(0!==Fl||null!==t&&0!=(128&t.flags))for(t=e.child;null!==t;){if(null!==(l=lo(t))){for(e.flags|=128,Ja(o,!1),null!==(i=l.updateQueue)&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=n,n=e.child;null!==n;)t=i,(o=n).flags&=14680066,null===(l=o.alternate)?(o.childLanes=0,o.lanes=t,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=l.childLanes,o.lanes=l.lanes,o.child=l.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=l.memoizedProps,o.memoizedState=l.memoizedState,o.updateQueue=l.updateQueue,o.type=l.type,t=l.dependencies,o.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return Tr(ao,1&ao.current|2),e.child}t=t.sibling}null!==o.tail&&Yt()>Vl&&(e.flags|=128,i=!0,Ja(o,!1),e.lanes=4194304)}else{if(!i)if(null!==(t=lo(l))){if(e.flags|=128,i=!0,null!==(n=t.updateQueue)&&(e.updateQueue=n,e.flags|=4),Ja(o,!0),null===o.tail&&"hidden"===o.tailMode&&!l.alternate&&!rs)return qa(e),null}else 2*Yt()-o.renderingStartTime>Vl&&1073741824!==n&&(e.flags|=128,i=!0,Ja(o,!1),e.lanes=4194304);o.isBackwards?(l.sibling=e.child,e.child=l):(null!==(n=o.last)?n.sibling=l:e.child=l,o.last=l)}return null!==o.tail?(e=o.tail,o.rendering=e,o.tail=e.sibling,o.renderingStartTime=Yt(),e.sibling=null,n=ao.current,Tr(ao,i?1&n|2:1&n),e):(qa(e),null);case 22:case 23:return dc(),i=null!==e.memoizedState,null!==t&&null!==t.memoizedState!==i&&(e.flags|=8192),i&&0!=(1&e.mode)?0!=(1073741824&Ol)&&(qa(e),6&e.subtreeFlags&&(e.flags|=8192)):qa(e),null;case 24:case 25:return null}throw Error(s(156,e.tag))}function Xa(t,e){switch(es(e),e.tag){case 1:return Lr(e.type)&&Or(),65536&(t=e.flags)?(e.flags=-65537&t|128,e):null;case 3:return ro(),xr(Pr),xr(Br),uo(),0!=(65536&(t=e.flags))&&0==(128&t)?(e.flags=-65537&t|128,e):null;case 5:return oo(e),null;case 13:if(xr(ao),null!==(t=e.memoizedState)&&null!==t.dehydrated){if(null===e.alternate)throw Error(s(340));fs()}return 65536&(t=e.flags)?(e.flags=-65537&t|128,e):null;case 19:return xr(ao),null;case 4:return ro(),null;case 10:return ws(e.type._context),null;case 22:case 23:return dc(),null;default:return null}}La=function(t,e){for(var n=e.child;null!==n;){if(5===n.tag||6===n.tag)t.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===e)break;for(;null===n.sibling;){if(null===n.return||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Oa=function(){},Ra=function(t,e,n,i){var r=t.memoizedProps;if(r!==i){t=e.stateNode,no($s.current);var s,o=null;switch(n){case"input":r=X(t,r),i=X(t,i),o=[];break;case"select":r=D({},r,{value:void 0}),i=D({},i,{value:void 0}),o=[];break;case"textarea":r=it(t,r),i=it(t,i),o=[];break;default:"function"!=typeof r.onClick&&"function"==typeof i.onClick&&(t.onclick=$i)}for(u in yt(n,i),n=null,r)if(!i.hasOwnProperty(u)&&r.hasOwnProperty(u)&&null!=r[u])if("style"===u){var l=r[u];for(s in l)l.hasOwnProperty(s)&&(n||(n={}),n[s]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(a.hasOwnProperty(u)?o||(o=[]):(o=o||[]).push(u,null));for(u in i){var c=i[u];if(l=null!=r?r[u]:void 0,i.hasOwnProperty(u)&&c!==l&&(null!=c||null!=l))if("style"===u)if(l){for(s in l)!l.hasOwnProperty(s)||c&&c.hasOwnProperty(s)||(n||(n={}),n[s]="");for(s in c)c.hasOwnProperty(s)&&l[s]!==c[s]&&(n||(n={}),n[s]=c[s])}else n||(o||(o=[]),o.push(u,n)),n=c;else"dangerouslySetInnerHTML"===u?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(o=o||[]).push(u,c)):"children"===u?"string"!=typeof c&&"number"!=typeof c||(o=o||[]).push(u,""+c):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(a.hasOwnProperty(u)?(null!=c&&"onScroll"===u&&Ui("scroll",t),o||l===c||(o=[])):(o=o||[]).push(u,c))}n&&(o=o||[]).push("style",n);var u=o;(e.updateQueue=u)&&(e.flags|=4)}},Fa=function(t,e,n,i){n!==i&&(e.flags|=4)};var Qa=!1,Ya=!1,Za="function"==typeof WeakSet?WeakSet:Set,$a=null;function tl(t,e){var n=t.ref;if(null!==n)if("function"==typeof n)try{n(null)}catch(n){xc(t,e,n)}else n.current=null}function el(t,e,n){try{n()}catch(n){xc(t,e,n)}}var nl=!1;function il(t,e,n){var i=e.updateQueue;if(null!==(i=null!==i?i.lastEffect:null)){var r=i=i.next;do{if((r.tag&t)===t){var s=r.destroy;r.destroy=void 0,void 0!==s&&el(e,n,s)}r=r.next}while(r!==i)}}function rl(t,e){if(null!==(e=null!==(e=e.updateQueue)?e.lastEffect:null)){var n=e=e.next;do{if((n.tag&t)===t){var i=n.create;n.destroy=i()}n=n.next}while(n!==e)}}function sl(t){var e=t.ref;if(null!==e){var n=t.stateNode;t.tag,t=n,"function"==typeof e?e(t):e.current=t}}function ol(t){var e=t.alternate;null!==e&&(t.alternate=null,ol(e)),t.child=null,t.deletions=null,t.sibling=null,5===t.tag&&null!==(e=t.stateNode)&&(delete e[dr],delete e[fr],delete e[gr],delete e[mr],delete e[vr]),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function al(t){return 5===t.tag||3===t.tag||4===t.tag}function ll(t){t:for(;;){for(;null===t.sibling;){if(null===t.return||al(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;5!==t.tag&&6!==t.tag&&18!==t.tag;){if(2&t.flags)continue t;if(null===t.child||4===t.tag)continue t;t.child.return=t,t=t.child}if(!(2&t.flags))return t.stateNode}}function cl(t,e,n){var i=t.tag;if(5===i||6===i)t=t.stateNode,e?8===n.nodeType?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(8===n.nodeType?(e=n.parentNode).insertBefore(t,n):(e=n).appendChild(t),null!=(n=n._reactRootContainer)||null!==e.onclick||(e.onclick=$i));else if(4!==i&&null!==(t=t.child))for(cl(t,e,n),t=t.sibling;null!==t;)cl(t,e,n),t=t.sibling}function ul(t,e,n){var i=t.tag;if(5===i||6===i)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(4!==i&&null!==(t=t.child))for(ul(t,e,n),t=t.sibling;null!==t;)ul(t,e,n),t=t.sibling}var hl=null,dl=!1;function fl(t,e,n){for(n=n.child;null!==n;)pl(t,e,n),n=n.sibling}function pl(t,e,n){if(se&&"function"==typeof se.onCommitFiberUnmount)try{se.onCommitFiberUnmount(re,n)}catch(t){}switch(n.tag){case 5:Ya||tl(n,e);case 6:var i=hl,r=dl;hl=null,fl(t,e,n),dl=r,null!==(hl=i)&&(dl?(t=hl,n=n.stateNode,8===t.nodeType?t.parentNode.removeChild(n):t.removeChild(n)):hl.removeChild(n.stateNode));break;case 18:null!==hl&&(dl?(t=hl,n=n.stateNode,8===t.nodeType?lr(t.parentNode,n):1===t.nodeType&&lr(t,n),je(t)):lr(hl,n.stateNode));break;case 4:i=hl,r=dl,hl=n.stateNode.containerInfo,dl=!0,fl(t,e,n),hl=i,dl=r;break;case 0:case 11:case 14:case 15:if(!Ya&&null!==(i=n.updateQueue)&&null!==(i=i.lastEffect)){r=i=i.next;do{var s=r,o=s.destroy;s=s.tag,void 0!==o&&(0!=(2&s)||0!=(4&s))&&el(n,e,o),r=r.next}while(r!==i)}fl(t,e,n);break;case 1:if(!Ya&&(tl(n,e),"function"==typeof(i=n.stateNode).componentWillUnmount))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(t){xc(n,e,t)}fl(t,e,n);break;case 21:fl(t,e,n);break;case 22:1&n.mode?(Ya=(i=Ya)||null!==n.memoizedState,fl(t,e,n),Ya=i):fl(t,e,n);break;default:fl(t,e,n)}}function gl(t){var e=t.updateQueue;if(null!==e){t.updateQueue=null;var n=t.stateNode;null===n&&(n=t.stateNode=new Za),e.forEach((function(e){var i=Pc.bind(null,t,e);n.has(e)||(n.add(e),e.then(i,i))}))}}function ml(t,e){var n=e.deletions;if(null!==n)for(var i=0;i<n.length;i++){var r=n[i];try{var o=t,a=e,l=a;t:for(;null!==l;){switch(l.tag){case 5:hl=l.stateNode,dl=!1;break t;case 3:case 4:hl=l.stateNode.containerInfo,dl=!0;break t}l=l.return}if(null===hl)throw Error(s(160));pl(o,a,r),hl=null,dl=!1;var c=r.alternate;null!==c&&(c.return=null),r.return=null}catch(t){xc(r,e,t)}}if(12854&e.subtreeFlags)for(e=e.child;null!==e;)vl(e,t),e=e.sibling}function vl(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(ml(e,t),yl(t),4&i){try{il(3,t,t.return),rl(3,t)}catch(e){xc(t,t.return,e)}try{il(5,t,t.return)}catch(e){xc(t,t.return,e)}}break;case 1:ml(e,t),yl(t),512&i&&null!==n&&tl(n,n.return);break;case 5:if(ml(e,t),yl(t),512&i&&null!==n&&tl(n,n.return),32&t.flags){var r=t.stateNode;try{dt(r,"")}catch(e){xc(t,t.return,e)}}if(4&i&&null!=(r=t.stateNode)){var o=t.memoizedProps,a=null!==n?n.memoizedProps:o,l=t.type,c=t.updateQueue;if(t.updateQueue=null,null!==c)try{"input"===l&&"radio"===o.type&&null!=o.name&&Y(r,o),bt(l,a);var u=bt(l,o);for(a=0;a<c.length;a+=2){var h=c[a],d=c[a+1];"style"===h?mt(r,d):"dangerouslySetInnerHTML"===h?ht(r,d):"children"===h?dt(r,d):b(r,h,d,u)}switch(l){case"input":Z(r,o);break;case"textarea":st(r,o);break;case"select":var f=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!o.multiple;var p=o.value;null!=p?nt(r,!!o.multiple,p,!1):f!==!!o.multiple&&(null!=o.defaultValue?nt(r,!!o.multiple,o.defaultValue,!0):nt(r,!!o.multiple,o.multiple?[]:"",!1))}r[fr]=o}catch(e){xc(t,t.return,e)}}break;case 6:if(ml(e,t),yl(t),4&i){if(null===t.stateNode)throw Error(s(162));r=t.stateNode,o=t.memoizedProps;try{r.nodeValue=o}catch(e){xc(t,t.return,e)}}break;case 3:if(ml(e,t),yl(t),4&i&&null!==n&&n.memoizedState.isDehydrated)try{je(e.containerInfo)}catch(e){xc(t,t.return,e)}break;case 4:default:ml(e,t),yl(t);break;case 13:ml(e,t),yl(t),8192&(r=t.child).flags&&(o=null!==r.memoizedState,r.stateNode.isHidden=o,!o||null!==r.alternate&&null!==r.alternate.memoizedState||(jl=Yt())),4&i&&gl(t);break;case 22:if(h=null!==n&&null!==n.memoizedState,1&t.mode?(Ya=(u=Ya)||h,ml(e,t),Ya=u):ml(e,t),yl(t),8192&i){if(u=null!==t.memoizedState,(t.stateNode.isHidden=u)&&!h&&0!=(1&t.mode))for($a=t,h=t.child;null!==h;){for(d=$a=h;null!==$a;){switch(p=(f=$a).child,f.tag){case 0:case 11:case 14:case 15:il(4,f,f.return);break;case 1:tl(f,f.return);var g=f.stateNode;if("function"==typeof g.componentWillUnmount){i=f,n=f.return;try{e=i,g.props=e.memoizedProps,g.state=e.memoizedState,g.componentWillUnmount()}catch(t){xc(i,n,t)}}break;case 5:tl(f,f.return);break;case 22:if(null!==f.memoizedState){wl(d);continue}}null!==p?(p.return=f,$a=p):wl(d)}h=h.sibling}t:for(h=null,d=t;;){if(5===d.tag){if(null===h){h=d;try{r=d.stateNode,u?"function"==typeof(o=r.style).setProperty?o.setProperty("display","none","important"):o.display="none":(l=d.stateNode,a=null!=(c=d.memoizedProps.style)&&c.hasOwnProperty("display")?c.display:null,l.style.display=gt("display",a))}catch(e){xc(t,t.return,e)}}}else if(6===d.tag){if(null===h)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(e){xc(t,t.return,e)}}else if((22!==d.tag&&23!==d.tag||null===d.memoizedState||d===t)&&null!==d.child){d.child.return=d,d=d.child;continue}if(d===t)break t;for(;null===d.sibling;){if(null===d.return||d.return===t)break t;h===d&&(h=null),d=d.return}h===d&&(h=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:ml(e,t),yl(t),4&i&&gl(t);case 21:}}function yl(t){var e=t.flags;if(2&e){try{t:{for(var n=t.return;null!==n;){if(al(n)){var i=n;break t}n=n.return}throw Error(s(160))}switch(i.tag){case 5:var r=i.stateNode;32&i.flags&&(dt(r,""),i.flags&=-33),ul(t,ll(t),r);break;case 3:case 4:var o=i.stateNode.containerInfo;cl(t,ll(t),o);break;default:throw Error(s(161))}}catch(e){xc(t,t.return,e)}t.flags&=-3}4096&e&&(t.flags&=-4097)}function bl(t,e,n){$a=t,_l(t,e,n)}function _l(t,e,n){for(var i=0!=(1&t.mode);null!==$a;){var r=$a,s=r.child;if(22===r.tag&&i){var o=null!==r.memoizedState||Qa;if(!o){var a=r.alternate,l=null!==a&&null!==a.memoizedState||Ya;a=Qa;var c=Ya;if(Qa=o,(Ya=l)&&!c)for($a=r;null!==$a;)l=(o=$a).child,22===o.tag&&null!==o.memoizedState?Cl(r):null!==l?(l.return=o,$a=l):Cl(r);for(;null!==s;)$a=s,_l(s,e,n),s=s.sibling;$a=r,Qa=a,Ya=c}Al(t)}else 0!=(8772&r.subtreeFlags)&&null!==s?(s.return=r,$a=s):Al(t)}}function Al(t){for(;null!==$a;){var e=$a;if(0!=(8772&e.flags)){var n=e.alternate;try{if(0!=(8772&e.flags))switch(e.tag){case 0:case 11:case 15:Ya||rl(5,e);break;case 1:var i=e.stateNode;if(4&e.flags&&!Ya)if(null===n)i.componentDidMount();else{var r=e.elementType===e.type?n.memoizedProps:ms(e.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var o=e.updateQueue;null!==o&&Ns(e,o,i);break;case 3:var a=e.updateQueue;if(null!==a){if(n=null,null!==e.child)switch(e.child.tag){case 5:case 1:n=e.child.stateNode}Ns(e,a,n)}break;case 5:var l=e.stateNode;if(null===n&&4&e.flags){n=l;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===e.memoizedState){var u=e.alternate;if(null!==u){var h=u.memoizedState;if(null!==h){var d=h.dehydrated;null!==d&&je(d)}}}break;default:throw Error(s(163))}Ya||512&e.flags&&sl(e)}catch(t){xc(e,e.return,t)}}if(e===t){$a=null;break}if(null!==(n=e.sibling)){n.return=e.return,$a=n;break}$a=e.return}}function wl(t){for(;null!==$a;){var e=$a;if(e===t){$a=null;break}var n=e.sibling;if(null!==n){n.return=e.return,$a=n;break}$a=e.return}}function Cl(t){for(;null!==$a;){var e=$a;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{rl(4,e)}catch(t){xc(e,n,t)}break;case 1:var i=e.stateNode;if("function"==typeof i.componentDidMount){var r=e.return;try{i.componentDidMount()}catch(t){xc(e,r,t)}}var s=e.return;try{sl(e)}catch(t){xc(e,s,t)}break;case 5:var o=e.return;try{sl(e)}catch(t){xc(e,o,t)}}}catch(t){xc(e,e.return,t)}if(e===t){$a=null;break}var a=e.sibling;if(null!==a){a.return=e.return,$a=a;break}$a=e.return}}var El,xl=Math.ceil,Tl=_.ReactCurrentDispatcher,Sl=_.ReactCurrentOwner,Bl=_.ReactCurrentBatchConfig,Pl=0,Ml=null,Il=null,Ll=0,Ol=0,Rl=Er(0),Fl=0,kl=null,Dl=0,Nl=0,Ul=0,zl=null,Gl=null,jl=0,Vl=1/0,Hl=null,Wl=!1,Jl=null,ql=null,Kl=!1,Xl=null,Ql=0,Yl=0,Zl=null,$l=-1,tc=0;function ec(){return 0!=(6&Pl)?Yt():-1!==$l?$l:$l=Yt()}function nc(t){return 0==(1&t.mode)?1:0!=(2&Pl)&&0!==Ll?Ll&-Ll:null!==gs.transition?(0===tc&&(tc=ge()),tc):0!==(t=be)?t:t=void 0===(t=window.event)?16:Qe(t.type)}function ic(t,e,n,i){if(50<Yl)throw Yl=0,Zl=null,Error(s(185));ve(t,n,i),0!=(2&Pl)&&t===Ml||(t===Ml&&(0==(2&Pl)&&(Nl|=n),4===Fl&&lc(t,Ll)),rc(t,i),1===n&&0===Pl&&0==(1&e.mode)&&(Vl=Yt()+500,Ur&&jr()))}function rc(t,e){var n=t.callbackNode;!function(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,r=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-oe(s),a=1<<o,l=r[o];-1===l?0!=(a&n)&&0==(a&i)||(r[o]=fe(a,e)):l<=e&&(t.expiredLanes|=a),s&=~a}}(t,e);var i=de(t,t===Ml?Ll:0);if(0===i)null!==n&&Kt(n),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(null!=n&&Kt(n),1===e)0===t.tag?function(t){Ur=!0,Gr(t)}(cc.bind(null,t)):Gr(cc.bind(null,t)),or((function(){0==(6&Pl)&&jr()})),n=null;else{switch(_e(i)){case 1:n=$t;break;case 4:n=te;break;case 16:default:n=ee;break;case 536870912:n=ie}n=Mc(n,sc.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function sc(t,e){if($l=-1,tc=0,0!=(6&Pl))throw Error(s(327));var n=t.callbackNode;if(Cc()&&t.callbackNode!==n)return null;var i=de(t,t===Ml?Ll:0);if(0===i)return null;if(0!=(30&i)||0!=(i&t.expiredLanes)||e)e=vc(t,i);else{e=i;var r=Pl;Pl|=2;var o=gc();for(Ml===t&&Ll===e||(Hl=null,Vl=Yt()+500,fc(t,e));;)try{bc();break}catch(e){pc(t,e)}As(),Tl.current=o,Pl=r,null!==Il?e=0:(Ml=null,Ll=0,e=Fl)}if(0!==e){if(2===e&&0!==(r=pe(t))&&(i=r,e=oc(t,r)),1===e)throw n=kl,fc(t,0),lc(t,i),rc(t,Yt()),n;if(6===e)lc(t,i);else{if(r=t.current.alternate,0==(30&i)&&!function(t){for(var e=t;;){if(16384&e.flags){var n=e.updateQueue;if(null!==n&&null!==(n=n.stores))for(var i=0;i<n.length;i++){var r=n[i],s=r.getSnapshot;r=r.value;try{if(!ai(s(),r))return!1}catch(t){return!1}}}if(n=e.child,16384&e.subtreeFlags&&null!==n)n.return=e,e=n;else{if(e===t)break;for(;null===e.sibling;){if(null===e.return||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}(r)&&(2===(e=vc(t,i))&&0!==(o=pe(t))&&(i=o,e=oc(t,o)),1===e))throw n=kl,fc(t,0),lc(t,i),rc(t,Yt()),n;switch(t.finishedWork=r,t.finishedLanes=i,e){case 0:case 1:throw Error(s(345));case 2:case 5:wc(t,Gl,Hl);break;case 3:if(lc(t,i),(130023424&i)===i&&10<(e=jl+500-Yt())){if(0!==de(t,0))break;if(((r=t.suspendedLanes)&i)!==i){ec(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=ir(wc.bind(null,t,Gl,Hl),e);break}wc(t,Gl,Hl);break;case 4:if(lc(t,i),(4194240&i)===i)break;for(e=t.eventTimes,r=-1;0<i;){var a=31-oe(i);o=1<<a,(a=e[a])>r&&(r=a),i&=~o}if(i=r,10<(i=(120>(i=Yt()-i)?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*xl(i/1960))-i)){t.timeoutHandle=ir(wc.bind(null,t,Gl,Hl),i);break}wc(t,Gl,Hl);break;default:throw Error(s(329))}}}return rc(t,Yt()),t.callbackNode===n?sc.bind(null,t):null}function oc(t,e){var n=zl;return t.current.memoizedState.isDehydrated&&(fc(t,e).flags|=256),2!==(t=vc(t,e))&&(e=Gl,Gl=n,null!==e&&ac(e)),t}function ac(t){null===Gl?Gl=t:Gl.push.apply(Gl,t)}function lc(t,e){for(e&=~Ul,e&=~Nl,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-oe(e),i=1<<n;t[n]=-1,e&=~i}}function cc(t){if(0!=(6&Pl))throw Error(s(327));Cc();var e=de(t,0);if(0==(1&e))return rc(t,Yt()),null;var n=vc(t,e);if(0!==t.tag&&2===n){var i=pe(t);0!==i&&(e=i,n=oc(t,i))}if(1===n)throw n=kl,fc(t,0),lc(t,e),rc(t,Yt()),n;if(6===n)throw Error(s(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,wc(t,Gl,Hl),rc(t,Yt()),null}function uc(t,e){var n=Pl;Pl|=1;try{return t(e)}finally{0===(Pl=n)&&(Vl=Yt()+500,Ur&&jr())}}function hc(t){null!==Xl&&0===Xl.tag&&0==(6&Pl)&&Cc();var e=Pl;Pl|=1;var n=Bl.transition,i=be;try{if(Bl.transition=null,be=1,t)return t()}finally{be=i,Bl.transition=n,0==(6&(Pl=e))&&jr()}}function dc(){Ol=Rl.current,xr(Rl)}function fc(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(-1!==n&&(t.timeoutHandle=-1,rr(n)),null!==Il)for(n=Il.return;null!==n;){var i=n;switch(es(i),i.tag){case 1:null!=(i=i.type.childContextTypes)&&Or();break;case 3:ro(),xr(Pr),xr(Br),uo();break;case 5:oo(i);break;case 4:ro();break;case 13:case 19:xr(ao);break;case 10:ws(i.type._context);break;case 22:case 23:dc()}n=n.return}if(Ml=t,Il=t=Rc(t.current,null),Ll=Ol=e,Fl=0,kl=null,Ul=Nl=Dl=0,Gl=zl=null,null!==Ts){for(e=0;e<Ts.length;e++)if(null!==(i=(n=Ts[e]).interleaved)){n.interleaved=null;var r=i.next,s=n.pending;if(null!==s){var o=s.next;s.next=r,i.next=o}n.pending=i}Ts=null}return t}function pc(t,e){for(;;){var n=Il;try{if(As(),ho.current=oa,yo){for(var i=go.memoizedState;null!==i;){var r=i.queue;null!==r&&(r.pending=null),i=i.next}yo=!1}if(po=0,vo=mo=go=null,bo=!1,_o=0,Sl.current=null,null===n||null===n.return){Fl=1,kl=e,Il=null;break}t:{var o=t,a=n.return,l=n,c=e;if(e=Ll,l.flags|=32768,null!==c&&"object"==typeof c&&"function"==typeof c.then){var u=c,h=l,d=h.tag;if(0==(1&h.mode)&&(0===d||11===d||15===d)){var f=h.alternate;f?(h.updateQueue=f.updateQueue,h.memoizedState=f.memoizedState,h.lanes=f.lanes):(h.updateQueue=null,h.memoizedState=null)}var p=va(a);if(null!==p){p.flags&=-257,ya(p,a,l,0,e),1&p.mode&&ma(o,u,e),c=u;var g=(e=p).updateQueue;if(null===g){var m=new Set;m.add(c),e.updateQueue=m}else g.add(c);break t}if(0==(1&e)){ma(o,u,e),mc();break t}c=Error(s(426))}else if(rs&&1&l.mode){var v=va(a);if(null!==v){0==(65536&v.flags)&&(v.flags|=256),ya(v,a,l,0,e),ps(ua(c,l));break t}}o=c=ua(c,l),4!==Fl&&(Fl=2),null===zl?zl=[o]:zl.push(o),o=a;do{switch(o.tag){case 3:o.flags|=65536,e&=-e,o.lanes|=e,ks(o,pa(0,c,e));break t;case 1:l=c;var y=o.type,b=o.stateNode;if(0==(128&o.flags)&&("function"==typeof y.getDerivedStateFromError||null!==b&&"function"==typeof b.componentDidCatch&&(null===ql||!ql.has(b)))){o.flags|=65536,e&=-e,o.lanes|=e,ks(o,ga(o,l,e));break t}}o=o.return}while(null!==o)}Ac(n)}catch(t){e=t,Il===n&&null!==n&&(Il=n=n.return);continue}break}}function gc(){var t=Tl.current;return Tl.current=oa,null===t?oa:t}function mc(){0!==Fl&&3!==Fl&&2!==Fl||(Fl=4),null===Ml||0==(268435455&Dl)&&0==(268435455&Nl)||lc(Ml,Ll)}function vc(t,e){var n=Pl;Pl|=2;var i=gc();for(Ml===t&&Ll===e||(Hl=null,fc(t,e));;)try{yc();break}catch(e){pc(t,e)}if(As(),Pl=n,Tl.current=i,null!==Il)throw Error(s(261));return Ml=null,Ll=0,Fl}function yc(){for(;null!==Il;)_c(Il)}function bc(){for(;null!==Il&&!Xt();)_c(Il)}function _c(t){var e=El(t.alternate,t,Ol);t.memoizedProps=t.pendingProps,null===e?Ac(t):Il=e,Sl.current=null}function Ac(t){var e=t;do{var n=e.alternate;if(t=e.return,0==(32768&e.flags)){if(null!==(n=Ka(n,e,Ol)))return void(Il=n)}else{if(null!==(n=Xa(n,e)))return n.flags&=32767,void(Il=n);if(null===t)return Fl=6,void(Il=null);t.flags|=32768,t.subtreeFlags=0,t.deletions=null}if(null!==(e=e.sibling))return void(Il=e);Il=e=t}while(null!==e);0===Fl&&(Fl=5)}function wc(t,e,n){var i=be,r=Bl.transition;try{Bl.transition=null,be=1,function(t,e,n,i){do{Cc()}while(null!==Xl);if(0!=(6&Pl))throw Error(s(327));n=t.finishedWork;var r=t.finishedLanes;if(null===n)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(s(177));t.callbackNode=null,t.callbackPriority=0;var o=n.lanes|n.childLanes;if(function(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<n;){var r=31-oe(n),s=1<<r;e[r]=0,i[r]=-1,t[r]=-1,n&=~s}}(t,o),t===Ml&&(Il=Ml=null,Ll=0),0==(2064&n.subtreeFlags)&&0==(2064&n.flags)||Kl||(Kl=!0,Mc(ee,(function(){return Cc(),null}))),o=0!=(15990&n.flags),0!=(15990&n.subtreeFlags)||o){o=Bl.transition,Bl.transition=null;var a=be;be=1;var l=Pl;Pl|=4,Sl.current=null,function(t,e){if(tr=He,fi(t=di())){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else t:{var i=(n=(n=t.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(i&&0!==i.rangeCount){n=i.anchorNode;var r=i.anchorOffset,o=i.focusNode;i=i.focusOffset;try{n.nodeType,o.nodeType}catch(t){n=null;break t}var a=0,l=-1,c=-1,u=0,h=0,d=t,f=null;e:for(;;){for(var p;d!==n||0!==r&&3!==d.nodeType||(l=a+r),d!==o||0!==i&&3!==d.nodeType||(c=a+i),3===d.nodeType&&(a+=d.nodeValue.length),null!==(p=d.firstChild);)f=d,d=p;for(;;){if(d===t)break e;if(f===n&&++u===r&&(l=a),f===o&&++h===i&&(c=a),null!==(p=d.nextSibling))break;f=(d=f).parentNode}d=p}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(er={focusedElem:t,selectionRange:n},He=!1,$a=e;null!==$a;)if(t=(e=$a).child,0!=(1028&e.subtreeFlags)&&null!==t)t.return=e,$a=t;else for(;null!==$a;){e=$a;try{var g=e.alternate;if(0!=(1024&e.flags))switch(e.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==g){var m=g.memoizedProps,v=g.memoizedState,y=e.stateNode,b=y.getSnapshotBeforeUpdate(e.elementType===e.type?m:ms(e.type,m),v);y.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var _=e.stateNode.containerInfo;1===_.nodeType?_.textContent="":9===_.nodeType&&_.documentElement&&_.removeChild(_.documentElement);break;default:throw Error(s(163))}}catch(t){xc(e,e.return,t)}if(null!==(t=e.sibling)){t.return=e.return,$a=t;break}$a=e.return}g=nl,nl=!1}(t,n),vl(n,t),pi(er),He=!!tr,er=tr=null,t.current=n,bl(n,t,r),Qt(),Pl=l,be=a,Bl.transition=o}else t.current=n;if(Kl&&(Kl=!1,Xl=t,Ql=r),0===(o=t.pendingLanes)&&(ql=null),function(t){if(se&&"function"==typeof se.onCommitFiberRoot)try{se.onCommitFiberRoot(re,t,void 0,128==(128&t.current.flags))}catch(t){}}(n.stateNode),rc(t,Yt()),null!==e)for(i=t.onRecoverableError,n=0;n<e.length;n++)i((r=e[n]).value,{componentStack:r.stack,digest:r.digest});if(Wl)throw Wl=!1,t=Jl,Jl=null,t;0!=(1&Ql)&&0!==t.tag&&Cc(),0!=(1&(o=t.pendingLanes))?t===Zl?Yl++:(Yl=0,Zl=t):Yl=0,jr()}(t,e,n,i)}finally{Bl.transition=r,be=i}return null}function Cc(){if(null!==Xl){var t=_e(Ql),e=Bl.transition,n=be;try{if(Bl.transition=null,be=16>t?16:t,null===Xl)var i=!1;else{if(t=Xl,Xl=null,Ql=0,0!=(6&Pl))throw Error(s(331));var r=Pl;for(Pl|=4,$a=t.current;null!==$a;){var o=$a,a=o.child;if(0!=(16&$a.flags)){var l=o.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for($a=u;null!==$a;){var h=$a;switch(h.tag){case 0:case 11:case 15:il(8,h,o)}var d=h.child;if(null!==d)d.return=h,$a=d;else for(;null!==$a;){var f=(h=$a).sibling,p=h.return;if(ol(h),h===u){$a=null;break}if(null!==f){f.return=p,$a=f;break}$a=p}}}var g=o.alternate;if(null!==g){var m=g.child;if(null!==m){g.child=null;do{var v=m.sibling;m.sibling=null,m=v}while(null!==m)}}$a=o}}if(0!=(2064&o.subtreeFlags)&&null!==a)a.return=o,$a=a;else t:for(;null!==$a;){if(0!=(2048&(o=$a).flags))switch(o.tag){case 0:case 11:case 15:il(9,o,o.return)}var y=o.sibling;if(null!==y){y.return=o.return,$a=y;break t}$a=o.return}}var b=t.current;for($a=b;null!==$a;){var _=(a=$a).child;if(0!=(2064&a.subtreeFlags)&&null!==_)_.return=a,$a=_;else t:for(a=b;null!==$a;){if(0!=(2048&(l=$a).flags))try{switch(l.tag){case 0:case 11:case 15:rl(9,l)}}catch(t){xc(l,l.return,t)}if(l===a){$a=null;break t}var A=l.sibling;if(null!==A){A.return=l.return,$a=A;break t}$a=l.return}}if(Pl=r,jr(),se&&"function"==typeof se.onPostCommitFiberRoot)try{se.onPostCommitFiberRoot(re,t)}catch(t){}i=!0}return i}finally{be=n,Bl.transition=e}}return!1}function Ec(t,e,n){t=Rs(t,e=pa(0,e=ua(n,e),1),1),e=ec(),null!==t&&(ve(t,1,e),rc(t,e))}function xc(t,e,n){if(3===t.tag)Ec(t,t,n);else for(;null!==e;){if(3===e.tag){Ec(e,t,n);break}if(1===e.tag){var i=e.stateNode;if("function"==typeof e.type.getDerivedStateFromError||"function"==typeof i.componentDidCatch&&(null===ql||!ql.has(i))){e=Rs(e,t=ga(e,t=ua(n,t),1),1),t=ec(),null!==e&&(ve(e,1,t),rc(e,t));break}}e=e.return}}function Tc(t,e,n){var i=t.pingCache;null!==i&&i.delete(e),e=ec(),t.pingedLanes|=t.suspendedLanes&n,Ml===t&&(Ll&n)===n&&(4===Fl||3===Fl&&(130023424&Ll)===Ll&&500>Yt()-jl?fc(t,0):Ul|=n),rc(t,e)}function Sc(t,e){0===e&&(0==(1&t.mode)?e=1:(e=ue,0==(130023424&(ue<<=1))&&(ue=4194304)));var n=ec();null!==(t=Ps(t,e))&&(ve(t,e,n),rc(t,n))}function Bc(t){var e=t.memoizedState,n=0;null!==e&&(n=e.retryLane),Sc(t,n)}function Pc(t,e){var n=0;switch(t.tag){case 13:var i=t.stateNode,r=t.memoizedState;null!==r&&(n=r.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(s(314))}null!==i&&i.delete(e),Sc(t,n)}function Mc(t,e){return qt(t,e)}function Ic(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Lc(t,e,n,i){return new Ic(t,e,n,i)}function Oc(t){return!(!(t=t.prototype)||!t.isReactComponent)}function Rc(t,e){var n=t.alternate;return null===n?((n=Lc(t.tag,e,t.key,t.mode)).elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&t.flags,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Fc(t,e,n,i,r,o){var a=2;if(i=t,"function"==typeof t)Oc(t)&&(a=1);else if("string"==typeof t)a=5;else t:switch(t){case C:return kc(n.children,r,o,e);case E:a=8,r|=8;break;case x:return(t=Lc(12,n,e,2|r)).elementType=x,t.lanes=o,t;case P:return(t=Lc(13,n,e,r)).elementType=P,t.lanes=o,t;case M:return(t=Lc(19,n,e,r)).elementType=M,t.lanes=o,t;case O:return Dc(n,r,o,e);default:if("object"==typeof t&&null!==t)switch(t.$$typeof){case T:a=10;break t;case S:a=9;break t;case B:a=11;break t;case I:a=14;break t;case L:a=16,i=null;break t}throw Error(s(130,null==t?t:typeof t,""))}return(e=Lc(a,n,e,r)).elementType=t,e.type=i,e.lanes=o,e}function kc(t,e,n,i){return(t=Lc(7,t,i,e)).lanes=n,t}function Dc(t,e,n,i){return(t=Lc(22,t,i,e)).elementType=O,t.lanes=n,t.stateNode={isHidden:!1},t}function Nc(t,e,n){return(t=Lc(6,t,null,e)).lanes=n,t}function Uc(t,e,n){return(e=Lc(4,null!==t.children?t.children:[],t.key,e)).lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function zc(t,e,n,i,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=me(0),this.expirationTimes=me(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=me(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Gc(t,e,n,i,r,s,o,a,l){return t=new zc(t,e,n,a,l),1===e?(e=1,!0===s&&(e|=8)):e=0,s=Lc(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Is(s),t}function jc(t){if(!t)return Sr;t:{if(jt(t=t._reactInternals)!==t||1!==t.tag)throw Error(s(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break t;case 1:if(Lr(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break t}}e=e.return}while(null!==e);throw Error(s(171))}if(1===t.tag){var n=t.type;if(Lr(n))return Fr(t,n,e)}return e}function Vc(t,e,n,i,r,s,o,a,l){return(t=Gc(n,i,!0,t,0,s,0,a,l)).context=jc(null),n=t.current,(s=Os(i=ec(),r=nc(n))).callback=null!=e?e:null,Rs(n,s,r),t.current.lanes=r,ve(t,r,i),rc(t,i),t}function Hc(t,e,n,i){var r=e.current,s=ec(),o=nc(r);return n=jc(n),null===e.context?e.context=n:e.pendingContext=n,(e=Os(s,o)).payload={element:t},null!==(i=void 0===i?null:i)&&(e.callback=i),null!==(t=Rs(r,e,o))&&(ic(t,r,o,s),Fs(t,r,o)),o}function Wc(t){return(t=t.current).child?(t.child.tag,t.child.stateNode):null}function Jc(t,e){if(null!==(t=t.memoizedState)&&null!==t.dehydrated){var n=t.retryLane;t.retryLane=0!==n&&n<e?n:e}}function qc(t,e){Jc(t,e),(t=t.alternate)&&Jc(t,e)}El=function(t,e,n){if(null!==t)if(t.memoizedProps!==e.pendingProps||Pr.current)_a=!0;else{if(0==(t.lanes&n)&&0==(128&e.flags))return _a=!1,function(t,e,n){switch(e.tag){case 3:Ma(e),fs();break;case 5:so(e);break;case 1:Lr(e.type)&&kr(e);break;case 4:io(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,r=e.memoizedProps.value;Tr(vs,i._currentValue),i._currentValue=r;break;case 13:if(null!==(i=e.memoizedState))return null!==i.dehydrated?(Tr(ao,1&ao.current),e.flags|=128,null):0!=(n&e.child.childLanes)?Na(t,e,n):(Tr(ao,1&ao.current),null!==(t=Wa(t,e,n))?t.sibling:null);Tr(ao,1&ao.current);break;case 19:if(i=0!=(n&e.childLanes),0!=(128&t.flags)){if(i)return Va(t,e,n);e.flags|=128}if(null!==(r=e.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),Tr(ao,ao.current),i)break;return null;case 22:case 23:return e.lanes=0,xa(t,e,n)}return Wa(t,e,n)}(t,e,n);_a=0!=(131072&t.flags)}else _a=!1,rs&&0!=(1048576&e.flags)&&$r(e,Jr,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;Ha(t,e),t=e.pendingProps;var r=Ir(e,Br.current);Es(e,n),r=Eo(null,e,i,t,r,n);var o=xo();return e.flags|=1,"object"==typeof r&&null!==r&&"function"==typeof r.render&&void 0===r.$$typeof?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Lr(i)?(o=!0,kr(e)):o=!1,e.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,Is(e),r.updater=Gs,e.stateNode=r,r._reactInternals=e,Ws(e,i,t,n),e=Pa(null,e,i,!0,o,n)):(e.tag=0,rs&&o&&ts(e),Aa(null,e,r,n),e=e.child),e;case 16:i=e.elementType;t:{switch(Ha(t,e),t=e.pendingProps,i=(r=i._init)(i._payload),e.type=i,r=e.tag=function(t){if("function"==typeof t)return Oc(t)?1:0;if(null!=t){if((t=t.$$typeof)===B)return 11;if(t===I)return 14}return 2}(i),t=ms(i,t),r){case 0:e=Sa(null,e,i,t,n);break t;case 1:e=Ba(null,e,i,t,n);break t;case 11:e=wa(null,e,i,t,n);break t;case 14:e=Ca(null,e,i,ms(i.type,t),n);break t}throw Error(s(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,Sa(t,e,i,r=e.elementType===i?r:ms(i,r),n);case 1:return i=e.type,r=e.pendingProps,Ba(t,e,i,r=e.elementType===i?r:ms(i,r),n);case 3:t:{if(Ma(e),null===t)throw Error(s(387));i=e.pendingProps,r=(o=e.memoizedState).element,Ls(t,e),Ds(e,i,null,n);var a=e.memoizedState;if(i=a.element,o.isDehydrated){if(o={element:i,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=o,e.memoizedState=o,256&e.flags){e=Ia(t,e,i,n,r=ua(Error(s(423)),e));break t}if(i!==r){e=Ia(t,e,i,n,r=ua(Error(s(424)),e));break t}for(is=cr(e.stateNode.containerInfo.firstChild),ns=e,rs=!0,ss=null,n=Ys(e,null,i,n),e.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(fs(),i===r){e=Wa(t,e,n);break t}Aa(t,e,i,n)}e=e.child}return e;case 5:return so(e),null===t&&cs(e),i=e.type,r=e.pendingProps,o=null!==t?t.memoizedProps:null,a=r.children,nr(i,r)?a=null:null!==o&&nr(i,o)&&(e.flags|=32),Ta(t,e),Aa(t,e,a,n),e.child;case 6:return null===t&&cs(e),null;case 13:return Na(t,e,n);case 4:return io(e,e.stateNode.containerInfo),i=e.pendingProps,null===t?e.child=Qs(e,null,i,n):Aa(t,e,i,n),e.child;case 11:return i=e.type,r=e.pendingProps,wa(t,e,i,r=e.elementType===i?r:ms(i,r),n);case 7:return Aa(t,e,e.pendingProps,n),e.child;case 8:case 12:return Aa(t,e,e.pendingProps.children,n),e.child;case 10:t:{if(i=e.type._context,r=e.pendingProps,o=e.memoizedProps,a=r.value,Tr(vs,i._currentValue),i._currentValue=a,null!==o)if(ai(o.value,a)){if(o.children===r.children&&!Pr.current){e=Wa(t,e,n);break t}}else for(null!==(o=e.child)&&(o.return=e);null!==o;){var l=o.dependencies;if(null!==l){a=o.child;for(var c=l.firstContext;null!==c;){if(c.context===i){if(1===o.tag){(c=Os(-1,n&-n)).tag=2;var u=o.updateQueue;if(null!==u){var h=(u=u.shared).pending;null===h?c.next=c:(c.next=h.next,h.next=c),u.pending=c}}o.lanes|=n,null!==(c=o.alternate)&&(c.lanes|=n),Cs(o.return,n,e),l.lanes|=n;break}c=c.next}}else if(10===o.tag)a=o.type===e.type?null:o.child;else if(18===o.tag){if(null===(a=o.return))throw Error(s(341));a.lanes|=n,null!==(l=a.alternate)&&(l.lanes|=n),Cs(a,n,e),a=o.sibling}else a=o.child;if(null!==a)a.return=o;else for(a=o;null!==a;){if(a===e){a=null;break}if(null!==(o=a.sibling)){o.return=a.return,a=o;break}a=a.return}o=a}Aa(t,e,r.children,n),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,Es(e,n),i=i(r=xs(r)),e.flags|=1,Aa(t,e,i,n),e.child;case 14:return r=ms(i=e.type,e.pendingProps),Ca(t,e,i,r=ms(i.type,r),n);case 15:return Ea(t,e,e.type,e.pendingProps,n);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:ms(i,r),Ha(t,e),e.tag=1,Lr(i)?(t=!0,kr(e)):t=!1,Es(e,n),Vs(e,i,r),Ws(e,i,r,n),Pa(null,e,i,!0,t,n);case 19:return Va(t,e,n);case 22:return xa(t,e,n)}throw Error(s(156,e.tag))};var Kc="function"==typeof reportError?reportError:function(t){console.error(t)};function Xc(t){this._internalRoot=t}function Qc(t){this._internalRoot=t}function Yc(t){return!(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType)}function Zc(t){return!(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType&&(8!==t.nodeType||" react-mount-point-unstable "!==t.nodeValue))}function $c(){}function tu(t,e,n,i,r){var s=n._reactRootContainer;if(s){var o=s;if("function"==typeof r){var a=r;r=function(){var t=Wc(o);a.call(t)}}Hc(e,o,t,r)}else o=function(t,e,n,i,r){if(r){if("function"==typeof i){var s=i;i=function(){var t=Wc(o);s.call(t)}}var o=Vc(e,i,t,0,null,!1,0,"",$c);return t._reactRootContainer=o,t[pr]=o.current,ji(8===t.nodeType?t.parentNode:t),hc(),o}for(;r=t.lastChild;)t.removeChild(r);if("function"==typeof i){var a=i;i=function(){var t=Wc(l);a.call(t)}}var l=Gc(t,0,!1,null,0,!1,0,"",$c);return t._reactRootContainer=l,t[pr]=l.current,ji(8===t.nodeType?t.parentNode:t),hc((function(){Hc(e,l,n,i)})),l}(n,e,t,r,i);return Wc(o)}Qc.prototype.render=Xc.prototype.render=function(t){var e=this._internalRoot;if(null===e)throw Error(s(409));Hc(t,e,null,null)},Qc.prototype.unmount=Xc.prototype.unmount=function(){var t=this._internalRoot;if(null!==t){this._internalRoot=null;var e=t.containerInfo;hc((function(){Hc(null,t,null,null)})),e[pr]=null}},Qc.prototype.unstable_scheduleHydration=function(t){if(t){var e=Ee();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Oe.length&&0!==e&&e<Oe[n].priority;n++);Oe.splice(n,0,t),0===n&&De(t)}},Ae=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=he(e.pendingLanes);0!==n&&(ye(e,1|n),rc(e,Yt()),0==(6&Pl)&&(Vl=Yt()+500,jr()))}break;case 13:hc((function(){var e=Ps(t,1);if(null!==e){var n=ec();ic(e,t,1,n)}})),qc(t,1)}},we=function(t){if(13===t.tag){var e=Ps(t,134217728);null!==e&&ic(e,t,134217728,ec()),qc(t,134217728)}},Ce=function(t){if(13===t.tag){var e=nc(t),n=Ps(t,e);null!==n&&ic(n,t,e,ec()),qc(t,e)}},Ee=function(){return be},xe=function(t,e){var n=be;try{return be=t,e()}finally{be=n}},wt=function(t,e,n){switch(e){case"input":if(Z(t,n),e=n.name,"radio"===n.type&&null!=e){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var r=Ar(i);if(!r)throw Error(s(90));q(i),Z(i,r)}}}break;case"textarea":st(t,n);break;case"select":null!=(e=n.value)&&nt(t,!!n.multiple,e,!1)}},Bt=uc,Pt=hc;var eu={usingClientEntryPoint:!1,Events:[br,_r,Ar,Tt,St,uc]},nu={findFiberByHostInstance:yr,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},iu={bundleType:nu.bundleType,version:nu.version,rendererPackageName:nu.rendererPackageName,rendererConfig:nu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:_.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return null===(t=Wt(t))?null:t.stateNode},findFiberByHostInstance:nu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var ru=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ru.isDisabled&&ru.supportsFiber)try{re=ru.inject(iu),se=ru}catch(ut){}}e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=eu,e.createPortal=function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Yc(e))throw Error(s(200));return function(t,e,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:w,key:null==i?null:""+i,children:t,containerInfo:e,implementation:n}}(t,e,null,n)},e.createRoot=function(t,e){if(!Yc(t))throw Error(s(299));var n=!1,i="",r=Kc;return null!=e&&(!0===e.unstable_strictMode&&(n=!0),void 0!==e.identifierPrefix&&(i=e.identifierPrefix),void 0!==e.onRecoverableError&&(r=e.onRecoverableError)),e=Gc(t,1,!1,null,0,n,0,i,r),t[pr]=e.current,ji(8===t.nodeType?t.parentNode:t),new Xc(e)},e.findDOMNode=function(t){if(null==t)return null;if(1===t.nodeType)return t;var e=t._reactInternals;if(void 0===e){if("function"==typeof t.render)throw Error(s(188));throw t=Object.keys(t).join(","),Error(s(268,t))}return null===(t=Wt(e))?null:t.stateNode},e.flushSync=function(t){return hc(t)},e.hydrate=function(t,e,n){if(!Zc(e))throw Error(s(200));return tu(null,t,e,!0,n)},e.hydrateRoot=function(t,e,n){if(!Yc(t))throw Error(s(405));var i=null!=n&&n.hydratedSources||null,r=!1,o="",a=Kc;if(null!=n&&(!0===n.unstable_strictMode&&(r=!0),void 0!==n.identifierPrefix&&(o=n.identifierPrefix),void 0!==n.onRecoverableError&&(a=n.onRecoverableError)),e=Vc(e,null,t,1,null!=n?n:null,r,0,o,a),t[pr]=e.current,ji(t),i)for(t=0;t<i.length;t++)r=(r=(n=i[t])._getVersion)(n._source),null==e.mutableSourceEagerHydrationData?e.mutableSourceEagerHydrationData=[n,r]:e.mutableSourceEagerHydrationData.push(n,r);return new Qc(e)},e.render=function(t,e,n){if(!Zc(e))throw Error(s(200));return tu(null,t,e,!1,n)},e.unmountComponentAtNode=function(t){if(!Zc(t))throw Error(s(40));return!!t._reactRootContainer&&(hc((function(){tu(null,null,t,!1,(function(){t._reactRootContainer=null,t[pr]=null}))})),!0)},e.unstable_batchedUpdates=uc,e.unstable_renderSubtreeIntoContainer=function(t,e,n,i){if(!Zc(n))throw Error(s(200));if(null==t||void 0===t._reactInternals)throw Error(s(38));return tu(t,e,n,!1,i)},e.version="18.2.0-next-9e3b772b8-20220608"},745:(t,e,n)=>{"use strict";var i=n(935);e.s=i.createRoot,i.hydrateRoot},935:(t,e,n)=>{"use strict";!function t(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(t){console.error(t)}}(),t.exports=n(448)},408:(t,e)=>{"use strict";var n=Symbol.for("react.element"),i=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),f=Symbol.iterator,p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,m={};function v(t,e,n){this.props=t,this.context=e,this.refs=m,this.updater=n||p}function y(){}function b(t,e,n){this.props=t,this.context=e,this.refs=m,this.updater=n||p}v.prototype.isReactComponent={},v.prototype.setState=function(t,e){if("object"!=typeof t&&"function"!=typeof t&&null!=t)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")},v.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")},y.prototype=v.prototype;var _=b.prototype=new y;_.constructor=b,g(_,v.prototype),_.isPureReactComponent=!0;var A=Array.isArray,w=Object.prototype.hasOwnProperty,C={current:null},E={key:!0,ref:!0,__self:!0,__source:!0};function x(t,e,i){var r,s={},o=null,a=null;if(null!=e)for(r in void 0!==e.ref&&(a=e.ref),void 0!==e.key&&(o=""+e.key),e)w.call(e,r)&&!E.hasOwnProperty(r)&&(s[r]=e[r]);var l=arguments.length-2;if(1===l)s.children=i;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];s.children=c}if(t&&t.defaultProps)for(r in l=t.defaultProps)void 0===s[r]&&(s[r]=l[r]);return{$$typeof:n,type:t,key:o,ref:a,props:s,_owner:C.current}}function T(t){return"object"==typeof t&&null!==t&&t.$$typeof===n}var S=/\/+/g;function B(t,e){return"object"==typeof t&&null!==t&&null!=t.key?function(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,(function(t){return e[t]}))}(""+t.key):e.toString(36)}function P(t,e,r,s,o){var a=typeof t;"undefined"!==a&&"boolean"!==a||(t=null);var l=!1;if(null===t)l=!0;else switch(a){case"string":case"number":l=!0;break;case"object":switch(t.$$typeof){case n:case i:l=!0}}if(l)return o=o(l=t),t=""===s?"."+B(l,0):s,A(o)?(r="",null!=t&&(r=t.replace(S,"$&/")+"/"),P(o,e,r,"",(function(t){return t}))):null!=o&&(T(o)&&(o=function(t,e){return{$$typeof:n,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}(o,r+(!o.key||l&&l.key===o.key?"":(""+o.key).replace(S,"$&/")+"/")+t)),e.push(o)),1;if(l=0,s=""===s?".":s+":",A(t))for(var c=0;c<t.length;c++){var u=s+B(a=t[c],c);l+=P(a,e,r,u,o)}else if(u=function(t){return null===t||"object"!=typeof t?null:"function"==typeof(t=f&&t[f]||t["@@iterator"])?t:null}(t),"function"==typeof u)for(t=u.call(t),c=0;!(a=t.next()).done;)l+=P(a=a.value,e,r,u=s+B(a,c++),o);else if("object"===a)throw e=String(t),Error("Objects are not valid as a React child (found: "+("[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return l}function M(t,e,n){if(null==t)return t;var i=[],r=0;return P(t,i,"","",(function(t){return e.call(n,t,r++)})),i}function I(t){if(-1===t._status){var e=t._result;(e=e()).then((function(e){0!==t._status&&-1!==t._status||(t._status=1,t._result=e)}),(function(e){0!==t._status&&-1!==t._status||(t._status=2,t._result=e)})),-1===t._status&&(t._status=0,t._result=e)}if(1===t._status)return t._result.default;throw t._result}var L={current:null},O={transition:null},R={ReactCurrentDispatcher:L,ReactCurrentBatchConfig:O,ReactCurrentOwner:C};e.Children={map:M,forEach:function(t,e,n){M(t,(function(){e.apply(this,arguments)}),n)},count:function(t){var e=0;return M(t,(function(){e++})),e},toArray:function(t){return M(t,(function(t){return t}))||[]},only:function(t){if(!T(t))throw Error("React.Children.only expected to receive a single React element child.");return t}},e.Component=v,e.Fragment=r,e.Profiler=o,e.PureComponent=b,e.StrictMode=s,e.Suspense=u,e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=R,e.cloneElement=function(t,e,i){if(null==t)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=g({},t.props),s=t.key,o=t.ref,a=t._owner;if(null!=e){if(void 0!==e.ref&&(o=e.ref,a=C.current),void 0!==e.key&&(s=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(c in e)w.call(e,c)&&!E.hasOwnProperty(c)&&(r[c]=void 0===e[c]&&void 0!==l?l[c]:e[c])}var c=arguments.length-2;if(1===c)r.children=i;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];r.children=l}return{$$typeof:n,type:t.type,key:s,ref:o,props:r,_owner:a}},e.createContext=function(t){return(t={$$typeof:l,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:a,_context:t},t.Consumer=t},e.createElement=x,e.createFactory=function(t){var e=x.bind(null,t);return e.type=t,e},e.createRef=function(){return{current:null}},e.forwardRef=function(t){return{$$typeof:c,render:t}},e.isValidElement=T,e.lazy=function(t){return{$$typeof:d,_payload:{_status:-1,_result:t},_init:I}},e.memo=function(t,e){return{$$typeof:h,type:t,compare:void 0===e?null:e}},e.startTransition=function(t){var e=O.transition;O.transition={};try{t()}finally{O.transition=e}},e.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},e.useCallback=function(t,e){return L.current.useCallback(t,e)},e.useContext=function(t){return L.current.useContext(t)},e.useDebugValue=function(){},e.useDeferredValue=function(t){return L.current.useDeferredValue(t)},e.useEffect=function(t,e){return L.current.useEffect(t,e)},e.useId=function(){return L.current.useId()},e.useImperativeHandle=function(t,e,n){return L.current.useImperativeHandle(t,e,n)},e.useInsertionEffect=function(t,e){return L.current.useInsertionEffect(t,e)},e.useLayoutEffect=function(t,e){return L.current.useLayoutEffect(t,e)},e.useMemo=function(t,e){return L.current.useMemo(t,e)},e.useReducer=function(t,e,n){return L.current.useReducer(t,e,n)},e.useRef=function(t){return L.current.useRef(t)},e.useState=function(t){return L.current.useState(t)},e.useSyncExternalStore=function(t,e,n){return L.current.useSyncExternalStore(t,e,n)},e.useTransition=function(){return L.current.useTransition()},e.version="18.2.0"},294:(t,e,n)=>{"use strict";t.exports=n(408)},53:(t,e)=>{"use strict";function n(t,e){var n=t.length;t.push(e);t:for(;0<n;){var i=n-1>>>1,r=t[i];if(!(0<s(r,e)))break t;t[i]=e,t[n]=r,n=i}}function i(t){return 0===t.length?null:t[0]}function r(t){if(0===t.length)return null;var e=t[0],n=t.pop();if(n!==e){t[0]=n;t:for(var i=0,r=t.length,o=r>>>1;i<o;){var a=2*(i+1)-1,l=t[a],c=a+1,u=t[c];if(0>s(l,n))c<r&&0>s(u,l)?(t[i]=u,t[c]=n,i=c):(t[i]=l,t[a]=n,i=a);else{if(!(c<r&&0>s(u,n)))break t;t[i]=u,t[c]=n,i=c}}}return e}function s(t,e){var n=t.sortIndex-e.sortIndex;return 0!==n?n:t.id-e.id}if("object"==typeof performance&&"function"==typeof performance.now){var o=performance;e.unstable_now=function(){return o.now()}}else{var a=Date,l=a.now();e.unstable_now=function(){return a.now()-l}}var c=[],u=[],h=1,d=null,f=3,p=!1,g=!1,m=!1,v="function"==typeof setTimeout?setTimeout:null,y="function"==typeof clearTimeout?clearTimeout:null,b="undefined"!=typeof setImmediate?setImmediate:null;function _(t){for(var e=i(u);null!==e;){if(null===e.callback)r(u);else{if(!(e.startTime<=t))break;r(u),e.sortIndex=e.expirationTime,n(c,e)}e=i(u)}}function A(t){if(m=!1,_(t),!g)if(null!==i(c))g=!0,O(w);else{var e=i(u);null!==e&&R(A,e.startTime-t)}}function w(t,n){g=!1,m&&(m=!1,y(T),T=-1),p=!0;var s=f;try{for(_(n),d=i(c);null!==d&&(!(d.expirationTime>n)||t&&!P());){var o=d.callback;if("function"==typeof o){d.callback=null,f=d.priorityLevel;var a=o(d.expirationTime<=n);n=e.unstable_now(),"function"==typeof a?d.callback=a:d===i(c)&&r(c),_(n)}else r(c);d=i(c)}if(null!==d)var l=!0;else{var h=i(u);null!==h&&R(A,h.startTime-n),l=!1}return l}finally{d=null,f=s,p=!1}}"undefined"!=typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var C,E=!1,x=null,T=-1,S=5,B=-1;function P(){return!(e.unstable_now()-B<S)}function M(){if(null!==x){var t=e.unstable_now();B=t;var n=!0;try{n=x(!0,t)}finally{n?C():(E=!1,x=null)}}else E=!1}if("function"==typeof b)C=function(){b(M)};else if("undefined"!=typeof MessageChannel){var I=new MessageChannel,L=I.port2;I.port1.onmessage=M,C=function(){L.postMessage(null)}}else C=function(){v(M,0)};function O(t){x=t,E||(E=!0,C())}function R(t,n){T=v((function(){t(e.unstable_now())}),n)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(t){t.callback=null},e.unstable_continueExecution=function(){g||p||(g=!0,O(w))},e.unstable_forceFrameRate=function(t){0>t||125<t?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):S=0<t?Math.floor(1e3/t):5},e.unstable_getCurrentPriorityLevel=function(){return f},e.unstable_getFirstCallbackNode=function(){return i(c)},e.unstable_next=function(t){switch(f){case 1:case 2:case 3:var e=3;break;default:e=f}var n=f;f=e;try{return t()}finally{f=n}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(t,e){switch(t){case 1:case 2:case 3:case 4:case 5:break;default:t=3}var n=f;f=t;try{return e()}finally{f=n}},e.unstable_scheduleCallback=function(t,r,s){var o=e.unstable_now();switch(s="object"==typeof s&&null!==s&&"number"==typeof(s=s.delay)&&0<s?o+s:o,t){case 1:var a=-1;break;case 2:a=250;break;case 5:a=1073741823;break;case 4:a=1e4;break;default:a=5e3}return t={id:h++,callback:r,priorityLevel:t,startTime:s,expirationTime:a=s+a,sortIndex:-1},s>o?(t.sortIndex=s,n(u,t),null===i(c)&&t===i(u)&&(m?(y(T),T=-1):m=!0,R(A,s-o))):(t.sortIndex=a,n(c,t),g||p||(g=!0,O(w))),t},e.unstable_shouldYield=P,e.unstable_wrapCallback=function(t){var e=f;return function(){var n=f;f=e;try{return t.apply(this,arguments)}finally{f=n}}}},840:(t,e,n)=>{"use strict";t.exports=n(53)}},s={};function o(t){var e=s[t];if(void 0!==e)return e.exports;var n=s[t]={exports:{}};return r[t].call(n.exports,n,n.exports,o),n.exports}o.m=r,o.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return o.d(e,{a:e}),e},e=Object.getPrototypeOf?t=>Object.getPrototypeOf(t):t=>t.__proto__,o.t=function(n,i){if(1&i&&(n=this(n)),8&i)return n;if("object"==typeof n&&n){if(4&i&&n.__esModule)return n;if(16&i&&"function"==typeof n.then)return n}var r=Object.create(null);o.r(r);var s={};t=t||[null,e({}),e([]),e(e)];for(var a=2&i&&n;"object"==typeof a&&!~t.indexOf(a);a=e(a))Object.getOwnPropertyNames(a).forEach((t=>s[t]=()=>n[t]));return s.default=()=>n,o.d(r,s),r},o.d=(t,e)=>{for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o.f={},o.e=t=>Promise.all(Object.keys(o.f).reduce(((e,n)=>(o.f[n](t,e),e)),[])),o.u=t=>t+".js",o.miniCssF=t=>{},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n={},i="deck.gl-minimum-template:",o.l=(t,e,r,s)=>{if(n[t])n[t].push(e);else{var a,l;if(void 0!==r)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var h=c[u];if(h.getAttribute("src")==t||h.getAttribute("data-webpack")==i+r){a=h;break}}a||(l=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,o.nc&&a.setAttribute("nonce",o.nc),a.setAttribute("data-webpack",i+r),a.src=t),n[t]=[e];var d=(e,i)=>{a.onerror=a.onload=null,clearTimeout(f);var r=n[t];if(delete n[t],a.parentNode&&a.parentNode.removeChild(a),r&&r.forEach((t=>t(i))),e)return e(i)},f=setTimeout(d.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=d.bind(null,a.onerror),a.onload=d.bind(null,a.onload),l&&document.head.appendChild(a)}},o.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.p="",(()=>{var t={804:0};o.f.j=(e,n)=>{var i=o.o(t,e)?t[e]:void 0;if(0!==i)if(i)n.push(i[2]);else{var r=new Promise(((n,r)=>i=t[e]=[n,r]));n.push(i[2]=r);var s=o.p+o.u(e),a=new Error;o.l(s,(n=>{if(o.o(t,e)&&(0!==(i=t[e])&&(t[e]=void 0),i)){var r=n&&("load"===n.type?"missing":n.type),s=n&&n.target&&n.target.src;a.message="Loading chunk "+e+" failed.\n("+r+": "+s+")",a.name="ChunkLoadError",a.type=r,a.request=s,i[1](a)}}),"chunk-"+e,e)}};var e=(e,n)=>{var i,r,[s,a,l]=n,c=0;if(s.some((e=>0!==t[e]))){for(i in a)o.o(a,i)&&(o.m[i]=a[i]);l&&l(o)}for(e&&e(n);c<s.length;c++)r=s[c],o.o(t,r)&&t[r]&&t[r][0](),t[r]=0},n=self.webpackChunkdeck_gl_minimum_template=self.webpackChunkdeck_gl_minimum_template||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))})(),(()=>{"use strict";var t={};o.r(t),o.d(t,{readFileAsArrayBuffer:()=>Kg,readFileAsText:()=>Xg,requireFromFile:()=>Qg,requireFromString:()=>Yg});var e={};o.r(e),o.d(e,{decode:()=>ev,name:()=>tv});var n={};o.r(n),o.d(n,{name:()=>ov,preprocess:()=>av});var i={};o.r(i),o.d(i,{name:()=>cv,preprocess:()=>uv});var r={};o.r(r),o.d(r,{decode:()=>ty,encode:()=>ey,name:()=>Zv,preprocess:()=>$v});var s={};o.r(s),o.d(s,{decode:()=>vy,name:()=>fy});var a={};o.r(a),o.d(a,{decode:()=>Cy,encode:()=>Ey,name:()=>wy});var l={};o.r(l),o.d(l,{decode:()=>Sy,encode:()=>By,name:()=>Ty});var c={};o.r(c),o.d(c,{decode:()=>Iy,encode:()=>Ly,name:()=>My});var u={};o.r(u),o.d(u,{decode:()=>ky,name:()=>Fy});var h=o(294),d=o(745);function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function p(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,r,s,o,a=[],l=!0,c=!1;try{if(s=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=s.call(n)).done)&&(a.push(i.value),a.length!==e);l=!0);}catch(t){c=!0,r=t}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw r}}return a}}(t,e)||function(t,e){if(t){if("string"==typeof t)return f(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(t){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},g(t)}function m(t,e,n){return(e=function(t){var e=function(t,e){if("object"!==g(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,"string");if("object"!==g(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===g(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}let v=1,y=1;class b{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(t){const{delay:e=0,duration:n=Number.POSITIVE_INFINITY,rate:i=1,repeat:r=1}=t,s=v++,o={time:0,delay:e,duration:n,rate:i,repeat:r};return this._setChannelTime(o,this.time),this.channels.set(s,o),s}removeChannel(t){this.channels.delete(t);for(const[e,n]of this.animations)n.channel===t&&this.detachAnimation(e)}isFinished(t){const e=this.channels.get(t);return void 0!==e&&this.time>=e.delay+e.duration*e.repeat}getTime(t){if(void 0===t)return this.time;const e=this.channels.get(t);return void 0===e?-1:e.time}setTime(t){this.time=Math.max(0,t);const e=this.channels.values();for(const t of e)this._setChannelTime(t,this.time);const n=this.animations.values();for(const t of n){const{animation:e,channel:n}=t;e.setTime(this.getTime(n))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(t,e){const n=y++;return this.animations.set(n,{animation:t,channel:e}),t.setTime(this.getTime(e)),n}detachAnimation(t){this.animations.delete(t)}update(t){this.playing&&(-1===this.lastEngineTime&&(this.lastEngineTime=t),this.setTime(this.time+(t-this.lastEngineTime)),this.lastEngineTime=t)}_setChannelTime(t,e){const n=e-t.delay;n>=t.duration*t.repeat?t.time=t.duration*t.rate:(t.time=Math.max(0,n)%t.duration,t.time*=t.rate)}}const _=Symbol.for("component"),A=Symbol.for("propTypes"),w=Symbol.for("deprecatedProps"),C=Symbol.for("asyncPropDefaults"),E=Symbol.for("asyncPropOriginal"),x=Symbol.for("asyncPropResolved");function T(t){if("undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof process&&"object"==typeof process.versions&&Boolean(process.versions.electron))return!0;const e="object"==typeof navigator&&"string"==typeof navigator.userAgent&&navigator.userAgent,n=t||e;return!!(n&&n.indexOf("Electron")>=0)}function S(){return!("object"==typeof process&&"[object process]"===String(process)&&!process.browser)||T()}const B="undefined"!=typeof __VERSION__?__VERSION__:"untranspiled source";S();class P{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage";m(this,"storage",void 0),m(this,"id",void 0),m(this,"config",void 0),this.storage=function(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch(t){return null}}(n),this.id=t,this.config=e,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){if(Object.assign(this.config,t),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let t={};if(this.storage){const e=this.storage.getItem(this.id);t=e?JSON.parse(e):{}}return Object.assign(this.config,t),this}}function M(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:600;const r=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>i&&(n=Math.min(n,i/t.width));const s=t.width*n,o=t.height*n,a=["font-size:1px;","padding:".concat(Math.floor(o/2),"px ").concat(Math.floor(s/2),"px;"),"line-height:".concat(o,"px;"),"background:url(".concat(r,");"),"background-size:".concat(s,"px ").concat(o,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),a]}let I;function L(t){return"string"==typeof t?I[t.toUpperCase()]||I.WHITE:t}function O(t,e){if(!t)throw new Error(e||"Assertion failed")}!function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"}(I||(I={}));const R={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==o.g&&o.g,document:"undefined"!=typeof document&&document,process:"object"==typeof process&&process},F=R.window||R.self||R.global,k=R.process||{};function D(){let t;var e,n;if(S&&"performance"in F)t=null==F||null===(e=F.performance)||void 0===e||null===(n=e.now)||void 0===n?void 0:n.call(e);else if("hrtime"in k){var i;const e=null==k||null===(i=k.hrtime)||void 0===i?void 0:i.call(k);t=1e3*e[0]+e[1]/1e6}else t=Date.now();return t}const N={debug:S&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},U={enabled:!0,level:0};function z(){}const G={},j={once:!0};class V{constructor(){let{id:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{id:""};m(this,"id",void 0),m(this,"VERSION",B),m(this,"_startTs",D()),m(this,"_deltaTs",D()),m(this,"_storage",void 0),m(this,"userData",{}),m(this,"LOG_THROTTLE_TIMEOUT",0),this.id=t,this.userData={},this._storage=new P("__probe-".concat(this.id,"__"),U),this.timeStamp("".concat(this.id," started")),function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["constructor"];const n=Object.getPrototypeOf(t),i=Object.getOwnPropertyNames(n);for(const n of i)"function"==typeof t[n]&&(e.find((t=>n===t))||(t[n]=t[n].bind(t)))}(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((D()-this._startTs).toPrecision(10))}getDelta(){return Number((D()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._storage.setConfiguration({enabled:t}),this}setLevel(t){return this._storage.setConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,e){this._storage.setConfiguration({[t]:e})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,e){O(t,e)}warn(t){return this._getLogFunction(0,t,N.warn,arguments,j)}error(t){return this._getLogFunction(0,t,N.error,arguments)}deprecated(t,e){return this.warn("`".concat(t,"` is deprecated and will be removed in a later version. Use `").concat(e,"` instead"))}removed(t,e){return this.error("`".concat(t,"` has been removed. Use `").concat(e,"` instead"))}probe(t,e){return this._getLogFunction(t,e,N.log,arguments,{time:!0,once:!0})}log(t,e){return this._getLogFunction(t,e,N.debug,arguments)}info(t,e){return this._getLogFunction(t,e,console.info,arguments)}once(t,e){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return this._getLogFunction(t,e,N.debug||N.info,arguments,j)}table(t,e,n){return e?this._getLogFunction(t,e,console.table||z,n&&[n],{tag:J(e)}):z}image(t){let{logLevel:e,priority:n,image:i,message:r="",scale:s=1}=t;return this._shouldLog(e||n)?S?function(t){let{image:e,message:n="",scale:i=1}=t;if("string"==typeof e){const t=new Image;return t.onload=()=>{const e=M(t,n,i);console.log(...e)},t.src=e,z}const r=e.nodeName||"";if("img"===r.toLowerCase())return console.log(...M(e,n,i)),z;if("canvas"===r.toLowerCase()){const t=new Image;return t.onload=()=>console.log(...M(t,n,i)),t.src=e.toDataURL(),z}return z}({image:i,message:r,scale:s}):function(t){let{image:e,message:n="",scale:i=1}=t;return console.warn("removed"),z}({image:i,message:r,scale:s}):z}time(t,e){return this._getLogFunction(t,e,console.time?console.time:console.info)}timeEnd(t,e){return this._getLogFunction(t,e,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,e){return this._getLogFunction(t,e,console.timeStamp||z)}group(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{collapsed:!1};const i=W({logLevel:t,message:e,opts:n}),{collapsed:r}=n;return i.method=(r?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.group(t,e,Object.assign({},n,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||z)}withGroup(t,e,n){this.group(t,e)();try{n()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=H(t)}_getLogFunction(t,e,n,i,r){if(this._shouldLog(t)){r=W({logLevel:t,message:e,args:i,opts:r}),O(n=n||r.method),r.total=this.getTotal(),r.delta=this.getDelta(),this._deltaTs=D();const s=r.tag||r.message;if(r.once){if(G[s])return z;G[s]=D()}return e=function(t,e,n){if("string"==typeof e){const o=n.time?function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8;const n=Math.max(e-t.length,0);return"".concat(" ".repeat(n)).concat(t)}(function(t){let e;return e=t<10?"".concat(t.toFixed(2),"ms"):t<100?"".concat(t.toFixed(1),"ms"):t<1e3?"".concat(t.toFixed(0),"ms"):"".concat((t/1e3).toFixed(2),"s"),e}(n.total)):"";i=e=n.time?"".concat(t,": ").concat(o,"  ").concat(e):"".concat(t,": ").concat(e),r=n.color,s=n.background,S||"string"!=typeof i||(r&&(r=L(r),i="[".concat(r,"m").concat(i,"[39m")),s&&(r=L(s),i="[".concat(s+10,"m").concat(i,"[49m"))),e=i}var i,r,s;return e}(this.id,r.message,r),n.bind(console,e,...r.args)}return z}}function H(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return O(Number.isFinite(e)&&e>=0),e}function W(t){const{logLevel:e,message:n}=t;t.logLevel=H(e);const i=t.args?Array.from(t.args):[];for(;i.length&&i.shift()!==n;);switch(typeof e){case"string":case"function":void 0!==n&&i.unshift(n),t.message=e;break;case"object":Object.assign(t,e)}"function"==typeof t.message&&(t.message=t.message());const r=typeof t.message;return O("string"===r||"object"===r),Object.assign(t,{args:i},t.opts)}function J(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}m(V,"VERSION",B);const q=new V({id:"deck"});let K={};function X(t){K=t}function Q(t,e,n,i){q.level>0&&K[t]&&K[t].call(null,e,n,i)}function Y(t,e=(()=>!0)){return Array.isArray(t)?Z(t,e,[]):e(t)?[t]:[]}function Z(t,e,n){let i=-1;for(;++i<t.length;){const r=t[i];Array.isArray(r)?Z(r,e,n):e(r)&&n.push(r)}return n}function $({target:t,source:e,start:n=0,count:i=1}){const r=e.length,s=i*r;let o=0;for(let i=n;o<r;o++)t[i++]=e[o];for(;o<s;)o<s-o?(t.copyWithin(n+o,n,n+o),o*=2):(t.copyWithin(n+o,n,n+s-o),o=s);return t}function tt(){let t;if("undefined"!=typeof window&&window.performance)t=window.performance.now();else if("undefined"!=typeof process&&process.hrtime){const e=process.hrtime();t=1e3*e[0]+e[1]/1e6}else t=Date.now();return t}class et{constructor(t,e){m(this,"name",void 0),m(this,"type",void 0),m(this,"sampleSize",1),m(this,"time",void 0),m(this,"count",void 0),m(this,"samples",void 0),m(this,"lastTiming",void 0),m(this,"lastSampleTime",void 0),m(this,"lastSampleCount",void 0),m(this,"_count",0),m(this,"_time",0),m(this,"_samples",0),m(this,"_startTime",0),m(this,"_timerPending",!1),this.name=t,this.type=e,this.reset()}setSampleSize(t){return this.sampleSize=t,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(t){return this._count+=t,this._samples++,this._checkSampling(),this}subtractCount(t){return this._count-=t,this._samples++,this._checkSampling(),this}addTime(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=tt(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(tt()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class nt{constructor(t){m(this,"id",void 0),m(this,"stats",{}),this.id=t.id,this.stats={},this._initializeStats(t.stats),Object.seal(this)}get(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"count";return this._getOrCreate({name:t,type:e})}get size(){return Object.keys(this.stats).length}reset(){for(const t in this.stats)this.stats[t].reset();return this}forEach(t){for(const e in this.stats)t(this.stats[e])}getTable(){const t={};return this.forEach((e=>{t[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}})),t}_initializeStats(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach((t=>this._getOrCreate(t)))}_getOrCreate(t){if(!t||!t.name)return null;const{name:e,type:n}=t;return this.stats[e]||(this.stats[e]=t instanceof et?t:new et(e,n)),this.stats[e]}}const it=t=>"function"==typeof t,rt=t=>null!==t&&"object"==typeof t,st=t=>rt(t)&&t.constructor==={}.constructor,ot=t=>t&&"function"==typeof t[Symbol.iterator],at=t=>t&&"function"==typeof t[Symbol.asyncIterator],lt=t=>"undefined"!=typeof Response&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,ct=t=>"undefined"!=typeof Blob&&t instanceof Blob,ut=t=>t&&"object"==typeof t&&t.isBuffer,ht=t=>(t=>"undefined"!=typeof ReadableStream&&t instanceof ReadableStream||rt(t)&&it(t.tee)&&it(t.cancel)&&it(t.getReader))(t)||(t=>rt(t)&&it(t.read)&&it(t.pipe)&&(t=>"boolean"==typeof t)(t.readable))(t);function dt(t,e){if(!t)throw new Error(e||"loader assertion failed.")}function ft(t){var e;return!!t&&(Array.isArray(t)&&(t=t[0]),Array.isArray(null===(e=t)||void 0===e?void 0:e.extensions))}function pt(t){var e,n;let i;return dt(t,"null loader"),dt(ft(t),"invalid loader"),Array.isArray(t)&&(i=t[1],t=t[0],t={...t,options:{...t.options,...i}}),(null!==(e=t)&&void 0!==e&&e.parseTextSync||null!==(n=t)&&void 0!==n&&n.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}let gt="";const mt={},vt=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,yt=/^([-\w.]+\/[-\w.+]+)/;function bt(t){const e=vt.exec(t);return e?e[1]:""}const _t=/\?.*/;function At(t){return t.replace(_t,"")}function wt(t){return lt(t)?t.url:ct(t)?t.name||"":"string"==typeof t?t:""}function Ct(t){if(lt(t)){const e=t,n=e.headers.get("content-type")||"",i=At(e.url);return function(t){const e=yt.exec(t);return e?e[1]:t}(n)||bt(i)}return ct(t)?t.type||"":"string"==typeof t?bt(t):""}async function Et(t){if(lt(t))return t;const e={},n=function(t){return lt(t)?t.headers["content-length"]||-1:ct(t)?t.size:"string"==typeof t?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}(t);n>=0&&(e["content-length"]=String(n));const i=wt(t),r=Ct(t);r&&(e["content-type"]=r);const s=await async function(t){if("string"==typeof t)return"data:,".concat(t.slice(0,5));if(t instanceof Blob){const e=t.slice(0,5);return await new Promise((t=>{const n=new FileReader;n.onload=e=>{var n;return t(null==e||null===(n=e.target)||void 0===n?void 0:n.result)},n.readAsDataURL(e)}))}if(t instanceof ArrayBuffer){const e=function(t){let e="";const n=new Uint8Array(t);for(let t=0;t<n.byteLength;t++)e+=String.fromCharCode(n[t]);return btoa(e)}(t.slice(0,5));return"data:base64,".concat(e)}return null}(t);s&&(e["x-first-bytes"]=s),"string"==typeof t&&(t=(new TextEncoder).encode(t));const o=new Response(t,{headers:e});return Object.defineProperty(o,"url",{value:i}),o}async function xt(t,e){if("string"==typeof t){t=function(t){for(const e in mt)if(t.startsWith(e)){const n=mt[e];t=t.replace(e,n)}return t.startsWith("http://")||t.startsWith("https://")||(t="".concat(gt).concat(t)),t}(t);let n=e;return null!=e&&e.fetch&&"function"!=typeof(null==e?void 0:e.fetch)&&(n=e.fetch),await fetch(t,n)}return await Et(t)}function Tt(){return!("object"==typeof process&&"[object process]"===String(process)&&!process.browser)||function(t){if("undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof process&&"object"==typeof process.versions&&Boolean(process.versions.electron))return!0;const e="object"==typeof navigator&&"string"==typeof navigator.userAgent&&navigator.userAgent;return!!(e&&e.indexOf("Electron")>=0)}()}const St="undefined"!=typeof __VERSION__?__VERSION__:"untranspiled source";Tt();class Bt{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage";this.storage=void 0,this.id=void 0,this.config=void 0,this.storage=function(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch(t){return null}}(n),this.id=t,this.config=e,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){if(Object.assign(this.config,t),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let t={};if(this.storage){const e=this.storage.getItem(this.id);t=e?JSON.parse(e):{}}return Object.assign(this.config,t),this}}function Pt(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:600;const r=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>i&&(n=Math.min(n,i/t.width));const s=t.width*n,o=t.height*n,a=["font-size:1px;","padding:".concat(Math.floor(o/2),"px ").concat(Math.floor(s/2),"px;"),"line-height:".concat(o,"px;"),"background:url(".concat(r,");"),"background-size:".concat(s,"px ").concat(o,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),a]}let Mt;!function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"}(Mt||(Mt={}));function It(t){return"string"!=typeof t?t:(t=t.toUpperCase(),Mt[t]||Mt.WHITE)}function Lt(t,e){if(!t)throw new Error(e||"Assertion failed")}globalThis.self||globalThis.window||globalThis.global;const Ot=globalThis.window||globalThis.self||globalThis.global,Rt=(globalThis.document,globalThis.process||{});function Ft(){let t;var e,n;if(Tt()&&Ot.performance)t=null==Ot||null===(e=Ot.performance)||void 0===e||null===(n=e.now)||void 0===n?void 0:n.call(e);else if("hrtime"in Rt){var i;const e=null==Rt||null===(i=Rt.hrtime)||void 0===i?void 0:i.call(Rt);t=1e3*e[0]+e[1]/1e6}else t=Date.now();return t}globalThis.console,globalThis.navigator;const kt={debug:Tt()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Dt={enabled:!0,level:0};function Nt(){}const Ut={},zt={once:!0};class Gt{constructor(){let{id:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{id:""};this.id=void 0,this.VERSION=St,this._startTs=Ft(),this._deltaTs=Ft(),this._storage=void 0,this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=t,this.userData={},this._storage=new Bt("__probe-".concat(this.id,"__"),Dt),this.timeStamp("".concat(this.id," started")),function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["constructor"];const n=Object.getPrototypeOf(t),i=Object.getOwnPropertyNames(n),r=t;for(const n of i){const i=r[n];"function"==typeof i&&(e.find((t=>n===t))||(r[n]=i.bind(t)))}}(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Ft()-this._startTs).toPrecision(10))}getDelta(){return Number((Ft()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._storage.setConfiguration({enabled:t}),this}setLevel(t){return this._storage.setConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,e){this._storage.setConfiguration({[t]:e})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,e){Lt(t,e)}warn(t){return this._getLogFunction(0,t,kt.warn,arguments,zt)}error(t){return this._getLogFunction(0,t,kt.error,arguments)}deprecated(t,e){return this.warn("`".concat(t,"` is deprecated and will be removed in a later version. Use `").concat(e,"` instead"))}removed(t,e){return this.error("`".concat(t,"` has been removed. Use `").concat(e,"` instead"))}probe(t,e){return this._getLogFunction(t,e,kt.log,arguments,{time:!0,once:!0})}log(t,e){return this._getLogFunction(t,e,kt.debug,arguments)}info(t,e){return this._getLogFunction(t,e,console.info,arguments)}once(t,e){return this._getLogFunction(t,e,kt.debug||kt.info,arguments,zt)}table(t,e,n){return e?this._getLogFunction(t,e,console.table||Nt,n&&[n],{tag:Ht(e)}):Nt}image(t){let{logLevel:e,priority:n,image:i,message:r="",scale:s=1}=t;return this._shouldLog(e||n)?Tt()?function(t){let{image:e,message:n="",scale:i=1}=t;if("string"==typeof e){const t=new Image;return t.onload=()=>{const e=Pt(t,n,i);console.log(...e)},t.src=e,Nt}const r=e.nodeName||"";if("img"===r.toLowerCase())return console.log(...Pt(e,n,i)),Nt;if("canvas"===r.toLowerCase()){const t=new Image;return t.onload=()=>console.log(...Pt(t,n,i)),t.src=e.toDataURL(),Nt}return Nt}({image:i,message:r,scale:s}):function(t){let{image:e,message:n="",scale:i=1}=t;return console.warn("removed"),Nt}({image:i,message:r,scale:s}):Nt}time(t,e){return this._getLogFunction(t,e,console.time?console.time:console.info)}timeEnd(t,e){return this._getLogFunction(t,e,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,e){return this._getLogFunction(t,e,console.timeStamp||Nt)}group(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{collapsed:!1};const i=Vt({logLevel:t,message:e,opts:n}),{collapsed:r}=n;return i.method=(r?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.group(t,e,Object.assign({},n,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||Nt)}withGroup(t,e,n){this.group(t,e)();try{n()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=jt(t)}_getLogFunction(t,e,n,i,r){if(this._shouldLog(t)){r=Vt({logLevel:t,message:e,args:i,opts:r}),Lt(n=n||r.method),r.total=this.getTotal(),r.delta=this.getDelta(),this._deltaTs=Ft();const s=r.tag||r.message;if(r.once&&s){if(Ut[s])return Nt;Ut[s]=Ft()}return e=function(t,e,n){if("string"==typeof e){const i=n.time?function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8;const n=Math.max(e-t.length,0);return"".concat(" ".repeat(n)).concat(t)}(function(t){let e;return e=t<10?"".concat(t.toFixed(2),"ms"):t<100?"".concat(t.toFixed(1),"ms"):t<1e3?"".concat(t.toFixed(0),"ms"):"".concat((t/1e3).toFixed(2),"s"),e}(n.total)):"";e=function(t,e,n){if(!Tt&&"string"==typeof t){if(e){const n=It(e);t="[".concat(n,"m").concat(t,"[39m")}if(n){const e=It(n);t="[".concat(e+10,"m").concat(t,"[49m")}}return t}(e=n.time?"".concat(t,": ").concat(i,"  ").concat(e):"".concat(t,": ").concat(e),n.color,n.background)}return e}(this.id,r.message,r),n.bind(console,e,...r.args)}return Nt}}function jt(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return Lt(Number.isFinite(e)&&e>=0),e}function Vt(t){const{logLevel:e,message:n}=t;t.logLevel=jt(e);const i=t.args?Array.from(t.args):[];for(;i.length&&i.shift()!==n;);switch(typeof e){case"string":case"function":void 0!==n&&i.unshift(n),t.message=e;break;case"object":Object.assign(t,e)}"function"==typeof t.message&&(t.message=t.message());const r=typeof t.message;return Lt("string"===r||"object"===r),Object.assign(t,{args:i},t.opts)}function Ht(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}Gt.VERSION=St;const Wt=new Gt({id:"loaders.gl"});class Jt{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}"undefined"!=typeof self&&self,"undefined"!=typeof window&&window,void 0!==o.g&&o.g,"undefined"!=typeof document&&document;const qt=Boolean("object"!=typeof process||"[object process]"!==String(process)||process.browser),Kt="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version),Xt=(Kt&&parseFloat(Kt[1]),{fetch:null,mimeType:void 0,nothrow:!1,log:new class{constructor(){m(this,"console",void 0),this.console=console}log(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.console.log.bind(this.console,...e)}info(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.console.info.bind(this.console,...e)}warn(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.console.warn.bind(this.console,...e)}error(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.console.error.bind(this.console,...e)}},CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:qt,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]}),Qt={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function Yt(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state=t._state||{},t._state}const Zt=()=>{const t=Yt();return t.globalOptions=t.globalOptions||{...Xt},t.globalOptions};function $t(t,e,n,i){return n=n||[],function(t,e){te(t,null,Xt,Qt,e);for(const n of e){const i=t&&t[n.id]||{},r=n.options&&n.options[n.id]||{},s=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};te(i,n.id,r,s,e)}}(t,n=Array.isArray(n)?n:[n]),function(t,e,n){const i={...t.options||{}};return function(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}(i,n),null===i.log&&(i.log=new Jt),ne(i,Zt()),ne(i,e),i}(e,t,i)}function te(t,e,n,i,r){const s=e||"Top level",o=e?"".concat(e,"."):"";for(const a in t){const l=!e&&rt(t[a]);if(!(a in n)&&("baseUri"!==a||e)&&("workerUrl"!==a||!e))if(a in i)Wt.warn("".concat(s," loader option '").concat(o).concat(a,"' no longer supported, use '").concat(i[a],"'"))();else if(!l){const t=ee(a,r);Wt.warn("".concat(s," loader option '").concat(o).concat(a,"' not recognized. ").concat(t))()}}}function ee(t,e){const n=t.toLowerCase();let i="";for(const r of e)for(const e in r.options){if(t===e)return"Did you mean '".concat(r.id,".").concat(e,"'?");const s=e.toLowerCase();(n.startsWith(s)||s.startsWith(n))&&(i=i||"Did you mean '".concat(r.id,".").concat(e,"'?"))}return i}function ne(t,e){for(const n in e)if(n in e){const i=e[n];st(i)&&st(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function ie(t,e){const n=Zt(),i=t||n;return"function"==typeof i.fetch?i.fetch:rt(i.fetch)?t=>xt(t,i):null!=e&&e.fetch?null==e?void 0:e.fetch:xt}function re(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const se={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==o.g&&o.g,document:"undefined"!=typeof document&&document},oe=se.global||se.self||se.window||{},ae="object"!=typeof process||"[object process]"!==String(process)||process.browser,le="function"==typeof importScripts,ce="undefined"!=typeof window&&void 0!==window.orientation,ue="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);ue&&parseFloat(ue[1]);class he{terminate(){}}const de=new Map;function fe(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function pe(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0;const i=n||new Set;if(t)if(ge(t))i.add(t);else if(ge(t.buffer))i.add(t.buffer);else if(ArrayBuffer.isView(t));else if(e&&"object"==typeof t)for(const n in t)pe(t[n],e,i);return void 0===n?Array.from(i):[]}function ge(t){return!!t&&(t instanceof ArrayBuffer||"undefined"!=typeof MessagePort&&t instanceof MessagePort||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas)}const me=()=>{};class ve{static isSupported(){return"undefined"!=typeof Worker&&ae||void 0!==he&&!ae}constructor(t){m(this,"name",void 0),m(this,"source",void 0),m(this,"url",void 0),m(this,"terminated",!1),m(this,"worker",void 0),m(this,"onMessage",void 0),m(this,"onError",void 0),m(this,"_loadableURL","");const{name:e,source:n,url:i}=t;re(n||i),this.name=e,this.source=n,this.url=i,this.onMessage=me,this.onError=t=>console.log(t),this.worker=ae?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=me,this.onError=me,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(t,e){e=e||pe(t),this.worker.postMessage(t,e)}_getErrorFromErrorEvent(t){let e="Failed to load ";return e+="worker ".concat(this.name," from ").concat(this.url,". "),t.message&&(e+="".concat(t.message," in ")),t.lineno&&(e+=":".concat(t.lineno,":").concat(t.colno)),new Error(e)}_createBrowserWorker(){this._loadableURL=function(t){re(t.source&&!t.url||!t.source&&t.url);let e=de.get(t.source||t.url);return e||(t.url&&(e=(n=t.url).startsWith("http")?fe("try {\n  importScripts('".concat(n,"');\n} catch (error) {\n  console.error(error);\n  throw error;\n}")):n,de.set(t.url,e)),t.source&&(e=fe(t.source),de.set(t.source,e))),re(e),e;var n}({source:this.source,url:this.url});const t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},t.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},t.onmessageerror=t=>console.error(t),t}_createNodeWorker(){let t;if(this.url){const e=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);t=new he(e,{eval:!1})}else{if(!this.source)throw new Error("no worker");t=new he(this.source,{eval:!0})}return t.on("message",(t=>{this.onMessage(t)})),t.on("error",(t=>{this.onError(t)})),t.on("exit",(t=>{})),t}}class ye{constructor(t,e){m(this,"name",void 0),m(this,"workerThread",void 0),m(this,"isRunning",!0),m(this,"result",void 0),m(this,"_resolve",(()=>{})),m(this,"_reject",(()=>{})),this.name=t,this.workerThread=e,this.result=new Promise(((t,e)=>{this._resolve=t,this._reject=e}))}postMessage(t,e){this.workerThread.postMessage({source:"loaders.gl",type:t,payload:e})}done(t){re(this.isRunning),this.isRunning=!1,this._resolve(t)}error(t){re(this.isRunning),this.isRunning=!1,this._reject(t)}}class be{static isSupported(){return ve.isSupported()}constructor(t){m(this,"name","unnamed"),m(this,"source",void 0),m(this,"url",void 0),m(this,"maxConcurrency",1),m(this,"maxMobileConcurrency",1),m(this,"onDebug",(()=>{})),m(this,"reuseWorkers",!0),m(this,"props",{}),m(this,"jobQueue",[]),m(this,"idleQueue",[]),m(this,"count",0),m(this,"isDestroyed",!1),this.source=t.source,this.url=t.url,this.setProps(t)}destroy(){this.idleQueue.forEach((t=>t.destroy())),this.isDestroyed=!0}setProps(t){this.props={...this.props,...t},void 0!==t.name&&(this.name=t.name),void 0!==t.maxConcurrency&&(this.maxConcurrency=t.maxConcurrency),void 0!==t.maxMobileConcurrency&&(this.maxMobileConcurrency=t.maxMobileConcurrency),void 0!==t.reuseWorkers&&(this.reuseWorkers=t.reuseWorkers),void 0!==t.onDebug&&(this.onDebug=t.onDebug)}async startJob(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(t,e,n)=>t.done(n),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(t,e)=>t.error(e);const i=new Promise((i=>(this.jobQueue.push({name:t,onMessage:e,onError:n,onStart:i}),this)));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const t=this._getAvailableWorker();if(!t)return;const e=this.jobQueue.shift();if(e){this.onDebug({message:"Starting job",name:e.name,workerThread:t,backlog:this.jobQueue.length});const n=new ye(e.name,t);t.onMessage=t=>e.onMessage(n,t.type,t.payload),t.onError=t=>e.onError(n,t),e.onStart(n);try{await n.result}finally{this.returnWorkerToQueue(t)}}}returnWorkerToQueue(t){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const t="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new ve({name:t,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return ce?this.maxMobileConcurrency:this.maxConcurrency}}const _e={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class Ae{static isSupported(){return ve.isSupported()}static getWorkerFarm(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Ae._workerFarm=Ae._workerFarm||new Ae({}),Ae._workerFarm.setProps(t),Ae._workerFarm}constructor(t){m(this,"props",void 0),m(this,"workerPools",new Map),this.props={..._e},this.setProps(t),this.workerPools=new Map}destroy(){for(const t of this.workerPools.values())t.destroy();this.workerPools=new Map}setProps(t){this.props={...this.props,...t};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(t){const{name:e,source:n,url:i}=t;let r=this.workerPools.get(e);return r||(r=new be({name:e,source:n,url:i}),r.setProps(this._getWorkerPoolProps()),this.workerPools.set(e,r)),r}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}m(Ae,"_workerFarm",void 0);const we="latest";async function Ce(t,e,n,i,r){const s=t.id,o=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=e[t.id]||{},i="".concat(t.id,"-worker.js");let r=n.workerUrl;if(r||"compression"!==t.id||(r=e.workerUrl),"test"===e._workerType&&(r="modules/".concat(t.module,"/dist/").concat(i)),!r){let e=t.version;"latest"===e&&(e=we);const n=e?"@".concat(e):"";r="https://unpkg.com/@loaders.gl/".concat(t.module).concat(n,"/dist/").concat(i)}return re(r),r}(t,n),a=Ae.getWorkerFarm(n).getWorkerPool({name:s,url:o});n=JSON.parse(JSON.stringify(n)),i=JSON.parse(JSON.stringify(i||{}));const l=await a.startJob("process-on-worker",Ee.bind(null,r));l.postMessage("process",{input:e,options:n,context:i});const c=await l.result;return await c.result}async function Ee(t,e,n,i){switch(n){case"done":e.done(i);break;case"error":e.error(new Error(i.error));break;case"process":const{id:r,input:s,options:o}=i;try{const n=await t(s,o);e.postMessage("done",{id:r,result:n})}catch(t){const n=t instanceof Error?t.message:"unknown error";e.postMessage("error",{id:r,error:n})}break;default:console.warn("parse-with-worker unknown message ".concat(n))}}function xe(t,e,n){const i=void 0!==n?new Uint8Array(t).subarray(e,e+n):new Uint8Array(t).subarray(e);return new Uint8Array(i).buffer}const Te=262144,Se=262144,Be=1048576;function Pe(t){if((e=t)&&"object"==typeof e&&e.isBuffer)return t;var e;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return 0===t.byteOffset&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if("string"==typeof t){const e=t;return(new TextEncoder).encode(e).buffer}if(t&&"object"==typeof t&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function Me(t,e){return qt?async function*(t,e){const n=t.getReader();let i;try{for(;;){const t=i||n.read();null!=e&&e._streamReadAhead&&(i=n.read());const{done:r,value:s}=await t;if(r)return;yield Pe(s)}}catch(t){n.releaseLock()}}(t,e):async function*(t,e){for await(const e of t)yield Pe(e)}(t)}const Ie="Cannot convert supplied data type";async function Le(t,e,n){const i=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if("string"==typeof t||i)return function(t,e,n){if(e.text&&"string"==typeof t)return t;if(ut(t)&&(t=t.buffer),t instanceof ArrayBuffer){const n=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let n=t.buffer;const i=t.byteLength||t.length;return 0===t.byteOffset&&i===n.byteLength||(n=n.slice(t.byteOffset,t.byteOffset+i)),n}throw new Error(Ie)}(t,e);if(ct(t)&&(t=await Et(t)),lt(t)){const n=t;return await async function(t){if(!t.ok){const e=await async function(t){let e="Failed to fetch resource ".concat(t.url," (").concat(t.status,"): ");try{const n=t.headers.get("Content-Type");let i=t.statusText;n.includes("application/json")&&(i+=" ".concat(await t.text())),e+=i,e=e.length>60?"".concat(e.slice(0,60),"..."):e}catch(t){}return e}(t);throw new Error(e)}}(n),e.binary?await n.arrayBuffer():await n.text()}if(ht(t)&&(t=function(t,e){if("string"==typeof t)return function*(t,e){const n=(null==e?void 0:e.chunkSize)||Te;let i=0;const r=new TextEncoder;for(;i<t.length;){const e=Math.min(t.length-i,n),s=t.slice(i,i+e);i+=e,yield r.encode(s)}}(t,e);if(t instanceof ArrayBuffer)return function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function*(){const{chunkSize:n=Se}=e;let i=0;for(;i<t.byteLength;){const e=Math.min(t.byteLength-i,n),r=new ArrayBuffer(e),s=new Uint8Array(t,i,e);new Uint8Array(r).set(s),i+=e,yield r}}()}(t,e);if(ct(t))return async function*(t,e){const n=(null==e?void 0:e.chunkSize)||Be;let i=0;for(;i<t.size;){const e=i+n,r=await t.slice(i,e).arrayBuffer();i=e,yield r}}(t,e);if(ht(t))return Me(t,e);if(lt(t))return Me(t.body,e);throw new Error("makeIterator")}(t,n)),ot(t)||at(t))return async function(t){const e=[];for await(const n of t)e.push(n);return function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=e.map((t=>t instanceof ArrayBuffer?new Uint8Array(t):t)),r=i.reduce(((t,e)=>t+e.byteLength),0),s=new Uint8Array(r);let o=0;for(const t of i)s.set(t,o),o+=t.byteLength;return s.buffer}(...e)}(t);throw new Error(Ie)}function Oe(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function Re(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const Fe=new Gt({id:"loaders.gl"}),ke=()=>{const t=Yt();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry},De=/\.([^.]+)$/;function Ne(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(!Ue(t))return null;if(e&&!Array.isArray(e))return pt(e);let r=[];e&&(r=r.concat(e)),null!=n&&n.ignoreRegisteredLoaders||r.push(...ke()),function(t){for(const e of t)pt(e)}(r);const s=function(t,e,n,i){const r=wt(t),s=Ct(t),o=At(r)||(null==i?void 0:i.url);let a=null,l="";var c;return null!=n&&n.mimeType&&(a=Ge(e,null==n?void 0:n.mimeType),l="match forced by supplied MIME type ".concat(null==n?void 0:n.mimeType)),a=a||function(t,e){const n=e&&De.exec(e),i=n&&n[1];return i?function(t,e){e=e.toLowerCase();for(const n of t)for(const t of n.extensions)if(t.toLowerCase()===e)return n;return null}(t,i):null}(e,o),l=l||(a?"matched url ".concat(o):""),a=a||Ge(e,s),l=l||(a?"matched MIME type ".concat(s):""),a=a||function(t,e){if(!e)return null;for(const n of t)if("string"==typeof e){if(je(e,n))return n}else if(ArrayBuffer.isView(e)){if(Ve(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&Ve(e,0,n))return n;return null}(e,t),l=l||(a?"matched initial data ".concat(He(t)):""),a=a||Ge(e,null==n?void 0:n.fallbackMimeType),l=l||(a?"matched fallback MIME type ".concat(s):""),l&&Fe.log(1,"selectLoader selected ".concat(null===(c=a)||void 0===c?void 0:c.name,": ").concat(l,".")),a}(t,r,n,i);if(!(s||null!=n&&n.nothrow))throw new Error(ze(t));return s}function Ue(t){return!(t instanceof Response&&204===t.status)}function ze(t){const e=wt(t),n=Ct(t);let i="No valid loader found (";i+=e?"".concat(Oe(e),", "):"no url provided, ",i+="MIME type: ".concat(n?'"'.concat(n,'"'):"not provided",", ");const r=t?He(t):"";return i+=r?' first bytes: "'.concat(r,'"'):"first bytes: not available",i+=")",i}function Ge(t,e){for(const n of t){if(n.mimeTypes&&n.mimeTypes.includes(e))return n;if(e==="application/x.".concat(n.id))return n}return null}function je(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some((e=>t.startsWith(e)))}function Ve(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some((i=>function(t,e,n,i){if(i instanceof ArrayBuffer)return function(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const i=new Uint8Array(t),r=new Uint8Array(e);for(let t=0;t<i.length;++t)if(i[t]!==r[t])return!1;return!0}(i,t,i.byteLength);switch(typeof i){case"function":return i(t,n);case"string":return i===We(t,e,i.length);default:return!1}}(t,e,n,i)))}function He(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;return"string"==typeof t?t.slice(0,e):ArrayBuffer.isView(t)?We(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?We(t,0,e):""}function We(t,e,n){if(t.byteLength<e+n)return"";const i=new DataView(t);let r="";for(let t=0;t<n;t++)r+=String.fromCharCode(i.getUint8(e+t));return r}async function Je(t,e,n,i){re(!i||"object"==typeof i),!e||Array.isArray(e)||ft(e)||(i=void 0,n=e,e=void 0),n=n||{};const r=wt(t=await t),s=function(t,e){if(!e&&t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const t=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...t]:t}return n&&n.length?n:null}(e,i),o=await async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(!Ue(t))return null;let r=Ne(t,e,{...n,nothrow:!0},i);if(r)return r;if(ct(t)&&(r=Ne(t=await t.slice(0,10).arrayBuffer(),e,n,i)),!(r||null!=n&&n.nothrow))throw new Error(ze(t));return r}(t,s,n);return o?(i=function(t,e,n){if(n)return n;const i={fetch:ie(e,t),...t};if(i.url){const t=At(i.url);i.baseUrl=t,i.queryString=function(t){const e=t.match(_t);return e&&e[0]}(i.url),i.filename=Oe(t),i.baseUrl=Re(t)}return Array.isArray(i.loaders)||(i.loaders=null),i}({url:r,parse:Je,loaders:s},n=$t(n,o,s,r),i||null),await async function(t,e,n,i){if(function(t){re(t,"no worker provided");t.version}(t),lt(e)){const t=e,{ok:n,redirected:r,status:s,statusText:o,type:a,url:l}=t,c=Object.fromEntries(t.headers.entries());i.response={headers:c,ok:n,redirected:r,status:s,statusText:o,type:a,url:l}}if(e=await Le(e,t,n),t.parseTextSync&&"string"==typeof e)return n.dataType="text",t.parseTextSync(e,n,i,t);if(function(t,e){return!!Ae.isSupported()&&!!(ae||null!=e&&e._nodeWorkers)&&t.worker&&(null==e?void 0:e.worker)}(t,n))return await Ce(t,e,n,i,Je);if(t.parseText&&"string"==typeof e)return await t.parseText(e,n,i,t);if(t.parse)return await t.parse(e,n,i,t);throw re(!t.parseSync),new Error("".concat(t.id," loader - no parser found and worker is disabled"))}(o,t,n,i)):null}async function qe(t,e,n,i){Array.isArray(e)||ft(e)||(n=e,e=void 0);const r=ie(n);let s=t;return"string"==typeof t&&(s=await r(t)),ct(t)&&(s=await r(t)),await Je(s,e,n)}class Ke{constructor(t,e,n){m(this,"id",void 0),m(this,"context",void 0),m(this,"isLoaded",void 0),m(this,"persistent",void 0),m(this,"_loadCount",0),m(this,"_subscribers",new Set),m(this,"_data",void 0),m(this,"_loader",void 0),m(this,"_error",void 0),m(this,"_content",void 0),this.id=t,this.context=n,this.setData(e)}subscribe(t){this._subscribers.add(t)}unsubscribe(t){this._subscribers.delete(t)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then((()=>this.getData()))}setData(t,e){if(t===this._data&&!e)return;this._data=t;const n=++this._loadCount;let i=t;"string"==typeof t&&(i=qe(t)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then((t=>{this._loadCount===n&&(this.isLoaded=!0,this._error=void 0,this._content=t)})).catch((t=>{this._loadCount===n&&(this.isLoaded=!0,this._error=t||!0)}))):(this.isLoaded=!0,this._error=void 0,this._content=t);for(const t of this._subscribers)t.onChange(this.getData())}}class Xe{constructor({gl:t,protocol:e}){m(this,"protocol",void 0),m(this,"_context",void 0),m(this,"_resources",void 0),m(this,"_consumers",void 0),m(this,"_pruneRequest",void 0),this.protocol=e||"resource://",this._context={gl:t,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(t){return!!t.startsWith(this.protocol)||t in this._resources}add({resourceId:t,data:e,forceUpdate:n=!1,persistent:i=!0}){let r=this._resources[t];r?r.setData(e,n):(r=new Ke(t,e,this._context),this._resources[t]=r),r.persistent=i}remove(t){const e=this._resources[t];e&&(e.delete(),delete this._resources[t])}unsubscribe({consumerId:t}){const e=this._consumers[t];if(e){for(const t in e){const n=e[t],i=this._resources[n.resourceId];i&&i.unsubscribe(n)}delete this._consumers[t],this.prune()}}subscribe({resourceId:t,onChange:e,consumerId:n,requestId:i="default"}){const{_resources:r,protocol:s}=this;t.startsWith(s)&&(r[t=t.replace(s,"")]||this.add({resourceId:t,data:null,persistent:!1}));const o=r[t];if(this._track(n,i,o,e),o)return o.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout((()=>this._prune()),0))}finalize(){for(const t in this._resources)this._resources[t].delete()}_track(t,e,n,i){const r=this._consumers,s=r[t]=r[t]||{},o=s[e]||{},a=o.resourceId&&this._resources[o.resourceId];a&&(a.unsubscribe(o),this.prune()),n&&(s[e]=o,o.onChange=i,o.resourceId=n.id,n.subscribe(o))}_prune(){this._pruneRequest=null;for(const t of Object.keys(this._resources)){const e=this._resources[t];e.persistent||e.inUse()||(e.delete(),delete this._resources[t])}}}const Qe=new class{constructor(t={}){m(this,"_pool",[]),m(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(t)}setOptions(t){Object.assign(this.opts,t)}allocate(t,e,{size:n=1,type:i,padding:r=0,copy:s=!1,initialize:o=!1,maxCount:a}){const l=i||t&&t.constructor||Float32Array,c=e*n+r;if(ArrayBuffer.isView(t)){if(c<=t.length)return t;if(c*t.BYTES_PER_ELEMENT<=t.buffer.byteLength)return new l(t.buffer,0,c)}let u=1/0;a&&(u=a*n+r);const h=this._allocate(l,c,o,u);return t&&s?h.set(t):o||h.fill(0,0,4),this._release(t),h}release(t){this._release(t)}_allocate(t,e,n,i){let r=Math.max(Math.ceil(e*this.opts.overAlloc),1);r>i&&(r=i);const s=this._pool,o=t.BYTES_PER_ELEMENT*r,a=s.findIndex((t=>t.byteLength>=o));if(a>=0){const e=new t(s.splice(a,1)[0],0,r);return n&&e.fill(0),e}return new t(r)}_release(t){if(!ArrayBuffer.isView(t))return;const e=this._pool,{buffer:n}=t,{byteLength:i}=n,r=e.findIndex((t=>t.byteLength>=i));r<0?e.push(n):(r>0||e.length<this.opts.poolSize)&&e.splice(r,0,n),e.length>this.opts.poolSize&&e.shift()}},Ye=1/Math.PI*180,Ze=1/180*Math.PI,$e={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function tn(t,{precision:e=$e.precision}={}){return t=function(t){return Math.round(t/$e.EPSILON)*$e.EPSILON}(t),"".concat(parseFloat(t.toPrecision(e)))}function en(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function nn(t){return function(t,e){return cn(t,(t=>t*Ze),void 0)}(t)}function rn(t){return sn(t)}function sn(t,e){return cn(t,(t=>t*Ye),e)}function on(t,e,n){return cn(t,(t=>Math.max(e,Math.min(n,t))))}function an(t,e,n){return en(t)?t.map(((t,i)=>an(t,e[i],n))):n*e+(1-n)*t}function ln(t,e,n){const i=$e.EPSILON;n&&($e.EPSILON=n);try{if(t===e)return!0;if(en(t)&&en(e)){if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(!ln(t[n],e[n]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):"number"==typeof t&&"number"==typeof e&&Math.abs(t-e)<=$e.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))}finally{$e.EPSILON=i}}function cn(t,e,n){if(en(t)){const i=t;n=n||function(t){return t.clone?t.clone():new Array(t.length)}(i);for(let r=0;r<n.length&&r<i.length;++r)n[r]=e(t[r],r,n);return n}return e(t)}class un extends(function(t){function e(){var e=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(e,Object.getPrototypeOf(this)),e}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}(Array)){clone(){return(new this.constructor).copy(this)}fromArray(t,e=0){for(let n=0;n<this.ELEMENTS;++n)this[n]=t[n+e];return this.check()}toArray(t=[],e=0){for(let n=0;n<this.ELEMENTS;++n)t[e+n]=this[n];return t}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}to(t){return t===this?this:en(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString($e)}formatString(t){let e="";for(let n=0;n<this.ELEMENTS;++n)e+=(n>0?", ":"")+tn(this[n],t);return"".concat(t.printTypes?this.constructor.name:"","[").concat(e,"]")}equals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(!ln(this[e],t[e]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,e,n){if(void 0===n)return this.lerp(this,t,e);for(let i=0;i<this.ELEMENTS;++i){const r=t[i];this[i]=r+n*(e[i]-r)}return this.check()}min(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}max(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}clamp(t,e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t[n]),e[n]);return this.check()}add(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]+=e[t];return this.check()}subtract(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]-=e[t];return this.check()}scale(t){if("number"==typeof t)for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;else for(let e=0;e<this.ELEMENTS&&e<t.length;++e)this[e]*=t[e];return this.check()}multiplyByScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}check(){if($e.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let t=this.length===this.ELEMENTS;for(let e=0;e<this.ELEMENTS;++e)t=t&&Number.isFinite(this[e]);return t}sub(t){return this.subtract(t)}setScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}addScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}divideScalar(t){return this.multiplyByScalar(1/t)}clampScalar(t,e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t),e);return this.check()}get elements(){return this}}function hn(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function dn(t,e,n=""){if($e.debug&&!function(t,e){if(t.length!==e)return!1;for(let e=0;e<t.length;++e)if(!Number.isFinite(t[e]))return!1;return!0}(t,e))throw new Error("math.gl: ".concat(n," some fields set to invalid numbers'"));return t}function fn(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}class pn extends un{get x(){return this[0]}set x(t){this[0]=hn(t)}get y(){return this[1]}set y(t){this[1]=hn(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let e=0;for(let n=0;n<this.ELEMENTS;++n){const i=this[n]-t[n];e+=i*i}return hn(e)}dot(t){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*t[n];return hn(e)}normalize(){const t=this.magnitude();if(0!==t)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}multiply(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]*=e[t];return this.check()}divide(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e[t];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return fn(t>=0&&t<this.ELEMENTS,"index is out of range"),hn(this[t])}setComponent(t,e){return fn(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=e,this.check()}addVectors(t,e){return this.copy(t).add(e)}subVectors(t,e){return this.copy(t).subtract(e)}multiplyVectors(t,e){return this.copy(t).multiply(e)}addScaledVector(t,e){return this.add(new this.constructor(t).multiplyScalar(e))}}var gn=1e-6,mn="undefined"!=typeof Float32Array?Float32Array:Array;function vn(){var t=new mn(3);return mn!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function yn(t){var e=t[0],n=t[1],i=t[2];return Math.hypot(e,n,i)}function bn(t,e,n){var i=new mn(3);return i[0]=t,i[1]=e,i[2]=n,i}function _n(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function An(t,e,n){var i=e[0],r=e[1],s=e[2],o=n[0],a=n[1],l=n[2];return t[0]=r*l-s*a,t[1]=s*o-i*l,t[2]=i*a-r*o,t}function wn(t,e,n){var i=e[0],r=e[1],s=e[2],o=n[3]*i+n[7]*r+n[11]*s+n[15];return o=o||1,t[0]=(n[0]*i+n[4]*r+n[8]*s+n[12])/o,t[1]=(n[1]*i+n[5]*r+n[9]*s+n[13])/o,t[2]=(n[2]*i+n[6]*r+n[10]*s+n[14])/o,t}function Cn(t,e,n){var i=e[0],r=e[1],s=e[2];return t[0]=i*n[0]+r*n[3]+s*n[6],t[1]=i*n[1]+r*n[4]+s*n[7],t[2]=i*n[2]+r*n[5]+s*n[8],t}function En(t,e,n){var i=n[0],r=n[1],s=n[2],o=n[3],a=e[0],l=e[1],c=e[2],u=r*c-s*l,h=s*a-i*c,d=i*l-r*a,f=r*d-s*h,p=s*u-i*d,g=i*h-r*u,m=2*o;return u*=m,h*=m,d*=m,f*=2,p*=2,g*=2,t[0]=a+u+f,t[1]=l+h+p,t[2]=c+d+g,t}Math.random,Math.PI,Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var xn=yn;function Tn(t,e,n){const i=e[0],r=e[1],s=n[3]*i+n[7]*r||1;return t[0]=(n[0]*i+n[4]*r)/s,t[1]=(n[1]*i+n[5]*r)/s,t}function Sn(t,e,n){const i=e[0],r=e[1],s=e[2],o=n[3]*i+n[7]*r+n[11]*s||1;return t[0]=(n[0]*i+n[4]*r+n[8]*s)/o,t[1]=(n[1]*i+n[5]*r+n[9]*s)/o,t[2]=(n[2]*i+n[6]*r+n[10]*s)/o,t}function Bn(t,e,n){const i=e[0],r=e[1],s=e[2];return t[0]=n[0]*i+n[3]*r+n[6]*s,t[1]=n[1]*i+n[4]*r+n[7]*s,t[2]=n[2]*i+n[5]*r+n[8]*s,t[3]=e[3],t}vn();const Pn=[0,0,0];let Mn;class In extends pn{static get ZERO(){return Mn||(Mn=new In(0,0,0),Object.freeze(Mn)),Mn}constructor(t=0,e=0,n=0){super(-0,-0,-0),1===arguments.length&&en(t)?this.copy(t):($e.debug&&(hn(t),hn(e),hn(n)),this[0]=t,this[1]=e,this[2]=n)}set(t,e,n){return this[0]=t,this[1]=e,this[2]=n,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return $e.debug&&(hn(t.x),hn(t.y),hn(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=hn(t)}angle(t){return function(t,e){var n=t[0],i=t[1],r=t[2],s=e[0],o=e[1],a=e[2],l=Math.sqrt(n*n+i*i+r*r)*Math.sqrt(s*s+o*o+a*a),c=l&&_n(t,e)/l;return Math.acos(Math.min(Math.max(c,-1),1))}(this,t)}cross(t){return An(this,this,t),this.check()}rotateX({radians:t,origin:e=Pn}){return function(t,e,n,i){var r=[],s=[];r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],s[0]=r[0],s[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),s[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2]}(this,this,e,t),this.check()}rotateY({radians:t,origin:e=Pn}){return function(t,e,n,i){var r=[],s=[];r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],s[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),s[1]=r[1],s[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2]}(this,this,e,t),this.check()}rotateZ({radians:t,origin:e=Pn}){return function(t,e,n,i){var r=[],s=[];r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],s[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),s[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),s[2]=r[2],t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2]}(this,this,e,t),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return wn(this,this,t),this.check()}transformAsVector(t){return Sn(this,this,t),this.check()}transformByMatrix3(t){return Cn(this,this,t),this.check()}transformByMatrix2(t){return function(t,e,n){const i=e[0],r=e[1];t[0]=n[0]*i+n[2]*r,t[1]=n[1]*i+n[3]*r,t[2]=e[2]}(this,this,t),this.check()}transformByQuaternion(t){return En(this,this,t),this.check()}}const Ln=new In;function On(t,e,n,i){Ln.set(t,e,n);const r=Ln.len();return{distance:i/r,normal:new In(-t/r,-e/r,-n/r)}}function Rn(t){return t-Math.fround(t)}let Fn;function kn(t,e){const{size:n=1,startIndex:i=0}=e,r=void 0!==e.endIndex?e.endIndex:t.length,s=(r-i)/n;Fn=Qe.allocate(Fn,s,{type:Float32Array,size:2*n});let o=i,a=0;for(;o<r;){for(let e=0;e<n;e++){const i=t[o++];Fn[a+e]=i,Fn[a+e+n]=Rn(i)}a+=2*n}return Fn.subarray(0,s*n*2)}function Dn(t){let e=null,n=!1;for(const i of t)i&&(e?(n||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],n=!0),e[0][0]=Math.min(e[0][0],i[0][0]),e[0][1]=Math.min(e[0][1],i[0][1]),e[1][0]=Math.max(e[1][0],i[1][0]),e[1][1]=Math.max(e[1][1],i[1][1])):e=i);return e}class Nn extends un{toString(){let t="[";if($e.printRowMajor){t+="row-major:";for(let e=0;e<this.RANK;++e)for(let n=0;n<this.RANK;++n)t+=" ".concat(this[n*this.RANK+e])}else{t+="column-major:";for(let e=0;e<this.ELEMENTS;++e)t+=" ".concat(this[e])}return t+="]",t}getElementIndex(t,e){return e*this.RANK+t}getElement(t,e){return this[e*this.RANK+t]}setElement(t,e,n){return this[e*this.RANK+t]=hn(n),this}getColumn(t,e=new Array(this.RANK).fill(-0)){const n=t*this.RANK;for(let t=0;t<this.RANK;++t)e[t]=this[n+t];return e}setColumn(t,e){const n=t*this.RANK;for(let t=0;t<this.RANK;++t)this[n+t]=e[t];return this}}function Un(t,e){var n=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],f=e[11],p=e[12],g=e[13],m=e[14],v=e[15],y=n*a-i*o,b=n*l-r*o,_=n*c-s*o,A=i*l-r*a,w=i*c-s*a,C=r*c-s*l,E=u*g-h*p,x=u*m-d*p,T=u*v-f*p,S=h*m-d*g,B=h*v-f*g,P=d*v-f*m,M=y*P-b*B+_*S+A*T-w*x+C*E;return M?(M=1/M,t[0]=(a*P-l*B+c*S)*M,t[1]=(r*B-i*P-s*S)*M,t[2]=(g*C-m*w+v*A)*M,t[3]=(d*w-h*C-f*A)*M,t[4]=(l*T-o*P-c*x)*M,t[5]=(n*P-r*T+s*x)*M,t[6]=(m*_-p*C-v*b)*M,t[7]=(u*C-d*_+f*b)*M,t[8]=(o*B-a*T+c*E)*M,t[9]=(i*T-n*B-s*E)*M,t[10]=(p*w-g*_+v*y)*M,t[11]=(h*_-u*w-f*y)*M,t[12]=(a*x-o*S-l*E)*M,t[13]=(n*S-i*x+r*E)*M,t[14]=(g*b-p*A-m*y)*M,t[15]=(u*A-h*b+d*y)*M,t):null}function zn(t,e,n){var i=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=e[9],f=e[10],p=e[11],g=e[12],m=e[13],v=e[14],y=e[15],b=n[0],_=n[1],A=n[2],w=n[3];return t[0]=b*i+_*a+A*h+w*g,t[1]=b*r+_*l+A*d+w*m,t[2]=b*s+_*c+A*f+w*v,t[3]=b*o+_*u+A*p+w*y,b=n[4],_=n[5],A=n[6],w=n[7],t[4]=b*i+_*a+A*h+w*g,t[5]=b*r+_*l+A*d+w*m,t[6]=b*s+_*c+A*f+w*v,t[7]=b*o+_*u+A*p+w*y,b=n[8],_=n[9],A=n[10],w=n[11],t[8]=b*i+_*a+A*h+w*g,t[9]=b*r+_*l+A*d+w*m,t[10]=b*s+_*c+A*f+w*v,t[11]=b*o+_*u+A*p+w*y,b=n[12],_=n[13],A=n[14],w=n[15],t[12]=b*i+_*a+A*h+w*g,t[13]=b*r+_*l+A*d+w*m,t[14]=b*s+_*c+A*f+w*v,t[15]=b*o+_*u+A*p+w*y,t}function Gn(t,e,n){var i,r,s,o,a,l,c,u,h,d,f,p,g=n[0],m=n[1],v=n[2];return e===t?(t[12]=e[0]*g+e[4]*m+e[8]*v+e[12],t[13]=e[1]*g+e[5]*m+e[9]*v+e[13],t[14]=e[2]*g+e[6]*m+e[10]*v+e[14],t[15]=e[3]*g+e[7]*m+e[11]*v+e[15]):(i=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=e[9],f=e[10],p=e[11],t[0]=i,t[1]=r,t[2]=s,t[3]=o,t[4]=a,t[5]=l,t[6]=c,t[7]=u,t[8]=h,t[9]=d,t[10]=f,t[11]=p,t[12]=i*g+a*m+h*v+e[12],t[13]=r*g+l*m+d*v+e[13],t[14]=s*g+c*m+f*v+e[14],t[15]=o*g+u*m+p*v+e[15]),t}function jn(t,e,n){var i=n[0],r=n[1],s=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Vn(t,e,n){var i=Math.sin(n),r=Math.cos(n),s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*r+c*i,t[5]=o*r+u*i,t[6]=a*r+h*i,t[7]=l*r+d*i,t[8]=c*r-s*i,t[9]=u*r-o*i,t[10]=h*r-a*i,t[11]=d*r-l*i,t}function Hn(t,e,n){var i=Math.sin(n),r=Math.cos(n),s=e[0],o=e[1],a=e[2],l=e[3],c=e[4],u=e[5],h=e[6],d=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*r+c*i,t[1]=o*r+u*i,t[2]=a*r+h*i,t[3]=l*r+d*i,t[4]=c*r-s*i,t[5]=u*r-o*i,t[6]=h*r-a*i,t[7]=d*r-l*i,t}var Wn;function Jn(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function qn(t,e){return t[0]=-e[0],t[1]=-e[1],t}function Kn(t,e,n,i){var r=e[0],s=e[1];return t[0]=r+i*(n[0]-r),t[1]=s+i*(n[1]-s),t}function Xn(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[3]*r+n[6],t[1]=n[1]*i+n[4]*r+n[7],t}function Qn(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[4]*r+n[12],t[1]=n[1]*i+n[5]*r+n[13],t}function Yn(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function Zn(t,e,n){var i=e[0],r=e[1],s=e[2],o=e[3];return t[0]=n[0]*i+n[4]*r+n[8]*s+n[12]*o,t[1]=n[1]*i+n[5]*r+n[9]*s+n[13]*o,t[2]=n[2]*i+n[6]*r+n[10]*s+n[14]*o,t[3]=n[3]*i+n[7]*r+n[11]*s+n[15]*o,t}!function(){var t;t=new mn(2),mn!=Float32Array&&(t[0]=0,t[1]=0)}(),function(){var t;t=new mn(4),mn!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}(),function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"}(Wn||(Wn={}));const $n=45*Math.PI/180,ti=1,ei=.1,ni=500,ii=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class ri extends Nn{static get IDENTITY(){return oi||(oi=new ri,Object.freeze(oi)),oi}static get ZERO(){return si||(si=new ri([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(si)),si}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Wn}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,e,n,i,r,s,o,a,l,c,u,h,d,f,p,g){return this[0]=t,this[1]=e,this[2]=n,this[3]=i,this[4]=r,this[5]=s,this[6]=o,this[7]=a,this[8]=l,this[9]=c,this[10]=u,this[11]=h,this[12]=d,this[13]=f,this[14]=p,this[15]=g,this.check()}setRowMajor(t,e,n,i,r,s,o,a,l,c,u,h,d,f,p,g){return this[0]=t,this[1]=r,this[2]=l,this[3]=d,this[4]=e,this[5]=s,this[6]=c,this[7]=f,this[8]=n,this[9]=o,this[10]=u,this[11]=p,this[12]=i,this[13]=a,this[14]=h,this[15]=g,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(ii)}fromObject(t){return this.check()}fromQuaternion(t){return function(t,e){var n=e[0],i=e[1],r=e[2],s=e[3],o=n+n,a=i+i,l=r+r,c=n*o,u=i*o,h=i*a,d=r*o,f=r*a,p=r*l,g=s*o,m=s*a,v=s*l;t[0]=1-h-p,t[1]=u+v,t[2]=d-m,t[3]=0,t[4]=u-v,t[5]=1-c-p,t[6]=f+g,t[7]=0,t[8]=d+m,t[9]=f-g,t[10]=1-c-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(this,t),this.check()}frustum(t){const{left:e,right:n,bottom:i,top:r,near:s=ei,far:o=ni}=t;return o===1/0?function(t,e,n,i,r,s){const o=2*s/(n-e),a=2*s/(r-i),l=(n+e)/(n-e),c=(r+i)/(r-i),u=-2*s;t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=l,t[9]=c,t[10]=-1,t[11]=-1,t[12]=0,t[13]=0,t[14]=u,t[15]=0}(this,e,n,i,r,s):function(t,e,n,i,r,s,o){var a=1/(n-e),l=1/(r-i),c=1/(s-o);t[0]=2*s*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*s*l,t[6]=0,t[7]=0,t[8]=(n+e)*a,t[9]=(r+i)*l,t[10]=(o+s)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*c,t[15]=0}(this,e,n,i,r,s,o),this.check()}lookAt(t){const{eye:e,center:n=[0,0,0],up:i=[0,1,0]}=t;return function(t,e,n,i){var r,s,o,a,l,c,u,h,d,f,p=e[0],g=e[1],m=e[2],v=i[0],y=i[1],b=i[2],_=n[0],A=n[1],w=n[2];Math.abs(p-_)<gn&&Math.abs(g-A)<gn&&Math.abs(m-w)<gn?function(t){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(t):(u=p-_,h=g-A,d=m-w,r=y*(d*=f=1/Math.hypot(u,h,d))-b*(h*=f),s=b*(u*=f)-v*d,o=v*h-y*u,(f=Math.hypot(r,s,o))?(r*=f=1/f,s*=f,o*=f):(r=0,s=0,o=0),a=h*o-d*s,l=d*r-u*o,c=u*s-h*r,(f=Math.hypot(a,l,c))?(a*=f=1/f,l*=f,c*=f):(a=0,l=0,c=0),t[0]=r,t[1]=a,t[2]=u,t[3]=0,t[4]=s,t[5]=l,t[6]=h,t[7]=0,t[8]=o,t[9]=c,t[10]=d,t[11]=0,t[12]=-(r*p+s*g+o*m),t[13]=-(a*p+l*g+c*m),t[14]=-(u*p+h*g+d*m),t[15]=1)}(this,e,n,i),this.check()}ortho(t){const{left:e,right:n,bottom:i,top:r,near:s=ei,far:o=ni}=t;return function(t,e,n,i,r,s,o){var a=1/(e-n),l=1/(i-r),c=1/(s-o);t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*a,t[13]=(r+i)*l,t[14]=(o+s)*c,t[15]=1}(this,e,n,i,r,s,o),this.check()}orthographic(t){const{fovy:e=$n,aspect:n=ti,focalDistance:i=1,near:r=ei,far:s=ni}=t;ai(e);const o=e/2,a=i*Math.tan(o),l=a*n;return this.ortho({left:-l,right:l,bottom:-a,top:a,near:r,far:s})}perspective(t){const{fovy:e=45*Math.PI/180,aspect:n=1,near:i=.1,far:r=500}=t;return ai(e),function(t,e,n,i,r){var s,o=1/Math.tan(e/2);t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=r&&r!==1/0?(s=1/(i-r),t[10]=(r+i)*s,t[14]=2*r*i*s):(t[10]=-1,t[14]=-2*i)}(this,e,n,i,r),this.check()}determinant(){return function(t){var e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11],f=t[12],p=t[13],g=t[14],m=t[15];return(e*o-n*s)*(h*m-d*g)-(e*a-i*s)*(u*m-d*p)+(e*l-r*s)*(u*g-h*p)+(n*a-i*o)*(c*m-d*f)-(n*l-r*o)*(c*g-h*f)+(i*l-r*a)*(c*p-u*f)}(this)}getScale(t=[-0,-0,-0]){return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(t=[-0,-0,-0]){return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t,e){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],e=e||[-0,-0,-0];const n=this.getScale(e),i=1/n[0],r=1/n[1],s=1/n[2];return t[0]=this[0]*i,t[1]=this[1]*r,t[2]=this[2]*s,t[3]=0,t[4]=this[4]*i,t[5]=this[5]*r,t[6]=this[6]*s,t[7]=0,t[8]=this[8]*i,t[9]=this[9]*r,t[10]=this[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t,e){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0],e=e||[-0,-0,-0];const n=this.getScale(e),i=1/n[0],r=1/n[1],s=1/n[2];return t[0]=this[0]*i,t[1]=this[1]*r,t[2]=this[2]*s,t[3]=this[4]*i,t[4]=this[5]*r,t[5]=this[6]*s,t[6]=this[8]*i,t[7]=this[9]*r,t[8]=this[10]*s,t}transpose(){return function(t,e){if(t===e){var n=e[1],i=e[2],r=e[3],s=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=s,t[11]=e[14],t[12]=r,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15]}(this,this),this.check()}invert(){return Un(this,this),this.check()}multiplyLeft(t){return zn(this,t,this),this.check()}multiplyRight(t){return zn(this,this,t),this.check()}rotateX(t){return Vn(this,this,t),this.check()}rotateY(t){return function(t,e,n){var i=Math.sin(n),r=Math.cos(n),s=e[0],o=e[1],a=e[2],l=e[3],c=e[8],u=e[9],h=e[10],d=e[11];e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*r-c*i,t[1]=o*r-u*i,t[2]=a*r-h*i,t[3]=l*r-d*i,t[8]=s*i+c*r,t[9]=o*i+u*r,t[10]=a*i+h*r,t[11]=l*i+d*r}(this,this,t),this.check()}rotateZ(t){return Hn(this,this,t),this.check()}rotateXYZ(t){return this.rotateX(t[0]).rotateY(t[1]).rotateZ(t[2])}rotateAxis(t,e){return function(t,e,n,i){var r,s,o,a,l,c,u,h,d,f,p,g,m,v,y,b,_,A,w,C,E,x,T,S,B=i[0],P=i[1],M=i[2],I=Math.hypot(B,P,M);I<gn||(B*=I=1/I,P*=I,M*=I,r=Math.sin(n),o=1-(s=Math.cos(n)),a=e[0],l=e[1],c=e[2],u=e[3],h=e[4],d=e[5],f=e[6],p=e[7],g=e[8],m=e[9],v=e[10],y=e[11],b=B*B*o+s,_=P*B*o+M*r,A=M*B*o-P*r,w=B*P*o-M*r,C=P*P*o+s,E=M*P*o+B*r,x=B*M*o+P*r,T=P*M*o-B*r,S=M*M*o+s,t[0]=a*b+h*_+g*A,t[1]=l*b+d*_+m*A,t[2]=c*b+f*_+v*A,t[3]=u*b+p*_+y*A,t[4]=a*w+h*C+g*E,t[5]=l*w+d*C+m*E,t[6]=c*w+f*C+v*E,t[7]=u*w+p*C+y*E,t[8]=a*x+h*T+g*S,t[9]=l*x+d*T+m*S,t[10]=c*x+f*T+v*S,t[11]=u*x+p*T+y*S,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]))}(this,this,t,e),this.check()}scale(t){return jn(this,this,Array.isArray(t)?t:[t,t,t]),this.check()}translate(t){return Gn(this,this,t),this.check()}transform(t,e){return 4===t.length?(dn(e=Zn(e||[-0,-0,-0,-0],t,this),4),e):this.transformAsPoint(t,e)}transformAsPoint(t,e){const{length:n}=t;let i;switch(n){case 2:i=Qn(e||[-0,-0],t,this);break;case 3:i=wn(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return dn(i,t.length),i}transformAsVector(t,e){let n;switch(t.length){case 2:n=Tn(e||[-0,-0],t,this);break;case 3:n=Sn(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return dn(n,t.length),n}transformPoint(t,e){return this.transformAsPoint(t,e)}transformVector(t,e){return this.transformAsPoint(t,e)}transformDirection(t,e){return this.transformAsVector(t,e)}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,e,n){return this.identity().translate([t,e,n])}}let si,oi;function ai(t){if(t>2*Math.PI)throw Error("expected radians")}function li(t,e){const n=Zn([],e,t);return Yn(n,n,1/n[3]),n}function ci(t,e){const n=t%e;return n<0?e+n:n}function ui(t,e,n){return t<e?e:t>n?n:t}const hi=Math.log2||function(t){return Math.log(t)*Math.LOG2E};function di(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const fi=Math.PI,pi=fi/4,gi=fi/180,mi=180/fi,vi=512,yi=4003e4,bi=85.051129,_i=1.5;function Ai(t){const[e,n]=t;di(Number.isFinite(e)),di(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const i=n*gi;return[vi*(e*gi+fi)/(2*fi),vi*(fi+Math.log(Math.tan(pi+.5*i)))/(2*fi)]}function wi(t){const[e,n]=t,i=e/vi*(2*fi)-fi,r=2*(Math.atan(Math.exp(n/vi*(2*fi)-fi))-pi);return[i*mi,r*mi]}function Ci(t){const e=Math.cos(t*gi);return vi/yi/e}function Ei(t){const{latitude:e,longitude:n,highPrecision:i=!1}=t;di(Number.isFinite(e)&&Number.isFinite(n));const r=vi,s=Math.cos(e*gi),o=r/360,a=o/s,l=r/yi/s,c={unitsPerMeter:[l,l,l],metersPerUnit:[1/l,1/l,1/l],unitsPerDegree:[o,a,l],degreesPerUnit:[1/o,1/a,1/l]};if(i){const t=gi*Math.tan(e*gi)/s,n=o*t/2,i=r/yi*t,u=i/a*l;c.unitsPerDegree2=[0,n,i],c.unitsPerMeter2=[u,0,u]}return c}function xi(t,e){const[n,i,r]=t,[s,o,a]=e,{unitsPerMeter:l,unitsPerMeter2:c}=Ei({longitude:n,latitude:i,highPrecision:!0}),u=Ai(t);u[0]+=s*(l[0]+c[0]*o),u[1]+=o*(l[1]+c[1]*o);const h=wi(u),d=(r||0)+(a||0);return Number.isFinite(r)||Number.isFinite(a)?[h[0],h[1],d]:h}function Ti(t){return 2*Math.atan(.5/t)*mi}function Si(t){return.5/Math.tan(.5*t*gi)}function Bi(t,e){const[n,i,r=0]=t;return di(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(r)),li(e,[n,i,r,1])}function Pi(t,e,n=0){const[i,r,s]=t;if(di(Number.isFinite(i)&&Number.isFinite(r),"invalid pixel coordinate"),Number.isFinite(s))return li(e,[i,r,s,1]);const o=li(e,[i,r,0,1]),a=li(e,[i,r,1,1]),l=o[2],c=a[2];return Kn([],o,a,l===c?0:((n||0)-l)/(c-l))}const Mi=Math.PI/180;function Ii(t,e,n){const{pixelUnprojectionMatrix:i}=t,r=li(i,[e,0,1,1]),s=li(i,[e,t.height,1,1]),o=wi(Kn([],r,s,(n*t.distanceScales.unitsPerMeter[2]-r[2])/(s[2]-r[2])));return o.push(n),o}const Li={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Li,"IDENTITY",{get:()=>(q.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Oi={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Ri={common:0,meters:1,pixels:2},Fi={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},ki=Math.PI/180,Di=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Ni=[0,0,0],Ui={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};class zi{constructor(t={}){m(this,"id",void 0),m(this,"x",void 0),m(this,"y",void 0),m(this,"width",void 0),m(this,"height",void 0),m(this,"padding",void 0),m(this,"isGeospatial",void 0),m(this,"zoom",void 0),m(this,"focalDistance",void 0),m(this,"position",void 0),m(this,"modelMatrix",void 0),m(this,"distanceScales",void 0),m(this,"scale",void 0),m(this,"center",void 0),m(this,"cameraPosition",void 0),m(this,"projectionMatrix",void 0),m(this,"viewMatrix",void 0),m(this,"viewMatrixUncentered",void 0),m(this,"viewMatrixInverse",void 0),m(this,"viewProjectionMatrix",void 0),m(this,"pixelProjectionMatrix",void 0),m(this,"pixelUnprojectionMatrix",void 0),m(this,"resolution",void 0),m(this,"_frustumPlanes",{}),this.id=t.id||this.constructor.displayName||"viewport",this.x=t.x||0,this.y=t.y||0,this.width=t.width||1,this.height=t.height||1,this.zoom=t.zoom||0,this.padding=t.padding,this.distanceScales=t.distanceScales||Ui,this.focalDistance=t.focalDistance||1,this.position=t.position||Ni,this.modelMatrix=t.modelMatrix||null;const{longitude:e,latitude:n}=t;this.isGeospatial=Number.isFinite(n)&&Number.isFinite(e),this._initProps(t),this._initMatrices(t),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Oi.WEB_MERCATOR:Oi.WEB_MERCATOR_AUTO_OFFSET:Oi.IDENTITY}equals(t){return t instanceof zi&&(this===t||t.width===this.width&&t.height===this.height&&t.scale===this.scale&&ln(t.projectionMatrix,this.projectionMatrix)&&ln(t.viewMatrix,this.viewMatrix))}project(t,{topLeft:e=!0}={}){const n=Bi(this.projectPosition(t),this.pixelProjectionMatrix),[i,r]=n,s=e?r:this.height-r;return 2===t.length?[i,s]:[i,s,n[2]]}unproject(t,{topLeft:e=!0,targetZ:n}={}){const[i,r,s]=t,o=e?r:this.height-r,a=n&&n*this.distanceScales.unitsPerMeter[2],l=Pi([i,o,s],this.pixelUnprojectionMatrix,a),[c,u,h]=this.unprojectPosition(l);return Number.isFinite(s)?[c,u,h]:Number.isFinite(n)?[c,u,n]:[c,u]}projectPosition(t){const[e,n]=this.projectFlat(t);return[e,n,(t[2]||0)*this.distanceScales.unitsPerMeter[2]]}unprojectPosition(t){const[e,n]=this.unprojectFlat(t);return[e,n,(t[2]||0)*this.distanceScales.metersPerUnit[2]]}projectFlat(t){if(this.isGeospatial){const e=Ai(t);return e[1]=on(e[1],-318,830),e}return t}unprojectFlat(t){return this.isGeospatial?wi(t):t}getBounds(t={}){const e={targetZ:t.z||0},n=this.unproject([0,0],e),i=this.unproject([this.width,0],e),r=this.unproject([0,this.height],e),s=this.unproject([this.width,this.height],e);return[Math.min(n[0],i[0],r[0],s[0]),Math.min(n[1],i[1],r[1],s[1]),Math.max(n[0],i[0],r[0],s[0]),Math.max(n[1],i[1],r[1],s[1])]}getDistanceScales(t){return t?Ei({longitude:t[0],latitude:t[1],highPrecision:!0}):this.distanceScales}containsPixel({x:t,y:e,width:n=1,height:i=1}){return t<this.x+this.width&&this.x<t+n&&e<this.y+this.height&&this.y<e+i}getFrustumPlanes(){return this._frustumPlanes.near||Object.assign(this._frustumPlanes,{left:On((t=this.viewProjectionMatrix)[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:On(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:On(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:On(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:On(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:On(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}),this._frustumPlanes;var t}panByPosition(t,e){return null}_initProps(t){const e=t.longitude,n=t.latitude;this.isGeospatial&&(Number.isFinite(t.zoom)||(this.zoom=function(t){const{latitude:e}=t;di(Number.isFinite(e));const n=Math.cos(e*gi);return hi(yi*n)-9}({latitude:n})+Math.log2(this.focalDistance)),this.distanceScales=t.distanceScales||Ei({latitude:n,longitude:e}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:r,modelMatrix:s}=t;let o=Ni;if(r&&(o=s?new ri(s).transformAsVector(r,[]):r),this.isGeospatial){const t=this.projectPosition([e,n,0]);this.center=new In(o).scale(this.distanceScales.unitsPerMeter).add(t)}else this.center=this.projectPosition(o)}_initMatrices(t){const{viewMatrix:e=Di,projectionMatrix:n=null,orthographic:i=!1,fovyRadians:r,fovy:s=75,near:o=.1,far:a=1e3,padding:l=null,focalDistance:c=1}=t;this.viewMatrixUncentered=e,this.viewMatrix=(new ri).multiplyRight(e).translate(new In(this.center).negate()),this.projectionMatrix=n||function({width:t,height:e,orthographic:n,fovyRadians:i,focalDistance:r,padding:s,near:o,far:a}){const l=t/e,c=n?(new ri).orthographic({fovy:i,aspect:l,focalDistance:r,near:o,far:a}):(new ri).perspective({fovy:i,aspect:l,near:o,far:a});if(s){const{left:n=0,right:i=0,top:r=0,bottom:o=0}=s,a=on((n+t-i)/2,0,t)-t/2,l=on((r+e-o)/2,0,e)-e/2;c[8]-=2*a/t,c[9]+=2*l/e}return c}({width:this.width,height:this.height,orthographic:i,fovyRadians:r||s*ki,focalDistance:c,padding:l,near:o,far:a});const u=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];var h;zn(u,u,this.projectionMatrix),zn(u,u,this.viewMatrix),this.viewProjectionMatrix=u,this.viewMatrixInverse=Un([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=[(h=this.viewMatrixInverse)[12],h[13],h[14]];const d=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],f=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];jn(d,d,[this.width/2,-this.height/2,1]),Gn(d,d,[1,-1,0]),zn(f,d,this.viewProjectionMatrix),this.pixelProjectionMatrix=f,this.pixelUnprojectionMatrix=Un([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||q.warn("Pixel project matrix not invertible")()}}m(zi,"displayName","Viewport");const Gi="vs",ji="fs";function Vi(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const Hi={number:{validate:(t,e)=>Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)},array:{validate:(t,e)=>Array.isArray(t)||ArrayBuffer.isView(t)}};function Wi(t){let e=Ji(t);return"object"===e?t?"type"in t?Object.assign({},t,Hi[t.type]):"value"in t?(e=Ji(t.value),Object.assign({type:e},t,Hi[e])):{type:"object",value:t}:{type:"object",value:null}:Object.assign({type:e,value:t},Hi[e])}function Ji(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}class qi{constructor(t){let{name:e,vs:n,fs:i,dependencies:r=[],uniforms:s,getUniforms:o,deprecations:a=[],defines:l={},inject:c={},vertexShader:u,fragmentShader:h}=t;Vi("string"==typeof e),this.name=e,this.vs=n||u,this.fs=i||h,this.getModuleUniforms=o,this.dependencies=r,this.deprecations=this._parseDeprecationDefinitions(a),this.defines=l,this.injections=function(t){const e={vs:{},fs:{}};for(const n in t){let i=t[n];"string"==typeof i&&(i={order:0,injection:i}),e[n.slice(0,2)][n]=i}return e}(c),s&&(this.uniforms=function(t){const e={};for(const n in t){const i=Wi(t[n]);e[n]=i}return e}(s))}getModuleSource(t){let e;switch(t){case"vs":e=this.vs||"";break;case"fs":e=this.fs||"";break;default:Vi(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),"\n").concat(e,"// END MODULE_").concat(this.name,"\n\n")}getUniforms(t,e){return this.getModuleUniforms?this.getModuleUniforms(t,e):this.uniforms?this._defaultGetUniforms(t):{}}getDefines(){return this.defines}checkDeprecations(t,e){this.deprecations.forEach((n=>{n.regex.test(t)&&(n.deprecated?e.deprecated(n.old,n.new)():e.removed(n.old,n.new)())}))}_parseDeprecationDefinitions(t){return t.forEach((t=>{"function"===t.type?t.regex=new RegExp("\\b".concat(t.old,"\\(")):t.regex=new RegExp("".concat(t.type," ").concat(t.old,";"))})),t}_defaultGetUniforms(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e={},n=this.uniforms;for(const i in n){const r=n[i];i in t&&!r.private?(r.validate&&Vi(r.validate(t[i],r),"".concat(this.name,": invalid ").concat(i)),e[i]=t[i]):e[i]=r.value}return e}}function Ki(t){return function(t){const e={},n={};return Xi({modules:t,level:0,moduleMap:e,moduleDepth:n}),Object.keys(n).sort(((t,e)=>n[e]-n[t])).map((t=>e[t]))}(Qi(t))}function Xi(t){let{modules:e,level:n,moduleMap:i,moduleDepth:r}=t;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const t of e)i[t.name]=t,(void 0===r[t.name]||r[t.name]<n)&&(r[t.name]=n);for(const t of e)t.dependencies&&Xi({modules:t.dependencies,level:n+1,moduleMap:i,moduleDepth:r})}function Qi(t,e){return t.map((t=>(t instanceof qi||(Vi("string"!=typeof t,"Shader module use by name is deprecated. Import shader module '".concat(t,"' and use it directly.")),Vi(t.name,"shader module has no name"),(t=new qi(t)).dependencies=Qi(t.dependencies)),t)))}const Yi=7936,Zi=7937,$i=7938,tr=35724,er={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},nr={};Object.keys(er).forEach((t=>{nr[t]=t}));const ir={};function rr(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=er[e];if(Vi(i,e),!function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e="undefined"!=typeof window&&window.navigator||{},n=t.userAgent||e.userAgent||"",i=-1!==n.indexOf("MSIE "),r=-1!==n.indexOf("Trident/");return i||r}(n))return!0;if(e in ir)return ir[e];const r=i[0],s=n.behavior||"enable",o="#extension GL_".concat(r," : ").concat(s,"\nvoid main(void) {}"),a=t.createShader(35633);t.shaderSource(a,o),t.compileShader(a);const l=t.getShaderParameter(a,35713);return t.deleteShader(a),ir[e]=l,l}function sr(t,e){return(e=Array.isArray(e)?e:[e]).every((e=>function(t,e){const n=er[e];Vi(n,e);const i=function(t){return"undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||Boolean(t&&2===t._version)}(t)&&n[1]||n[0],r="string"==typeof i?Boolean(t.getExtension(i)):i;return Vi(!1===r||!0===r),r}(t,e)))}const or={[Gi]:"#ifdef MODULE_LOGDEPTH\n  logdepth_adjustPosition(gl_Position);\n#endif\n",[ji]:"#ifdef MODULE_MATERIAL\n  gl_FragColor = material_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LIGHTING\n  gl_FragColor = lighting_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_FOG\n  gl_FragColor = fog_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_PICKING\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LOGDEPTH\n  logdepth_setFragDepth();\n#endif\n"},ar="__LUMA_INJECT_DECLARATIONS__",lr=/void\s+main\s*\([^)]*\)\s*\{\n?/,cr=/}\n?[^{}]*$/,ur=[];function hr(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=e===Gi;for(const e in n){const i=n[e];i.sort(((t,e)=>t.order-e.order)),ur.length=i.length;for(let t=0,e=i.length;t<e;++t)ur[t]=i[t].injection;const s="".concat(ur.join("\n"),"\n");switch(e){case"vs:#decl":r&&(t=t.replace(ar,s));break;case"vs:#main-start":r&&(t=t.replace(lr,(t=>t+s)));break;case"vs:#main-end":r&&(t=t.replace(cr,(t=>s+t)));break;case"fs:#decl":r||(t=t.replace(ar,s));break;case"fs:#main-start":r||(t=t.replace(lr,(t=>t+s)));break;case"fs:#main-end":r||(t=t.replace(cr,(t=>s+t)));break;default:t=t.replace(e,(t=>t+s))}}return t=t.replace(ar,""),i&&(t=t.replace(/\}\s*$/,(t=>t+or[e]))),t}function dr(t){const e={};return Vi(Array.isArray(t)&&t.length>1),t.forEach((t=>{for(const n in t)e[n]=e[n]?"".concat(e[n],"\n").concat(t[n]):t[n]})),e}function fr(t){return new RegExp("\\b".concat(t,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}const pr=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,"#version 300 es\n"],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],gr=[...pr,[fr("attribute"),"in $1"],[fr("varying"),"out $1"]],mr=[...pr,[fr("varying"),"in $1"]],vr=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],yr=[...vr,[fr("in"),"attribute $1"],[fr("out"),"varying $1"]],br=[...vr,[fr("in"),"varying $1"]],_r="gl_FragColor",Ar=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,wr=/void\s+main\s*\([^)]*\)\s*\{\n?/;function Cr(t,e){for(const[n,i]of e)t=t.replace(n,i);return t}const Er="\n\n".concat(ar,"\n\n"),xr={[Gi]:"vertex",[ji]:"fragment"};function Tr(t,e){let{id:n,source:i,type:r,modules:s,defines:o={},hookFunctions:a=[],inject:l={},transpileToGLSL100:c=!1,prologue:u=!0,log:h}=e;Vi("string"==typeof i,"shader source must be a string");const d=r===Gi,f=i.split("\n");let p=100,g="",m=i;0===f[0].indexOf("#version ")?(p=300,g=f[0],m=f.slice(1).join("\n")):g="#version ".concat(p);const v={};s.forEach((t=>{Object.assign(v,t.getDefines())})),Object.assign(v,o);let y=u?"".concat(g,"\n").concat(function(t){let{id:e,source:n,type:i}=t;return e&&"string"==typeof e&&-1===n.indexOf("SHADER_NAME")?"\n#define SHADER_NAME ".concat(e,"_").concat(xr[i],"\n\n"):""}({id:n,source:i,type:r}),"\n").concat(function(t){let{type:e}=t;return"\n#define SHADER_TYPE_".concat(xr[e].toUpperCase(),"\n")}({type:r}),"\n").concat(function(t){const e=function(t){const e=t.getExtension("WEBGL_debug_renderer_info"),n=t.getParameter(e&&e.UNMASKED_VENDOR_WEBGL||Yi),i=t.getParameter(e&&e.UNMASKED_RENDERER_WEBGL||Zi);return{gpuVendor:function(t,e){return t.match(/NVIDIA/i)||e.match(/NVIDIA/i)?"NVIDIA":t.match(/INTEL/i)||e.match(/INTEL/i)?"INTEL":t.match(/AMD/i)||e.match(/AMD/i)||t.match(/ATI/i)||e.match(/ATI/i)?"AMD":"UNKNOWN GPU"}(n,i),vendor:n,renderer:i,version:t.getParameter($i),shadingLanguageVersion:t.getParameter(tr)}}(t);switch(e.gpuVendor.toLowerCase()){case"nvidia":return"#define NVIDIA_GPU\n// Nvidia optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n";case"intel":return"#define INTEL_GPU\n// Intel optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Intel's built-in 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n";case"amd":return"#define AMD_GPU\n";default:return"#define DEFAULT_GPU\n// Prevent driver from optimizing away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Intel's built-in 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n"}}(t),"\n").concat(function(t,e,n){let i="#if (__VERSION__ > 120)\n\n# define FEATURE_GLSL_DERIVATIVES\n# define FEATURE_GLSL_DRAW_BUFFERS\n# define FEATURE_GLSL_FRAG_DEPTH\n# define FEATURE_GLSL_TEXTURE_LOD\n\n// DEPRECATED FLAGS, remove in v9\n# define FRAG_DEPTH\n# define DERIVATIVES\n# define DRAW_BUFFERS\n# define TEXTURE_LOD\n\n#endif // __VERSION\n";return sr(t,nr.GLSL_FRAG_DEPTH)&&(i+="\n// FRAG_DEPTH => gl_FragDepth is available\n#ifdef GL_EXT_frag_depth\n#extension GL_EXT_frag_depth : enable\n# define FEATURE_GLSL_FRAG_DEPTH\n# define FRAG_DEPTH\n# define gl_FragDepth gl_FragDepthEXT\n#endif\n"),sr(t,nr.GLSL_DERIVATIVES)&&rr(t,nr.GLSL_DERIVATIVES)&&(i+="\n// DERIVATIVES => dxdF, dxdY and fwidth are available\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n# define FEATURE_GLSL_DERIVATIVES\n# define DERIVATIVES\n#endif\n"),sr(t,nr.GLSL_FRAG_DATA)&&rr(t,nr.GLSL_FRAG_DATA,{behavior:"require"})&&(i+="\n// DRAW_BUFFERS => gl_FragData[] is available\n#ifdef GL_EXT_draw_buffers\n#extension GL_EXT_draw_buffers : require\n#define FEATURE_GLSL_DRAW_BUFFERS\n#define DRAW_BUFFERS\n#endif\n"),sr(t,nr.GLSL_TEXTURE_LOD)&&(i+="// TEXTURE_LOD => texture2DLod etc are available\n#ifdef GL_EXT_shader_texture_lod\n#extension GL_EXT_shader_texture_lod : enable\n\n# define FEATURE_GLSL_TEXTURE_LOD\n# define TEXTURE_LOD\n\n#endif\n"),i}(t),"\n").concat(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=0,n="";for(const i in t){0===e&&(n+="\n// APPLICATION DEFINES\n"),e++;const r=t[i];(r||Number.isFinite(r))&&(n+="#define ".concat(i.toUpperCase()," ").concat(t[i],"\n"))}return 0===e&&(n+="\n"),n}(v),"\n").concat(d?"":"precision highp float;\n\n","\n"):"".concat(g,"\n");const b=function(t){const e={vs:{},fs:{}};return t.forEach((t=>{let n;"string"!=typeof t?(n=t,t=n.hook):n={},t=t.trim();const[i,r]=t.split(":"),s=t.replace(/\(.+/,"");e[i][s]=Object.assign(n,{signature:r})})),e}(a),_={},A={},w={};for(const t in l){const e="string"==typeof l[t]?{injection:l[t],order:0}:l[t],n=t.match(/^(v|f)s:(#)?([\w-]+)$/);if(n){const i=n[2],r=n[3];i?"decl"===r?A[t]=[e]:w[t]=[e]:_[t]=[e]}else w[t]=[e]}for(const t of s){h&&t.checkDeprecations(m,h),y+=t.getModuleSource(r,p);const e=t.injections[r];for(const t in e){const n=t.match(/^(v|f)s:#([\w-]+)$/);if(n){const i="decl"===n[2]?A:w;i[t]=i[t]||[],i[t].push(e[t])}else _[t]=_[t]||[],_[t].push(e[t])}}return y+=Er,y=hr(y,r,A),y+=function(t,e){let n="";for(const i in t){const r=t[i];if(n+="void ".concat(r.signature," {\n"),r.header&&(n+="  ".concat(r.header)),e[i]){const t=e[i];t.sort(((t,e)=>t.order-e.order));for(const e of t)n+="  ".concat(e.injection,"\n")}r.footer&&(n+="  ".concat(r.footer)),n+="}\n"}return n}(b[r],_),y+=m,y=hr(y,r,w),y=function(t,e,n){switch(e){case 300:return n?Cr(t,gr):function(t){const e=(t=Cr(t,mr)).match(Ar);if(e){const n=e[1];t=t.replace(new RegExp("\\b".concat(_r,"\\b"),"g"),n)}else{const e="fragmentColor";t=t.replace(wr,(t=>"out vec4 ".concat(e,";\n").concat(t))).replace(new RegExp("\\b".concat(_r,"\\b"),"g"),e)}return t}(t);case 100:return n?Cr(t,yr):function(t){const e=(t=Cr(t,br)).match(Ar);if(e){const n=e[1];t=t.replace(Ar,"").replace(new RegExp("\\b".concat(n,"\\b"),"g"),_r)}return t}(t);default:throw new Error("unknown GLSL version ".concat(e))}}(y,c?100:p,d),y}function Sr(t){return function(e){const n={};for(const i of t){const t=i.getUniforms(e,n);Object.assign(n,t)}return n}}function Br(){return!("object"==typeof process&&"[object process]"===String(process)&&!process.browser)||function(t){if("undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof process&&"object"==typeof process.versions&&Boolean(process.versions.electron))return!0;const e="object"==typeof navigator&&"string"==typeof navigator.userAgent&&navigator.userAgent;return!!(e&&e.indexOf("Electron")>=0)}()}const Pr="undefined"!=typeof __VERSION__?__VERSION__:"untranspiled source";Br();class Mr{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage";m(this,"storage",void 0),m(this,"id",void 0),m(this,"config",void 0),this.storage=function(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch(t){return null}}(n),this.id=t,this.config=e,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){if(Object.assign(this.config,t),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let t={};if(this.storage){const e=this.storage.getItem(this.id);t=e?JSON.parse(e):{}}return Object.assign(this.config,t),this}}function Ir(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:600;const r=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>i&&(n=Math.min(n,i/t.width));const s=t.width*n,o=t.height*n,a=["font-size:1px;","padding:".concat(Math.floor(o/2),"px ").concat(Math.floor(s/2),"px;"),"line-height:".concat(o,"px;"),"background:url(".concat(r,");"),"background-size:".concat(s,"px ").concat(o,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),a]}let Lr;function Or(t){return"string"==typeof t?Lr[t.toUpperCase()]||Lr.WHITE:t}function Rr(t,e){if(!t)throw new Error(e||"Assertion failed")}!function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"}(Lr||(Lr={}));const Fr={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==o.g&&o.g,document:"undefined"!=typeof document&&document,process:"object"==typeof process&&process},kr=Fr.window||Fr.self||Fr.global,Dr=Fr.process||{};function Nr(){let t;var e,n;if(Br&&"performance"in kr)t=null==kr||null===(e=kr.performance)||void 0===e||null===(n=e.now)||void 0===n?void 0:n.call(e);else if("hrtime"in Dr){var i;const e=null==Dr||null===(i=Dr.hrtime)||void 0===i?void 0:i.call(Dr);t=1e3*e[0]+e[1]/1e6}else t=Date.now();return t}const Ur={debug:Br&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},zr={enabled:!0,level:0};function Gr(){}const jr={},Vr={once:!0};class Hr{constructor(){let{id:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{id:""};m(this,"id",void 0),m(this,"VERSION",Pr),m(this,"_startTs",Nr()),m(this,"_deltaTs",Nr()),m(this,"_storage",void 0),m(this,"userData",{}),m(this,"LOG_THROTTLE_TIMEOUT",0),this.id=t,this.userData={},this._storage=new Mr("__probe-".concat(this.id,"__"),zr),this.timeStamp("".concat(this.id," started")),function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["constructor"];const n=Object.getPrototypeOf(t),i=Object.getOwnPropertyNames(n);for(const n of i)"function"==typeof t[n]&&(e.find((t=>n===t))||(t[n]=t[n].bind(t)))}(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Nr()-this._startTs).toPrecision(10))}getDelta(){return Number((Nr()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._storage.setConfiguration({enabled:t}),this}setLevel(t){return this._storage.setConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,e){this._storage.setConfiguration({[t]:e})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,e){Rr(t,e)}warn(t){return this._getLogFunction(0,t,Ur.warn,arguments,Vr)}error(t){return this._getLogFunction(0,t,Ur.error,arguments)}deprecated(t,e){return this.warn("`".concat(t,"` is deprecated and will be removed in a later version. Use `").concat(e,"` instead"))}removed(t,e){return this.error("`".concat(t,"` has been removed. Use `").concat(e,"` instead"))}probe(t,e){return this._getLogFunction(t,e,Ur.log,arguments,{time:!0,once:!0})}log(t,e){return this._getLogFunction(t,e,Ur.debug,arguments)}info(t,e){return this._getLogFunction(t,e,console.info,arguments)}once(t,e){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return this._getLogFunction(t,e,Ur.debug||Ur.info,arguments,Vr)}table(t,e,n){return e?this._getLogFunction(t,e,console.table||Gr,n&&[n],{tag:qr(e)}):Gr}image(t){let{logLevel:e,priority:n,image:i,message:r="",scale:s=1}=t;return this._shouldLog(e||n)?Br?function(t){let{image:e,message:n="",scale:i=1}=t;if("string"==typeof e){const t=new Image;return t.onload=()=>{const e=Ir(t,n,i);console.log(...e)},t.src=e,Gr}const r=e.nodeName||"";if("img"===r.toLowerCase())return console.log(...Ir(e,n,i)),Gr;if("canvas"===r.toLowerCase()){const t=new Image;return t.onload=()=>console.log(...Ir(t,n,i)),t.src=e.toDataURL(),Gr}return Gr}({image:i,message:r,scale:s}):function(t){let{image:e,message:n="",scale:i=1}=t;return console.warn("removed"),Gr}({image:i,message:r,scale:s}):Gr}time(t,e){return this._getLogFunction(t,e,console.time?console.time:console.info)}timeEnd(t,e){return this._getLogFunction(t,e,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,e){return this._getLogFunction(t,e,console.timeStamp||Gr)}group(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{collapsed:!1};const i=Jr({logLevel:t,message:e,opts:n}),{collapsed:r}=n;return i.method=(r?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.group(t,e,Object.assign({},n,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||Gr)}withGroup(t,e,n){this.group(t,e)();try{n()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=Wr(t)}_getLogFunction(t,e,n,i,r){if(this._shouldLog(t)){r=Jr({logLevel:t,message:e,args:i,opts:r}),Rr(n=n||r.method),r.total=this.getTotal(),r.delta=this.getDelta(),this._deltaTs=Nr();const s=r.tag||r.message;if(r.once){if(jr[s])return Gr;jr[s]=Nr()}return e=function(t,e,n){if("string"==typeof e){const o=n.time?function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8;const n=Math.max(e-t.length,0);return"".concat(" ".repeat(n)).concat(t)}(function(t){let e;return e=t<10?"".concat(t.toFixed(2),"ms"):t<100?"".concat(t.toFixed(1),"ms"):t<1e3?"".concat(t.toFixed(0),"ms"):"".concat((t/1e3).toFixed(2),"s"),e}(n.total)):"";i=e=n.time?"".concat(t,": ").concat(o,"  ").concat(e):"".concat(t,": ").concat(e),r=n.color,s=n.background,Br||"string"!=typeof i||(r&&(r=Or(r),i="[".concat(r,"m").concat(i,"[39m")),s&&(r=Or(s),i="[".concat(s+10,"m").concat(i,"[49m"))),e=i}var i,r,s;return e}(this.id,r.message,r),n.bind(console,e,...r.args)}return Gr}}function Wr(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return Rr(Number.isFinite(e)&&e>=0),e}function Jr(t){const{logLevel:e,message:n}=t;t.logLevel=Wr(e);const i=t.args?Array.from(t.args):[];for(;i.length&&i.shift()!==n;);switch(typeof e){case"string":case"function":void 0!==n&&i.unshift(n),t.message=e;break;case"object":Object.assign(t,e)}"function"==typeof t.message&&(t.message=t.message());const r=typeof t.message;return Rr("string"===r||"object"===r),Object.assign(t,{args:i},t.opts)}function qr(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}m(Hr,"VERSION",Pr);const Kr=new Hr({id:"luma.gl"});function Xr(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const Qr="Requires WebGL2";function Yr(t){return"undefined"!=typeof WebGLRenderingContext&&t instanceof WebGLRenderingContext||"undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||Boolean(t&&Number.isFinite(t._version))}function Zr(t){return"undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||Boolean(t&&2===t._version)}function $r(t){return Xr(Yr(t),"Invalid WebGLRenderingContext"),t}function ts(t){return Xr(Zr(t),Qr),t}const es={};const ns=function t(e){const n=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(let e=0;e<this.attribs.length;e++){const i=new t.VertexAttrib(n);this.attribs[e]=i}this.maxAttrib=0};(ns.VertexAttrib=function(t){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()}).prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const is=function(t){const e=this;this.gl=t,function(t){const e=t.getError;t.getError=function(){let n;do{n=e.apply(t),0!==n&&(es[n]=!0)}while(0!==n);for(n in es)if(es[n])return delete es[n],parseInt(n,10);return 0}}(t);const n=this.original={getParameter:t.getParameter,enableVertexAttribArray:t.enableVertexAttribArray,disableVertexAttribArray:t.disableVertexAttribArray,bindBuffer:t.bindBuffer,getVertexAttrib:t.getVertexAttrib,vertexAttribPointer:t.vertexAttribPointer};t.getParameter=function(t){return t===e.VERTEX_ARRAY_BINDING_OES?e.currentVertexArrayObject===e.defaultVertexArrayObject?null:e.currentVertexArrayObject:n.getParameter.apply(this,arguments)},t.enableVertexAttribArray=function(t){const i=e.currentVertexArrayObject;return i.maxAttrib=Math.max(i.maxAttrib,t),i.attribs[t].enabled=!0,n.enableVertexAttribArray.apply(this,arguments)},t.disableVertexAttribArray=function(t){const i=e.currentVertexArrayObject;return i.maxAttrib=Math.max(i.maxAttrib,t),i.attribs[t].enabled=!1,n.disableVertexAttribArray.apply(this,arguments)},t.bindBuffer=function(t,i){switch(t){case 34962:e.currentArrayBuffer=i;break;case 34963:e.currentVertexArrayObject.elementArrayBuffer=i}return n.bindBuffer.apply(this,arguments)},t.getVertexAttrib=function(t,i){const r=e.currentVertexArrayObject.attribs[t];switch(i){case 34975:return r.buffer;case 34338:return r.enabled;case 34339:return r.size;case 34340:return r.stride;case 34341:return r.type;case 34922:return r.normalized;default:return n.getVertexAttrib.apply(this,arguments)}},t.vertexAttribPointer=function(t,i,r,s,o,a){const l=e.currentVertexArrayObject;l.maxAttrib=Math.max(l.maxAttrib,t);const c=l.attribs[t];return c.buffer=e.currentArrayBuffer,c.size=i,c.type=r,c.normalized=s,c.stride=o,c.offset=a,c.recache(),n.vertexAttribPointer.apply(this,arguments)},t.instrumentExtension&&t.instrumentExtension(this,"OES_vertex_array_object"),t.canvas&&t.canvas.addEventListener("webglcontextrestored",(()=>{globalThis.console&&globalThis.console.log&&globalThis.console.log("OESVertexArrayObject emulation library context restored"),e.reset_()}),!0),this.reset_()};is.prototype.VERTEX_ARRAY_BINDING_OES=34229,is.prototype.reset_=function(){if(void 0!==this.vertexArrayObjects)for(let t=0;t<this.vertexArrayObjects.length;++t)this.vertexArrayObjects.isAlive=!1;const t=this.gl;this.maxVertexAttribs=t.getParameter(34921),this.defaultVertexArrayObject=new ns(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)},is.prototype.createVertexArrayOES=function(){const t=new ns(this);return this.vertexArrayObjects.push(t),t},is.prototype.deleteVertexArrayOES=function(t){t.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(t),1),this.currentVertexArrayObject===t&&this.bindVertexArrayOES(null)},is.prototype.isVertexArrayOES=function(t){return!!(t&&t instanceof ns&&t.hasBeenBound&&t.ext===this)},is.prototype.bindVertexArrayOES=function(t){const e=this.gl;if(t&&!t.isAlive)return n="bindVertexArrayOES: attempt to bind deleted arrayObject",es[1282]=!0,void(void 0!==n&&(i=n,globalThis.console&&globalThis.console.error&&globalThis.console.error(i)));var n,i;const r=this.original,s=this.currentVertexArrayObject;this.currentVertexArrayObject=t||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const o=this.currentVertexArrayObject;if(s===o)return;s&&o.elementArrayBuffer===s.elementArrayBuffer||r.bindBuffer.call(e,34963,o.elementArrayBuffer);let a=this.currentArrayBuffer;const l=Math.max(s?s.maxAttrib:0,o.maxAttrib);for(let t=0;t<=l;t++){const n=o.attribs[t],i=s?s.attribs[t]:null;if(s&&n.enabled===i.enabled||(n.enabled?r.enableVertexAttribArray.call(e,t):r.disableVertexAttribArray.call(e,t)),n.enabled){let o=!1;s&&n.buffer===i.buffer||(a!==n.buffer&&(r.bindBuffer.call(e,34962,n.buffer),a=n.buffer),o=!0),(o||n.cached!==i.cached)&&r.vertexAttribPointer.call(e,t,n.size,n.type,n.normalized,n.stride,n.offset)}}this.currentArrayBuffer!==a&&r.bindBuffer.call(e,34962,this.currentArrayBuffer)};const rs="OES_element_index",ss="WEBGL_draw_buffers",os="WEBGL_debug_renderer_info",as=t=>Zr(t)?void 0:0,ls={3074:t=>Zr(t)?void 0:36064,35723:t=>Zr(t)?void 0:4352,35977:as,32937:as,36795:(t,e)=>{const n=Zr(t)?t.getExtension("EXT_disjoint_timer_query_webgl2"):t.getExtension("EXT_disjoint_timer_query");return n&&n.GPU_DISJOINT_EXT?e(n.GPU_DISJOINT_EXT):0},37445:(t,e)=>{const n=t.getExtension(os);return e(n&&n.UNMASKED_VENDOR_WEBGL||7936)},37446:(t,e)=>{const n=t.getExtension(os);return e(n&&n.UNMASKED_RENDERER_WEBGL||7937)},34047:(t,e)=>{const n=t.luma.extensions.EXT_texture_filter_anisotropic;return n?e(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},32883:as,35071:as,37447:as,36063:(t,e)=>{if(!Zr(t)){const n=t.getExtension(ss);return n?e(n.MAX_COLOR_ATTACHMENTS_WEBGL):0}},35379:as,35374:as,35377:as,34852:t=>{if(!Zr(t)){const e=t.getExtension(ss);return e?e.MAX_DRAW_BUFFERS_WEBGL:0}},36203:t=>t.getExtension(rs)?2147483647:65535,33001:t=>t.getExtension(rs)?16777216:65535,33e3:t=>16777216,37157:as,35373:as,35657:as,36183:as,37137:as,34045:as,35978:as,35979:as,35968:as,35376:as,35375:as,35659:as,37154:as,35371:as,35658:as,35076:as,35077:as,35380:as},cs="ANGLE_instanced_arrays",us={OES_vertex_array_object:{meta:{suffix:"OES"},createVertexArray:()=>{Xr(!1,"VertexArray requires WebGL2 or OES_vertex_array_object extension")},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[cs]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(t,e){Xr(0===e,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},WEBGL_draw_buffers:{meta:{suffix:"WEBGL"},drawBuffers:()=>{Xr(!1)}},EXT_disjoint_timer_query:{meta:{suffix:"EXT"},createQuery:()=>{Xr(!1)},deleteQuery:()=>{Xr(!1)},beginQuery:()=>{Xr(!1)},endQuery:()=>{},getQuery(t,e){return this.getQueryObject(t,e)},getQueryParameter(t,e){return this.getQueryObject(t,e)},getQueryObject:()=>{}}},hs={readBuffer:(t,e,n)=>{Zr(t)&&e(n)},getVertexAttrib:(t,e,n,i)=>{const{webgl2:r,ext:s}=function(t,e){return{webgl2:Zr(t),ext:t.getExtension(e)}}(t,cs);let o;switch(i){case 35069:o=!!r&&void 0;break;case 35070:o=r||s?void 0:0}return void 0!==o?o:e(n,i)},getProgramParameter:(t,e,n,i)=>{if(!Zr(t))switch(i){case 35967:return 35981;case 35971:case 35382:return 0}return e(n,i)},getInternalformatParameter:(t,e,n,i,r)=>Zr(t)||32937!==r?t.getInternalformatParameter(n,i,r):new Int32Array([0]),getTexParameter(t,e,n,i){if(34046===i){const{extensions:e}=t.luma,n=e.EXT_texture_filter_anisotropic;i=n&&n.TEXTURE_MAX_ANISOTROPY_EXT||34046}return e(n,i)},getParameter:function(t,e,n){const i=ls[n],r="function"==typeof i?i(t,e,n):i;return void 0!==r?r:e(n)},hint:(t,e,n,i)=>e(n,i)};function ds(t,e){let{extension:n,target:i,target2:r}=e;const s=us[n];Xr(s);const{meta:o={}}=s,{suffix:a=""}=o,l=t.getExtension(n);for(const e of Object.keys(s)){const n="".concat(e).concat(a);let o=null;"meta"===e||"function"==typeof t[e]||(l&&"function"==typeof l[n]?o=function(){return l[n](...arguments)}:"function"==typeof s[e]&&(o=s[e].bind(i))),o&&(i[e]=o,r[e]=o)}}globalThis.polyfillContext=function(t){t.luma=t.luma||{};const{luma:e}=t;return e.polyfilled||(function(t){if("function"==typeof t.createVertexArray)return;const e=t.getSupportedExtensions;t.getSupportedExtensions=function(){const t=e.call(this)||[];return t.indexOf("OES_vertex_array_object")<0&&t.push("OES_vertex_array_object"),t};const n=t.getExtension;t.getExtension=function(e){return n.call(this,e)||("OES_vertex_array_object"!==e?null:(t.__OESVertexArrayObject||(this.__OESVertexArrayObject=new is(this)),this.__OESVertexArrayObject))}}(t),function(t){t.luma.extensions={};const e=t.getSupportedExtensions()||[];for(const n of e)t.luma[n]=t.getExtension(n)}(t),function(t,e){for(const n of Object.getOwnPropertyNames(e))"overrides"!==n&&ds(t,{extension:n,target:t.luma,target2:t})}(t,us),function(t,e){let{target:n,target2:i}=e;Object.keys(hs).forEach((e=>{if("function"==typeof hs[e]){const r=t[e]?t[e].bind(t):()=>{},s=hs[e].bind(null,t,r);n[e]=s,i[e]=s}}))}(t,{target:e,target2:t}),e.polyfilled=!0),t};const fs={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,36006:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],3333:4,3317:4,37440:!1,37441:!1,37443:37444,35723:4352,36010:null,35977:!1,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},ps=(t,e,n)=>e?t.enable(n):t.disable(n),gs=(t,e,n)=>t.hint(n,e),ms=(t,e,n)=>t.pixelStorei(n,e);function vs(t){return Array.isArray(t)||ArrayBuffer.isView(t)}const ys={3042:ps,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:ps,2885:(t,e)=>t.cullFace(e),2929:ps,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:ps,35723:gs,36006:(t,e)=>{const n=Zr(t)?36009:36160;return t.bindFramebuffer(n,e)},2886:(t,e)=>t.frontFace(e),33170:gs,2849:(t,e)=>t.lineWidth(e),32823:ps,32824:"polygonOffset",10752:"polygonOffset",35977:ps,32938:"sampleCoverage",32939:"sampleCoverage",3089:ps,3088:(t,e)=>t.scissor(...e),2960:ps,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),3333:ms,3317:ms,37440:ms,37441:ms,37443:ms,3330:ms,3332:ms,3331:ms,36010:(t,e)=>t.bindFramebuffer(36008,e),3314:ms,32878:ms,3316:ms,3315:ms,32877:ms,framebuffer:(t,e)=>{const n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{e=vs(e)?e:[e,e],t.blendEquationSeparate(...e)},blendFunc:(t,e)=>{e=vs(e)&&2===e.length?[...e,...e]:e,t.blendFuncSeparate(...e)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=vs(e)?e:[e,e];const[n,i]=e;t.stencilMaskSeparate(1028,n),t.stencilMaskSeparate(1029,i)},stencilFunc:(t,e)=>{e=vs(e)&&3===e.length?[...e,...e]:e;const[n,i,r,s,o,a]=e;t.stencilFuncSeparate(1028,n,i,r),t.stencilFuncSeparate(1029,s,o,a)},stencilOp:(t,e)=>{e=vs(e)&&3===e.length?[...e,...e]:e;const[n,i,r,s,o,a]=e;t.stencilOpSeparate(1028,n,i,r),t.stencilOpSeparate(1029,s,o,a)},viewport:(t,e)=>t.viewport(...e)};function bs(t,e,n){return void 0!==e[t]?e[t]:n[t]}const _s={blendEquation:(t,e,n)=>t.blendEquationSeparate(bs(32777,e,n),bs(34877,e,n)),blendFunc:(t,e,n)=>t.blendFuncSeparate(bs(32969,e,n),bs(32968,e,n),bs(32971,e,n),bs(32970,e,n)),polygonOffset:(t,e,n)=>t.polygonOffset(bs(32824,e,n),bs(10752,e,n)),sampleCoverage:(t,e,n)=>t.sampleCoverage(bs(32938,e,n),bs(32939,e,n)),stencilFuncFront:(t,e,n)=>t.stencilFuncSeparate(1028,bs(2962,e,n),bs(2967,e,n),bs(2963,e,n)),stencilFuncBack:(t,e,n)=>t.stencilFuncSeparate(1029,bs(34816,e,n),bs(36003,e,n),bs(36004,e,n)),stencilOpFront:(t,e,n)=>t.stencilOpSeparate(1028,bs(2964,e,n),bs(2965,e,n),bs(2966,e,n)),stencilOpBack:(t,e,n)=>t.stencilOpSeparate(1029,bs(34817,e,n),bs(34818,e,n),bs(34819,e,n))},As={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,n)=>t({[e]:n}),hint:(t,e,n)=>t({[e]:n}),bindFramebuffer:(t,e,n)=>{switch(e){case 36160:return t({36006:n,36010:n});case 36009:return t({36006:n});case 36008:return t({36010:n});default:return null}},blendColor:(t,e,n,i,r)=>t({32773:new Float32Array([e,n,i,r])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,n)=>t({32777:e,34877:n}),blendFunc:(t,e,n)=>t({32969:e,32968:n,32971:e,32970:n}),blendFuncSeparate:(t,e,n,i,r)=>t({32969:e,32968:n,32971:i,32970:r}),clearColor:(t,e,n,i,r)=>t({3106:new Float32Array([e,n,i,r])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,n,i,r)=>t({3107:[e,n,i,r]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,n)=>t({2928:new Float32Array([e,n])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,n)=>t({32824:e,10752:n}),sampleCoverage:(t,e,n)=>t({32938:e,32939:n}),scissor:(t,e,n,i,r)=>t({3088:new Int32Array([e,n,i,r])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,n)=>t({[1028===e?2968:36005]:n}),stencilFunc:(t,e,n,i)=>t({2962:e,2967:n,2963:i,34816:e,36003:n,36004:i}),stencilFuncSeparate:(t,e,n,i,r)=>t({[1028===e?2962:34816]:n,[1028===e?2967:36003]:i,[1028===e?2963:36004]:r}),stencilOp:(t,e,n,i)=>t({2964:e,2965:n,2966:i,34817:e,34818:n,34819:i}),stencilOpSeparate:(t,e,n,i,r)=>t({[1028===e?2964:34817]:n,[1028===e?2965:34818]:i,[1028===e?2966:34819]:r}),viewport:(t,e,n,i,r)=>t({2978:[e,n,i,r]})},ws=(t,e)=>t.isEnabled(e),Cs={3042:ws,2884:ws,2929:ws,3024:ws,32823:ws,32926:ws,32928:ws,3089:ws,2960:ws,35977:ws};function Es(t){for(const e in t)return!1;return!0}function xs(t,e){if(t===e)return!0;const n=Array.isArray(t)||ArrayBuffer.isView(t),i=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&i&&t.length===e.length){for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}return!1}function Ts(t,e){const n=t[e].bind(t);t[e]=function(){const e=arguments.length<=0?void 0:arguments[0];return e in t.state.cache&&t.state.enable?t.state.cache[e]:n(...arguments)},Object.defineProperty(t[e],"name",{value:"".concat(e,"-from-cache"),configurable:!1})}function Ss(t,e,n){const i=t[e].bind(t);t[e]=function(){for(var e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];const{valueChanged:o,oldValue:a}=n(t.state._updateCache,...r);return o&&i(...r),a},Object.defineProperty(t[e],"name",{value:"".concat(e,"-to-cache"),configurable:!1})}class Bs{constructor(t){let{copyState:e=!1,log:n=(()=>{})}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.gl=t,this.program=null,this.stateStack=[],this.enable=!0,this.cache=e?function(t,e){if("number"==typeof(e=e||fs)){const n=e,i=Cs[n];return i?i(t,n):t.getParameter(n)}const n=Array.isArray(e)?e:Object.keys(e),i={};for(const e of n){const n=Cs[e];i[e]=n?n(t,Number(e)):t.getParameter(Number(e))}return i}(t):Object.assign({},fs),this.log=n,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){Xr(this.stateStack.length>0);const t=this.stateStack[this.stateStack.length-1];Is(this.gl,t),this.stateStack.pop()}_updateCache(t){let e,n=!1;const i=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const r in t){Xr(void 0!==r);const s=t[r],o=this.cache[r];xs(s,o)||(n=!0,e=o,i&&!(r in i)&&(i[r]=o),this.cache[r]=s)}return{valueChanged:n,oldValue:e}}}function Ps(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{enable:n=!0,copyState:i}=e;if(Xr(void 0!==i),!t.state){const{polyfillContext:e}=globalThis;e&&e(t),t.state=new Bs(t,{copyState:i}),function(t){const e=t.useProgram.bind(t);t.useProgram=function(n){t.state.program!==n&&(e(n),t.state.program=n)}}(t);for(const e in As)Ss(t,e,As[e]);Ts(t,"getParameter"),Ts(t,"isEnabled")}return t.state.enable=n,t}function Ms(t){Xr(t.state),t.state.pop()}function Is(t,e){if(Xr(Yr(t),"setParameters requires a WebGL context"),Es(e))return;const n={};for(const i in e){const r=Number(i),s=ys[i];s&&("string"==typeof s?n[s]=!0:s(t,e[i],r))}const i=t.state&&t.state.cache;if(i)for(const r in n)(0,_s[r])(t,e,i)}function Ls(t,e,n){if(Es(e))return n(t);const{nocatch:i=!0}=e;let r;if(function(t){t.state||Ps(t,{copyState:!1}),t.state.push()}(t),Is(t,e),i)r=n(t),Ms(t);else try{r=n(t)}finally{Ms(t)}return r}function Os(t){const{luma:e}=t;if(t.canvas&&e){const n=e.canvasSizeInfo,i="clientWidth"in n?n.clientWidth:t.canvas.clientWidth;return i?t.drawingBufferWidth/i:1}return 1}function Rs(t,e){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return function(t,e,n,i,r){const s=Fs(t[0],e,n);let o=ks(t[1],e,i,r),a=Fs(t[0]+1,e,n);const l=a===n-1?a:a-1;let c;return a=ks(t[1]+1,e,i,r),r?(a=0===a?a:a+1,c=o,o=a):c=a===i-1?a:a-1,{x:s,y:o,width:Math.max(l-s+1,1),height:Math.max(c-o+1,1)}}(e,Os(t),t.drawingBufferWidth,t.drawingBufferHeight,n)}function Fs(t,e,n){return Math.min(Math.round(t*e),n-1)}function ks(t,e,n,i){return i?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}const Ds=Br(),Ns=Ds&&"undefined"!=typeof document,Us={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function zs(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Xr(Ds,"createGLContext only available in the browser.\nCreate your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils"),t=Object.assign({},Us,t);const{width:e,height:n}=t;function i(e){if(t.throwOnError)throw new Error(e);return console.error(e),null}let r;t.onError=i;const{canvas:s}=t,o=function(t){let e,{canvas:n,width:i=800,height:r=600,onError:s}=t;return"string"==typeof n?(Ns&&"complete"===document.readyState||s("createGLContext called on canvas '".concat(n,"' before page was loaded")),e=document.getElementById(n)):n?e=n:(e=document.createElement("canvas"),e.id="lumagl-canvas",e.style.width=Number.isFinite(i)?"".concat(i,"px"):"100%",e.style.height=Number.isFinite(r)?"".concat(r,"px"):"100%",document.body.insertBefore(e,document.body.firstChild)),e}({canvas:s,width:e,height:n,onError:i});return r=function(t,e){const{onError:n}=e;let i=null;const r=t=>i=t.statusMessage||i;t.addEventListener("webglcontextcreationerror",r,!1);const{webgl1:s=!0,webgl2:o=!0}=e;let a=null;return o&&(a=a||t.getContext("webgl2",e),a=a||t.getContext("experimental-webgl2",e)),s&&(a=a||t.getContext("webgl",e),a=a||t.getContext("experimental-webgl",e)),t.removeEventListener("webglcontextcreationerror",r,!1),a?(e.onContextLost&&t.addEventListener("webglcontextlost",e.onContextLost,!1),e.onContextRestored&&t.addEventListener("webglcontextrestored",e.onContextRestored,!1),a):n("Failed to create ".concat(o&&!s?"WebGL2":"WebGL"," context: ").concat(i||"Unknown error"))}(o,t),r?(r=Gs(r,t),function(t){const e=Zr(t)?"WebGL2":"WebGL1",n=function(t){const e=t.getParameter(7936),n=t.getParameter(7937),i=t.getExtension("WEBGL_debug_renderer_info");return{vendor:i&&t.getParameter(i.UNMASKED_VENDOR_WEBGL||7936)||e,renderer:i&&t.getParameter(i.UNMASKED_RENDERER_WEBGL||7937)||n,vendorMasked:e,rendererMasked:n,version:t.getParameter(7938),shadingLanguageVersion:t.getParameter(35724)}}(t),i=n?"(".concat(n.vendor,",").concat(n.renderer,")"):"",r=t.debug?" debug":"";Kr.info(1,"".concat(e).concat(r," context ").concat(i))()}(r),r):null}function Gs(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t||t._instrumented)return t;t._version=t._version||function(t){return"undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext?2:1}(t),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{},e=Object.assign({},Us,e);const{manageState:n,debug:i}=e;return n&&Ps(t,{copyState:!1,log:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return Kr.log(1,...e)()}}),Ds&&i&&(globalThis.makeDebugContext?(t=globalThis.makeDebugContext(t,e),Kr.level=Math.max(Kr.level,1)):Kr.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),t._instrumented=!0,t}function js(){let t;if("undefined"!=typeof window&&window.performance)t=window.performance.now();else if("undefined"!=typeof process&&process.hrtime){const e=process.hrtime();t=1e3*e[0]+e[1]/1e6}else t=Date.now();return t}class Vs{constructor(t,e){m(this,"name",void 0),m(this,"type",void 0),m(this,"sampleSize",1),m(this,"time",void 0),m(this,"count",void 0),m(this,"samples",void 0),m(this,"lastTiming",void 0),m(this,"lastSampleTime",void 0),m(this,"lastSampleCount",void 0),m(this,"_count",0),m(this,"_time",0),m(this,"_samples",0),m(this,"_startTime",0),m(this,"_timerPending",!1),this.name=t,this.type=e,this.reset()}setSampleSize(t){return this.sampleSize=t,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(t){return this._count+=t,this._samples++,this._checkSampling(),this}subtractCount(t){return this._count-=t,this._samples++,this._checkSampling(),this}addTime(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=js(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(js()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Hs{constructor(t){m(this,"id",void 0),m(this,"stats",{}),this.id=t.id,this.stats={},this._initializeStats(t.stats),Object.seal(this)}get(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"count";return this._getOrCreate({name:t,type:e})}get size(){return Object.keys(this.stats).length}reset(){for(const t in this.stats)this.stats[t].reset();return this}forEach(t){for(const e in this.stats)t(this.stats[e])}getTable(){const t={};return this.forEach((e=>{t[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}})),t}_initializeStats(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach((t=>this._getOrCreate(t)))}_getOrCreate(t){if(!t||!t.name)return null;const{name:e,type:n}=t;return this.stats[e]||(this.stats[e]=t instanceof Vs?t:new Vs(e,n)),this.stats[e]}}function Ws(t){if("undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof process&&"object"==typeof process.versions&&Boolean(process.versions.electron))return!0;const e="object"==typeof navigator&&"string"==typeof navigator.userAgent&&navigator.userAgent,n=t||e;return!!(n&&n.indexOf("Electron")>=0)}function Js(){return!("object"==typeof process&&"[object process]"===String(process)&&!process.browser)||Ws()}const qs="8.5.21",Ks=new class{constructor(){this.stats=new Map}get(t){return this.stats.has(t)||this.stats.set(t,new Hs({id:t})),this.stats.get(t)}};if(globalThis.luma&&globalThis.luma.VERSION!==qs)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(qs));function Xs(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}function Qs(t,e){if("string"!=typeof e)return e;const n=Number(e);if(!isNaN(n))return n;const i=t[e=e.replace(/^.*\./,"")];return Xs(void 0!==i,"Accessing undefined constant GL.".concat(e)),i}function Ys(t,e){e=Number(e);for(const n in t)if(t[n]===e)return"GL.".concat(n);return String(e)}globalThis.luma||(Js()&&Kr.log(1,"luma.gl ".concat(qs," - ").concat("set luma.log.level=1 (or higher) to trace rendering"))(),globalThis.luma=globalThis.luma||{VERSION:qs,version:qs,log:Kr,stats:Ks,globals:{modules:{},nodeIO:{}}}),globalThis.luma;const Zs={};function $s(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"id";Zs[t]=Zs[t]||1;const e=Zs[t]++;return"".concat(t,"-").concat(e)}function to(t){return Xs("number"==typeof t,"Input must be a number"),t&&0==(t&t-1)}function eo(t){let e=!0;for(const n in t){e=!1;break}return e}function no(t,e,n,i){const r="See luma.gl ".concat(n," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),s=Object.getPrototypeOf(t);i.forEach((t=>{s.methodName||(s[t]=()=>{throw Kr.removed("Calling removed method ".concat(e,".").concat(t,": "),r)(),new Error(t)})}))}const io="Resource subclass must define virtual methods";class ro{get[Symbol.toStringTag](){return"Resource"}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};$r(t);const{id:n,userData:i={}}=e;this.gl=t,this.gl2=t,this.id=n||$s(this[Symbol.toStringTag]),this.userData=i,this._bound=!1,this._handle=e.handle,void 0===this._handle&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,e&&t&&e.filter(Boolean).forEach((t=>t.delete())),this}bind(){let t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.handle;return"function"!=typeof e?(this._bindHandle(e),this):(this._bound?t=e():(this._bindHandle(this.handle),this._bound=!0,t=e(),this._bound=!1,this._bindHandle(null)),t)}unbind(){this.bind(null)}getParameter(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Xs(t=Qs(this.gl,t));const n=(this.constructor.PARAMETERS||{})[t];if(n){const t=Zr(this.gl);if("webgl2"in n&&!t||"extension"in n&&!this.gl.getExtension(n.extension)){const e=n.webgl1,i="webgl2"in n?n.webgl2:n.webgl1;return t?i:e}}return this._getParameter(t,e)}getParameters(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{parameters:e,keys:n}=t,i=this.constructor.PARAMETERS||{},r=Zr(this.gl),s={},o=e||Object.keys(i);for(const e of o){const o=i[e];if(o&&(!("webgl2"in o)||r)&&(!("extension"in o)||this.gl.getExtension(o.extension))){const i=n?Ys(this.gl,e):e;s[i]=this.getParameter(e,t),n&&"GLenum"===o.type&&(s[i]=Ys(this.gl,s[i]))}}return s}setParameter(t,e){Xs(t=Qs(this.gl,t));const n=(this.constructor.PARAMETERS||{})[t];if(n){const t=Zr(this.gl);if("webgl2"in n&&!t||"extension"in n&&!this.gl.getExtension(n.extension))throw new Error("Parameter not available on this platform");"GLenum"===n.type&&(e=Qs(e))}return this._setParameter(t,e),this}setParameters(t){for(const e in t)this.setParameter(e,t[e]);return this}stubRemovedMethods(t,e,n){return no(this,t,e,n)}initialize(t){}_createHandle(){throw new Error(io)}_deleteHandle(){throw new Error(io)}_bindHandle(t){throw new Error(io)}_getOptsFromHandle(){throw new Error(io)}_getParameter(t,e){throw new Error(io)}_setParameter(t,e){throw new Error(io)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const t=this[Symbol.toStringTag],e=Ks.get("Resource Counts");e.get("Resources Created").incrementCount(),e.get("".concat(t,"s Created")).incrementCount(),e.get("".concat(t,"s Active")).incrementCount()}_removeStats(){const t=this[Symbol.toStringTag];Ks.get("Resource Counts").get("".concat(t,"s Active")).decrementCount()}_trackAllocatedMemory(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this[Symbol.toStringTag];this._trackAllocatedMemoryForContext(t,e),this._trackAllocatedMemoryForContext(t,e,this.gl.canvas&&this.gl.canvas.id),this.byteLength=t}_trackAllocatedMemoryForContext(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this[Symbol.toStringTag],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const i=Ks.get("Memory Usage".concat(n));i.get("GPU Memory").addCount(t),i.get("".concat(e," Memory")).addCount(t)}_trackDeallocatedMemory(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this[Symbol.toStringTag];this._trackDeallocatedMemoryForContext(t),this._trackDeallocatedMemoryForContext(t,this.gl.canvas&&this.gl.canvas.id),this.byteLength=0}_trackDeallocatedMemoryForContext(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this[Symbol.toStringTag],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const n=Ks.get("Memory Usage".concat(e));n.get("GPU Memory").subtractCount(this.byteLength),n.get("".concat(t," Memory")).subtractCount(this.byteLength)}}const so="Failed to deduce GL constant from typed array";function oo(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(so)}}function ao(t){let{clamped:e=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return e?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function lo(t){let{data:e,width:n,height:i}=t;const r=Math.round(n/2),s=Math.round(i/2),o=new Uint8Array(r*s*4);for(let t=0;t<s;t++)for(let i=0;i<r;i++)for(let s=0;s<4;s++)o[4*(t*r+i)+s]=e[4*(2*t*n+2*i)+s];return{data:o,width:r,height:s}}function co(t,e,n){const{removedProps:i={},deprecatedProps:r={},replacedProps:s={}}=n;for(const n in i)if(n in e){const e=i[n]?"".concat(t,".").concat(i[n]):"N/A";Kr.removed("".concat(t,".").concat(n),e)()}for(const n in r)if(n in e){const e=r[n];Kr.deprecated("".concat(t,".").concat(n),"".concat(t,".").concat(e))()}let o=null;for(const n in s)if(n in e){const i=s[n];Kr.deprecated("".concat(t,".").concat(n),"".concat(t,".").concat(i))(),o=o||Object.assign({},e),o[i]=e[n],delete o[n]}return o||e}const uo={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},ho={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class fo{static getBytesPerElement(t){return ao(t.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(t){return Xs(t.size),ao(t.type||5126).BYTES_PER_ELEMENT*t.size}static resolve(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return new fo(...[uo,...e])}constructor(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];e.forEach((t=>this._assign(t))),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return fo.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return fo.getBytesPerVertex(this)}_assign(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t=co("Accessor",t,ho),void 0!==t.type&&(this.type=t.type,5124!==t.type&&5125!==t.type||(this.integer=!0)),void 0!==t.size&&(this.size=t.size),void 0!==t.offset&&(this.offset=t.offset),void 0!==t.stride&&(this.stride=t.stride),void 0!==t.normalized&&(this.normalized=t.normalized),void 0!==t.integer&&(this.integer=t.integer),void 0!==t.divisor&&(this.divisor=t.divisor),void 0!==t.buffer&&(this.buffer=t.buffer),void 0!==t.index&&("boolean"==typeof t.index?this.index=t.index?1:0:this.index=t.index),void 0!==t.instanced&&(this.divisor=t.instanced?1:0),void 0!==t.isInstanced&&(this.divisor=t.isInstanced?1:0),this}}const po={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},go={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:po},mo={removedProps:po};class vo extends ro{get[Symbol.toStringTag](){return"Buffer"}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(t,e),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=e.target||(this.gl.webgl2?36662:34962),this.initialize(e),Object.seal(this)}getElementCount(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.accessor;return Math.round(this.byteLength/fo.getBytesPerElement(t))}getVertexCount(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.accessor;return Math.round(this.byteLength/fo.getBytesPerVertex(t))}initialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return ArrayBuffer.isView(t)&&(t={data:t}),Number.isFinite(t)&&(t={byteLength:t}),t=co("Buffer",t,go),this.usage=t.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},t,t.accessor)),t.data?this._setData(t.data,t.offset,t.byteLength):this._setByteLength(t.byteLength||0),this}setProps(t){return"accessor"in(t=co("Buffer",t,mo))&&this.setAccessor(t.accessor),this}setAccessor(t){return delete(t=Object.assign({},t)).buffer,this.accessor=new fo(t),this}reallocate(t){return t>this.byteLength?(this._setByteLength(t),!0):(this.bytesUsed=t,!1)}setData(t){return this.initialize(t)}subData(t){ArrayBuffer.isView(t)&&(t={data:t});const{data:e,offset:n=0,srcOffset:i=0}=t,r=t.byteLength||t.length;Xs(e);const s=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(s,this.handle),0!==i||void 0!==r?(ts(this.gl),this.gl.bufferSubData(this.target,n,e,i,r)):this.gl.bufferSubData(s,n,e),this.gl.bindBuffer(s,null),this.debugData=null,this._inferType(e),this}copyData(t){let{sourceBuffer:e,readOffset:n=0,writeOffset:i=0,size:r}=t;const{gl:s}=this;return ts(s),s.bindBuffer(36662,e.handle),s.bindBuffer(36663,this.handle),s.copyBufferSubData(36662,36663,n,i,r),s.bindBuffer(36662,null),s.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:t=null,srcByteOffset:e=0,dstOffset:n=0,length:i=0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};ts(this.gl);const r=ao(this.accessor.type||5126,{clamped:!1}),s=this._getAvailableElementCount(e),o=n;let a,l;t?(l=t.length,a=l-o):(a=Math.min(s,i||s),l=o+a);const c=Math.min(s,a);return i=i||c,Xs(i<=c),t=t||new r(l),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,e,t,n,i),this.gl.bindBuffer(36662,null),t}bind(){let{target:t=this.target,index:e=this.accessor&&this.accessor.index,offset:n=0,size:i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return 35345===t||35982===t?void 0!==i?this.gl.bindBufferRange(t,e,this.handle,n,i):(Xs(0===n),this.gl.bindBufferBase(t,e,this.handle)):this.gl.bindBuffer(t,this.handle),this}unbind(){let{target:t=this.target,index:e=this.accessor&&this.accessor.index}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return 35345===t||35982===t?this.gl.bindBufferBase(t,e,null):this.gl.bindBuffer(t,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(10,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.byteLength+e;Xs(ArrayBuffer.isView(t)),this._trackDeallocatedMemory();const i=this._getTarget();this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,n,this.usage),this.gl.bufferSubData(i,e,t),this.gl.bindBuffer(i,null),this.debugData=t.slice(0,10),this.bytesUsed=n,this._trackAllocatedMemory(n);const r=oo(t);return Xs(r),this.setAccessor(new fo(this.accessor,{type:r})),this}_setByteLength(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.usage;Xs(t>=0),this._trackDeallocatedMemory();let n=t;0===t&&(n=new Float32Array(0));const i=this._getTarget();return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,n,e),this.gl.bindBuffer(i,null),this.usage=e,this.debugData=null,this.bytesUsed=t,this._trackAllocatedMemory(t),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(t){const e=t/ao(this.accessor.type||5126,{clamped:!1}).BYTES_PER_ELEMENT;return this.getElementCount()-e}_inferType(t){this.accessor.type||this.setAccessor(new fo(this.accessor,{type:oo(t)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(t){this.gl.bindBuffer(this.target,this.handle);const e=this.gl.getBufferParameter(this.target,t);return this.gl.bindBuffer(this.target,null),e}get type(){return Kr.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return Kr.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(t){return Kr.deprecated("setByteLength","reallocate")(),this.reallocate(t)}updateAccessor(t){return Kr.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new fo(this.accessor,t),this}}const yo={6407:{dataFormat:6407,types:[5121,33635]},6408:{dataFormat:6408,types:[5121,32819,32820]},6406:{dataFormat:6406,types:[5121]},6409:{dataFormat:6409,types:[5121]},6410:{dataFormat:6410,types:[5121]},33326:{dataFormat:6403,types:[5126],gl2:!0},33328:{dataFormat:33319,types:[5126],gl2:!0},34837:{dataFormat:6407,types:[5126],gl2:!0},34836:{dataFormat:6408,types:[5126],gl2:!0}},bo={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},_o={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1},Ao=[9729,9728],wo=globalThis.WebGLBuffer||function(){};class Co extends ro{get[Symbol.toStringTag](){return"Texture"}static isSupported(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{format:n,linearFiltering:i}=e;let r=!0;return n&&(r=r&&function(t,e){const n=yo[e];if(!n)return!1;if(void 0===n.gl1&&void 0===n.gl2)return!0;const i=Zr(t)&&n.gl2||n.gl1;return"string"==typeof i?t.getExtension(i):i}(t,n),r=r&&(!i||function(t,e){const n=yo[e];switch(n&&n.types[0]){case 5126:return t.getExtension("OES_texture_float_linear");case 5131:return t.getExtension("OES_texture_half_float_linear");default:return!0}}(t,n))),r}constructor(t,e){const{id:n=$s("texture"),handle:i,target:r}=e;super(t,{id:n,handle:i}),this.target=r,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.data;if(e instanceof Promise)return e.then((e=>this.initialize(Object.assign({},t,{pixels:e,data:e})))),this;const n="undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement;if(n&&e.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,e.addEventListener("loadeddata",(()=>this.initialize(t))),this;const{pixels:i=null,format:r=6408,border:s=0,recreate:o=!1,parameters:a={},pixelStore:l={},textureUnit:c}=t;e||(e=i);let{width:u,height:h,dataFormat:d,type:f,compressed:p=!1,mipmaps:g=!0}=t;const{depth:m=0}=t;return({width:u,height:h,compressed:p,dataFormat:d,type:f}=this._deduceParameters({format:r,type:f,dataFormat:d,compressed:p,data:e,width:u,height:h})),this.width=u,this.height=h,this.depth=m,this.format=r,this.type=f,this.dataFormat=d,this.border=s,this.textureUnit=c,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),g&&this._isNPOT()&&(Kr.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),g=!1,this._updateForNPOT(a)),this.mipmaps=g,this.setImageData({data:e,width:u,height:h,depth:m,format:r,type:f,dataFormat:d,border:s,mipmaps:g,parameters:l,compressed:p}),g&&this.generateMipmap(),this.setParameters(a),o&&(this.data=e),n&&(this._video={video:e,parameters:a,lastTime:e.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?e.currentTime:-1}),this}update(){if(this._video){const{video:t,parameters:e,lastTime:n}=this._video;if(n===t.currentTime||t.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:t,parameters:e}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=t.currentTime}}resize(t){let{height:e,width:n,mipmaps:i=!1}=t;return n!==this.width||e!==this.height?this.initialize({width:n,height:e,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:i}):this}generateMipmap(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._isNPOT()?(Kr.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Ls(this.gl,t,(()=>{this.gl.generateMipmap(this.target)})),this.gl.bindTexture(this.target,null),this)}setImageData(t){this._trackDeallocatedMemory("Texture");const{target:e=this.target,pixels:n=null,level:i=0,format:r=this.format,border:s=this.border,offset:o=0,parameters:a={}}=t;let{data:l=null,type:c=this.type,width:u=this.width,height:h=this.height,dataFormat:d=this.dataFormat,compressed:f=!1}=t;l||(l=n),({type:c,dataFormat:d,compressed:f,width:u,height:h}=this._deduceParameters({format:r,type:c,dataFormat:d,compressed:f,data:l,width:u,height:h}));const{gl:p}=this;p.bindTexture(this.target,this.handle);let g,m=null;({data:l,dataType:m}=this._getDataType({data:l,compressed:f}));let v=0;if(Ls(this.gl,a,(()=>{switch(m){case"null":p.texImage2D(e,i,r,u,h,s,d,c,l);break;case"typed-array":p.texImage2D(e,i,r,u,h,s,d,c,l,o);break;case"buffer":g=ts(p),g.bindBuffer(35052,l.handle||l),g.texImage2D(e,i,r,u,h,s,d,c,o),g.bindBuffer(35052,null);break;case"browser-object":Zr(p)?p.texImage2D(e,i,r,u,h,s,d,c,l):p.texImage2D(e,i,r,d,c,l);break;case"compressed":for(const[t,n]of l.entries())p.compressedTexImage2D(e,t,n.format,n.width,n.height,s,n.data),v+=n.levelSize;break;default:Xs(!1,"Unknown image data type")}})),"compressed"===m)this._trackAllocatedMemory(v,"Texture");else if(l&&l.byteLength)this._trackAllocatedMemory(l.byteLength,"Texture");else{const t=bo[this.dataFormat]||4,e=_o[this.type]||1;this._trackAllocatedMemory(this.width*this.height*t*e,"Texture")}return this.loaded=!0,this}setSubImageData(t){let{target:e=this.target,pixels:n=null,data:i=null,x:r=0,y:s=0,width:o=this.width,height:a=this.height,level:l=0,format:c=this.format,type:u=this.type,dataFormat:h=this.dataFormat,compressed:d=!1,offset:f=0,border:p=this.border,parameters:g={}}=t;if(({type:u,dataFormat:h,compressed:d,width:o,height:a}=this._deduceParameters({format:c,type:u,dataFormat:h,compressed:d,data:i,width:o,height:a})),Xs(0===this.depth,"texSubImage not supported for 3D textures"),i||(i=n),i&&i.data){const t=i;i=t.data,o=t.shape[0],a=t.shape[1]}i instanceof vo&&(i=i.handle),this.gl.bindTexture(this.target,this.handle),Ls(this.gl,g,(()=>{if(d)this.gl.compressedTexSubImage2D(e,l,r,s,o,a,c,i);else if(null===i)this.gl.texSubImage2D(e,l,r,s,o,a,h,u,null);else if(ArrayBuffer.isView(i))this.gl.texSubImage2D(e,l,r,s,o,a,h,u,i,f);else if(i instanceof wo){const t=ts(this.gl);t.bindBuffer(35052,i),t.texSubImage2D(e,l,r,s,o,a,h,u,f),t.bindBuffer(35052,null)}else Zr(this.gl)?ts(this.gl).texSubImage2D(e,l,r,s,o,a,h,u,i):this.gl.texSubImage2D(e,l,r,s,h,u,i)})),this.gl.bindTexture(this.target,null)}copyFramebuffer(){return Kr.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.textureUnit;const{gl:e}=this;return void 0!==t&&(this.textureUnit=t,e.activeTexture(33984+t)),e.bindTexture(this.target,this.handle),t}unbind(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.textureUnit;const{gl:e}=this;return void 0!==t&&(this.textureUnit=t,e.activeTexture(33984+t)),e.bindTexture(this.target,null),t}_getDataType(t){let{data:e,compressed:n=!1}=t;return n?{data:e,dataType:"compressed"}:null===e?{data:e,dataType:"null"}:ArrayBuffer.isView(e)?{data:e,dataType:"typed-array"}:e instanceof vo?{data:e.handle,dataType:"buffer"}:e instanceof wo?{data:e,dataType:"buffer"}:{data:e,dataType:"browser-object"}}_deduceParameters(t){const{format:e,data:n}=t;let{width:i,height:r,dataFormat:s,type:o,compressed:a}=t;const l=yo[e];return s=s||l&&l.dataFormat,o=o||l&&l.types[0],a=a||l&&l.compressed,({width:i,height:r}=this._deduceImageSize(n,i,r)),{dataFormat:s,type:o,compressed:a,width:i,height:r,format:e,data:n}}_deduceImageSize(t,e,n){let i;return i="undefined"!=typeof ImageData&&t instanceof ImageData?{width:t.width,height:t.height}:"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement?{width:t.naturalWidth,height:t.naturalHeight}:"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?{width:t.width,height:t.height}:"undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t?{width:e,height:n}:{width:e>=0?e:1,height:n>=0?n:1},Xs(i,"Could not deduced texture size"),Xs(void 0===e||i.width===e,"Deduced texture width does not match supplied width"),Xs(void 0===n||i.height===n,"Deduced texture height does not match supplied height"),i}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(t){switch(t){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const e=this.gl.getTexParameter(this.target,t);return this.gl.bindTexture(this.target,null),e}}_setParameter(t,e){switch(this.gl.bindTexture(this.target,this.handle),e=this._getNPOTParam(t,e),t){case 33082:case 33083:this.gl.texParameterf(this.handle,t,e);break;case 4096:case 4097:Xs(!1);break;default:this.gl.texParameteri(this.target,t,e)}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return!(Zr(this.gl)||!this.width||!this.height||to(this.width)&&to(this.height))}_updateForNPOT(t){void 0===t[this.gl.TEXTURE_MIN_FILTER]&&(t[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),void 0===t[this.gl.TEXTURE_WRAP_S]&&(t[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),void 0===t[this.gl.TEXTURE_WRAP_T]&&(t[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(t,e){if(this._isNPOT())switch(t){case 10241:-1===Ao.indexOf(e)&&(e=9729);break;case 10242:case 10243:33071!==e&&(e=33071)}return e}}class Eo extends Co{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(t,e){return Co.isSupported(t,e)}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n;$r(t),(e instanceof Promise||"string"==typeof e)&&(e={data:e}),"string"==typeof e.data&&(e=Object.assign({},e,{data:(n=e.data,Xs("string"==typeof n),n=""+n,new Promise(((t,e)=>{try{const i=new Image;i.onload=()=>t(i),i.onerror=()=>e(new Error("Could not load image ".concat(n,"."))),i.crossOrigin="anonymous",i.src=n}catch(t){e(t)}})))})),super(t,Object.assign({},e,{target:3553})),this.initialize(e),Object.seal(this)}}const xo="EXT_color_buffer_float",To={33189:{bpp:2},33190:{gl2:!0,bpp:3},36012:{gl2:!0,bpp:4},36168:{bpp:1},34041:{bpp:4},35056:{gl2:!0,bpp:4},36013:{gl2:!0,bpp:5},32854:{bpp:2},36194:{bpp:2},32855:{bpp:2},33321:{gl2:!0,bpp:1},33330:{gl2:!0,bpp:1},33329:{gl2:!0,bpp:1},33332:{gl2:!0,bpp:2},33331:{gl2:!0,bpp:2},33334:{gl2:!0,bpp:4},33333:{gl2:!0,bpp:4},33323:{gl2:!0,bpp:2},33336:{gl2:!0,bpp:2},33335:{gl2:!0,bpp:2},33338:{gl2:!0,bpp:4},33337:{gl2:!0,bpp:4},33340:{gl2:!0,bpp:8},33339:{gl2:!0,bpp:8},32849:{gl2:!0,bpp:3},32856:{gl2:!0,bpp:4},32857:{gl2:!0,bpp:4},36220:{gl2:!0,bpp:4},36238:{gl2:!0,bpp:4},36975:{gl2:!0,bpp:4},36214:{gl2:!0,bpp:8},36232:{gl2:!0,bpp:8},36226:{gl2:!0,bpp:16},36208:{gl2:!0,bpp:16},33325:{gl2:xo,bpp:2},33327:{gl2:xo,bpp:4},34842:{gl2:xo,bpp:8},33326:{gl2:xo,bpp:4},33328:{gl2:xo,bpp:8},34836:{gl2:xo,bpp:16},35898:{gl2:xo,bpp:4}};class So extends ro{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(t){let{format:e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{format:null};return!e||function(t,e,n){const i=n[e];if(!i)return!1;const r=Zr(t)&&i.gl2||i.gl1;return"string"==typeof r?t.getExtension(r):r}(t,e,To)}static getSamplesForFormat(t,e){let{format:n}=e;return t.getInternalformatParameter(36161,n,32937)}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(t,e),this.initialize(e),Object.seal(this)}initialize(t){let{format:e,width:n=1,height:i=1,samples:r=0}=t;return Xs(e,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),0!==r&&Zr(this.gl)?this.gl.renderbufferStorageMultisample(36161,r,e,n,i):this.gl.renderbufferStorage(36161,e,n,i),this.format=e,this.width=n,this.height=i,this.samples=r,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*To[this.format].bpp),this}resize(t){let{width:e,height:n}=t;return e!==this.width||n!==this.height?this.initialize({width:e,height:n,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(t){this.gl.bindRenderbuffer(36161,t)}_syncHandle(t){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(t){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,t)}}const Bo=6144,Po="clear: bad arguments";function Mo(t){let{framebuffer:e=null,color:n=null,depth:i=null,stencil:r=null}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s={};e&&(s.framebuffer=e);let o=0;n&&(o|=16384,!0!==n&&(s.clearColor=n)),i&&(o|=256,!0!==i&&(s.clearDepth=i)),r&&(o|=1024,!0!==i&&(s.clearStencil=i)),Xs(0!==o,Po),Ls(t,s,(()=>{t.clear(o)}))}const Io=[34069,34070,34071,34072,34073,34074];class Lo extends Co{get[Symbol.toStringTag](){return"TextureCube"}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};$r(t),super(t,Object.assign({},e,{target:34067})),this.initialize(e),Object.seal(this)}initialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{mipmaps:e=!0,parameters:n={}}=t;return this.opts=t,this.setCubeMapImageData(t).then((()=>{this.loaded=!0,e&&this.generateMipmap(t),this.setParameters(n)})),this}subImage(t){let{face:e,data:n,x:i=0,y:r=0,mipmapLevel:s=0}=t;return this._subImage({target:e,data:n,x:i,y:r,mipmapLevel:s})}async setCubeMapImageData(t){let{width:e,height:n,pixels:i,data:r,border:s=0,format:o=6408,type:a=5121}=t;const{gl:l}=this,c=i||r,u=await Promise.all(Io.map((t=>{const e=c[t];return Promise.all(Array.isArray(e)?e:[e])})));this.bind(),Io.forEach(((t,i)=>{u[i].length>1&&!1!==this.opts.mipmaps&&Kr.warn("".concat(this.id," has mipmap and multiple LODs."))(),u[i].forEach(((i,r)=>{e&&n?l.texImage2D(t,r,o,e,n,s,o,a,i):l.texImage2D(t,r,o,o,a,i)}))})),this.unbind()}setImageDataForFace(t){const{face:e,width:n,height:i,pixels:r,data:s,border:o=0,format:a=6408,type:l=5121}=t,{gl:c}=this,u=r||s;return this.bind(),u instanceof Promise?u.then((n=>this.setImageDataForFace(Object.assign({},t,{face:e,data:n,pixels:n})))):this.width||this.height?c.texImage2D(e,0,a,n,i,o,a,l,u):c.texImage2D(e,0,a,a,l,u),this}}Lo.FACES=Io;class Oo extends Co{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(t){return Zr(t)}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};ts(t),e=Object.assign({depth:1},e,{target:32879,unpackFlipY:!1}),super(t,e),this.initialize(e),Object.seal(this)}setImageData(t){let{level:e=0,dataFormat:n=6408,width:i,height:r,depth:s=1,border:o=0,format:a,type:l=5121,offset:c=0,data:u,parameters:h={}}=t;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),Ls(this.gl,h,(()=>{ArrayBuffer.isView(u)&&this.gl.texImage3D(this.target,e,n,i,r,s,o,a,l,u),u instanceof vo&&(this.gl.bindBuffer(35052,u.handle),this.gl.texImage3D(this.target,e,n,i,r,s,o,a,l,c))})),u&&u.byteLength)this._trackAllocatedMemory(u.byteLength,"Texture");else{const t=bo[this.dataFormat]||4,e=_o[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*t*e,"Texture")}return this.loaded=!0,this}}function Ro(t,e){const{gl:n,width:i,height:r,id:s}=t;return new Ko(n,Object.assign({},e,{id:"framebuffer-for-".concat(s),width:i,height:r,attachments:{36064:t}}))}function Fo(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{sourceX:n=0,sourceY:i=0,sourceFormat:r=6408}=e;let{sourceAttachment:s=36064,target:o=null,sourceWidth:a,sourceHeight:l,sourceType:c}=e;const{framebuffer:u,deleteFramebuffer:h}=Do(t);Xs(u);const{gl:d,handle:f,attachments:p}=u;a=a||u.width,l=l||u.height,36064===s&&null===f&&(s=1028),Xs(p[s]),c=c||p[s].type,o=function(t,e,n,i,r){if(t)return t;const s=ao(e=e||5121,{clamped:!1}),o=function(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return Xs(!1),0}}(n);return new s(i*r*o)}(o,c,r,a,l),c=c||oo(o);const g=d.bindFramebuffer(36160,f);return d.readPixels(n,i,a,l,r,c,o),d.bindFramebuffer(36160,g||null),h&&u.delete(),o}function ko(t){let{sourceAttachment:e=36064,targetMaxHeight:n=Number.MAX_SAFE_INTEGER}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=Fo(t,{sourceAttachment:e}),{width:r,height:s}=t;for(;s>n;)({data:i,width:r,height:s}=lo({data:i,width:r,height:s}));!function(t){let{data:e,width:n,height:i,bytesPerPixel:r=4,temp:s}=t;const o=n*r;s=s||new Uint8Array(o);for(let t=0;t<i/2;++t){const n=t*o,r=(i-t-1)*o;s.set(e.subarray(n,n+o)),e.copyWithin(n,r,r+o),e.set(s,r)}}({data:i,width:r,height:s});const o=document.createElement("canvas");o.width=r,o.height=s;const a=o.getContext("2d"),l=a.createImageData(r,s);return l.data.set(i),a.putImageData(l,0,0),o.toDataURL()}function Do(t){return t instanceof Ko?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:Ro(t),deleteFramebuffer:!0}}const No="TIMER_QUERY",Uo="ELEMENT_INDEX_UINT32",zo="GLSL_DERIVATIVES",Go="GLSL_TEXTURE_LOD",jo={WEBGL2:[!1,!0],VERTEX_ARRAY_OBJECT:["OES_vertex_array_object",!0],[No]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],INSTANCED_RENDERING:["ANGLE_instanced_arrays",!0],MULTIPLE_RENDER_TARGETS:["WEBGL_draw_buffers",!0],[Uo]:["OES_element_index_uint",!0],BLEND_EQUATION_MINMAX:["EXT_blend_minmax",!0],FLOAT_BLEND:["EXT_float_blend"],COLOR_ENCODING_SRGB:["EXT_sRGB",!0],TEXTURE_DEPTH:["WEBGL_depth_texture",!0],TEXTURE_FLOAT:["OES_texture_float",!0],TEXTURE_HALF_FLOAT:["OES_texture_half_float",!0],TEXTURE_FILTER_LINEAR_FLOAT:["OES_texture_float_linear"],TEXTURE_FILTER_LINEAR_HALF_FLOAT:["OES_texture_half_float_linear"],TEXTURE_FILTER_ANISOTROPIC:["EXT_texture_filter_anisotropic"],COLOR_ATTACHMENT_RGBA32F:[function(t){const e=new Eo(t,{format:6408,type:5126,dataFormat:6408}),n=new Ko(t,{id:"test-framebuffer",check:!1,attachments:{36064:e}}),i=n.getStatus();return e.delete(),n.delete(),36053===i},"EXT_color_buffer_float"],COLOR_ATTACHMENT_FLOAT:[!1,"EXT_color_buffer_float"],COLOR_ATTACHMENT_HALF_FLOAT:["EXT_color_buffer_half_float"],GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],[zo]:["OES_standard_derivatives",!0],[Go]:["EXT_shader_texture_lod",!0]},Vo=2;function Ho(t,e){return Wo(t,e)}function Wo(t,e){return(e=Array.isArray(e)?e:[e]).every((e=>Jo(t,e)))}function Jo(t,e){return t.luma=t.luma||{},t.luma.caps=t.luma.caps||{},void 0===t.luma.caps[e]&&(t.luma.caps[e]=function(t,e){const n=jo[e];let i;Xs(n,e);const r=Zr(t)&&n[1]||n[0];if("function"==typeof r)i=r(t);else if(Array.isArray(r)){i=!0;for(const e of r)i=i&&Boolean(t.getExtension(e))}else"string"==typeof r?i=Boolean(t.getExtension(r)):"boolean"==typeof r?i=r:Xs(!1);return i}(t,e)),t.luma.caps[e]||Kr.log(Vo,"Feature: ".concat(e," not supported"))(),t.luma.caps[e]}const qo="Multiple render targets not supported";class Ko extends ro{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{colorBufferFloat:n,colorBufferHalfFloat:i}=e;let r=!0;return n&&(r=Boolean(t.getExtension("EXT_color_buffer_float")||t.getExtension("WEBGL_color_buffer_float")||t.getExtension("OES_texture_float"))),i&&(r=r&&Boolean(t.getExtension("EXT_color_buffer_float")||t.getExtension("EXT_color_buffer_half_float"))),r}static getDefaultFramebuffer(t){return t.luma=t.luma||{},t.luma.defaultFramebuffer=t.luma.defaultFramebuffer||new Ko(t,{id:"default-framebuffer",handle:null,attachments:{}}),t.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const t=ts(this.gl);return t.getParameter(t.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const t=ts(this.gl);return t.getParameter(t.MAX_DRAW_BUFFERS)}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(t,e),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(e),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(t){let{width:e=1,height:n=1,attachments:i=null,color:r=!0,depth:s=!0,stencil:o=!1,check:a=!0,readBuffer:l,drawBuffers:c}=t;if(Xs(e>=0&&n>=0,"Width and height need to be integers"),this.width=e,this.height=n,i)for(const t in i){const r=i[t];(Array.isArray(r)?r[0]:r).resize({width:e,height:n})}else i=this._createDefaultAttachments(r,s,o,e,n);this.update({clearAttachments:!0,attachments:i,readBuffer:l,drawBuffers:c}),i&&a&&this.checkStatus()}delete(){for(const t of this.ownResources)t.delete();return super.delete(),this}update(t){let{attachments:e={},readBuffer:n,drawBuffers:i,clearAttachments:r=!1,resizeAttachments:s=!0}=t;this.attach(e,{clearAttachments:r,resizeAttachments:s});const{gl:o}=this,a=o.bindFramebuffer(36160,this.handle);return n&&this._setReadBuffer(n),i&&this._setDrawBuffers(i),o.bindFramebuffer(36160,a||null),this}resize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{width:e,height:n}=t;if(null===this.handle)return Xs(void 0===e&&void 0===n),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;void 0===e&&(e=this.gl.drawingBufferWidth),void 0===n&&(n=this.gl.drawingBufferHeight),e!==this.width&&n!==this.height&&Kr.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(e,"x").concat(n))();for(const t in this.attachments)this.attachments[t].resize({width:e,height:n});return this.width=e,this.height=n,this}attach(t){let{clearAttachments:e=!1,resizeAttachments:n=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i={};e&&Object.keys(this.attachments).forEach((t=>{i[t]=null})),Object.assign(i,t);const r=this.gl.bindFramebuffer(36160,this.handle);for(const t in i){Xs(void 0!==t,"Misspelled framebuffer binding point?");const e=Number(t),r=i[e];let s=r;if(s)if(s instanceof So)this._attachRenderbuffer({attachment:e,renderbuffer:s});else if(Array.isArray(r)){const[t,n=0,i=0]=r;s=t,this._attachTexture({attachment:e,texture:t,layer:n,level:i})}else this._attachTexture({attachment:e,texture:s,layer:0,level:0});else this._unattach(e);n&&s&&s.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,r||null),Object.assign(this.attachments,t),Object.keys(this.attachments).filter((t=>!this.attachments[t])).forEach((t=>{delete this.attachments[t]}))}checkStatus(){const{gl:t}=this,e=this.getStatus();if(36053!==e)throw new Error(function(t){return(Ko.STATUS||{})[t]||"Framebuffer error ".concat(t)}(e));return this}getStatus(){const{gl:t}=this,e=t.bindFramebuffer(36160,this.handle),n=t.checkFramebufferStatus(36160);return t.bindFramebuffer(36160,e||null),n}clear(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{color:e,depth:n,stencil:i,drawBuffers:r=[]}=t,s=this.gl.bindFramebuffer(36160,this.handle);return(e||n||i)&&Mo(this.gl,{color:e,depth:n,stencil:i}),r.forEach(((t,e)=>{!function(t){let{framebuffer:e=null,buffer:n=Bo,drawBuffer:i=0,value:r=[0,0,0,0]}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};ts(t),Ls(t,{framebuffer:e},(()=>{switch(n){case Bo:switch(r.constructor){case Int32Array:t.clearBufferiv(n,i,r);break;case Uint32Array:t.clearBufferuiv(n,i,r);break;case Float32Array:default:t.clearBufferfv(n,i,r)}break;case 6145:t.clearBufferfv(6145,0,[r]);break;case 6146:t.clearBufferiv(6146,0,[r]);break;case 34041:const[e,s]=r;t.clearBufferfi(34041,0,e,s);break;default:Xs(!1,Po)}}))}(this.gl,{drawBuffer:e,value:t})})),this.gl.bindFramebuffer(36160,s||null),this}readPixels(){return Kr.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){return Kr.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){return Kr.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){return Kr.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){return Kr.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){return Kr.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(t){let{attachments:e=[],x:n=0,y:i=0,width:r,height:s}=t;const o=ts(this.gl),a=o.bindFramebuffer(36008,this.handle);return 0===n&&0===i&&void 0===r&&void 0===s?o.invalidateFramebuffer(36008,e):o.invalidateFramebuffer(36008,e,n,i,r,s),o.bindFramebuffer(36008,a),this}getAttachmentParameter(t,e,n){let i=this._getAttachmentParameterFallback(e);return null===i&&(this.gl.bindFramebuffer(36160,this.handle),i=this.gl.getFramebufferAttachmentParameter(36160,t,e),this.gl.bindFramebuffer(36160,null)),n&&i>1e3&&(i=Ys(this.gl,i)),i}getAttachmentParameters(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:36064,e=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[];const i={};for(const r of n)i[e?Ys(this.gl,r):r]=this.getAttachmentParameter(t,r,e);return i}getParameters(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const e=Object.keys(this.attachments),n={};for(const i of e){const e=Number(i);n[t?Ys(this.gl,e):e]=this.getAttachmentParameters(e,t)}return n}show(){return"undefined"!=typeof window&&window.open(ko(this),"luma-debug-texture"),this}log(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(t>Kr.level||"undefined"==typeof window)return this;e=e||"Framebuffer ".concat(this.id);const n=ko(this,{targetMaxHeight:100});return Kr.image({logLevel:t,message:e,image:n},e)(),this}bind(){let{target:t=36160}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.gl.bindFramebuffer(t,this.handle),this}unbind(){let{target:t=36160}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.gl.bindFramebuffer(t,null),this}_createDefaultAttachments(t,e,n,i,r){let s=null;return t&&(s=s||{},s[36064]=new Eo(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:i,height:r,mipmaps:!1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.ownResources.push(s[36064])),e&&n?(s=s||{},s[33306]=new So(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:i,height:111}),this.ownResources.push(s[33306])):e?(s=s||{},s[36096]=new So(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:i,height:r}),this.ownResources.push(s[36096])):n&&Xs(!1),s}_unattach(t){const e=this.attachments[t];e&&(e instanceof So?this.gl.framebufferRenderbuffer(36160,t,36161,null):this.gl.framebufferTexture2D(36160,t,3553,null,0),delete this.attachments[t])}_attachRenderbuffer(t){let{attachment:e=36064,renderbuffer:n}=t;const{gl:i}=this;i.framebufferRenderbuffer(36160,e,36161,n.handle),this.attachments[e]=n}_attachTexture(t){let{attachment:e=36064,texture:n,layer:i,level:r}=t;const{gl:s}=this;switch(s.bindTexture(n.target,n.handle),n.target){case 35866:case 32879:ts(s).framebufferTextureLayer(36160,e,n.target,r,i);break;case 34067:const t=function(t){return t<34069?t+34069:t}(i);s.framebufferTexture2D(36160,e,t,n.handle,r);break;case 3553:s.framebufferTexture2D(36160,e,3553,n.handle,r);break;default:Xs(!1,"Illegal texture type")}s.bindTexture(n.target,null),this.attachments[e]=n}_setReadBuffer(t){const e=Zr(n=this.gl)?n:null;var n;e?e.readBuffer(t):Xs(36064===t||1029===t,qo),this.readBuffer=t}_setDrawBuffers(t){const{gl:e}=this,n=ts(e);if(n)n.drawBuffers(t);else{const n=e.getExtension("WEBGL_draw_buffers");n?n.drawBuffersWEBGL(t):Xs(1===t.length&&(36064===t[0]||1029===t[0]),qo)}this.drawBuffers=t}_getAttachmentParameterFallback(t){const e=function(t){t.luma=t.luma||{},t.luma.caps=t.luma.caps||{};for(const e in jo)void 0===t.luma.caps[e]&&(t.luma.caps[e]=Jo(t,e));return t.luma.caps}(this.gl);switch(t){case 36052:return e.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return e.WEBGL2?null:8;case 33297:return e.WEBGL2?null:5125;case 33296:return e.WEBGL2||e.EXT_sRGB?null:9729;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(t){return this.gl.bindFramebuffer(36160,t)}}Ko.ATTACHMENT_PARAMETERS=[36049,36048,33296,33298,33299,33300,33301,33302,33303];const Xo={5126:ca.bind(null,"uniform1fv",ea,1,ua),35664:ca.bind(null,"uniform2fv",ea,2,ua),35665:ca.bind(null,"uniform3fv",ea,3,ua),35666:ca.bind(null,"uniform4fv",ea,4,ua),5124:ca.bind(null,"uniform1iv",na,1,ua),35667:ca.bind(null,"uniform2iv",na,2,ua),35668:ca.bind(null,"uniform3iv",na,3,ua),35669:ca.bind(null,"uniform4iv",na,4,ua),35670:ca.bind(null,"uniform1iv",na,1,ua),35671:ca.bind(null,"uniform2iv",na,2,ua),35672:ca.bind(null,"uniform3iv",na,3,ua),35673:ca.bind(null,"uniform4iv",na,4,ua),35674:ca.bind(null,"uniformMatrix2fv",ea,4,ha),35675:ca.bind(null,"uniformMatrix3fv",ea,9,ha),35676:ca.bind(null,"uniformMatrix4fv",ea,16,ha),35678:la,35680:la,5125:ca.bind(null,"uniform1uiv",ia,1,ua),36294:ca.bind(null,"uniform2uiv",ia,2,ua),36295:ca.bind(null,"uniform3uiv",ia,3,ua),36296:ca.bind(null,"uniform4uiv",ia,4,ua),35685:ca.bind(null,"uniformMatrix2x3fv",ea,6,ha),35686:ca.bind(null,"uniformMatrix2x4fv",ea,8,ha),35687:ca.bind(null,"uniformMatrix3x2fv",ea,6,ha),35688:ca.bind(null,"uniformMatrix3x4fv",ea,12,ha),35689:ca.bind(null,"uniformMatrix4x2fv",ea,8,ha),35690:ca.bind(null,"uniformMatrix4x3fv",ea,12,ha),35678:la,35680:la,35679:la,35682:la,36289:la,36292:la,36293:la,36298:la,36299:la,36300:la,36303:la,36306:la,36307:la,36308:la,36311:la},Qo={},Yo={},Zo={},$o=[0];function ta(t,e,n,i){1===e&&"boolean"==typeof t&&(t=t?1:0),Number.isFinite(t)&&($o[0]=t,t=$o);const r=t.length;if(r%e&&Kr.warn("Uniform size should be multiples of ".concat(e),t)(),t instanceof n)return t;let s=i[r];s||(s=new n(r),i[r]=s);for(let e=0;e<r;e++)s[e]=t[e];return s}function ea(t,e){return ta(t,e,Float32Array,Qo)}function na(t,e){return ta(t,e,Int32Array,Yo)}function ia(t,e){return ta(t,e,Uint32Array,Zo)}function ra(t,e,n){const i=Xo[n.type];if(!i)throw new Error("Unknown GLSL uniform type ".concat(n.type));return i().bind(null,t,e)}function sa(t){if("]"!==t[t.length-1])return{name:t,length:1,isArray:!1};const e=t.match(/([^[]*)(\[[0-9]+\])?/);if(!e||e.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(t));return{name:e[1],length:e[2]||1,isArray:Boolean(e[2])}}function oa(t){return Array.isArray(t)||ArrayBuffer.isView(t)?function(t){if(0===t.length)return!1;const e=Math.min(t.length,16);for(let n=0;n<e;++n)if(!Number.isFinite(t[n]))return!1;return!0}(t):!!isFinite(t)||!0===t||!1===t||t instanceof Co||t instanceof So||t instanceof Ko&&Boolean(t.texture)}function aa(t,e,n){if(Array.isArray(n)||ArrayBuffer.isView(n))if(t[e]){const i=t[e];for(let t=0,e=n.length;t<e;++t)i[t]=n[t]}else t[e]=n.slice();else t[e]=n}function la(){let t=null;return(e,n,i)=>{const r=t!==i;return r&&(e.uniform1i(n,i),t=i),r}}function ca(t,e,n,i){let r=null,s=null;return(o,a,l)=>{const c=e(l,n),u=c.length;let h=!1;if(null===r)r=new Float32Array(u),s=u,h=!0;else{Xs(s===u,"Uniform length cannot change.");for(let t=0;t<u;++t)if(c[t]!==r[t]){h=!0;break}}return h&&(i(o,t,a,c),r.set(c)),h}}function ua(t,e,n,i){t[e](n,i)}function ha(t,e,n,i){t[e](n,!1,i)}function da(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"unnamed";const n=t.match(/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/);return n?n[1]:e}function fa(t,e){let n="";for(let i=0;i<e.length;i++){const r=e[i];if((t[i+3]||t[i+2]||t[i+1])&&(n+="".concat(r,"\n"),t[i+1])){const e=t[i+1],r=e.split(":",3),s=r[0],o=parseInt(r[1],10)||0,a=e.substring(r.join(":").length+1).trim();n+=pa("^^^ ".concat(s,": ").concat(a,"\n\n"),o)}}return n}function pa(t,e){let n="";for(let t=0;t<e;++t)n+=" ";return"".concat(n).concat(t)}class ga extends ro{get[Symbol.toStringTag](){return"Shader"}static getTypeName(t){switch(t){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return Xs(!1),"unknown"}}constructor(t,e){$r(t),Xs("string"==typeof e.source,"Shader: GLSL source code must be a JavaScript string"),super(t,{id:da(e.source,null)||e.id||$s("unnamed ".concat(ga.getTypeName(e.shaderType)))}),this.shaderType=e.shaderType,this.source=e.source,this.initialize(e)}initialize(t){let{source:e}=t;const n=da(e,null);n&&(this.id=$s(n)),this._compile(e)}getParameter(t){return this.gl.getShaderParameter(this.handle,t)}toString(){return"".concat(ga.getTypeName(this.shaderType),":").concat(this.id)}getName(){return da(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const t=this.gl.getExtension("WEBGL_debug_shaders");return t?t.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.source;if(t.startsWith("#version ")||(t="#version 100\n".concat(t)),this.source=t,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const t=this.gl.getShaderInfoLog(this.handle),{shaderName:e,errors:n,warnings:i}=function(t,e,n,i){const r=t.split(/\r?\n/),s={},o={},a=i||da(e)||"(unnamed)",l="".concat(function(t){switch(t){case 35632:return"fragment";case 35633:return"vertex";default:return"unknown type"}}(n)," shader ").concat(a);for(let e=0;e<r.length;e++){const n=r[e];if(n.length<=1)continue;const i=n.split(":"),a=i[0],c=parseInt(i[2],10);if(isNaN(c))throw new Error("GLSL compilation error in ".concat(l,": ").concat(t));"WARNING"!==a?s[c]=n:o[c]=n}const c=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:": ";const i=t.split(/\r?\n/),r=String(i.length+e-1).length;return i.map(((t,i)=>{const s=String(i+e),o=s.length;return pa(s,r-o)+n+t}))}(e);return{shaderName:l,errors:fa(s,c),warnings:fa(o,c)}}(t,this.source,this.shaderType,this.id);throw Kr.error("GLSL compilation errors in ".concat(e,"\n").concat(n))(),Kr.warn("GLSL compilation warnings in ".concat(e,"\n").concat(i))(),new Error("GLSL compilation errors in ".concat(e))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class ma extends ga{get[Symbol.toStringTag](){return"VertexShader"}constructor(t,e){"string"==typeof e&&(e={source:e}),super(t,Object.assign({},e,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class va extends ga{get[Symbol.toStringTag](){return"FragmentShader"}constructor(t,e){"string"==typeof e&&(e={source:e}),super(t,Object.assign({},e,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const ya=5120,ba=5121,_a=5122,Aa=5123,wa=5126,Ca=5124,Ea=5125,xa={[wa]:[wa,1,"float"],35664:[wa,2,"vec2"],35665:[wa,3,"vec3"],35666:[wa,4,"vec4"],[Ca]:[Ca,1,"int"],35667:[Ca,2,"ivec2"],35668:[Ca,3,"ivec3"],35669:[Ca,4,"ivec4"],[Ea]:[Ea,1,"uint"],36294:[Ea,2,"uvec2"],36295:[Ea,3,"uvec3"],36296:[Ea,4,"uvec4"],35670:[wa,1,"bool"],35671:[wa,2,"bvec2"],35672:[wa,3,"bvec3"],35673:[wa,4,"bvec4"],35674:[wa,8,"mat2"],35685:[wa,8,"mat2x3"],35686:[wa,8,"mat2x4"],35675:[wa,12,"mat3"],35687:[wa,12,"mat3x2"],35688:[wa,12,"mat3x4"],35676:[wa,16,"mat4"],35689:[wa,16,"mat4x2"],35690:[wa,16,"mat4x3"]};function Ta(t){const e=xa[t];if(!e)return null;const[n,i]=e;return{type:n,components:i}}function Sa(t,e){switch(t){case ya:case ba:case _a:case Aa:t=wa}for(const n in xa){const[i,r,s]=xa[n];if(i===t&&r===e)return{glType:n,name:s}}return null}class Ba{constructor(t){this.id=t.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(t),this._readVaryingsFromProgram(t)}getAttributeInfo(t){const e=Number(t);return Number.isFinite(e)?this.attributeInfosByLocation[e]:this.attributeInfosByName[t]||null}getAttributeLocation(t){const e=this.getAttributeInfo(t);return e?e.location:-1}getAttributeAccessor(t){const e=this.getAttributeInfo(t);return e?e.accessor:null}getVaryingInfo(t){const e=Number(t);return Number.isFinite(e)?this.varyingInfos[e]:this.varyingInfosByName[t]||null}getVaryingIndex(t){const e=this.getVaryingInfo();return e?e.location:-1}getVaryingAccessor(t){const e=this.getVaryingInfo();return e?e.accessor:null}_readAttributesFromProgram(t){const{gl:e}=t,n=e.getProgramParameter(t.handle,35721);for(let i=0;i<n;i++){const{name:n,type:r,size:s}=e.getActiveAttrib(t.handle,i),o=e.getAttribLocation(t.handle,n);o>=0&&this._addAttribute(o,n,r,s)}this.attributeInfos.sort(((t,e)=>t.location-e.location))}_readVaryingsFromProgram(t){const{gl:e}=t;if(!Zr(e))return;const n=e.getProgramParameter(t.handle,35971);for(let i=0;i<n;i++){const{name:n,type:r,size:s}=e.getTransformFeedbackVarying(t.handle,i);this._addVarying(i,n,r,s)}this.varyingInfos.sort(((t,e)=>t.location-e.location))}_addAttribute(t,e,n,i){const{type:r,components:s}=Ta(n),o={type:r,size:i*s};this._inferProperties(t,e,o);const a={location:t,name:e,accessor:new fo(o)};this.attributeInfos.push(a),this.attributeInfosByLocation[t]=a,this.attributeInfosByName[a.name]=a}_inferProperties(t,e,n){/instance/i.test(e)&&(n.divisor=1)}_addVarying(t,e,n,i){const{type:r,components:s}=Ta(n),o={location:t,name:e,accessor:new fo({type:r,size:i*s})};this.varyingInfos.push(o),this.varyingInfosByName[o.name]=o}}const Pa=35981,Ma=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class Ia extends ro{get[Symbol.toStringTag](){return"Program"}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(t,e),this.stubRemovedMethods("Program","v6.0",Ma),this._isCached=!1,this.initialize(e),Object.seal(this),this._setId(e.id)}initialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{hash:e,vs:n,fs:i,varyings:r,bufferMode:s=Pa}=t;return this.hash=e||"",this.vs="string"==typeof n?new ma(this.gl,{id:"".concat(t.id,"-vs"),source:n}):n,this.fs="string"==typeof i?new va(this.gl,{id:"".concat(t.id,"-fs"),source:i}):i,Xs(this.vs instanceof ma),Xs(this.fs instanceof va),this.uniforms={},this._textureUniforms={},r&&r.length>0&&(ts(this.gl),this.varyings=r,this.gl2.transformFeedbackVaryings(this.handle,r,s)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new Ba(this),this.setProps(t)}delete(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._isCached?this:super.delete(t)}setProps(t){return"uniforms"in t&&this.setUniforms(t.uniforms),this}draw(t){let{logPriority:e,drawMode:n=4,vertexCount:i,offset:r=0,start:s,end:o,isIndexed:a=!1,indexType:l=5123,instanceCount:c=0,isInstanced:u=c>0,vertexArray:h=null,transformFeedback:d,framebuffer:f,parameters:p={},uniforms:g,samplers:m}=t;if((g||m)&&(Kr.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(g||{})),Kr.priority>=e){const t=f?f.id:"default",r="mode=".concat(Ys(this.gl,n)," verts=").concat(i," ")+"instances=".concat(c," indexType=").concat(Ys(this.gl,l)," ")+"isInstanced=".concat(u," isIndexed=").concat(a," ")+"Framebuffer=".concat(t);Kr.log(e,r)()}return Xs(h),this.gl.useProgram(this.handle),!(!this._areTexturesRenderable()||0===i||u&&0===c||(h.bindForDraw(i,c,(()=>{if(void 0!==f&&(p=Object.assign({},p,{framebuffer:f})),d){const t=function(t){switch(t){case 0:return 0;case 1:case 3:case 2:return 1;case 4:case 5:case 6:return 4;default:return Xs(!1),0}}(n);d.begin(t)}this._bindTextures(),Ls(this.gl,p,(()=>{a&&u?this.gl2.drawElementsInstanced(n,i,l,r,c):a&&Zr(this.gl)&&!isNaN(s)&&!isNaN(o)?this.gl2.drawRangeElements(n,s,o,i,l,r):a?this.gl.drawElements(n,i,l,r):u?this.gl2.drawArraysInstanced(n,r,i,c):this.gl.drawArrays(n,r,i)})),d&&d.end()})),0))}setUniforms(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Kr.priority>=2&&function(t,e,n){for(const i in t){const r=t[i];if((!n||Boolean(n[i]))&&!oa(r))throw e=e?"".concat(e," "):"",console.error("".concat(e," Bad uniform ").concat(i),r),new Error("".concat(e," Bad uniform ").concat(i))}}(t,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const e in t){const n=t[e],i=this._uniformSetters[e];if(i){let t=n,r=!1;if(t instanceof Ko&&(t=t.texture),t instanceof Co)if(r=this.uniforms[e]!==n,r){void 0===i.textureIndex&&(i.textureIndex=this._textureIndexCounter++);const n=t,{textureIndex:r}=i;n.bind(r),t=r,this._textureUniforms[e]=n}else t=i.textureIndex;else this._textureUniforms[e]&&delete this._textureUniforms[e];(i(t)||r)&&aa(this.uniforms,e,n)}}return this}_areTexturesRenderable(){let t=!0;for(const e in this._textureUniforms){const n=this._textureUniforms[e];n.update(),t=t&&n.loaded}return t}_bindTextures(){for(const t in this._textureUniforms){const e=this._uniformSetters[t].textureIndex;this._textureUniforms[t].bind(e)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(t){const e=this.gl.getAttachedShaders(t),n={};for(const t of e)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:n.vs=new ma({handle:t});break;case 35632:n.fs=new va({handle:t})}return n}_getParameter(t){return this.gl.getProgramParameter(this.handle,t)}_setId(t){if(!t){const t=this._getName();this.id=$s(t)}}_getName(){let t=this.vs.getName()||this.fs.getName();return t=t.replace(/shader/i,""),t=t?"".concat(t,"-program"):"program",t}_compileAndLink(){const{gl:t}=this;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),Kr.time(4,"linkProgram for ".concat(this._getName()))(),t.linkProgram(this.handle),Kr.timeEnd(4,"linkProgram for ".concat(this._getName()))(),t.debug||Kr.level>0){if(!t.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(t.getProgramInfoLog(this.handle)));if(t.validateProgram(this.handle),!t.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(t.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:t}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let e=0;e<this._uniformCount;e++){const n=this.gl.getActiveUniform(this.handle,e),{name:i}=sa(n.name);let r=t.getUniformLocation(this.handle,i);if(this._uniformSetters[i]=ra(t,r,n),n.size>1)for(let e=0;e<n.size;e++)r=t.getUniformLocation(this.handle,"".concat(i,"[").concat(e,"]")),this._uniformSetters["".concat(i,"[").concat(e,"]")]=ra(t,r,n)}this._textureIndexCounter=0}getActiveUniforms(t,e){return this.gl2.getActiveUniforms(this.handle,t,e)}getUniformBlockIndex(t){return this.gl2.getUniformBlockIndex(this.handle,t)}getActiveUniformBlockParameter(t,e){return this.gl2.getActiveUniformBlockParameter(this.handle,t,e)}uniformBlockBinding(t,e){this.gl2.uniformBlockBinding(this.handle,t,e)}}class La{static getDefaultProgramManager(t){return t.luma=t.luma||{},t.luma.defaultProgramManager=t.luma.defaultProgramManager||new La(t),t.luma.defaultProgramManager}constructor(t){this.gl=t,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(t){this._defaultModules.find((e=>e.name===t.name))||this._defaultModules.push(t),this.stateHash++}removeDefaultModule(t){const e="string"==typeof t?t:t.name;this._defaultModules=this._defaultModules.filter((t=>t.name!==e)),this.stateHash++}addShaderHook(t,e){e&&(t=Object.assign(e,{hook:t})),this._hookFunctions.push(t),this.stateHash++}get(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{vs:e="",fs:n="",defines:i={},inject:r={},varyings:s=[],bufferMode:o=35981,transpileToGLSL100:a=!1}=t,l=this._getModuleList(t.modules),c=this._getHash(e),u=this._getHash(n),h=l.map((t=>this._getHash(t.name))).sort(),d=s.map((t=>this._getHash(t))),f=Object.keys(i).sort(),p=Object.keys(r).sort(),g=[],m=[];for(const t of f)g.push(this._getHash(t)),g.push(this._getHash(i[t]));for(const t of p)m.push(this._getHash(t)),m.push(this._getHash(r[t]));const v="".concat(c,"/").concat(u,"D").concat(g.join("/"),"M").concat(h.join("/"),"I").concat(m.join("/"),"V").concat(d.join("/"),"H").concat(this.stateHash,"B").concat(o).concat(a?"T":"");if(!this._programCache[v]){const t=function(t,e){const{vs:n,fs:i}=e,r=Ki(e.modules||[]);return{gl:t,vs:Tr(t,Object.assign({},e,{source:n,type:Gi,modules:r})),fs:Tr(t,Object.assign({},e,{source:i,type:ji,modules:r})),getUniforms:Sr(r)}}(this.gl,{vs:e,fs:n,modules:l,inject:r,defines:i,hookFunctions:this._hookFunctions,transpileToGLSL100:a});this._programCache[v]=new Ia(this.gl,{hash:v,vs:t.vs,fs:t.fs,varyings:s,bufferMode:o}),this._getUniforms[v]=t.getUniforms||(t=>{}),this._useCounts[v]=0}return this._useCounts[v]++,this._programCache[v]}getUniforms(t){return this._getUniforms[t.hash]||null}release(t){const e=t.hash;this._useCounts[e]--,0===this._useCounts[e]&&(this._programCache[e].delete(),delete this._programCache[e],delete this._getUniforms[e],delete this._useCounts[e])}_getHash(t){return void 0===this._hashes[t]&&(this._hashes[t]=this._hashCounter++),this._hashes[t]}_getModuleList(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const e=new Array(this._defaultModules.length+t.length),n={};let i=0;for(let t=0,r=this._defaultModules.length;t<r;++t){const r=this._defaultModules[t],s=r.name;e[i++]=r,n[s]=!0}for(let r=0,s=t.length;r<s;++r){const s=t[r],o=s.name;n[o]||(e[i++]=s,n[o]=!0)}return e.length=i,e}}const Oa="#define SMOOTH_EDGE_RADIUS 0.5",Ra={name:"geometry",vs:"\n".concat(Oa,"\n\nstruct VertexGeometry {\n  vec4 position;\n  vec3 worldPosition;\n  vec3 worldPositionAlt;\n  vec3 normal;\n  vec2 uv;\n  vec3 pickingColor;\n} geometry = VertexGeometry(\n  vec4(0.0, 0.0, 1.0, 0.0),\n  vec3(0.0),\n  vec3(0.0),\n  vec3(0.0),\n  vec2(0.0),\n  vec3(0.0)\n);\n"),fs:"\n".concat(Oa,"\n\nstruct FragmentGeometry {\n  vec2 uv;\n} geometry;\n\nfloat smoothedge(float edge, float x) {\n  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);\n}\n")},Fa=Object.keys(Li).map((t=>"const int COORDINATE_SYSTEM_".concat(t," = ").concat(Li[t],";"))).join(""),ka=Object.keys(Oi).map((t=>"const int PROJECTION_MODE_".concat(t," = ").concat(Oi[t],";"))).join(""),Da=Object.keys(Ri).map((t=>"const int UNIT_".concat(t.toUpperCase()," = ").concat(Ri[t],";"))).join(""),Na="".concat(Fa,"\n").concat(ka,"\n").concat(Da,"\n\nuniform int project_uCoordinateSystem;\nuniform int project_uProjectionMode;\nuniform float project_uScale;\nuniform bool project_uWrapLongitude;\nuniform vec3 project_uCommonUnitsPerMeter;\nuniform vec3 project_uCommonUnitsPerWorldUnit;\nuniform vec3 project_uCommonUnitsPerWorldUnit2;\nuniform vec4 project_uCenter;\nuniform mat4 project_uModelMatrix;\nuniform mat4 project_uViewProjectionMatrix;\nuniform vec2 project_uViewportSize;\nuniform float project_uDevicePixelRatio;\nuniform float project_uFocalDistance;\nuniform vec3 project_uCameraPosition;\nuniform vec3 project_uCoordinateOrigin;\nuniform vec3 project_uCommonOrigin;\nuniform bool project_uPseudoMeters;\n\nconst float TILE_SIZE = 512.0;\nconst float PI = 3.1415926536;\nconst float WORLD_SCALE = TILE_SIZE / (PI * 2.0);\nconst vec3 ZERO_64_LOW = vec3(0.0);\nconst float EARTH_RADIUS = 6370972.0;\nconst float GLOBE_RADIUS = 256.0;\nfloat project_size_at_latitude(float lat) {\n  float y = clamp(lat, -89.9, 89.9);\n  return 1.0 / cos(radians(y));\n}\n\nfloat project_size() {\n  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&\n    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&\n    project_uPseudoMeters == false) {\n    \n    if (geometry.position.w == 0.0) {\n      return project_size_at_latitude(geometry.worldPosition.y);\n    }\n  \n    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;\n    float y2 = y * y;\n    float y4 = y2 * y2;\n    float y6 = y4 * y2;\n    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;\n  }\n  return 1.0;\n}\n\nfloat project_size_at_latitude(float meters, float lat) {\n  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);\n}\nfloat project_size(float meters) {\n  return meters * project_uCommonUnitsPerMeter.z * project_size();\n}\n\nvec2 project_size(vec2 meters) {\n  return meters * project_uCommonUnitsPerMeter.xy * project_size();\n}\n\nvec3 project_size(vec3 meters) {\n  return meters * project_uCommonUnitsPerMeter * project_size();\n}\n\nvec4 project_size(vec4 meters) {\n  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);\n}\nmat3 project_get_orientation_matrix(vec3 up) {\n  vec3 uz = normalize(up);\n  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));\n  vec3 uy = cross(uz, ux);\n  return mat3(ux, uy, uz);\n}\n\nbool project_needs_rotation(vec3 commonPosition, out mat3 transform) {\n  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {\n    transform = project_get_orientation_matrix(commonPosition);\n    return true;\n  }\n  return false;\n}\nvec3 project_normal(vec3 vector) {\n  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);\n  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);\n  mat3 rotation;\n  if (project_needs_rotation(geometry.position.xyz, rotation)) {\n    n = rotation * n;\n  }\n  return n;\n}\n\nvec4 project_offset_(vec4 offset) {\n  float dy = offset.y;\n  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;\n  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);\n}\nvec2 project_mercator_(vec2 lnglat) {\n  float x = lnglat.x;\n  if (project_uWrapLongitude) {\n    x = mod(x + 180., 360.0) - 180.;\n  }\n  float y = clamp(lnglat.y, -89.9, 89.9);\n  return vec2(\n    radians(x) + PI,\n    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))\n  ) * WORLD_SCALE;\n}\n\nvec3 project_globe_(vec3 lnglatz) {\n  float lambda = radians(lnglatz.x);\n  float phi = radians(lnglatz.y);\n  float cosPhi = cos(phi);\n  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;\n\n  return vec3(\n    sin(lambda) * cosPhi,\n    -cos(lambda) * cosPhi,\n    sin(phi)\n  ) * D;\n}\nvec4 project_position(vec4 position, vec3 position64Low) {\n  vec4 position_world = project_uModelMatrix * position;\n  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {\n    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      return vec4(\n        project_mercator_(position_world.xy),\n        project_size_at_latitude(position_world.z, position_world.y),\n        position_world.w\n      );\n    }\n    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {\n      position_world.xyz += project_uCoordinateOrigin;\n    }\n  }\n  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {\n    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      return vec4(\n        project_globe_(position_world.xyz),\n        position_world.w\n      );\n    }\n  }\n  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {\n    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {\n        return vec4(\n          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,\n          project_size(position_world.z),\n          position_world.w\n        );\n      }\n    }\n  }\n  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||\n    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&\n    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {\n    position_world.xyz -= project_uCoordinateOrigin;\n  }\n  return project_offset_(position_world + project_uModelMatrix * vec4(position64Low, 0.0));\n}\n\nvec4 project_position(vec4 position) {\n  return project_position(position, ZERO_64_LOW);\n}\n\nvec3 project_position(vec3 position, vec3 position64Low) {\n  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);\n  return projected_position.xyz;\n}\n\nvec3 project_position(vec3 position) {\n  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);\n  return projected_position.xyz;\n}\n\nvec2 project_position(vec2 position) {\n  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);\n  return projected_position.xy;\n}\n\nvec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {\n  return viewProjectionMatrix * position + center;\n}\nvec4 project_common_position_to_clipspace(vec4 position) {\n  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);\n}\nvec2 project_pixel_size_to_clipspace(vec2 pixels) {\n  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;\n  return offset * project_uFocalDistance;\n}\n\nfloat project_size_to_pixel(float meters) {\n  return project_size(meters) * project_uScale;\n}\nfloat project_size_to_pixel(float size, int unit) {\n  if (unit == UNIT_METERS) return project_size_to_pixel(size);\n  if (unit == UNIT_COMMON) return size * project_uScale;\n  return size;\n}\nfloat project_pixel_size(float pixels) {\n  return pixels / project_uScale;\n}\nvec2 project_pixel_size(vec2 pixels) {\n  return pixels / project_uScale;\n}\n");function Ua(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}return!1}function za(t){let e,n={};return i=>{for(const r in i)if(!Ua(i[r],n[r])){e=t(i),n=i;break}return e}}const Ga=[0,0,0,0],ja=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Va=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Ha=[0,0,0],Wa=[0,0,0],Ja=za((function({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:i}){const{projectionCenter:r,viewProjectionMatrix:s,originCommon:o,cameraPosCommon:a,shaderCoordinateOrigin:l,geospatialOrigin:c}=function(t,e,n){const{viewMatrixUncentered:i,projectionMatrix:r}=t;let{viewMatrix:s,viewProjectionMatrix:o}=t,a=Ga,l=Ga,c=t.cameraPosition;const{geospatialOrigin:u,shaderCoordinateOrigin:h,offsetMode:d}=qa(t,e,n);return d&&(l=t.projectPosition(u||h),c=[c[0]-l[0],c[1]-l[1],c[2]-l[2]],l[3]=1,a=Zn([],l,o),s=i||s,o=zn([],r,s),o=zn([],o,ja)),{viewMatrix:s,viewProjectionMatrix:o,projectionCenter:a,originCommon:l,cameraPosCommon:c,shaderCoordinateOrigin:h,geospatialOrigin:u}}(t,n,i),u=t.getDistanceScales(),h=[t.width*e,t.height*e],d=Zn([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,f={project_uCoordinateSystem:n,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:l,project_uCommonOrigin:o.slice(0,3),project_uCenter:r,project_uPseudoMeters:Boolean(t._pseudoMeters),project_uViewportSize:h,project_uDevicePixelRatio:e,project_uFocalDistance:d,project_uCommonUnitsPerMeter:u.unitsPerMeter,project_uCommonUnitsPerWorldUnit:u.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:Ha,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:s,project_uModelMatrix:Va,project_uCameraPosition:a};if(c){const e=t.getDistanceScales(c);switch(n){case Li.METER_OFFSETS:f.project_uCommonUnitsPerWorldUnit=e.unitsPerMeter,f.project_uCommonUnitsPerWorldUnit2=e.unitsPerMeter2;break;case Li.LNGLAT:case Li.LNGLAT_OFFSETS:t._pseudoMeters||(f.project_uCommonUnitsPerMeter=e.unitsPerMeter),f.project_uCommonUnitsPerWorldUnit=e.unitsPerDegree,f.project_uCommonUnitsPerWorldUnit2=e.unitsPerDegree2;break;case Li.CARTESIAN:f.project_uCommonUnitsPerWorldUnit=[1,1,e.unitsPerMeter[2]],f.project_uCommonUnitsPerWorldUnit2=[0,0,e.unitsPerMeter2[2]]}}return f}));function qa(t,e,n=Wa){n.length<3&&(n=[n[0],n[1],0]);let i,r=n,s=!0;switch(i=e===Li.LNGLAT_OFFSETS||e===Li.METER_OFFSETS?n:t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case Oi.WEB_MERCATOR:e!==Li.LNGLAT&&e!==Li.CARTESIAN||(i=[0,0,0],s=!1);break;case Oi.WEB_MERCATOR_AUTO_OFFSET:e===Li.LNGLAT?r=i:e===Li.CARTESIAN&&(r=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],i=t.unprojectPosition(r),r[0]-=n[0],r[1]-=n[1],r[2]-=n[2]);break;case Oi.IDENTITY:r=t.position.map(Math.fround),r[2]=r[2]||0;break;case Oi.GLOBE:s=!1,i=null;break;default:s=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:r,offsetMode:s}}const Ka={},Xa={name:"project",dependencies:[{name:"fp32",vs:"#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\nconst float TWO_PI = 6.2831854820251465;\nconst float PI_2 = 1.5707963705062866;\nconst float PI_16 = 0.1963495463132858;\n\nconst float SIN_TABLE_0 = 0.19509032368659973;\nconst float SIN_TABLE_1 = 0.3826834261417389;\nconst float SIN_TABLE_2 = 0.5555702447891235;\nconst float SIN_TABLE_3 = 0.7071067690849304;\n\nconst float COS_TABLE_0 = 0.9807852506637573;\nconst float COS_TABLE_1 = 0.9238795042037964;\nconst float COS_TABLE_2 = 0.8314695954322815;\nconst float COS_TABLE_3 = 0.7071067690849304;\n\nconst float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;\nconst float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;\nconst float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;\nconst float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;\n\nfloat sin_taylor_fp32(float a) {\n  float r, s, t, x;\n\n  if (a == 0.0) {\n    return 0.0;\n  }\n\n  x = -a * a;\n  s = a;\n  r = a;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_3;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_5;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_7;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_9;\n  s = s + t;\n\n  return s;\n}\n\nvoid sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {\n  if (a == 0.0) {\n    sin_t = 0.0;\n    cos_t = 1.0;\n  }\n  sin_t = sin_taylor_fp32(a);\n  cos_t = sqrt(1.0 - sin_t * sin_t);\n}\n\nfloat tan_taylor_fp32(float a) {\n    float sin_a;\n    float cos_a;\n\n    if (a == 0.0) {\n        return 0.0;\n    }\n    float z = floor(a / TWO_PI);\n    float r = a - TWO_PI * z;\n\n    float t;\n    float q = floor(r / PI_2 + 0.5);\n    int j = int(q);\n\n    if (j < -2 || j > 2) {\n        return 1.0 / 0.0;\n    }\n\n    t = r - PI_2 * q;\n\n    q = floor(t / PI_16 + 0.5);\n    int k = int(q);\n    int abs_k = int(abs(float(k)));\n\n    if (abs_k > 4) {\n        return 1.0 / 0.0;\n    } else {\n        t = t - PI_16 * q;\n    }\n\n    float u = 0.0;\n    float v = 0.0;\n\n    float sin_t, cos_t;\n    float s, c;\n    sincos_taylor_fp32(t, sin_t, cos_t);\n\n    if (k == 0) {\n        s = sin_t;\n        c = cos_t;\n    } else {\n        if (abs(float(abs_k) - 1.0) < 0.5) {\n            u = COS_TABLE_0;\n            v = SIN_TABLE_0;\n        } else if (abs(float(abs_k) - 2.0) < 0.5) {\n            u = COS_TABLE_1;\n            v = SIN_TABLE_1;\n        } else if (abs(float(abs_k) - 3.0) < 0.5) {\n            u = COS_TABLE_2;\n            v = SIN_TABLE_2;\n        } else if (abs(float(abs_k) - 4.0) < 0.5) {\n            u = COS_TABLE_3;\n            v = SIN_TABLE_3;\n        }\n        if (k > 0) {\n            s = u * sin_t + v * cos_t;\n            c = u * cos_t - v * sin_t;\n        } else {\n            s = u * sin_t - v * cos_t;\n            c = u * cos_t + v * sin_t;\n        }\n    }\n\n    if (j == 0) {\n        sin_a = s;\n        cos_a = c;\n    } else if (j == 1) {\n        sin_a = c;\n        cos_a = -s;\n    } else if (j == -1) {\n        sin_a = -c;\n        cos_a = s;\n    } else {\n        sin_a = -s;\n        cos_a = -c;\n    }\n    return sin_a / cos_a;\n}\n#endif\n\nfloat tan_fp32(float a) {\n#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\n  return tan_taylor_fp32(a);\n#else\n  return tan(a);\n#endif\n}\n",fs:null},Ra],vs:Na,getUniforms:function(t=Ka){return"viewport"in t?function({viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:i=Li.DEFAULT,coordinateOrigin:r=Wa,autoWrapLongitude:s=!1}){i===Li.DEFAULT&&(i=t.isGeospatial?Li.LNGLAT:Li.CARTESIAN);const o=Ja({viewport:t,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:r});return o.project_uWrapLongitude=s,o.project_uModelMatrix=n||Va,o}(t):{}}},Qa=[Xa],Ya=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function Za(t){const e=La.getDefaultProgramManager(t);for(const t of Qa)e.addDefaultModule(t);for(const t of Ya)e.addShaderHook(t);return e}class $a{constructor(t,{deck:e,stats:n,viewport:i,timeline:r}={}){m(this,"layers",void 0),m(this,"context",void 0),m(this,"resourceManager",void 0),m(this,"_lastRenderedLayers",[]),m(this,"_needsRedraw",!1),m(this,"_needsUpdate",!1),m(this,"_nextLayers",null),m(this,"_debug",!1),m(this,"activateViewport",(t=>{Q("layerManager.activateViewport",this,t),t&&(this.context.viewport=t)})),this.layers=[],this.resourceManager=new Xe({gl:t,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:t,deck:e,programManager:t&&Za(t),stats:n||new nt({id:"deck.gl"}),viewport:i||new zi({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:r||new b,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const t of this.layers)this._finalizeLayer(t)}needsRedraw(t={clearRedrawFlags:!1}){let e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);for(const n of this.layers){const i=n.getNeedsRedraw(t);e=e||i}return e}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(t){this._needsRedraw=this._needsRedraw||t}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t}getLayers({layerIds:t}={}){return t?this.layers.filter((e=>t.find((t=>0===e.id.indexOf(t))))):this.layers}setProps(t){"debug"in t&&(this._debug=t.debug),"userData"in t&&(this.context.userData=t.userData),"layers"in t&&(this._nextLayers=t.layers),"onError"in t&&(this.context.onError=t.onError)}setLayers(t,e){Q("layerManager.setLayers",this,e,t),this._lastRenderedLayers=t;const n=Y(t,Boolean);for(const t of n)t.context=this.context;this._updateLayers(this.layers,n)}updateLayers(){const t=this.needsUpdate();t&&(this.setNeedsRedraw("updating layers: ".concat(t)),this.setLayers(this._nextLayers||this._lastRenderedLayers,t)),this._nextLayers=null}_handleError(t,e,n){n.raiseError(e,"".concat(t," of ").concat(n))}_updateLayers(t,e){const n={};for(const e of t)n[e.id]?q.warn("Multiple old layers with same id ".concat(e.id))():n[e.id]=e;const i=[];this._updateSublayersRecursively(e,n,i),this._finalizeOldLayers(n);let r=!1;for(const t of i)if(t.hasUniformTransition()){r="Uniform transition in ".concat(t);break}this._needsUpdate=r,this.layers=i}_updateSublayersRecursively(t,e,n){for(const i of t){i.context=this.context;const t=e[i.id];null===t&&q.warn("Multiple new layers with same id ".concat(i.id))(),e[i.id]=null;let r=null;try{this._debug&&t!==i&&i.validateProps(),t?(this._transferLayerState(t,i),this._updateLayer(i)):this._initializeLayer(i),n.push(i),r=i.isComposite?i.getSubLayers():null}catch(t){this._handleError("matching",t,i)}r&&this._updateSublayersRecursively(r,e,n)}}_finalizeOldLayers(t){for(const e in t){const n=t[e];n&&this._finalizeLayer(n)}}_initializeLayer(t){try{t._initialize(),t.lifecycle="Initialized"}catch(e){this._handleError("initialization",e,t)}}_transferLayerState(t,e){e._transferState(t),e.lifecycle="Matched. State transferred from previous layer",e!==t&&(t.lifecycle="Discarded. Awaiting garbage collection")}_updateLayer(t){try{t._update()}catch(e){this._handleError("update",e,t)}}_finalizeLayer(t){this._needsRedraw=this._needsRedraw||"finalized ".concat(t),t.lifecycle="No longer matched. Awaiting garbage collection";try{t._finalize(),t.lifecycle="Finalized! Awaiting garbage collection"}catch(e){this._handleError("finalization",e,t)}}}function tl(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!tl(t[i],e[i],n-1))return!1;return!0}if(Array.isArray(e))return!1;if("object"==typeof t&&"object"==typeof e){const i=Object.keys(t),r=Object.keys(e);if(i.length!==r.length)return!1;for(const r of i){if(!e.hasOwnProperty(r))return!1;if(!tl(t[r],e[r],n-1))return!1}return!0}return!1}class el{constructor(t){m(this,"width",void 0),m(this,"height",void 0),m(this,"views",void 0),m(this,"viewState",void 0),m(this,"controllers",void 0),m(this,"timeline",void 0),m(this,"_viewports",void 0),m(this,"_viewportMap",void 0),m(this,"_isUpdating",void 0),m(this,"_needsRedraw",void 0),m(this,"_needsUpdate",void 0),m(this,"_eventManager",void 0),m(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=t.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=t.eventManager,this._eventCallbacks={onViewStateChange:t.onViewStateChange,onInteractionStateChange:t.onInteractionStateChange},Object.seal(this),this.setProps(t)}finalize(){for(const t in this.controllers){const e=this.controllers[t];e&&e.finalize()}this.controllers={}}needsRedraw(t={clearRedrawFlags:!1}){const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t,this._needsRedraw=this._needsRedraw||t}updateViewStates(){for(const t in this.controllers){const e=this.controllers[t];e&&e.updateTransition()}}getViewports(t){return t?this._viewports.filter((e=>e.containsPixel(t))):this._viewports}getViews(){const t={};return this.views.forEach((e=>{t[e.id]=e})),t}getView(t){return this.views.find((e=>e.id===t))}getViewState(t){const e="string"==typeof t?this.getView(t):t,n=e&&this.viewState[e.getViewStateId()]||this.viewState;return e?e.filterViewState(n):n}getViewport(t){return this._viewportMap[t]}unproject(t,e){const n=this.getViewports(),i={x:t[0],y:t[1]};for(let r=n.length-1;r>=0;--r){const s=n[r];if(s.containsPixel(i)){const n=t.slice();return n[0]-=s.x,n[1]-=s.y,s.unproject(n,e)}}return null}setProps(t){t.views&&this._setViews(t.views),t.viewState&&this._setViewState(t.viewState),("width"in t||"height"in t)&&this._setSize(t.width,t.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(t,e){t===this.width&&e===this.height||(this.width=t,this.height=e,this.setNeedsUpdate("Size changed"))}_setViews(t){t=Y(t,Boolean),this._diffViews(t,this.views)&&this.setNeedsUpdate("views changed"),this.views=t}_setViewState(t){t?(!tl(t,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=t):q.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(t,e){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...e,viewId:t})}_createController(t,e){return new(0,e.type)({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,e.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:e=>{var n;return null===(n=this.getView(t.id))||void 0===n?void 0:n.makeViewport({viewState:e,width:this.width,height:this.height})}})}_updateController(t,e,n,i){const r=t.controller;if(r&&n){const s={...e,...r,id:t.id,x:n.x,y:n.y,width:n.width,height:n.height};return i&&i.constructor===r.type||(i=this._createController(t,s)),i&&i.setProps(s),i}return null}_rebuildViewports(){const{views:t}=this,e=this.controllers;this._viewports=[],this.controllers={};let n=!1;for(let i=t.length;i--;){const r=t[i],s=this.getViewState(r),o=r.makeViewport({viewState:s,width:this.width,height:this.height});let a=e[r.id];const l=Boolean(r.controller);l&&!a&&(n=!0),!n&&l||!a||(a.finalize(),a=null),this.controllers[r.id]=this._updateController(r,s,o,a),o&&this._viewports.unshift(o)}for(const t in e){const n=e[t];n&&!this.controllers[t]&&n.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach((t=>{t.id&&(this._viewportMap[t.id]=this._viewportMap[t.id]||t)}))}_diffViews(t,e){return t.length!==e.length||t.some(((n,i)=>!t[i].equals(e[i])))}}const nl=/([0-9]+\.?[0-9]*)(%|px)/;function il(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=nl.exec(t);if(e&&e.length>=3){const t="%"===e[2],n=parseFloat(e[1]);return{position:t?n/100:n,relative:t}}default:throw new Error("Could not parse position string ".concat(t))}}function rl(t,e){return t.relative?Math.round(t.position*e):t.position}function sl(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class ol{constructor(t){m(this,"id",void 0),m(this,"viewportInstance",void 0),m(this,"_x",void 0),m(this,"_y",void 0),m(this,"_width",void 0),m(this,"_height",void 0),m(this,"_padding",void 0),m(this,"props",void 0);const{id:e,x:n=0,y:i=0,width:r="100%",height:s="100%",padding:o=null,viewportInstance:a}=t||{};sl(!a||a instanceof zi),this.viewportInstance=a,this.id=e||this.constructor.displayName||"view",this.props={...t,id:this.id},this._x=il(n),this._y=il(i),this._width=il(r),this._height=il(s),this._padding=o&&{left:il(o.left||0),right:il(o.right||0),top:il(o.top||0),bottom:il(o.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(t){return this===t||(this.viewportInstance?!!t.viewportInstance&&this.viewportInstance.equals(t.viewportInstance):this.ViewportType===t.ViewportType&&tl(this.props,t.props,2))}makeViewport({width:t,height:e,viewState:n}){if(this.viewportInstance)return this.viewportInstance;n=this.filterViewState(n);const i=this.getDimensions({width:t,height:e});return i.height&&i.width?new this.ViewportType({...n,...this.props,...i}):null}getViewStateId(){const{viewState:t}=this.props;return"string"==typeof t?t:(null==t?void 0:t.id)||this.id}filterViewState(t){if(this.props.viewState&&"object"==typeof this.props.viewState){if(!this.props.viewState.id)return this.props.viewState;const e={...t};for(const t in this.props.viewState)"id"!==t&&(e[t]=this.props.viewState[t]);return e}return t}getDimensions({width:t,height:e}){const n={x:rl(this._x,t),y:rl(this._y,e),width:rl(this._width,t),height:rl(this._height,e)};return this._padding&&(n.padding={left:rl(this._padding.left,t),top:rl(this._padding.top,e),right:rl(this._padding.right,t),bottom:rl(this._padding.bottom,e)}),n}get controller(){const t=this.props.controller;return t?!0===t?{type:this.ControllerType}:"function"==typeof t?{type:t}:{type:this.ControllerType,...t}:null}}class al extends zi{constructor(t={}){const{latitude:e=0,longitude:n=0,zoom:i=0,pitch:r=0,bearing:s=0,nearZMultiplier:o=.1,farZMultiplier:a=1.01,nearZ:l,farZ:c,orthographic:u=!1,projectionMatrix:h,repeat:d=!1,worldOffset:f=0,position:p,padding:g,legacyMeterSizes:v=!1}=t;let{width:y,height:b,altitude:_=1.5}=t;const A=Math.pow(2,i);let w;y=y||1,b=b||1;let C=null;if(h)_=h[5]/2,w=Ti(_);else{let n;if(t.fovy?(w=t.fovy,_=Si(w)):w=Ti(_),g){const{top:t=0,bottom:e=0}=g;n=[0,on((t+b-e)/2,0,b)-b/2]}C=function(t){const{width:e,height:n,altitude:i,pitch:r=0,offset:s,center:o,scale:a,nearZMultiplier:l=1,farZMultiplier:c=1}=t;let{fovy:u=Ti(_i)}=t;void 0!==i&&(u=Ti(i));const h=u*gi,d=r*gi,f=Si(u);let p=f;o&&(p+=o[2]*a/Math.cos(d)/n);const g=h*(.5+(s?s[1]:0)/n),m=Math.sin(g)*p/Math.sin(ui(Math.PI/2-d-g,.01,Math.PI-.01)),v=Math.sin(d)*m+p,y=10*p;return{fov:h,aspect:e/n,focalDistance:f,near:l,far:Math.min(v*c,y)}}({width:y,height:b,scale:A,center:p&&[0,0,p[2]*Ci(e)],offset:n,pitch:r,fovy:w,nearZMultiplier:o,farZMultiplier:a}),Number.isFinite(l)&&(C.near=l),Number.isFinite(c)&&(C.far=c)}let E=function(t){const{height:e,pitch:n,bearing:i,altitude:r,scale:s,center:o}=t,a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];Gn(a,a,[0,0,-r]),Vn(a,a,-n*gi),Hn(a,a,i*gi);const l=s/e;return jn(a,a,[l,l,l]),o&&Gn(a,a,function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}([],o)),a}({height:b,pitch:r,bearing:s,scale:A,altitude:_});f&&(E=(new ri).translate([512*f,0,0]).multiplyLeft(E)),super({...t,width:y,height:b,viewMatrix:E,longitude:n,latitude:e,zoom:i,...C,fovy:w,focalDistance:_}),m(this,"longitude",void 0),m(this,"latitude",void 0),m(this,"pitch",void 0),m(this,"bearing",void 0),m(this,"altitude",void 0),m(this,"fovy",void 0),m(this,"orthographic",void 0),m(this,"_subViewports",void 0),m(this,"_pseudoMeters",void 0),this.latitude=e,this.longitude=n,this.zoom=i,this.pitch=r,this.bearing=s,this.altitude=_,this.fovy=w,this.orthographic=u,this._subViewports=d?[]:null,this._pseudoMeters=v,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const t=this.getBounds(),e=Math.floor((t[0]+180)/360),n=Math.ceil((t[2]-180)/360);for(let t=e;t<=n;t++){const e=t?new al({...this,worldOffset:t}):this;this._subViewports.push(e)}}return this._subViewports}projectPosition(t){if(this._pseudoMeters)return super.projectPosition(t);const[e,n]=this.projectFlat(t);return[e,n,(t[2]||0)*Ci(t[1])]}unprojectPosition(t){if(this._pseudoMeters)return super.unprojectPosition(t);const[e,n]=this.unprojectFlat(t);return[e,n,(t[2]||0)/Ci(n)]}addMetersToLngLat(t,e){return xi(t,e)}panByPosition(t,e){const n=Pi(e,this.pixelUnprojectionMatrix),i=Jn([],this.projectFlat(t),qn([],n)),r=Jn([],this.center,i),[s,o]=this.unprojectFlat(r);return{longitude:s,latitude:o}}getBounds(t={}){const e=function(t,e=0){const{width:n,height:i,unproject:r}=t,s={targetZ:e},o=r([0,i],s),a=r([n,i],s);let l,c;return(t.fovy?.5*t.fovy*Mi:Math.atan(.5/t.altitude))>(90-t.pitch)*Mi-.01?(l=Ii(t,0,e),c=Ii(t,n,e)):(l=r([0,0],s),c=r([n,0],s)),[o,a,c,l]}(this,t.z||0);return[Math.min(e[0][0],e[1][0],e[2][0],e[3][0]),Math.min(e[0][1],e[1][1],e[2][1],e[3][1]),Math.max(e[0][0],e[1][0],e[2][0],e[3][0]),Math.max(e[0][1],e[1][1],e[2][1],e[3][1])]}fitBounds(t,e={}){const{width:n,height:i}=this,{longitude:r,latitude:s,zoom:o}=function(t){const{width:e,height:n,bounds:i,minExtent:r=0,maxZoom:s=24,offset:o=[0,0]}=t,[[a,l],[c,u]]=i,h=function(t=0){return"number"==typeof t?{top:t,bottom:t,left:t,right:t}:(di(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}(t.padding),d=Ai([a,ui(u,-85.051129,bi)]),f=Ai([c,ui(l,-85.051129,bi)]),p=[Math.max(Math.abs(f[0]-d[0]),r),Math.max(Math.abs(f[1]-d[1]),r)],g=[e-h.left-h.right-2*Math.abs(o[0]),n-h.top-h.bottom-2*Math.abs(o[1])];di(g[0]>0&&g[1]>0);const m=g[0]/p[0],v=g[1]/p[1],y=(h.right-h.left)/2/m,b=(h.top-h.bottom)/2/v,_=wi([(f[0]+d[0])/2+y,(f[1]+d[1])/2+b]),A=Math.min(s,hi(Math.abs(Math.min(m,v))));return di(Number.isFinite(A)),{longitude:_[0],latitude:_[1],zoom:A}}({width:n,height:i,bounds:t,...e});return new al({width:n,height:i,longitude:r,latitude:s,zoom:o})}}m(al,"displayName","WebMercatorViewport");class ll{constructor(t){m(this,"_inProgress",void 0),m(this,"_handle",void 0),m(this,"_timeline",void 0),m(this,"time",void 0),m(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=t,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(t){var e,n;this.cancel(),this.settings=t,this._inProgress=!0,null===(e=(n=this.settings).onStart)||void 0===e||e.call(n,this)}end(){var t,e;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,null===(t=(e=this.settings).onEnd)||void 0===t||t.call(e,this))}cancel(){var t,e;this._inProgress&&(null===(t=(e=this.settings).onInterrupt)||void 0===t||t.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var t,e;if(!this._inProgress)return!1;if(null===this._handle){const{_timeline:t,settings:e}=this;this._handle=t.addChannel({delay:t.getTime(),duration:e.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),null===(t=(e=this.settings).onUpdate)||void 0===t||t.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const cl=()=>{},ul=t=>t;class hl{constructor(t){m(this,"getControllerState",void 0),m(this,"props",void 0),m(this,"propsInTransition",void 0),m(this,"transition",void 0),m(this,"onViewStateChange",void 0),m(this,"onStateChange",void 0),m(this,"_onTransitionUpdate",(t=>{const{time:e,settings:{interpolator:n,startProps:i,endProps:r,duration:s,easing:o}}=t,a=o(e/s),l=n.interpolateProps(i,r,a);this.propsInTransition=this.getControllerState({...this.props,...l}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})})),this.getControllerState=t.getControllerState,this.propsInTransition=null,this.transition=new ll(t.timeline),this.onViewStateChange=t.onViewStateChange||cl,this.onStateChange=t.onStateChange||cl}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(t){let e=!1;const n=this.props;if(this.props=t,!n||this._shouldIgnoreViewportChange(n,t))return!1;if(this._isTransitionEnabled(t)){let i=n;if(this.transition.inProgress){const{interruption:t,endProps:e}=this.transition.settings;i={...n,...2===t?e:this.propsInTransition||n}}this._triggerTransition(i,t),e=!0}else this.transition.cancel();return e}updateTransition(){this.transition.update()}_isTransitionEnabled(t){const{transitionDuration:e,transitionInterpolator:n}=t;return(e>0||"auto"===e)&&Boolean(n)}_isUpdateDueToCurrentTransition(t){return!(!this.transition.inProgress||!this.propsInTransition)&&this.transition.settings.interpolator.arePropsEqual(t,this.propsInTransition)}_shouldIgnoreViewportChange(t,e){return this.transition.inProgress?3===this.transition.settings.interruption||this._isUpdateDueToCurrentTransition(e):!this._isTransitionEnabled(e)||e.transitionInterpolator.arePropsEqual(t,e)}_triggerTransition(t,e){const n=this.getControllerState(t),i=this.getControllerState(e).shortestPathFrom(n),r=e.transitionInterpolator,s=r.getDuration?r.getDuration(t,e):e.transitionDuration;if(0===s)return;const o=r.initializeProps(t,i);this.propsInTransition={};const a={duration:s,easing:e.transitionEasing||ul,interpolator:r,interruption:e.transitionInterruption||1,startProps:o.start,endProps:o.end,onStart:e.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(e.onTransitionInterrupt),onEnd:this._onTransitionEnd(e.onTransitionEnd)};this.transition.start(a),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(t){return e=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),null==t||t(e)}}}class dl{constructor(t){m(this,"_propsToCompare",void 0),m(this,"_propsToExtract",void 0),m(this,"_requiredProps",void 0);const{compare:e,extract:n,required:i}=t;this._propsToCompare=e,this._propsToExtract=n||e,this._requiredProps=i}arePropsEqual(t,e){for(const n of this._propsToCompare)if(!(n in t)||!(n in e)||!ln(t[n],e[n]))return!1;return!0}initializeProps(t,e){const n={},i={};for(const r of this._propsToExtract)(r in t||r in e)&&(n[r]=t[r],i[r]=e[r]);return this._checkRequiredProps(n),this._checkRequiredProps(i),{start:n,end:i}}getDuration(t,e){return e.transitionDuration}_checkRequiredProps(t){this._requiredProps&&this._requiredProps.forEach((e=>{const n=t[e];sl(Number.isFinite(n)||Array.isArray(n),"".concat(e," is required for transition"))}))}}const fl=["longitude","latitude","zoom","bearing","pitch"],pl=["longitude","latitude","zoom"];class gl extends dl{constructor(t={}){const e=Array.isArray(t)?t:t.transitionProps,n=Array.isArray(t)?{}:t;n.transitionProps=Array.isArray(e)?{compare:e,required:e}:e||{compare:fl,required:pl},super(n.transitionProps),m(this,"opts",void 0),this.opts=n}initializeProps(t,e){const n=super.initializeProps(t,e),{makeViewport:i,around:r}=this.opts;if(i&&r){const s=i(t),o=i(e),a=s.unproject(r);n.start.around=r,Object.assign(n.end,{around:o.project(a),aroundPosition:a,width:e.width,height:e.height})}return n}interpolateProps(t,e,n){const i={};for(const r of this._propsToExtract)i[r]=an(t[r]||0,e[r]||0,n);if(e.aroundPosition&&this.opts.makeViewport){const r=this.opts.makeViewport({...e,...i});Object.assign(i,r.panByPosition(e.aroundPosition,an(t.around,e.around,n)))}return i}}const ml={transitionDuration:0},vl=t=>1-(1-t)*(1-t),yl=["wheel"],bl=["panstart","panmove","panend"],_l=["pinchstart","pinchmove","pinchend"],Al=["tripanstart","tripanmove","tripanend"],wl=["doubletap"],Cl=["keydown"],El={};class xl{constructor(t){m(this,"props",void 0),m(this,"state",{}),m(this,"transitionManager",void 0),m(this,"eventManager",void 0),m(this,"onViewStateChange",void 0),m(this,"onStateChange",void 0),m(this,"makeViewport",void 0),m(this,"_controllerState",void 0),m(this,"_events",{}),m(this,"_interactionState",{isDragging:!1}),m(this,"_customEvents",[]),m(this,"_eventStartBlocked",null),m(this,"_panMove",!1),m(this,"invertPan",!1),m(this,"dragMode","rotate"),m(this,"inertia",0),m(this,"scrollZoom",!0),m(this,"dragPan",!0),m(this,"dragRotate",!0),m(this,"doubleClickZoom",!0),m(this,"touchZoom",!0),m(this,"touchRotate",!1),m(this,"keyboard",!0),this.transitionManager=new hl({...t,getControllerState:t=>new this.ControllerState(t),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=t.eventManager,this.onViewStateChange=t.onViewStateChange||(()=>{}),this.onStateChange=t.onStateChange||(()=>{}),this.makeViewport=t.makeViewport}set events(t){this.toggleEvents(this._customEvents,!1),this.toggleEvents(t,!0),this._customEvents=t,this.props&&this.setProps(this.props)}finalize(){for(const e in this._events){var t;this._events[e]&&(null===(t=this.eventManager)||void 0===t||t.off(e,this.handleEvent))}this.transitionManager.finalize()}handleEvent(t){this._controllerState=void 0;const e=this._eventStartBlocked;switch(t.type){case"panstart":return!e&&this._onPanStart(t);case"panmove":return this._onPan(t);case"panend":return this._onPanEnd(t);case"pinchstart":return!e&&this._onPinchStart(t);case"pinchmove":return this._onPinch(t);case"pinchend":return this._onPinchEnd(t);case"tripanstart":return!e&&this._onTriplePanStart(t);case"tripanmove":return this._onTriplePan(t);case"tripanend":return this._onTriplePanEnd(t);case"doubletap":return this._onDoubleTap(t);case"wheel":return this._onWheel(t);case"keydown":return this._onKeyDown(t);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(t){const{x:e,y:n}=this.props,{offsetCenter:i}=t;return[i.x-e,i.y-n]}isPointInBounds(t,e){const{width:n,height:i}=this.props;if(e&&e.handled)return!1;const r=t[0]>=0&&t[0]<=n&&t[1]>=0&&t[1]<=i;return r&&e&&e.stopPropagation(),r}isFunctionKeyPressed(t){const{srcEvent:e}=t;return Boolean(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(t){const e=setTimeout((()=>{this._eventStartBlocked===e&&(this._eventStartBlocked=null)}),t);this._eventStartBlocked=e}setProps(t){t.dragMode&&(this.dragMode=t.dragMode),this.props=t,"transitionInterpolator"in t||(t.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(t);const{inertia:e}=t;this.inertia=Number.isFinite(e)?e:!0===e?300:0;const{scrollZoom:n=!0,dragPan:i=!0,dragRotate:r=!0,doubleClickZoom:s=!0,touchZoom:o=!0,touchRotate:a=!1,keyboard:l=!0}=t,c=Boolean(this.onViewStateChange);this.toggleEvents(yl,c&&n),this.toggleEvents(bl,c),this.toggleEvents(_l,c&&(o||a)),this.toggleEvents(Al,c&&a),this.toggleEvents(wl,c&&s),this.toggleEvents(Cl,c&&l),this.scrollZoom=n,this.dragPan=i,this.dragRotate=r,this.doubleClickZoom=s,this.touchZoom=o,this.touchRotate=a,this.keyboard=l}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(t,e){this.eventManager&&t.forEach((t=>{this._events[t]!==e&&(this._events[t]=e,e?this.eventManager.on(t,this.handleEvent):this.eventManager.off(t,this.handleEvent))}))}updateViewport(t,e=null,n={}){const i={...t.getViewportProps(),...e},r=this.controllerState!==t;if(this.state=t.getState(),this._setInteractionState(n),r){const t=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:t})}}_onTransition(t){this.onViewStateChange({...t,interactionState:this._interactionState})}_setInteractionState(t){Object.assign(this._interactionState,t),this.onStateChange(this._interactionState)}_onPanStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;let n=this.isFunctionKeyPressed(t)||t.rightButton||!1;(this.invertPan||"pan"===this.dragMode)&&(n=!n);const i=this.controllerState[n?"panStart":"rotateStart"]({pos:e});return this._panMove=n,this.updateViewport(i,ml,{isDragging:!0}),!0}_onPan(t){return!!this.isDragging()&&(this._panMove?this._onPanMove(t):this._onPanRotate(t))}_onPanEnd(t){return!!this.isDragging()&&(this._panMove?this._onPanMoveEnd(t):this._onPanRotateEnd(t))}_onPanMove(t){if(!this.dragPan)return!1;const e=this.getCenter(t),n=this.controllerState.pan({pos:e});return this.updateViewport(n,ml,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(t){const{inertia:e}=this;if(this.dragPan&&e&&t.velocity){const n=this.getCenter(t),i=[n[0]+t.velocityX*e/2,n[1]+t.velocityY*e/2],r=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:vl},{isDragging:!1,isPanning:!0})}else{const t=this.controllerState.panEnd();this.updateViewport(t,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(t){if(!this.dragRotate)return!1;const e=this.getCenter(t),n=this.controllerState.rotate({pos:e});return this.updateViewport(n,ml,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(t){const{inertia:e}=this;if(this.dragRotate&&e&&t.velocity){const n=this.getCenter(t),i=[n[0]+t.velocityX*e/2,n[1]+t.velocityY*e/2],r=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:vl},{isDragging:!1,isRotating:!0})}else{const t=this.controllerState.rotateEnd();this.updateViewport(t,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(t){if(!this.scrollZoom)return!1;const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;t.srcEvent.preventDefault();const{speed:n=.01,smooth:i=!1}=!0===this.scrollZoom?{}:this.scrollZoom,{delta:r}=t;let s=2/(1+Math.exp(-Math.abs(r*n)));r<0&&0!==s&&(s=1/s);const o=this.controllerState.zoom({pos:e,scale:s});return this.updateViewport(o,{...this._getTransitionProps({around:e}),transitionDuration:i?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const n=this.controllerState.rotateStart({pos:e});return this.updateViewport(n,ml,{isDragging:!0}),!0}_onTriplePan(t){if(!this.touchRotate)return!1;if(!this.isDragging())return!1;const e=this.getCenter(t);e[0]-=t.deltaX;const n=this.controllerState.rotate({pos:e});return this.updateViewport(n,ml,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(t){if(!this.isDragging())return!1;const{inertia:e}=this;if(this.touchRotate&&e&&t.velocityY){const n=this.getCenter(t),i=[n[0],n[1]+=t.velocityY*e/2],r=this.controllerState.rotate({pos:i});this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:vl},{isDragging:!1,isRotating:!0}),this.blockEvents(e)}else{const t=this.controllerState.rotateEnd();this.updateViewport(t,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const n=this.controllerState.zoomStart({pos:e}).rotateStart({pos:e});return El._startPinchRotation=t.rotation,El._lastPinchEvent=t,this.updateViewport(n,ml,{isDragging:!0}),!0}_onPinch(t){if(!this.touchZoom&&!this.touchRotate)return!1;if(!this.isDragging())return!1;let e=this.controllerState;if(this.touchZoom){const{scale:n}=t,i=this.getCenter(t);e=e.zoom({pos:i,scale:n})}if(this.touchRotate){const{rotation:n}=t;e=e.rotate({deltaAngleX:El._startPinchRotation-n})}return this.updateViewport(e,ml,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),El._lastPinchEvent=t,!0}_onPinchEnd(t){if(!this.isDragging())return!1;const{inertia:e}=this,{_lastPinchEvent:n}=El;if(this.touchZoom&&e&&n&&t.scale!==n.scale){const i=this.getCenter(t);let r=this.controllerState.rotateEnd();const s=Math.log2(t.scale),o=(s-Math.log2(n.scale))/(t.deltaTime-n.deltaTime),a=Math.pow(2,s+o*e/2);r=r.zoom({pos:i,scale:a}).zoomEnd(),this.updateViewport(r,{...this._getTransitionProps({around:i}),transitionDuration:e,transitionEasing:vl},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(e)}else{const t=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(t,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return El._startPinchRotation=null,El._lastPinchEvent=null,!0}_onDoubleTap(t){if(!this.doubleClickZoom)return!1;const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const n=this.isFunctionKeyPressed(t),i=this.controllerState.zoom({pos:e,scale:n?.5:2});return this.updateViewport(i,this._getTransitionProps({around:e}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(t){if(!this.keyboard)return!1;const e=this.isFunctionKeyPressed(t),{zoomSpeed:n,moveSpeed:i,rotateSpeedX:r,rotateSpeedY:s}=!0===this.keyboard?{}:this.keyboard,{controllerState:o}=this;let a;const l={};switch(t.srcEvent.code){case"Minus":a=e?o.zoomOut(n).zoomOut(n):o.zoomOut(n),l.isZooming=!0;break;case"Equal":a=e?o.zoomIn(n).zoomIn(n):o.zoomIn(n),l.isZooming=!0;break;case"ArrowLeft":e?(a=o.rotateLeft(r),l.isRotating=!0):(a=o.moveLeft(i),l.isPanning=!0);break;case"ArrowRight":e?(a=o.rotateRight(r),l.isRotating=!0):(a=o.moveRight(i),l.isPanning=!0);break;case"ArrowUp":e?(a=o.rotateUp(s),l.isRotating=!0):(a=o.moveUp(i),l.isPanning=!0);break;case"ArrowDown":e?(a=o.rotateDown(s),l.isRotating=!0):(a=o.moveDown(i),l.isPanning=!0);break;default:return!1}return this.updateViewport(a,this._getTransitionProps(),l),!0}_getTransitionProps(t){const{transition:e}=this;return e&&e.transitionInterpolator?t?{...e,transitionInterpolator:new gl({...t,...e.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:e:ml}}class Tl{constructor(t,e){m(this,"_viewportProps",void 0),m(this,"_state",void 0),this._viewportProps=this.applyConstraints(t),this._state=e}getViewportProps(){return this._viewportProps}getState(){return this._state}}class Sl extends Tl{constructor(t){const{width:e,height:n,latitude:i,longitude:r,zoom:s,bearing:o=0,pitch:a=0,altitude:l=1.5,position:c=[0,0,0],maxZoom:u=20,minZoom:h=0,maxPitch:d=60,minPitch:f=0,startPanLngLat:p,startZoomLngLat:g,startRotatePos:v,startBearing:y,startPitch:b,startZoom:_,normalize:A=!0}=t;sl(Number.isFinite(r)),sl(Number.isFinite(i)),sl(Number.isFinite(s)),super({width:e,height:n,latitude:i,longitude:r,zoom:s,bearing:o,pitch:a,altitude:l,maxZoom:u,minZoom:h,maxPitch:d,minPitch:f,normalize:A,position:c},{startPanLngLat:p,startZoomLngLat:g,startRotatePos:v,startBearing:y,startPitch:b,startZoom:_}),m(this,"makeViewport",void 0),this.makeViewport=t.makeViewport}panStart({pos:t}){return this._getUpdatedState({startPanLngLat:this._unproject(t)})}pan({pos:t,startPos:e}){const n=this.getState().startPanLngLat||this._unproject(e);if(!n)return this;const i=this.makeViewport(this.getViewportProps()).panByPosition(n,t);return this._getUpdatedState(i)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:t}){return this._getUpdatedState({startRotatePos:t,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:t,deltaAngleX:e=0,deltaAngleY:n=0}){const{startRotatePos:i,startBearing:r,startPitch:s}=this.getState();if(!i||void 0===r||void 0===s)return this;let o;return o=t?this._getNewRotation(t,i,s,r):{bearing:r+e,pitch:s+n},this._getUpdatedState(o)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:t}){return this._getUpdatedState({startZoomLngLat:this._unproject(t),startZoom:this.getViewportProps().zoom})}zoom({pos:t,startPos:e,scale:n}){let{startZoom:i,startZoomLngLat:r}=this.getState();if(r||(i=this.getViewportProps().zoom,r=this._unproject(e)||this._unproject(t)),!r)return this;const{maxZoom:s,minZoom:o}=this.getViewportProps();let a=i+Math.log2(n);a=on(a,o,s);const l=this.makeViewport({...this.getViewportProps(),zoom:a});return this._getUpdatedState({zoom:a,...l.panByPosition(r,t)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(t=2){return this._zoomFromCenter(t)}zoomOut(t=2){return this._zoomFromCenter(1/t)}moveLeft(t=100){return this._panFromCenter([t,0])}moveRight(t=100){return this._panFromCenter([-t,0])}moveUp(t=100){return this._panFromCenter([0,t])}moveDown(t=100){return this._panFromCenter([0,-t])}rotateLeft(t=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-t})}rotateRight(t=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+t})}rotateUp(t=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+t})}rotateDown(t=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-t})}shortestPathFrom(t){const e=t.getViewportProps(),n={...this.getViewportProps()},{bearing:i,longitude:r}=n;return Math.abs(i-e.bearing)>180&&(n.bearing=i<0?i+360:i-360),Math.abs(r-e.longitude)>180&&(n.longitude=r<0?r+360:r-360),n}applyConstraints(t){const{maxZoom:e,minZoom:n,zoom:i}=t;t.zoom=on(i,n,e);const{maxPitch:r,minPitch:s,pitch:o}=t;t.pitch=on(o,s,r);const{normalize:a=!0}=t;return a&&Object.assign(t,function(t){const{width:e,height:n,pitch:i=0}=t;let{longitude:r,latitude:s,zoom:o,bearing:a=0}=t;(r<-180||r>180)&&(r=ci(r+180,360)-180),(a<-180||a>180)&&(a=ci(a+180,360)-180);const l=hi(n/512);if(o<=l)o=l,s=0;else{const t=n/2/Math.pow(2,o),e=wi([0,t])[1];if(s<e)s=e;else{const e=wi([0,512-t])[1];s>e&&(s=e)}}return{width:e,height:n,longitude:r,latitude:s,zoom:o,pitch:i,bearing:a}}(t)),t}_zoomFromCenter(t){const{width:e,height:n}=this.getViewportProps();return this.zoom({pos:[e/2,n/2],scale:t})}_panFromCenter(t){const{width:e,height:n}=this.getViewportProps();return this.pan({startPos:[e/2,n/2],pos:[e/2+t[0],n/2+t[1]]})}_getUpdatedState(t){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...t})}_unproject(t){const e=this.makeViewport(this.getViewportProps());return t&&e.unproject(t)}_getNewRotation(t,e,n,i){const r=t[0]-e[0],s=t[1]-e[1],o=t[1],a=e[1],{width:l,height:c}=this.getViewportProps(),u=r/l;let h=0;s>0?Math.abs(c-a)>5&&(h=s/(a-c)*1.2):s<0&&a>5&&(h=1-o/a),h=on(h,-1,1);const{minPitch:d,maxPitch:f}=this.getViewportProps();let p=n;return h>0?p=n+h*(f-n):h<0&&(p=n-h*(d-n)),{pitch:p,bearing:i+180*u}}}class Bl extends xl{constructor(...t){super(...t),m(this,"ControllerState",Sl),m(this,"transition",{transitionDuration:300,transitionInterpolator:new gl({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),m(this,"dragMode","pan")}setProps(t){t.position=t.position||[0,0,0];const e=this.props;super.setProps(t),(!e||e.height!==t.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...t,...this.state}))}}class Pl extends ol{get ViewportType(){return al}get ControllerType(){return Bl}}m(Pl,"displayName","MapView");const Ml=[255,255,255],Il=1;let Ll=0;class Ol{constructor(t={}){m(this,"id",void 0),m(this,"color",void 0),m(this,"intensity",void 0),m(this,"type","ambient");const{color:e=Ml}=t,{intensity:n=Il}=t;this.id=t.id||"ambient-".concat(Ll++),this.color=e,this.intensity=n}}const Rl=[255,255,255],Fl=1,kl=[0,0,-1];let Dl=0;class Nl{constructor(t={}){m(this,"id",void 0),m(this,"color",void 0),m(this,"intensity",void 0),m(this,"type","directional"),m(this,"direction",void 0),m(this,"shadow",void 0);const{color:e=Rl}=t,{intensity:n=Fl}=t,{direction:i=kl}=t,{_shadow:r=!1}=t;this.id=t.id||"directional-".concat(Dl++),this.color=e,this.intensity=n,this.type="directional",this.direction=new In(i).normalize().toArray(),this.shadow=r}getProjectedLight(t){return this}}class Ul{constructor(t,e={id:"pass"}){m(this,"id",void 0),m(this,"gl",void 0),m(this,"props",void 0);const{id:n}=e;this.id=n,this.gl=t,this.props={...e}}setProps(t){Object.assign(this.props,t)}render(t){}cleanup(){}}class zl extends Ul{constructor(...t){super(...t),m(this,"_lastRenderIndex",-1)}render(t){return Is(this.gl,{framebuffer:t.target}),this._drawLayers(t)}_drawLayers(t){const{target:e,moduleParameters:n,viewports:i,views:r,onViewportActive:s,clearStack:o=!0,clearCanvas:a=!0}=t;t.pass=t.pass||"unknown";const l=this.gl;a&&function(t,e){Is(t,{viewport:[0,0,e?e.width:t.drawingBufferWidth,e?e.height:t.drawingBufferHeight]}),t.clear(16640)}(l,e),o&&(this._lastRenderIndex=-1);const c=[];for(const o of i){const i=r&&r[o.id];null==s||s(o);const a=this._getDrawLayerParams(o,t),u=o.subViewports||[o];for(const r of u){const s=this._drawLayersInViewport(l,{target:e,moduleParameters:n,viewport:r,view:i,pass:t.pass,layers:t.layers},a);c.push(s)}}return c}_getDrawLayerParams(t,{layers:e,pass:n,isPicking:i=!1,layerFilter:r,cullRect:s,effects:o,moduleParameters:a},l=!1){const c=[],u=Gl(this._lastRenderIndex+1),h={layer:e[0],viewport:t,isPicking:i,renderPass:n,cullRect:s},d={};for(let i=0;i<e.length;i++){const s=e[i],f=this._shouldDrawLayer(s,h,r,d),p={shouldDrawLayer:f};f&&!l&&(p.layerRenderIndex=u(s,f),p.moduleParameters=this._getModuleParameters(s,o,n,a),p.layerParameters=this.getLayerParameters(s,i,t)),c[i]=p}return c}_drawLayersInViewport(t,{layers:e,moduleParameters:n,pass:i,target:r,viewport:s,view:o},a){const l=function(t,{moduleParameters:e,target:n,viewport:i}){const r=n&&"default-framebuffer"!==n.id,s=e&&e.devicePixelRatio||Os(t),o=r?n.height:t.drawingBufferHeight,a=i;return[a.x*s,o-(a.y+a.height)*s,a.width*s,a.height*s]}(t,{moduleParameters:n,target:r,viewport:s});if(o&&o.props.clear){const e=!0===o.props.clear?{color:!0,depth:!0}:o.props.clear;Ls(t,{scissorTest:!0,scissor:l},(()=>Mo(t,e)))}const c={totalCount:e.length,visibleCount:0,compositeCount:0,pickableCount:0};Is(t,{viewport:l});for(let t=0;t<e.length;t++){const n=e[t],{shouldDrawLayer:r,layerRenderIndex:o,moduleParameters:l,layerParameters:u}=a[t];if(r&&n.props.pickable&&c.pickableCount++,n.isComposite)c.compositeCount++;else if(r){c.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,o),l.viewport=s;try{n._drawLayer({moduleParameters:l,uniforms:{layerIndex:o},parameters:u})}catch(t){n.raiseError(t,"drawing ".concat(n," to ").concat(i))}}}return c}shouldDrawLayer(t){return!0}getModuleParameters(t,e){return null}getLayerParameters(t,e,n){return t.props.parameters}_shouldDrawLayer(t,e,n,i){if(!t.props.visible||!this.shouldDrawLayer(t))return!1;e.layer=t;let r=t.parent;for(;r;){if(!r.props.visible||!r.filterSubLayer(e))return!1;e.layer=r,r=r.parent}if(n){const t=e.layer.id;if(t in i||(i[t]=n(e)),!i[t])return!1}return t.activateViewport(e.viewport),!0}_getModuleParameters(t,e,n,i){var r;const s=Object.assign(Object.create((null===(r=t.internalState)||void 0===r?void 0:r.propsInTransition)||t.props),{autoWrapLongitude:t.wrapLongitude,viewport:t.context.viewport,mousePosition:t.context.mousePosition,pickingActive:0,devicePixelRatio:Os(this.gl)});if(e)for(const n of e){var o;Object.assign(s,null===(o=n.getModuleParameters)||void 0===o?void 0:o.call(n,t))}return Object.assign(s,this.getModuleParameters(t,e),i)}}function Gl(t=0,e={}){const n={},i=(r,s)=>{const o=r.props._offset,a=r.id,l=r.parent&&r.parent.id;let c;if(l&&!(l in e)&&i(r.parent,!1),l in n){const t=n[l]=n[l]||Gl(e[l],e);c=t(r,s),n[a]=t}else Number.isFinite(o)?(c=o+(e[l]||0),n[a]=null):c=t;return s&&c>=t&&(t=c+1),e[a]=c,c};return i}class jl extends zl{constructor(t,e){super(t,e),m(this,"shadowMap",void 0),m(this,"depthBuffer",void 0),m(this,"fbo",void 0),this.shadowMap=new Eo(t,{width:1,height:1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.depthBuffer=new So(t,{format:33189,width:1,height:1}),this.fbo=new Ko(t,{id:"shadowmap",width:1,height:1,attachments:{36064:this.shadowMap,36096:this.depthBuffer}})}render(t){const e=this.fbo;Ls(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},(()=>{const n=t.viewports[0],i=Os(this.gl),r=n.width*i,s=n.height*i;r===e.width&&s===e.height||e.resize({width:r,height:s}),super.render({...t,target:e,pass:"shadow"})}))}shouldDrawLayer(t){return!1!==t.props.shadowEnabled}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const Vl=za((function({viewport:t,center:e}){return new ri(t.viewProjectionMatrix).invert().transform(e)})),Hl=za((function({viewport:t,shadowMatrices:e}){const n=[],i=t.pixelUnprojectionMatrix,r=t.isGeospatial?void 0:1,s=[[0,0,r],[t.width,0,r],[0,t.height,r],[t.width,t.height,r],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map((t=>function(t,e){const[n,i,r]=t,s=Pi([n,i,r],e);return Number.isFinite(r)?s:[s[0],s[1],0]}(t,i)));for(const i of e){const e=i.clone().translate(new In(t.center).negate()),r=s.map((t=>e.transform(t))),o=(new ri).ortho({left:Math.min(...r.map((t=>t[0]))),right:Math.max(...r.map((t=>t[0]))),bottom:Math.min(...r.map((t=>t[1]))),top:Math.max(...r.map((t=>t[1]))),near:Math.min(...r.map((t=>-t[2]))),far:Math.max(...r.map((t=>-t[2])))});n.push(o.multiplyRight(i))}return n})),Wl=[0,0,0,1],Jl=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],ql={name:"shadow",dependencies:[Xa],vs:"\nconst int max_lights = 2;\nuniform mat4 shadow_uViewProjectionMatrices[max_lights];\nuniform vec4 shadow_uProjectCenters[max_lights];\nuniform bool shadow_uDrawShadowMap;\nuniform bool shadow_uUseShadowMap;\nuniform int shadow_uLightId;\nuniform float shadow_uLightCount;\n\nvarying vec3 shadow_vPosition[max_lights];\n\nvec4 shadow_setVertexPosition(vec4 position_commonspace) {\n  if (shadow_uDrawShadowMap) {\n    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);\n  }\n  if (shadow_uUseShadowMap) {\n    for (int i = 0; i < max_lights; i++) {\n      if(i < int(shadow_uLightCount)) {\n        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);\n        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;\n      }\n    }\n  }\n  return gl_Position;\n}\n",fs:"\nconst int max_lights = 2;\nuniform bool shadow_uDrawShadowMap;\nuniform bool shadow_uUseShadowMap;\nuniform sampler2D shadow_uShadowMap0;\nuniform sampler2D shadow_uShadowMap1;\nuniform vec4 shadow_uColor;\nuniform float shadow_uLightCount;\n\nvarying vec3 shadow_vPosition[max_lights];\n\nconst vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);\nconst vec4 bitUnpackShift = 1.0 / bitPackShift;\nconst vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);\n\nfloat shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {\n  vec4 rgbaDepth = texture2D(shadowMap, position.xy);\n\n  float z = dot(rgbaDepth, bitUnpackShift);\n  return smoothstep(0.001, 0.01, position.z - z);\n}\n\nvec4 shadow_filterShadowColor(vec4 color) {\n  if (shadow_uDrawShadowMap) {\n    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);\n    rgbaDepth -= rgbaDepth.gbaa * bitMask;\n    return rgbaDepth;\n  }\n  if (shadow_uUseShadowMap) {\n    float shadowAlpha = 0.0;\n    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);\n    if(shadow_uLightCount > 1.0) {\n      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);\n    }\n    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;\n    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);\n\n    return vec4(\n      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),\n      blendedAlpha\n    );\n  }\n  return color;\n}\n",inject:{"vs:DECKGL_FILTER_GL_POSITION":"\n    position = shadow_setVertexPosition(geometry.position);\n    ","fs:DECKGL_FILTER_COLOR":"\n    color = shadow_filterShadowColor(color);\n    "},getUniforms:(t={},e={})=>"viewport"in t&&(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0)?function(t,e){const{shadowEnabled:n=!0}=t;if(!n||!t.shadowMatrices||!t.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};const i={shadow_uDrawShadowMap:Boolean(t.drawToShadowMap),shadow_uUseShadowMap:!!t.shadowMaps&&t.shadowMaps.length>0,shadow_uColor:t.shadowColor||Wl,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},r=Vl({viewport:t.viewport,center:e.project_uCenter}),s=[],o=Hl({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let n=0;n<t.shadowMatrices.length;n++){const i=o[n],a=i.clone().translate(new In(t.viewport.center).negate());e.project_uCoordinateSystem===Li.LNGLAT&&e.project_uProjectionMode===Oi.WEB_MERCATOR?(o[n]=a,s[n]=r):(o[n]=i.clone().multiplyRight(Jl),s[n]=a.transform(r))}for(let e=0;e<o.length;e++)i["shadow_uViewProjectionMatrices[".concat(e,"]")]=o[e],i["shadow_uProjectCenters[".concat(e,"]")]=s[e],t.shadowMaps&&t.shadowMaps.length>0?i["shadow_uShadowMap".concat(e)]=t.shadowMaps[e]:i["shadow_uShadowMap".concat(e)]=t.dummyShadowMap;return i}(t,e):{}},Kl={color:[255,255,255],intensity:1},Xl=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],Ql=[0,0,0,200/255];class Yl{constructor(t={}){m(this,"id","lighting-effect"),m(this,"props",void 0),m(this,"shadowColor",Ql),m(this,"shadow",void 0),m(this,"ambientLight",void 0),m(this,"directionalLights",void 0),m(this,"pointLights",void 0),m(this,"shadowPasses",[]),m(this,"shadowMaps",[]),m(this,"dummyShadowMap",null),m(this,"programManager",void 0),m(this,"shadowMatrices",void 0),this.setProps(t)}setProps(t){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const e in t){const n=t[e];switch(n.type){case"ambient":this.ambientLight=n;break;case"directional":this.directionalLights.push(n);break;case"point":this.pointLights.push(n)}}this._applyDefaultLights(),this.shadow=this.directionalLights.some((t=>t.shadow)),this.props=t}preRender(t,{layers:e,layerFilter:n,viewports:i,onViewportActive:r,views:s}){if(this.shadow){this.shadowMatrices=this._calculateMatrices(),0===this.shadowPasses.length&&this._createShadowPasses(t),this.programManager||(this.programManager=La.getDefaultProgramManager(t),ql&&this.programManager.addDefaultModule(ql)),this.dummyShadowMap||(this.dummyShadowMap=new Eo(t,{width:1,height:1}));for(let t=0;t<this.shadowPasses.length;t++)this.shadowPasses[t].render({layers:e,layerFilter:n,viewports:i,onViewportActive:r,views:s,moduleParameters:{shadowLightId:t,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(t){const e=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return e.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map((e=>e.getProjectedLight({layer:t}))),pointLights:this.pointLights.map((e=>e.getProjectedLight({layer:t})))},e}cleanup(){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(ql),this.programManager=null)}_calculateMatrices(){const t=[];for(const e of this.directionalLights){const n=(new ri).lookAt({eye:new In(e.direction).negate()});t.push(n)}return t}_createShadowPasses(t){for(let e=0;e<this.directionalLights.length;e++){const n=new jl(t);this.shadowPasses[e]=n,this.shadowMaps[e]=n.shadowMap}}_applyDefaultLights(){const{ambientLight:t,pointLights:e,directionalLights:n}=this;t||0!==e.length||0!==n.length||(this.ambientLight=new Ol(Kl),this.directionalLights.push(new Nl(Xl[0]),new Nl(Xl[1])))}}const Zl=new Yl;class $l{constructor(){m(this,"effects",void 0),m(this,"_resolvedEffects",[]),m(this,"_defaultEffects",[]),m(this,"_needsRedraw",void 0),this.effects=[],this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(t){const e=this._defaultEffects;if(!e.find((e=>e.id===t.id))){const n=e.findIndex((e=>{return n=t,(null!==(i=e.order)&&void 0!==i?i:1/0)-(null!==(r=n.order)&&void 0!==r?r:1/0)>0;var n,i,r}));n<0?e.push(t):e.splice(n,0,t),this._setEffects(this.effects)}}setProps(t){"effects"in t&&(tl(t.effects,this.effects,1)||this._setEffects(t.effects))}needsRedraw(t={clearRedrawFlags:!1}){const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}getEffects(){return this._resolvedEffects}_setEffects(t){const e={};for(const t of this.effects)e[t.id]=t;const n=[];for(const i of t){const t=e[i.id];t&&t!==i?t.setProps?(t.setProps(i.props),n.push(t)):(t.cleanup(),n.push(i)):n.push(i),delete e[i.id]}for(const t in e)e[t].cleanup();this.effects=n,this._resolvedEffects=n.concat(this._defaultEffects),t.some((t=>t instanceof Yl))||this._resolvedEffects.push(Zl),this._needsRedraw="effects changed"}finalize(){for(const t of this._resolvedEffects)t.cleanup();this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class tc extends zl{shouldDrawLayer(t){const{operation:e}=t.props;return e.includes("draw")||e.includes("terrain")}}const ec={blendFunc:[1,0,32771,0],blendEquation:32774};class nc extends zl{constructor(...t){super(...t),m(this,"pickZ",void 0),m(this,"_colorEncoderState",null)}render(t){return"pickingFBO"in t?this._drawPickingBuffer(t):super.render(t)}_drawPickingBuffer({layers:t,layerFilter:e,views:n,viewports:i,onViewportActive:r,pickingFBO:s,deviceRect:{x:o,y:a,width:l,height:c},cullRect:u,effects:h,pass:d="picking",pickZ:f,moduleParameters:p}){const g=this.gl;this.pickZ=f;const m=this._resetColorEncoder(f),v=Ls(g,{scissorTest:!0,scissor:[o,a,l,c],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...ec,blend:!f},(()=>super.render({target:s,layers:t,layerFilter:e,views:n,viewports:i,onViewportActive:r,cullRect:u,effects:null==h?void 0:h.filter((t=>t.useInPicking)),pass:d,isPicking:!0,moduleParameters:p})));return this._colorEncoderState=null,{decodePickingColor:m&&ic.bind(null,m),stats:v}}shouldDrawLayer(t){const{pickable:e,operation:n}=t.props;return e&&n.includes("draw")||n.includes("terrain")||n.includes("mask")}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(t,e,n){const i={...t.props.parameters},{pickable:r,operation:s}=t.props;return this._colorEncoderState?r&&s.includes("draw")&&(Object.assign(i,ec),i.blend=!0,i.blendColor=function(t,e,n){const{byLayer:i,byAlpha:r}=t;let s,o=i.get(e);return o?(o.viewports.push(n),s=o.a):(s=i.size+1,s<=255?(o={a:s,layer:e,viewports:[n]},i.set(e,o),r[s]=o):(q.warn("Too many pickable layers, only picking the first 255")(),s=0)),[0,0,0,s/255]}(this._colorEncoderState,t,n)):i.blend=!1,s.includes("terrain")&&(i.blend=!1),i}_resetColorEncoder(t){return this._colorEncoderState=t?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function ic(t,e){const n=t.byAlpha[e[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(e)}}class rc{constructor(t){m(this,"gl",void 0),m(this,"layerFilter",void 0),m(this,"drawPickingColors",void 0),m(this,"drawLayersPass",void 0),m(this,"pickLayersPass",void 0),m(this,"renderCount",void 0),m(this,"_needsRedraw",void 0),m(this,"renderBuffers",void 0),m(this,"lastPostProcessEffect",void 0),this.gl=t,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new tc(t),this.pickLayersPass=new nc(t),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(t){this.layerFilter!==t.layerFilter&&(this.layerFilter=t.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==t.drawPickingColors&&(this.drawPickingColors=t.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(t){if(!t.viewports.length)return;const e=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,n={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...t,target:t.target||Ko.getDefaultFramebuffer(this.gl)};n.effects&&this._preRender(n.effects,n);const i=this.lastPostProcessEffect?this.renderBuffers[0]:n.target,r=e.render({...n,target:i});n.effects&&this._postRender(n.effects,n),this.renderCount++,Q("deckRenderer.renderLayers",this,r,t)}needsRedraw(t={clearRedrawFlags:!1}){const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}finalize(){const{renderBuffers:t}=this;for(const e of t)e.delete();t.length=0}_preRender(t,e){this.lastPostProcessEffect=null,e.preRenderStats=e.preRenderStats||{};for(const n of t)e.preRenderStats[n.id]=n.preRender(this.gl,e),n.postRender&&(this.lastPostProcessEffect=n.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:t}=this;0===t.length&&t.push(new Ko(this.gl),new Ko(this.gl));for(const e of t)e.resize()}_postRender(t,e){const{renderBuffers:n}=this,i={...e,inputBuffer:n[0],swapBuffer:n[1],target:null};for(const r of t)if(r.postRender){if(r.id===this.lastPostProcessEffect){i.target=e.target,r.postRender(this.gl,i);break}const t=r.postRender(this.gl,i);i.inputBuffer=t,i.swapBuffer=t===n[0]?n[1]:n[0]}}}const sc={pickedColor:null,pickedObjectIndex:-1};function oc({pickedColors:t,decodePickingColor:e,deviceX:n,deviceY:i,deviceRadius:r,deviceRect:s}){const{x:o,y:a,width:l,height:c}=s;let u=r*r,h=-1,d=0;for(let e=0;e<c;e++){const r=e+a-i,s=r*r;if(s>u)d+=4*l;else for(let e=0;e<l;e++){if(t[d+3]-1>=0){const t=e+o-n,i=t*t+s;i<=u&&(u=i,h=d)}d+=4}}if(h>=0){const n=t.slice(h,h+4),i=e(n);if(i){const t=Math.floor(h/4/l),e=h/4-t*l;return{...i,pickedColor:n,pickedX:o+e,pickedY:a+t}}q.error("Picked non-existent layer. Is picking buffer corrupt?")()}return sc}function ac({pickInfo:t,viewports:e,pixelRatio:n,x:i,y:r,z:s}){let o,a=e[0];if(e.length>1&&(a=function(t,e){for(let n=t.length-1;n>=0;n--){const i=t[n];if(i.containsPixel(e))return i}return t[0]}((null==t?void 0:t.pickedViewports)||e,{x:i,y:r})),a){const t=[i-a.x,r-a.y];void 0!==s&&(t[2]=s),o=a.unproject(t)}return{color:null,layer:null,viewport:a,index:-1,picked:!1,x:i,y:r,pixel:[i,r],coordinate:o,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:n}}function lc(t){const{pickInfo:e,lastPickedInfo:n,mode:i,layers:r}=t,{pickedColor:s,pickedLayer:o,pickedObjectIndex:a}=e,l=o?[o]:[];if("hover"===i){const t=n.index,e=n.layerId,i=o?o.props.id:null;if(i!==e||a!==t){if(i!==e){const t=r.find((t=>t.props.id===e));t&&l.unshift(t)}n.layerId=i,n.index=a,n.info=null}}const c=ac(t),u=new Map;return u.set(null,c),l.forEach((t=>{let e={...c};t===o&&(e.color=s,e.index=a,e.picked=!0),e=cc({layer:t,info:e,mode:i});const r=e.layer;t===o&&"hover"===i&&(n.info=e),u.set(r.id,e),"hover"===i&&r.updateAutoHighlight(e)})),u}function cc({layer:t,info:e,mode:n}){for(;t&&e;){const i=e.layer||null;e.sourceLayer=i,e.layer=t,e=t.getPickingInfo({info:e,mode:n,sourceLayer:i}),t=t.parent}return e}class uc{constructor(t){m(this,"gl",void 0),m(this,"pickingFBO",void 0),m(this,"depthFBO",void 0),m(this,"pickLayersPass",void 0),m(this,"layerFilter",void 0),m(this,"lastPickedInfo",void 0),m(this,"_pickable",!0),this.gl=t,this.pickLayersPass=new nc(t),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(t){"layerFilter"in t&&(this.layerFilter=t.layerFilter),"_pickable"in t&&(this._pickable=t._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(t){return this._pickClosestObject(t)}pickObjects(t){return this._pickVisibleObjects(t)}getLastPickedObject({x:t,y:e,layers:n,viewports:i},r=this.lastPickedInfo.info){const s=r&&r.layer&&r.layer.id,o=r&&r.viewport&&r.viewport.id,a=s?n.find((t=>t.id===s)):null,l=o&&i.find((t=>t.id===o))||i[0],c=l&&l.unproject([t-l.x,e-l.y]),u={x:t,y:e,viewport:l,coordinate:c,layer:a};return{...r,...u}}_resizeBuffer(){var t,e;const{gl:n}=this;if(!this.pickingFBO&&(this.pickingFBO=new Ko(n),Ko.isSupported(n,{colorBufferFloat:!0}))){const t=new Ko(n);t.attach({36064:new Eo(n,{format:Zr(n)?34836:6408,type:5126})}),this.depthFBO=t}null===(t=this.pickingFBO)||void 0===t||t.resize({width:n.canvas.width,height:n.canvas.height}),null===(e=this.depthFBO)||void 0===e||e.resize({width:n.canvas.width,height:n.canvas.height})}_getPickable(t){if(!1===this._pickable)return null;const e=t.filter((t=>this.pickLayersPass.shouldDrawLayer(t)&&!t.isComposite));return e.length?e:null}_pickClosestObject({layers:t,views:e,viewports:n,x:i,y:r,radius:s=0,depth:o=1,mode:a="query",unproject3D:l,onViewportActive:c,effects:u}){const h=this._getPickable(t),d=Os(this.gl);if(!h)return{result:[],emptyInfo:ac({viewports:n,x:i,y:r,pixelRatio:d})};this._resizeBuffer();const f=Rs(this.gl,[i,r],!0),p=[f.x+Math.floor(f.width/2),f.y+Math.floor(f.height/2)],g=Math.round(s*d),{width:m,height:v}=this.pickingFBO,y=this._getPickingRect({deviceX:p[0],deviceY:p[1],deviceRadius:g,deviceWidth:m,deviceHeight:v}),b={x:i-s,y:r-s,width:2*s+1,height:2*s+1};let _;const A=[],w=new Set;for(let t=0;t<o;t++){let s,f;if(s=y?oc({...this._drawAndSample({layers:h,views:e,viewports:n,onViewportActive:c,deviceRect:y,cullRect:b,effects:u,pass:"picking:".concat(a)}),deviceX:p[0],deviceY:p[1],deviceRadius:g,deviceRect:y}):{pickedColor:null,pickedObjectIndex:-1},s.pickedLayer&&l&&this.depthFBO){const{pickedColors:t}=this._drawAndSample({layers:[s.pickedLayer],views:e,viewports:n,onViewportActive:c,deviceRect:{x:s.pickedX,y:s.pickedY,width:1,height:1},cullRect:b,effects:u,pass:"picking:".concat(a,":z")},!0);t[3]&&(f=t[0])}s.pickedLayer&&t+1<o&&(w.add(s.pickedLayer),s.pickedLayer.disablePickingIndex(s.pickedObjectIndex)),_=lc({pickInfo:s,lastPickedInfo:this.lastPickedInfo,mode:a,layers:h,viewports:n,x:i,y:r,z:f,pixelRatio:d});for(const t of _.values())t.layer&&A.push(t);if(!s.pickedColor)break}for(const t of w)t.restorePickingColors();return{result:A,emptyInfo:_.get(null)}}_pickVisibleObjects({layers:t,views:e,viewports:n,x:i,y:r,width:s=1,height:o=1,mode:a="query",maxObjects:l=null,onViewportActive:c,effects:u}){const h=this._getPickable(t);if(!h)return[];this._resizeBuffer();const d=Os(this.gl),f=Rs(this.gl,[i,r],!0),p=f.x,g=f.y+f.height,m=Rs(this.gl,[i+s,r+o],!0),v=m.x+m.width,y=m.y,b={x:p,y,width:v-p,height:g-y},_=function({pickedColors:t,decodePickingColor:e}){const n=new Map;if(t)for(let i=0;i<t.length;i+=4)if(t[i+3]-1>=0){const r=t.slice(i,i+4),s=r.join(",");if(!n.has(s)){const t=e(r);t?n.set(s,{...t,color:r}):q.error("Picked non-existent layer. Is picking buffer corrupt?")()}}return Array.from(n.values())}(this._drawAndSample({layers:h,views:e,viewports:n,onViewportActive:c,deviceRect:b,cullRect:{x:i,y:r,width:s,height:o},effects:u,pass:"picking:".concat(a)})),A=new Map,w=Number.isFinite(l);for(let t=0;t<_.length&&!(w&&l&&A.size>=l);t++){const e=_[t];let n={color:e.pickedColor,layer:null,index:e.pickedObjectIndex,picked:!0,x:i,y:r,pixelRatio:d};n=cc({layer:e.pickedLayer,info:n,mode:a}),A.has(n.object)||A.set(n.object,n)}return Array.from(A.values())}_drawAndSample({layers:t,views:e,viewports:n,onViewportActive:i,deviceRect:r,cullRect:s,effects:o,pass:a},l=!1){const c=l?this.depthFBO:this.pickingFBO,u={layers:t,layerFilter:this.layerFilter,views:e,viewports:n,onViewportActive:i,pickingFBO:c,deviceRect:r,cullRect:s,effects:o,pass:a,pickZ:l,preRenderStats:{}};for(const t of o)t.useInPicking&&(u.preRenderStats[t.id]=t.preRender(this.gl,u));const{decodePickingColor:h}=this.pickLayersPass.render(u),{x:d,y:f,width:p,height:g}=r,m=new(l?Float32Array:Uint8Array)(p*g*4);return Fo(c,{sourceX:d,sourceY:f,sourceWidth:p,sourceHeight:g,target:m}),{pickedColors:m,decodePickingColor:h}}_getPickingRect({deviceX:t,deviceY:e,deviceRadius:n,deviceWidth:i,deviceHeight:r}){const s=Math.max(0,t-n),o=Math.max(0,e-n),a=Math.min(i,t+n+1)-s,l=Math.min(r,e+n+1)-o;return a<=0||l<=0?null:{x:s,y:o,width:a,height:l}}}const hc={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class dc{constructor(t){m(this,"el",null),m(this,"isVisible",!1);const e=t.parentElement;e&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,hc),e.appendChild(this.el))}setTooltip(t,e,n){const i=this.el;if(i){if("string"==typeof t)i.innerText=t;else{if(!t)return this.isVisible=!1,void(i.style.display="none");t.text&&(i.innerText=t.text),t.html&&(i.innerHTML=t.html),t.className&&(i.className=t.className)}this.isVisible=!0,i.style.display="block",i.style.transform="translate(".concat(e,"px, ").concat(n,"px)"),t&&"object"==typeof t&&"style"in t&&Object.assign(i.style,t.style)}}remove(){this.el&&(this.el.remove(),this.el=null)}}const{_parseImageNode:fc}=globalThis,pc="undefined"!=typeof Image,gc="undefined"!=typeof ImageBitmap,mc=Boolean(fc),vc=!!qt||mc;function yc(t){const e=function(t){return"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?"imagebitmap":"undefined"!=typeof Image&&t instanceof Image?"image":t&&"object"==typeof t&&t.data&&t.width&&t.height?"data":null}(t);if(!e)throw new Error("Not an image");return e}const bc=/^data:image\/svg\+xml/,_c=/\.svg((\?|#).*)?$/;function Ac(t){return t&&(bc.test(t)||_c.test(t))}function wc(t,e){if(Ac(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function Cc(t,e,n){const i=function(t,e){if(Ac(e)){let e=(new TextDecoder).decode(t);try{"function"==typeof unescape&&"function"==typeof encodeURIComponent&&(e=unescape(encodeURIComponent(e)))}catch(t){throw new Error(t.message)}return"data:image/svg+xml;base64,".concat(btoa(e))}return wc(t,e)}(t,n),r=self.URL||self.webkitURL,s="string"!=typeof i&&r.createObjectURL(i);try{return await async function(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise(((e,i)=>{try{n.onload=()=>e(n),n.onerror=e=>i(new Error("Could not load image ".concat(t,": ").concat(e)))}catch(t){i(t)}}))}(s||i,e)}finally{s&&r.revokeObjectURL(s)}}const Ec={};let xc=!0;const Tc=!1,Sc=!0;function Bc(t){const e=Pc(t);return function(t){const e=Pc(t);return e.byteLength>=24&&2303741511===e.getUint32(0,Tc)?{mimeType:"image/png",width:e.getUint32(16,Tc),height:e.getUint32(20,Tc)}:null}(e)||function(t){const e=Pc(t);if(!(e.byteLength>=3&&65496===e.getUint16(0,Tc)&&255===e.getUint8(2)))return null;const{tableMarkers:n,sofMarkers:i}=function(){const t=new Set([65499,65476,65484,65501,65534]);for(let e=65504;e<65520;++e)t.add(e);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}();let r=2;for(;r+9<e.byteLength;){const t=e.getUint16(r,Tc);if(i.has(t))return{mimeType:"image/jpeg",height:e.getUint16(r+5,Tc),width:e.getUint16(r+7,Tc)};if(!n.has(t))return null;r+=2,r+=e.getUint16(r,Tc)}return null}(e)||function(t){const e=Pc(t);return e.byteLength>=10&&1195984440===e.getUint32(0,Tc)?{mimeType:"image/gif",width:e.getUint16(6,Sc),height:e.getUint16(8,Sc)}:null}(e)||function(t){const e=Pc(t);return e.byteLength>=14&&16973===e.getUint16(0,Tc)&&e.getUint32(2,Sc)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Sc),height:e.getUint32(22,Sc)}:null}(e)||function(t){const e=function(t){return function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i=(r=e,[...r].map((t=>t.charCodeAt(0))));var r;for(let e=0;e<i.length;++e)if(i[e]!==t[e+n])return!1;return!0}(t,"ftyp",4)?0==(96&t[8])?null:function(t){switch((e=t,String.fromCharCode(...e.slice(8,12))).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}var e}(t):null}(new Uint8Array(t instanceof DataView?t.buffer:t));return e?{mimeType:e.mimeType,width:0,height:0}:null}(e)}function Pc(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}const Mc={id:"image",module:"images",name:"Images",version:"3.4.14",mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],parse:async function(t,e,n){const i=((e=e||{}).image||{}).type||"auto",{url:r}=n||{};let s;switch(function(t){switch(t){case"auto":case"data":return function(){if(gc)return"imagebitmap";if(pc)return"image";if(vc)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}();default:return function(t){switch(t){case"auto":return gc||pc||vc;case"imagebitmap":return gc;case"image":return pc;case"data":return vc;default:throw new Error("@loaders.gl/images: image ".concat(t," not supported in this environment"))}}(t),t}}(i)){case"imagebitmap":s=await async function(t,e,n){let i;i=Ac(n)?await Cc(t,e,n):wc(t,n);const r=e&&e.imagebitmap;return await async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!function(t){for(const e in t||Ec)return!1;return!0}(e)&&xc||(e=null),e)try{return await createImageBitmap(t,e)}catch(t){console.warn(t),xc=!1}return await createImageBitmap(t)}(i,r)}(t,e,r);break;case"image":s=await Cc(t,e,r);break;case"data":s=await async function(t,e){const{mimeType:n}=Bc(t)||{},i=globalThis._parseImageNode;return dt(i),await i(t,n)}(t);break;default:dt(!1)}return"data"===i&&(s=function(t){switch(yc(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}(s)),s},tests:[t=>Boolean(Bc(new DataView(t)))],options:{image:{type:"auto",decode:!0}}},Ic={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:function(t){const e=t[0],n=t[t.length-1];return"{"===e&&"}"===n||"["===e&&"]"===n},parseTextSync:JSON.parse},Lc=function(){const t="8.9.32",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error("deck.gl - multiple versions detected: ".concat(e," vs ").concat(t));return e||(q.log(1,"deck.gl ".concat(t))(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:q,_registerLoggers:X},function(t){const e=ke();t=Array.isArray(t)?t:[t];for(const n of t){const t=pt(n);e.find((e=>t===e))||e.unshift(t)}}([Ic,[Mc,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}(),Oc=globalThis;class Rc extends ro{get[Symbol.toStringTag](){return"Query"}static isSupported(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const n=Zr(t),i=Wo(t,No);let r=n||i;for(const t of e)switch(t){case"queries":r=r&&n;break;case"timers":r=r&&i;break;default:Xs(!1)}return r}constructor(t){super(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(35007)}beginOcclusionQuery(){let{conservative:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.begin(t?36202:35887)}beginTransformFeedbackQuery(){return this.begin(35976)}begin(t){return this._queryPending||(this.target=t,this.gl2.beginQuery(this.target,this.handle)),this}end(){return this._queryPending||this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this}isResultAvailable(){if(!this._queryPending)return!1;const t=this.gl2.getQueryParameter(this.handle,34919);return t&&(this._queryPending=!1),t}isTimerDisjoint(){return this.gl2.getParameter(36795)}getResult(){return this.gl2.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let e=0;return this._pollingPromise=new Promise(((n,i)=>{const r=()=>{this.isResultAvailable()?(n(this.getResult()),this._pollingPromise=null):e++>t?(i("Timed out"),this._pollingPromise=null):requestAnimationFrame(r)};requestAnimationFrame(r)})),this._pollingPromise}_createHandle(){return Rc.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}const Fc=(!("object"==typeof process&&"[object process]"===String(process)&&!process.browser)||function(t){if("undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof process&&"object"==typeof process.versions&&Boolean(process.versions.electron))return!0;const e="object"==typeof navigator&&"string"==typeof navigator.userAgent&&navigator.userAgent;return!!(e&&e.indexOf("Electron")>=0)}())&&"undefined"!=typeof document;let kc=0;class Dc{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{onCreateContext:e=(t=>zs(t)),onAddHTML:n=null,onInitialize:i=(()=>{}),onRender:r=(()=>{}),onFinalize:s=(()=>{}),onError:o,gl:a=null,glOptions:l={},debug:c=!1,createFramebuffer:u=!1,autoResizeViewport:h=!0,autoResizeDrawingBuffer:d=!0,stats:f=Ks.get("animation-loop-".concat(kc++))}=t;let{useDevicePixels:p=!0}=t;"useDevicePixelRatio"in t&&(Kr.deprecated("useDevicePixelRatio","useDevicePixels")(),p=t.useDevicePixelRatio),this.props={onCreateContext:e,onAddHTML:n,onInitialize:i,onRender:r,onFinalize:s,onError:o,gl:a,glOptions:l,debug:c,createFramebuffer:u},this.gl=a,this.needsRedraw=null,this.timeline=null,this.stats=f,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:h,autoResizeDrawingBuffer:d,useDevicePixels:p}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(t){return Xs("string"==typeof t),this.needsRedraw=this.needsRedraw||t,this}setProps(t){return"autoResizeViewport"in t&&(this.autoResizeViewport=t.autoResizeViewport),"autoResizeDrawingBuffer"in t&&(this.autoResizeDrawingBuffer=t.autoResizeDrawingBuffer),"useDevicePixels"in t&&(this.useDevicePixels=t.useDevicePixels),this}start(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._running)return this;this._running=!0;const e=this._getPageLoadPromise().then((()=>!this._running||this._initialized?null:(this._createWebGLContext(t),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=Rc.isSupported(this.gl,["timers"])?new Rc(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps)))).then((t=>{this._running&&(this._addCallbackData(t||{}),!1!==t&&this._startLoop())}));return this.props.onError&&e.catch(this.props.onError),this}redraw(){return this.isContextLost()||(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers()),this}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(t){return this.timeline=t,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise((t=>{this._resolveNextFrame=t}))),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const n=document.getElementById(t);return n?Number(n.value):e}setViewParameters(){return Kr.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const t=()=>{this._running&&(this.redraw(),this._animationFrameId=this._requestAnimationFrame(t))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(t)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=Fc?new Promise(((t,e)=>{Fc&&"complete"===document.readyState?t(document):window.addEventListener("load",(()=>{t(document)}))})):Promise.resolve({})),this._pageLoadPromise}_setDisplay(t){this.display&&(this.display.delete(),this.display.animationLoop=null),t&&(t.animationLoop=this),this.display=t}_cancelAnimationFrame(t){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(t):(e=t,"undefined"!=typeof window&&window.cancelAnimationFrame?window.cancelAnimationFrame(e):clearTimeout(e));var e}_requestAnimationFrame(t){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(t):(e=t,"undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame(e):setTimeout(e,1e3/60));var e}_renderFrame(){this.display?this.display._renderFrame(...arguments):this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:t,height:e,aspect:n}=this._getSizeAndAspect();t===this.animationProps.width&&e===this.animationProps.height||this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=t,this.animationProps.height=e,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(t){"object"==typeof t&&null!==t&&(this.animationProps=Object.assign({},this.animationProps,t))}_createWebGLContext(t){if(this.offScreen=t.canvas&&"undefined"!=typeof OffscreenCanvas&&t.canvas instanceof OffscreenCanvas,t=Object.assign({},t,this.props.glOptions),this.gl=this.props.gl?Gs(this.props.gl,t):this.onCreateContext(t),!Yr(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");Is(this.gl,fs),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const t=document.createElement("div");document.body.appendChild(t),t.style.position="relative";const e=document.createElement("div");e.style.position="absolute",e.style.left="10px",e.style.bottom="10px",e.style.width="300px",e.style.background="white",t.appendChild(this.gl.canvas),t.appendChild(e);const n=this.props.onAddHTML(e);n&&(e.innerHTML=n)}}_getSizeAndAspect(){const t=this.gl.drawingBufferWidth,e=this.gl.drawingBufferHeight;let n=1;const{canvas:i}=this.gl;return i&&i.clientHeight?n=i.clientWidth/i.clientHeight:t>0&&e>0&&(n=t/e),{width:t,height:e,aspect:n}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t.canvas)return void function(t,e,n){let i="width"in n?n.width:t.canvas.clientWidth,r="height"in n?n.height:t.canvas.clientHeight;i&&r||(Kr.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,i=t.canvas.width||1,r=t.canvas.height||1),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{};const s=t.luma.canvasSizeInfo;if(s.clientWidth!==i||s.clientHeight!==r||s.devicePixelRatio!==e){let n=e;const s=Math.floor(i*n),o=Math.floor(r*n);t.canvas.width=s,t.canvas.height=o,t.drawingBufferWidth===s&&t.drawingBufferHeight===o||(Kr.warn("Device pixel ratio clamped")(),n=Math.min(t.drawingBufferWidth/i,t.drawingBufferHeight/r),t.canvas.width=Math.floor(i*n),t.canvas.height=Math.floor(r*n)),Object.assign(t.luma.canvasSizeInfo,{clientWidth:i,clientHeight:r,devicePixelRatio:e})}}(t,function(t){const e="undefined"==typeof window?1:window.devicePixelRatio||1;return Number.isFinite(t)?t<=0?1:t:t?e:1}(e.useDevicePixels),e);const n=t.getExtension("STACKGL_resize_drawingbuffer");n&&"width"in e&&"height"in e&&n.resize(e.width,e.height)}(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new Ko(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:t}=this.gl;t&&(t.addEventListener("mousemove",this._onMousemove),t.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(t){this.animationProps._mousePosition=[t.offsetX,t.offsetY]}_onMouseleave(t){this.animationProps._mousePosition=null}}var Nc=o(797);const Uc={mousedown:1,mousemove:2,mouseup:4};!function(t){const e=t.prototype.handler;t.prototype.handler=function(t){const n=this.store;t.button>0&&"pointerdown"===t.type&&(function(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return!0;return!1}(n,(e=>e.pointerId===t.pointerId))||n.push(t)),e.call(this,t)}}(Nc.PointerEventInput),Nc.MouseInput.prototype.handler=function(t){let e=Uc[t.type];1&e&&t.button>=0&&(this.pressed=!0),2&e&&0===t.which&&(e=4),this.pressed&&(4&e&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))};const zc=Nc.Manager,Gc=Nc;class jc{constructor(t,e,n){this.element=t,this.callback=e,this.options={enable:!0,...n}}}const Vc=Gc?[[Gc.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[Gc.Rotate,{enable:!1}],[Gc.Pinch,{enable:!1}],[Gc.Swipe,{enable:!1}],[Gc.Pan,{threshold:0,enable:!1}],[Gc.Press,{enable:!1}],[Gc.Tap,{event:"doubletap",taps:2,enable:!1}],[Gc.Tap,{event:"anytap",enable:!1}],[Gc.Tap,{enable:!1}]]:null,Hc={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},Wc={doubletap:["tap"]},Jc={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},qc={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},Kc={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},Xc={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},Qc="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",Yc="undefined"!=typeof window?window:o.g;void 0!==o.g?o.g:window,"undefined"!=typeof document&&document;let Zc=!1;try{const t={get passive(){return Zc=!0,!0}};Yc.addEventListener("test",null,t),Yc.removeEventListener("test",null)}catch(t){Zc=!1}const $c=-1!==Qc.indexOf("firefox"),{WHEEL_EVENTS:tu}=qc,eu="wheel",nu=4.000244140625;class iu extends jc{constructor(t,e,n){super(t,e,n),this.handleEvent=t=>{if(!this.options.enable)return;let e=t.deltaY;Yc.WheelEvent&&($c&&t.deltaMode===Yc.WheelEvent.DOM_DELTA_PIXEL&&(e/=Yc.devicePixelRatio),t.deltaMode===Yc.WheelEvent.DOM_DELTA_LINE&&(e*=40)),0!==e&&e%nu==0&&(e=Math.floor(e/nu)),t.shiftKey&&e&&(e*=.25),this.callback({type:eu,center:{x:t.clientX,y:t.clientY},delta:-e,srcEvent:t,pointerType:"mouse",target:t.target})},this.events=(this.options.events||[]).concat(tu),this.events.forEach((e=>t.addEventListener(e,this.handleEvent,!!Zc&&{passive:!1})))}destroy(){this.events.forEach((t=>this.element.removeEventListener(t,this.handleEvent)))}enableEventType(t,e){t===eu&&(this.options.enable=e)}}const{MOUSE_EVENTS:ru}=qc,su="pointermove",ou="pointerover",au="pointerout",lu="pointerenter",cu="pointerleave";class uu extends jc{constructor(t,e,n){super(t,e,n),this.handleEvent=t=>{this.handleOverEvent(t),this.handleOutEvent(t),this.handleEnterEvent(t),this.handleLeaveEvent(t),this.handleMoveEvent(t)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,this.events=(this.options.events||[]).concat(ru),this.events.forEach((e=>t.addEventListener(e,this.handleEvent)))}destroy(){this.events.forEach((t=>this.element.removeEventListener(t,this.handleEvent)))}enableEventType(t,e){t===su&&(this.enableMoveEvent=e),t===ou&&(this.enableOverEvent=e),t===au&&(this.enableOutEvent=e),t===lu&&(this.enableEnterEvent=e),t===cu&&(this.enableLeaveEvent=e)}handleOverEvent(t){this.enableOverEvent&&"mouseover"===t.type&&this._emit(ou,t)}handleOutEvent(t){this.enableOutEvent&&"mouseout"===t.type&&this._emit(au,t)}handleEnterEvent(t){this.enableEnterEvent&&"mouseenter"===t.type&&this._emit(lu,t)}handleLeaveEvent(t){this.enableLeaveEvent&&"mouseleave"===t.type&&this._emit(cu,t)}handleMoveEvent(t){if(this.enableMoveEvent)switch(t.type){case"mousedown":t.button>=0&&(this.pressed=!0);break;case"mousemove":0===t.which&&(this.pressed=!1),this.pressed||this._emit(su,t);break;case"mouseup":this.pressed=!1}}_emit(t,e){this.callback({type:t,center:{x:e.clientX,y:e.clientY},srcEvent:e,pointerType:"mouse",target:e.target})}}const{KEY_EVENTS:hu}=qc,du="keydown",fu="keyup";class pu extends jc{constructor(t,e,n){super(t,e,n),this.handleEvent=t=>{const e=t.target||t.srcElement;"INPUT"===e.tagName&&"text"===e.type||"TEXTAREA"===e.tagName||(this.enableDownEvent&&"keydown"===t.type&&this.callback({type:du,srcEvent:t,key:t.key,target:t.target}),this.enableUpEvent&&"keyup"===t.type&&this.callback({type:fu,srcEvent:t,key:t.key,target:t.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(hu),t.tabIndex=this.options.tabIndex||0,t.style.outline="none",this.events.forEach((e=>t.addEventListener(e,this.handleEvent)))}destroy(){this.events.forEach((t=>this.element.removeEventListener(t,this.handleEvent)))}enableEventType(t,e){t===du&&(this.enableDownEvent=e),t===fu&&(this.enableUpEvent=e)}}const gu="contextmenu";class mu extends jc{constructor(t,e,n){super(t,e,n),this.handleEvent=t=>{this.options.enable&&this.callback({type:gu,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})},t.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(t,e){t===gu&&(this.options.enable=e)}}const vu={pointerdown:1,pointermove:2,pointerup:4,mousedown:1,mousemove:2,mouseup:4};function yu(t){const e=vu[t.srcEvent.type];if(!e)return null;const{buttons:n,button:i,which:r}=t.srcEvent;let s=!1,o=!1,a=!1;return 4===e||2===e&&!Number.isFinite(n)?(s=1===r,o=2===r,a=3===r):2===e?(s=Boolean(1&n),o=Boolean(4&n),a=Boolean(2&n)):1===e&&(s=0===i,o=1===i,a=2===i),{leftButton:s,middleButton:o,rightButton:a}}function bu(t,e){const n=t.center;if(!n)return null;const i=e.getBoundingClientRect(),r=i.width/e.offsetWidth||1,s=i.height/e.offsetHeight||1;return{center:n,offsetCenter:{x:(n.x-i.left-e.clientLeft)/r,y:(n.y-i.top-e.clientTop)/s}}}const _u={srcElement:"root",priority:0};class Au{constructor(t){this.handleEvent=t=>{if(this.isEmpty())return;const e=this._normalizeEvent(t);let n=t.srcEvent.target;for(;n&&n!==e.rootElement;){if(this._emit(e,n),e.handled)return;n=n.parentNode}this._emit(e,"root")},this.eventManager=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(t,e,n,i=!1,r=!1){const{handlers:s,handlersByElement:o}=this;let a=_u;"string"==typeof n||n&&n.addEventListener?a={..._u,srcElement:n}:n&&(a={..._u,...n});let l=o.get(a.srcElement);l||(l=[],o.set(a.srcElement,l));const c={type:t,handler:e,srcElement:a.srcElement,priority:a.priority};i&&(c.once=!0),r&&(c.passive=!0),s.push(c),this._active=this._active||!c.passive;let u=l.length-1;for(;u>=0&&!(l[u].priority>=c.priority);)u--;l.splice(u+1,0,c)}remove(t,e){const{handlers:n,handlersByElement:i}=this;for(let r=n.length-1;r>=0;r--){const s=n[r];if(s.type===t&&s.handler===e){n.splice(r,1);const t=i.get(s.srcElement);t.splice(t.indexOf(s),1),0===t.length&&i.delete(s.srcElement)}}this._active=n.some((t=>!t.passive))}_emit(t,e){const n=this.handlersByElement.get(e);if(n){let e=!1;const i=()=>{t.handled=!0},r=()=>{t.handled=!0,e=!0},s=[];for(let o=0;o<n.length;o++){const{type:a,handler:l,once:c}=n[o];if(l({...t,type:a,stopPropagation:i,stopImmediatePropagation:r}),c&&s.push(n[o]),e)break}for(let t=0;t<s.length;t++){const{type:e,handler:n}=s[t];this.remove(e,n)}}}_normalizeEvent(t){const e=this.eventManager.getElement();return{...t,...yu(t),...bu(t,e),preventDefault:()=>{t.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:e}}}const wu={events:null,recognizers:null,recognizerOptions:{},Manager:zc,touchAction:"none",tabIndex:0};class Cu{constructor(t=null,e){this._onBasicInput=t=>{const{srcEvent:e}=t,n=Jc[e.type];n&&this.manager.emit(n,t)},this._onOtherEvent=t=>{this.manager.emit(t.type,t)},this.options={...wu,...e},this.events=new Map,this.setElement(t);const{events:n}=this.options;n&&this.on(n)}getElement(){return this.element}setElement(t){if(this.element&&this.destroy(),this.element=t,!t)return;const{options:e}=this,n=e.Manager;this.manager=new n(t,{touchAction:e.touchAction,recognizers:e.recognizers||Vc}).on("hammer.input",this._onBasicInput),e.recognizers||Object.keys(Hc).forEach((t=>{const e=this.manager.get(t);e&&Hc[t].forEach((t=>{e.recognizeWith(t)}))}));for(const t in e.recognizerOptions){const n=this.manager.get(t);if(n){const i=e.recognizerOptions[t];delete i.enable,n.set(i)}}this.wheelInput=new iu(t,this._onOtherEvent,{enable:!1}),this.moveInput=new uu(t,this._onOtherEvent,{enable:!1}),this.keyInput=new pu(t,this._onOtherEvent,{enable:!1,tabIndex:e.tabIndex}),this.contextmenuInput=new mu(t,this._onOtherEvent,{enable:!1});for(const[t,e]of this.events)e.isEmpty()||(this._toggleRecognizer(e.recognizerName,!0),this.manager.on(t,e.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(t,e,n){this._addEventHandler(t,e,n,!1)}once(t,e,n){this._addEventHandler(t,e,n,!0)}watch(t,e,n){this._addEventHandler(t,e,n,!1,!0)}off(t,e){this._removeEventHandler(t,e)}_toggleRecognizer(t,e){const{manager:n}=this;if(!n)return;const i=n.get(t);if(i&&i.options.enable!==e){i.set({enable:e});const r=Wc[t];r&&!this.options.recognizers&&r.forEach((r=>{const s=n.get(r);e?(s.requireFailure(t),i.dropRequireFailure(r)):s.dropRequireFailure(t)}))}this.wheelInput.enableEventType(t,e),this.moveInput.enableEventType(t,e),this.keyInput.enableEventType(t,e),this.contextmenuInput.enableEventType(t,e)}_addEventHandler(t,e,n,i,r){if("string"!=typeof t){n=e;for(const e in t)this._addEventHandler(e,t[e],n,i,r);return}const{manager:s,events:o}=this,a=Xc[t]||t;let l=o.get(a);l||(l=new Au(this),o.set(a,l),l.recognizerName=Kc[a]||a,s&&s.on(a,l.handleEvent)),l.add(t,e,n,i,r),l.isEmpty()||this._toggleRecognizer(l.recognizerName,!0)}_removeEventHandler(t,e){if("string"!=typeof t){for(const e in t)this._removeEventHandler(e,t[e]);return}const{events:n}=this,i=Xc[t]||t,r=n.get(i);if(r&&(r.remove(t,e),r.isEmpty())){const{recognizerName:t}=r;let e=!1;for(const i of n.values())if(i.recognizerName===t&&!i.isEmpty()){e=!0;break}e||this._toggleRecognizer(t,!1)}}}function Eu(){}const xu={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:Eu,onResize:Eu,onViewStateChange:Eu,onInteractionStateChange:Eu,onBeforeRender:Eu,onAfterRender:Eu,onLoad:Eu,onError:t=>q.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:({isDragging:t})=>t?"grabbing":"grab",getTooltip:null,debug:!1,drawPickingColors:!1};class Tu{constructor(t){m(this,"props",void 0),m(this,"width",0),m(this,"height",0),m(this,"userData",{}),m(this,"canvas",null),m(this,"viewManager",null),m(this,"layerManager",null),m(this,"effectManager",null),m(this,"deckRenderer",null),m(this,"deckPicker",null),m(this,"eventManager",null),m(this,"tooltip",null),m(this,"metrics",void 0),m(this,"animationLoop",void 0),m(this,"stats",void 0),m(this,"viewState",void 0),m(this,"cursorState",void 0),m(this,"_needsRedraw",void 0),m(this,"_pickRequest",void 0),m(this,"_lastPointerDownInfo",null),m(this,"_metricsCounter",void 0),m(this,"_onPointerMove",(t=>{const{_pickRequest:e}=this;if("pointerleave"===t.type)e.x=-1,e.y=-1,e.radius=0;else{if(t.leftButton||t.rightButton)return;{const n=t.offsetCenter;if(!n)return;e.x=n.x,e.y=n.y,e.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:e.x,y:e.y}),e.event=t})),m(this,"_onEvent",(t=>{const e=Fi[t.type],n=t.offsetCenter;if(!e||!n||!this.layerManager)return;const i=this.layerManager.getLayers(),r=this.deckPicker.getLastPickedObject({x:n.x,y:n.y,layers:i,viewports:this.getViewports(n)},this._lastPointerDownInfo),{layer:s}=r,o=s&&(s[e.handler]||s.props[e.handler]),a=this.props[e.handler];let l=!1;o&&(l=o.call(s,r,t)),!l&&a&&a(r,t)})),m(this,"_onPointerDown",(t=>{const e=t.offsetCenter,n=this._pick("pickObject","pickObject Time",{x:e.x,y:e.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=n.result[0]||n.emptyInfo})),this.props={...xu,...t},t=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},t.viewState&&t.initialViewState&&q.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),"IE"===function(t){if(!S())return"Node";if(T(t))return"Electron";const e=("undefined"!=typeof navigator?navigator:{}).userAgent||"";if(e.indexOf("Edge")>-1)return"Edge";const n=-1!==e.indexOf("MSIE "),i=-1!==e.indexOf("Trident/");return n||i?"IE":Oc.chrome?"Chrome":Oc.safari?"Safari":Oc.mozInnerScreenX?"Firefox":"Unknown"}()&&q.warn("IE 11 is not supported")(),this.viewState=t.initialViewState,t.gl||"undefined"!=typeof document&&(this.canvas=this._createCanvas(t)),this.animationLoop=this._createAnimationLoop(t),this.stats=new nt({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(t),t._typedArrayManagerProps&&Qe.setOptions(t._typedArrayManagerProps),this.animationLoop.start()}finalize(){var t,e,n,i,r,s,o,a,l;null===(t=this.animationLoop)||void 0===t||t.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,null===(e=this.layerManager)||void 0===e||e.finalize(),this.layerManager=null,null===(n=this.viewManager)||void 0===n||n.finalize(),this.viewManager=null,null===(i=this.effectManager)||void 0===i||i.finalize(),this.effectManager=null,null===(r=this.deckRenderer)||void 0===r||r.finalize(),this.deckRenderer=null,null===(s=this.deckPicker)||void 0===s||s.finalize(),this.deckPicker=null,null===(o=this.eventManager)||void 0===o||o.destroy(),this.eventManager=null,null===(a=this.tooltip)||void 0===a||a.remove(),this.tooltip=null,this.props.canvas||this.props.gl||!this.canvas||(null===(l=this.canvas.parentElement)||void 0===l||l.removeChild(this.canvas),this.canvas=null)}setProps(t){this.stats.get("setProps Time").timeStart(),"onLayerHover"in t&&q.removed("onLayerHover","onHover")(),"onLayerClick"in t&&q.removed("onLayerClick","onClick")(),t.initialViewState&&!tl(this.props.initialViewState,t.initialViewState,3)&&(this.viewState=t.initialViewState),Object.assign(this.props,t),this._setCanvasSize(this.props);const e=Object.create(this.props);Object.assign(e,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(e),this.layerManager&&(this.viewManager.setProps(e),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(e),this.effectManager.setProps(e),this.deckRenderer.setProps(e),this.deckPicker.setProps(e)),this.stats.get("setProps Time").timeEnd()}needsRedraw(t={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);const n=this.viewManager.needsRedraw(t),i=this.layerManager.needsRedraw(t),r=this.effectManager.needsRedraw(t),s=this.deckRenderer.needsRedraw(t);return e=e||n||i||r||s,e}redraw(t){if(!this.layerManager)return;let e=this.needsRedraw({clearRedrawFlags:!0});e=t||e,e&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(e):this._drawLayers(e))}get isInitialized(){return null!==this.viewManager}getViews(){return sl(this.viewManager),this.viewManager.views}getViewports(t){return sl(this.viewManager),this.viewManager.getViewports(t)}getCanvas(){return this.canvas}pickObject(t){const e=this._pick("pickObject","pickObject Time",t).result;return e.length?e[0]:null}pickMultipleObjects(t){return t.depth=t.depth||10,this._pick("pickObject","pickMultipleObjects Time",t).result}pickObjects(t){return this._pick("pickObjects","pickObjects Time",t)}_addResources(t,e=!1){for(const n in t)this.layerManager.resourceManager.add({resourceId:n,data:t[n],forceUpdate:e})}_removeResources(t){for(const e of t)this.layerManager.resourceManager.remove(e)}_addDefaultEffect(t){this.effectManager.addDefaultEffect(t)}_pick(t,e,n){sl(this.deckPicker);const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(e).timeStart();const r=this.deckPicker[t]({layers:this.layerManager.getLayers(n),views:this.viewManager.getViews(),viewports:this.getViewports(n),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...n});return i.get(e).timeEnd(),r}_createCanvas(t){let e=t.canvas;return"string"==typeof e&&(e=document.getElementById(e),sl(e)),e||(e=document.createElement("canvas"),e.id=t.id||"deckgl-overlay",(t.parent||document.body).appendChild(e)),Object.assign(e.style,t.style),e}_setCanvasSize(t){if(!this.canvas)return;const{width:e,height:n}=t;if(e||0===e){const t=Number.isFinite(e)?"".concat(e,"px"):e;this.canvas.style.width=t}if(n||0===n){var i;const e=Number.isFinite(n)?"".concat(n,"px"):n;this.canvas.style.position=(null===(i=t.style)||void 0===i?void 0:i.position)||"absolute",this.canvas.style.height=e}}_updateCanvasSize(){var t,e;const{canvas:n}=this;if(!n)return;const i=null!==(t=n.clientWidth)&&void 0!==t?t:n.width,r=null!==(e=n.clientHeight)&&void 0!==e?e:n.height;var s,o;i===this.width&&r===this.height||(this.width=i,this.height=r,null===(s=this.viewManager)||void 0===s||s.setProps({width:i,height:r}),null===(o=this.layerManager)||void 0===o||o.activateViewport(this.getViewports()[0]),this.props.onResize({width:i,height:r}))}_createAnimationLoop(t){const{width:e,height:n,gl:i,glOptions:r,debug:s,onError:o,onBeforeRender:a,onAfterRender:l,useDevicePixels:c}=t;return new Dc({width:e,height:n,useDevicePixels:c,autoResizeDrawingBuffer:!i,autoResizeViewport:!1,gl:i,onCreateContext:t=>zs({...r,...t,canvas:this.canvas,debug:s,onContextLost:()=>this._onContextLost()}),onInitialize:t=>this._setGLContext(t.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:a,onAfterRender:l,onError:o})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let t=this.props.views||[new Pl({id:"default-view"})];return t=Array.isArray(t)?t:[t],t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:t}=this.props;this.animationLoop&&t&&t(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:t}=this;if(t.event){const{result:n,emptyInfo:i}=this._pick("pickObject","pickObject Time",t);this.cursorState.isHovering=n.length>0;let r=i,s=!1;for(const i of n){var e;r=i,s=(null===(e=i.layer)||void 0===e?void 0:e.onHover(i,t.event))||s}if(!s&&this.props.onHover&&this.props.onHover(r,t.event),this.props.getTooltip&&this.tooltip){const t=this.props.getTooltip(r);this.tooltip.setTooltip(t,r.x,r.y)}t.event=null}}_updateCursor(){const t=this.props.parent||this.canvas;t&&(t.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(t){if(this.layerManager)return;this.canvas||(this.canvas=t.canvas,Gs(t,{enable:!0,copyState:!0})),this.tooltip=new dc(this.canvas),Is(t,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(t);const e=new b;e.play(),this.animationLoop.attachTimeline(e),this.eventManager=new Cu(this.props.parent||t.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const t in Fi)this.eventManager.on(t,this._onEvent);this.viewManager=new el({timeline:e,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const n=this.viewManager.getViewports()[0];this.layerManager=new $a(t,{deck:this,stats:this.stats,viewport:n,timeline:e}),this.effectManager=new $l,this.deckRenderer=new rc(t),this.deckPicker=new uc(t),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(t,e){const{gl:n}=this.layerManager.context;Is(n,this.props.parameters),this.props.onBeforeRender({gl:n}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...e}),this.props.onAfterRender({gl:n})}_onRenderFrame(t){this._getFrameStats(),this._metricsCounter++%60==0&&(this._getMetrics(),this.stats.reset(),q.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(t){const e=this.props.onViewStateChange(t)||t.viewState;this.viewState&&(this.viewState={...this.viewState,[t.viewId]:e},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(t){this.cursorState.isDragging=t.isDragging||!1,this.props.onInteractionStateChange(t)}_getFrameStats(){const{stats:t}=this;t.get("frameRate").timeEnd(),t.get("frameRate").timeStart();const e=this.animationLoop.stats;t.get("GPU Time").addTime(e.get("GPU Time").lastTiming),t.get("CPU Time").addTime(e.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:t,stats:e}=this;t.fps=e.get("frameRate").getHz(),t.setPropsTime=e.get("setProps Time").time,t.updateAttributesTime=e.get("Update Attributes").time,t.framesRedrawn=e.get("Redraw Count").count,t.pickTime=e.get("pickObject Time").time+e.get("pickMultipleObjects Time").time+e.get("pickObjects Time").time,t.pickCount=e.get("Pick Count").count,t.gpuTime=e.get("GPU Time").time,t.cpuTime=e.get("CPU Time").time,t.gpuTimePerFrame=e.get("GPU Time").getAverageTime(),t.cpuTimePerFrame=e.get("CPU Time").getAverageTime();const n=Ks.get("Memory Usage");t.bufferMemory=n.get("Buffer Memory").count,t.textureMemory=n.get("Texture Memory").count,t.renderbufferMemory=n.get("Renderbuffer Memory").count,t.gpuMemory=n.get("GPU Memory").count}}m(Tu,"defaultProps",xu),m(Tu,"VERSION",Lc);const Su=512,Bu=Math.PI/180;function Pu({map:t,gl:e,deck:n}){if(t.__deck)return t.__deck;const i=null==n?void 0:n.props._customRender,r=null==n?void 0:n.props.onLoad,s=Lu({...null==n?void 0:n.props,_customRender:()=>{t.triggerRepaint(),null==i||i("")}});let o;return n&&n.props.gl!==e||(Object.assign(s,{gl:e,width:null,height:null,touchAction:"unset",viewState:Ou(t)}),null!=n&&n.isInitialized?Mu(n,t):s.onLoad=()=>{null==r||r(),Mu(o,t)}),n?(o=n,n.setProps(s),n.userData.isExternal=!0):(o=new Tu(s),t.on("remove",(()=>{Iu(t)}))),o.userData.mapboxLayers=new Set,t.__deck=o,t.on("render",(()=>{o.isInitialized&&function(t,e){const{mapboxLayers:n,isExternal:i}=t.userData;if(i){const i=Array.from(n,(t=>t.id)),r=Y(t.props.layers,Boolean).some((t=>t&&!i.includes(t.id)));let s=t.getViewports();const o=s.findIndex((t=>"mapbox"===t.id)),a=s.length>1||o<0;(r||a)&&(o>=0&&(s=s.slice(),s[o]=Ru(t,e,!1)),t._drawLayers("mapbox-repaint",{viewports:s,layerFilter:e=>(!t.props.layerFilter||t.props.layerFilter(e))&&("mapbox"!==e.viewport.id||!i.includes(e.layer.id)),clearCanvas:!1}))}t.userData.currentViewport=null}(o,t)})),o}function Mu(t,e){const n=()=>{t.isInitialized?function(t,e){t.setProps({viewState:Ou(e)}),t.needsRedraw({clearRedrawFlags:!0})}(t,e):e.off("move",n)};e.on("move",n)}function Iu(t){var e;null===(e=t.__deck)||void 0===e||e.finalize(),t.__deck=null}function Lu(t){return{...t,parameters:{depthMask:!0,depthTest:!0,blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthFunc:515,blendEquation:32774,...t.parameters},views:t.views||[new Pl({id:"mapbox"})]}}function Ou(t){var e;const{lng:n,lat:i}=t.getCenter(),r={longitude:(n+540)%360-180,latitude:i,zoom:t.getZoom(),bearing:t.getBearing(),pitch:t.getPitch(),padding:t.getPadding(),repeat:t.getRenderWorldCopies()};return null!==(e=t.getTerrain)&&void 0!==e&&e.call(t)&&function(t,e){if(t.getFreeCameraOptions){const{position:n}=t.getFreeCameraOptions();if(!n||void 0===n.z)return;const i=t.transform.height,{longitude:r,latitude:s,pitch:o}=e,a=n.x*Su,l=(1-n.y)*Su,c=n.z*Su,u=Ai([r,s]),h=a-u[0],d=l-u[1],f=Math.sqrt(h*h+d*d),p=o*Bu,g=1.5*i,m=p<.001?g*Math.cos(p)/c:g*Math.sin(p)/f;e.zoom=Math.log2(m);const v=c-g*Math.cos(p)/m;e.position=[0,0,v/Ci(s)]}else"number"==typeof t.transform.elevation&&(e.position=[0,0,t.transform.elevation])}(t,r),r}function Ru(t,e,n=!0){return new al({id:"mapbox",x:0,y:0,width:t.width,height:t.height,...Ou(e),nearZMultiplier:n?.02:.1,nearZ:e.transform._nearZ/e.transform.height,farZ:e.transform._farZ/e.transform.height})}function Fu(t){if(t.userData.isExternal)return;const e=[];t.userData.mapboxLayers.forEach((t=>{const n=new(0,t.props.type)(t.props);e.push(n)})),t.setProps({layers:e})}class ku{constructor(t){if(m(this,"id",void 0),m(this,"type",void 0),m(this,"renderingMode",void 0),m(this,"map",void 0),m(this,"deck",void 0),m(this,"props",void 0),!t.id)throw new Error("Layer must have an unique id");this.id=t.id,this.type="custom",this.renderingMode=t.renderingMode||"3d",this.map=null,this.deck=null,this.props=t}onAdd(t,e){var n;this.map=t,this.deck=Pu({map:t,gl:e,deck:this.props.deck}),(n=this.deck).userData.mapboxLayers.add(this),Fu(n)}onRemove(){var t;this.deck&&(this,(t=this.deck).userData.mapboxLayers.delete(this),Fu(t))}setProps(t){Object.assign(this.props,t,{id:this.id}),this.deck&&Fu(this.deck)}render(){!function(t,e,n){let{currentViewport:i}=t.userData,r=!1;i||(i=Ru(t,e,!0),t.userData.currentViewport=i,r=!0),t.isInitialized&&t._drawLayers("mapbox-repaint",{viewports:[i],layerFilter:({layer:t})=>n.id===t.id||t.props.operation.includes("terrain"),clearStack:r,clearCanvas:!1})}(this.deck,this.map,this)}}const Du="__UNDEFINED__";function Nu(t,e,n,i){if(!(t&&e&&t.style&&t.style._loaded))return;const r=Y(i,Boolean);if(n!==i){const e=Y(n,Boolean),i=new Set(e.map((t=>t.id)));for(const t of r)i.delete(t.id);for(const e of i)t.getLayer(e)&&t.removeLayer(e)}for(const n of r){const i=t.getLayer(n.id);i?i.implementation.setProps(n.props):t.addLayer(new ku({id:n.id,deck:e}),n.props.beforeId)}const s=t.style._order,o={};for(const t of r){let{beforeId:e}=t.props;e&&s.includes(e)||(e=Du),o[e]=o[e]||[],o[e].push(t.id)}for(const e in o){const n=o[e];let i=e===Du?s.length:s.indexOf(e),r=e===Du?void 0:e;for(let e=n.length-1;e>=0;e--){const o=n[e],a=s.indexOf(o);a!==i-1&&(t.moveLayer(o,r),a>i&&i++),i--,r=o}}}class Uu{constructor(t){m(this,"_props",void 0),m(this,"_deck",void 0),m(this,"_map",void 0),m(this,"_container",void 0),m(this,"_interleaved",void 0),m(this,"_lastMouseDownPoint",void 0),m(this,"_handleStyleChange",(()=>{Nu(this._map,this._deck,this._props.layers,this._props.layers)})),m(this,"_updateContainerSize",(()=>{if(this._map&&this._container){const{clientWidth:t,clientHeight:e}=this._map.getContainer();Object.assign(this._container.style,{width:"".concat(t,"px"),height:"".concat(e,"px")})}})),m(this,"_updateViewState",(()=>{const t=this._deck;t&&(t.setProps({viewState:Ou(this._map)}),t.isInitialized&&t.redraw())})),m(this,"_handleMouseEvent",(t=>{const e=this._deck;if(!e||!e.isInitialized)return;const n={type:t.type,offsetCenter:t.point,srcEvent:t},i=this._lastMouseDownPoint;switch(!t.point&&i&&(n.deltaX=t.originalEvent.clientX-i.clientX,n.deltaY=t.originalEvent.clientY-i.clientY,n.offsetCenter={x:i.x+n.deltaX,y:i.y+n.deltaY}),n.type){case"mousedown":e._onPointerDown(n),this._lastMouseDownPoint={...t.point,clientX:t.originalEvent.clientX,clientY:t.originalEvent.clientY};break;case"dragstart":n.type="panstart",e._onEvent(n);break;case"drag":n.type="panmove",e._onEvent(n);break;case"dragend":n.type="panend",e._onEvent(n);break;case"click":n.tapCount=1,e._onEvent(n);break;case"dblclick":n.type="click",n.tapCount=2,e._onEvent(n);break;case"mousemove":n.type="pointermove",e._onPointerMove(n);break;case"mouseout":n.type="pointerleave",e._onPointerMove(n);break;default:return}}));const{interleaved:e=!1,...n}=t;this._interleaved=e,this._props=n}setProps(t){this._interleaved&&t.layers&&Nu(this._map,this._deck,this._props.layers,t.layers),Object.assign(this._props,t),this._deck&&this._deck.setProps(this._interleaved?Lu(this._props):this._props)}onAdd(t){return this._map=t,this._interleaved?this._onAddInterleaved(t):this._onAddOverlaid(t)}_onAddOverlaid(t){const e=document.createElement("div");return Object.assign(e.style,{position:"absolute",left:0,top:0,pointerEvents:"none"}),this._container=e,this._deck=new Tu({...this._props,parent:e,viewState:Ou(t)}),t.on("resize",this._updateContainerSize),t.on("render",this._updateViewState),t.on("mousedown",this._handleMouseEvent),t.on("dragstart",this._handleMouseEvent),t.on("drag",this._handleMouseEvent),t.on("dragend",this._handleMouseEvent),t.on("mousemove",this._handleMouseEvent),t.on("mouseout",this._handleMouseEvent),t.on("click",this._handleMouseEvent),t.on("dblclick",this._handleMouseEvent),this._updateContainerSize(),e}_onAddInterleaved(t){return this._deck=Pu({map:t,gl:t.painter.context.gl,deck:new Tu({...this._props,gl:t.painter.context.gl})}),t.on("styledata",this._handleStyleChange),Nu(t,this._deck,[],this._props.layers),document.createElement("div")}onRemove(){const t=this._map;t&&(this._interleaved?this._onRemoveInterleaved(t):this._onRemoveOverlaid(t)),this._deck=void 0,this._map=void 0,this._container=void 0}_onRemoveOverlaid(t){var e;t.off("resize",this._updateContainerSize),t.off("render",this._updateViewState),t.off("mousedown",this._handleMouseEvent),t.off("dragstart",this._handleMouseEvent),t.off("drag",this._handleMouseEvent),t.off("dragend",this._handleMouseEvent),t.off("mousemove",this._handleMouseEvent),t.off("mouseout",this._handleMouseEvent),t.off("click",this._handleMouseEvent),t.off("dblclick",this._handleMouseEvent),null===(e=this._deck)||void 0===e||e.finalize()}_onRemoveInterleaved(t){t.off("styledata",this._handleStyleChange),Nu(t,this._deck,this._props.layers,[]),Iu(t)}getDefaultPosition(){return"top-left"}pickObject(t){return sl(this._deck),this._deck.pickObject(t)}pickMultipleObjects(t){return sl(this._deck),this._deck.pickMultipleObjects(t)}pickObjects(t){return sl(this._deck),this._deck.pickObjects(t)}finalize(){this._map&&this._map.removeControl(this)}getCanvas(){return this._map?this._interleaved?this._map.getCanvas():this._deck.getCanvas():null}}const zu=h.createContext(null);function Gu(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!Gu(t[n],e[n]))return!1;return!0}if(Array.isArray(e))return!1;if("object"==typeof t&&"object"==typeof e){const n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(const i of n){if(!e.hasOwnProperty(i))return!1;if(!Gu(t[i],e[i]))return!1}return!0}return!1}function ju(t,e){if(!t.getProjection)return;const n=t.getProjection();Gu(n,e.getProjection())||e.setProjection(n)}function Vu(t){return{longitude:t.center.lng,latitude:t.center.lat,zoom:t.zoom,pitch:t.pitch,bearing:t.bearing,padding:t.padding}}function Hu(t,e){const n=e.viewState||e;let i=!1;if("longitude"in n&&"latitude"in n){const e=t.center;t.center=new e.constructor(n.longitude,n.latitude),i=i||e!==t.center}if("zoom"in n){const e=t.zoom;t.zoom=n.zoom,i=i||e!==t.zoom}if("bearing"in n){const e=t.bearing;t.bearing=n.bearing,i=i||e!==t.bearing}if("pitch"in n){const e=t.pitch;t.pitch=n.pitch,i=i||e!==t.pitch}return n.padding&&!t.isPaddingEqual(n.padding)&&(i=!0,t.padding=n.padding),i}const Wu=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ju(t){if(!t)return null;if("string"==typeof t)return t;if("toJS"in t&&(t=t.toJS()),!t.layers)return t;const e={};for(const n of t.layers)e[n.id]=n;const n=t.layers.map((t=>{let n=null;"interactive"in t&&(n=Object.assign({},t),delete n.interactive);const i=e[t.ref];if(i){n=n||Object.assign({},t),delete n.ref;for(const t of Wu)t in i&&(n[t]=i[t])}return n||t}));return{...t,layers:n}}const qu={version:8,sources:{},layers:[]},Ku={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},Xu={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},Qu={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},Yu=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],Zu=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class $u{constructor(t,e,n){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=t=>{const e=this.props[Qu[t.type]];e?e(t):"error"===t.type&&console.error(t.error)},this._onPointerEvent=t=>{"mousemove"!==t.type&&"mouseout"!==t.type||this._updateHover(t);const e=this.props[Ku[t.type]];e&&(this.props.interactiveLayerIds&&"mouseover"!==t.type&&"mouseout"!==t.type&&(t.features=this._hoveredFeatures||this._queryRenderedFeatures(t.point)),e(t),delete t.features)},this._onCameraEvent=t=>{if(!this._internalUpdate){const e=this.props[Xu[t.type]];e&&e(t)}t.type in this._deferredEvents&&(this._deferredEvents[t.type]=!1)},this._MapClass=t,this.props=e,this._initialize(n)}get map(){return this._map}get transform(){return this._renderTransform}setProps(t){const e=this.props;this.props=t;const n=this._updateSettings(t,e);n&&this._createShadowTransform(this._map);const i=this._updateSize(t),r=this._updateViewState(t,!0);this._updateStyle(t,e),this._updateStyleComponents(t,e),this._updateHandlers(t,e),(n||i||r&&!this._map.isMoving())&&this.redraw()}static reuse(t,e){const n=$u.savedMaps.pop();if(!n)return null;const i=n.map,r=i.getContainer();for(e.className=r.className;r.childNodes.length>0;)e.appendChild(r.childNodes[0]);i._container=e;const s=i._resizeObserver;s&&(s.disconnect(),s.observe(e)),n.setProps({...t,styleDiffing:!1}),i.resize();const{initialViewState:o}=t;return o&&(o.bounds?i.fitBounds(o.bounds,{...o.fitBoundsOptions,duration:0}):n._updateViewState(o,!1)),i.isStyleLoaded()?i.fire("load"):i.once("styledata",(()=>i.fire("load"))),i._update(),n}_initialize(t){const{props:e}=this,{mapStyle:n=qu}=e,i={...e,...e.initialViewState,accessToken:e.mapboxAccessToken||th()||null,container:t,style:Ju(n)},r=i.initialViewState||i.viewState||i;if(Object.assign(i,{center:[r.longitude||0,r.latitude||0],zoom:r.zoom||0,pitch:r.pitch||0,bearing:r.bearing||0}),e.gl){const t=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=t,e.gl)}const s=new this._MapClass(i);r.padding&&s.setPadding(r.padding),e.cursor&&(s.getCanvas().style.cursor=e.cursor),this._createShadowTransform(s);const o=s._render;s._render=t=>{this._inRender=!0,o.call(s,t),this._inRender=!1};const a=s._renderTaskQueue.run;s._renderTaskQueue.run=t=>{a.call(s._renderTaskQueue,t),this._onBeforeRepaint()},s.on("render",(()=>this._onAfterRepaint()));const l=s.fire;s.fire=this._fireEvent.bind(this,l),s.on("resize",(()=>{this._renderTransform.resize(s.transform.width,s.transform.height)})),s.on("styledata",(()=>{this._updateStyleComponents(this.props,{}),ju(s.transform,this._renderTransform)})),s.on("sourcedata",(()=>this._updateStyleComponents(this.props,{})));for(const t in Ku)s.on(t,this._onPointerEvent);for(const t in Xu)s.on(t,this._onCameraEvent);for(const t in Qu)s.on(t,this._onEvent);this._map=s}recycle(){const t=this.map.getContainer().querySelector("[mapboxgl-children]");null==t||t.remove(),$u.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const t=this._map;!this._inRender&&t.style&&(t._frame&&(t._frame.cancel(),t._frame=null),t._render())}_createShadowTransform(t){const e=function(t){const e=t.clone();return e.pixelsToGLUnits=t.pixelsToGLUnits,e}(t.transform);t.painter.transform=e,this._renderTransform=e}_updateSize(t){const{viewState:e}=t;if(e){const t=this._map;if(e.width!==t.transform.width||e.height!==t.transform.height)return t.resize(),!0}return!1}_updateViewState(t,e){if(this._internalUpdate)return!1;const n=this._map,i=this._renderTransform,{zoom:r,pitch:s,bearing:o}=i,a=n.isMoving();a&&(i.cameraElevationReference="sea");const l=Hu(i,{...Vu(n.transform),...t});if(a&&(i.cameraElevationReference="ground"),l&&e){const t=this._deferredEvents;t.move=!0,t.zoom||(t.zoom=r!==i.zoom),t.rotate||(t.rotate=o!==i.bearing),t.pitch||(t.pitch=s!==i.pitch)}return a||Hu(n.transform,t),l}_updateSettings(t,e){const n=this._map;let i=!1;for(const r of Yu)if(r in t&&!Gu(t[r],e[r])){i=!0;const e=n[`set${r[0].toUpperCase()}${r.slice(1)}`];null==e||e.call(n,t[r])}return i}_updateStyle(t,e){if(t.cursor!==e.cursor&&(this._map.getCanvas().style.cursor=t.cursor||""),t.mapStyle!==e.mapStyle){const{mapStyle:e=qu,styleDiffing:n=!0}=t,i={diff:n};return"localIdeographFontFamily"in t&&(i.localIdeographFontFamily=t.localIdeographFontFamily),this._map.setStyle(Ju(e),i),!0}return!1}_updateStyleComponents(t,e){const n=this._map;let i=!1;return n.isStyleLoaded()&&("light"in t&&n.setLight&&!Gu(t.light,e.light)&&(i=!0,n.setLight(t.light)),"fog"in t&&n.setFog&&!Gu(t.fog,e.fog)&&(i=!0,n.setFog(t.fog)),"terrain"in t&&n.setTerrain&&!Gu(t.terrain,e.terrain)&&(t.terrain&&!n.getSource(t.terrain.source)||(i=!0,n.setTerrain(t.terrain)))),i}_updateHandlers(t,e){var n,i;const r=this._map;let s=!1;for(const o of Zu){const a=null===(n=t[o])||void 0===n||n;Gu(a,null===(i=e[o])||void 0===i||i)||(s=!0,a?r[o].enable(a):r[o].disable())}return s}_queryRenderedFeatures(t){const e=this._map,n=e.transform,{interactiveLayerIds:i=[]}=this.props;try{return e.transform=this._renderTransform,e.queryRenderedFeatures(t,{layers:i.filter(e.getLayer.bind(e))})}catch(t){return[]}finally{e.transform=n}}_updateHover(t){var e;const{props:n}=this;if(n.interactiveLayerIds&&(n.onMouseMove||n.onMouseEnter||n.onMouseLeave)){const n=t.type,i=(null===(e=this._hoveredFeatures)||void 0===e?void 0:e.length)>0,r=this._queryRenderedFeatures(t.point),s=r.length>0;!s&&i&&(t.type="mouseleave",this._onPointerEvent(t)),this._hoveredFeatures=r,s&&!i&&(t.type="mouseenter",this._onPointerEvent(t)),t.type=n}else this._hoveredFeatures=null}_fireEvent(t,e,n){const i=this._map,r=i.transform,s="string"==typeof e?e:e.type;return"move"===s&&this._updateViewState(this.props,!1),s in Xu&&("object"==typeof e&&(e.viewState=Vu(r)),this._map.isMoving())?(i.transform=this._renderTransform,t.call(i,e,n),i.transform=r,i):(t.call(i,e,n),i)}_onBeforeRepaint(){const t=this._map;this._internalUpdate=!0;for(const e in this._deferredEvents)this._deferredEvents[e]&&t.fire(e);this._internalUpdate=!1;const e=this._map.transform;t.transform=this._renderTransform,this._onAfterRepaint=()=>{ju(this._renderTransform,e),t.transform=e}}}function th(){let t=null;if("undefined"!=typeof location){const e=/access_token=([^&\/]*)/.exec(location.search);t=e&&e[1]}try{t=t||"MISSING_ENV_VAR".MapboxAccessToken}catch(t){}try{t=t||"MISSING_ENV_VAR".REACT_APP_MAPBOX_ACCESS_TOKEN}catch(t){}return t}$u.savedMaps=[];const eh=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];const nh="undefined"!=typeof document?h.useLayoutEffect:h.useEffect,ih=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"],rh=h.createContext(null);function sh(t,e,n){const i=(0,h.useContext)(zu),[r,s]=(0,h.useState)(null),o=(0,h.useRef)(),{current:a}=(0,h.useRef)({mapLib:null,map:null});(0,h.useEffect)((()=>{const e=t.mapLib;let r,l=!0;return Promise.resolve(e||n).then((e=>{if(!l)return;if(!e)throw new Error("Invalid mapLib");const n="Map"in e?e:e.default;if(!n.Map)throw new Error("Invalid mapLib");if(function(t,e){for(const n of ih)n in e&&(t[n]=e[n]);const{RTLTextPlugin:n="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=e;n&&t.getRTLTextPluginStatus&&"unavailable"===t.getRTLTextPluginStatus()&&t.setRTLTextPlugin(n,(t=>{t&&console.error(t)}),!1)}(n,t),n.supported&&!n.supported(t))throw new Error("Map is not supported by this browser");t.reuseMaps&&(r=$u.reuse(t,o.current)),r||(r=new $u(n.Map,t,o.current)),a.map=function(t){if(!t)return null;const e=t.map,n={getMap:()=>e,getCenter:()=>t.transform.center,getZoom:()=>t.transform.zoom,getBearing:()=>t.transform.bearing,getPitch:()=>t.transform.pitch,getPadding:()=>t.transform.padding,getBounds:()=>t.transform.getBounds(),project:n=>{const i=e.transform;e.transform=t.transform;const r=e.project(n);return e.transform=i,r},unproject:n=>{const i=e.transform;e.transform=t.transform;const r=e.unproject(n);return e.transform=i,r},queryTerrainElevation:(n,i)=>{const r=e.transform;e.transform=t.transform;const s=e.queryTerrainElevation(n,i);return e.transform=r,s},queryRenderedFeatures:(n,i)=>{const r=e.transform;e.transform=t.transform;const s=e.queryRenderedFeatures(n,i);return e.transform=r,s}};for(const t of function(t){const e=new Set;let n=t;for(;n;){for(const i of Object.getOwnPropertyNames(n))"_"!==i[0]&&"function"==typeof t[i]&&"fire"!==i&&"setEventedParent"!==i&&e.add(i);n=Object.getPrototypeOf(n)}return Array.from(e)}(e))t in n||eh.includes(t)||(n[t]=e[t].bind(e));return n}(r),a.mapLib=n,s(r),null==i||i.onMapMount(a.map,t.id)})).catch((e=>{const{onError:n}=t;n?n({type:"error",target:null,originalEvent:null,error:e}):console.error(e)})),()=>{l=!1,r&&(null==i||i.onMapUnmount(t.id),t.reuseMaps?r.recycle():r.destroy())}}),[]),nh((()=>{r&&r.setProps(t)})),(0,h.useImperativeHandle)(e,(()=>a.map),[r]);const l=(0,h.useMemo)((()=>({position:"relative",width:"100%",height:"100%",...t.style})),[t.style]);return h.createElement("div",{id:t.id,ref:o,style:l},r&&h.createElement(rh.Provider,{value:a},h.createElement("div",{"mapboxgl-children":"",style:{height:"100%"}},t.children)))}var oh=o(935);const ah=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function lh(t,e){if(!t||!e)return;const n=t.style;for(const t in e){const i=e[t];Number.isFinite(i)&&!ah.test(t)?n[t]=`${i}px`:n[t]=i}}function ch(t){return new Set(t?t.trim().split(/\s+/):[])}(0,h.memo)((0,h.forwardRef)((function(t,e){const{map:n,mapLib:i}=(0,h.useContext)(rh),r=(0,h.useRef)({props:t});r.current.props=t;const s=(0,h.useMemo)((()=>{let e=!1;h.Children.forEach(t.children,(t=>{t&&(e=!0)}));const n={...t,element:e?document.createElement("div"):null},o=new i.Marker(n);return o.setLngLat([t.longitude,t.latitude]),o.getElement().addEventListener("click",(t=>{var e,n;null===(n=(e=r.current.props).onClick)||void 0===n||n.call(e,{type:"click",target:o,originalEvent:t})})),o.on("dragstart",(t=>{var e,n;const i=t;i.lngLat=s.getLngLat(),null===(n=(e=r.current.props).onDragStart)||void 0===n||n.call(e,i)})),o.on("drag",(t=>{var e,n;const i=t;i.lngLat=s.getLngLat(),null===(n=(e=r.current.props).onDrag)||void 0===n||n.call(e,i)})),o.on("dragend",(t=>{var e,n;const i=t;i.lngLat=s.getLngLat(),null===(n=(e=r.current.props).onDragEnd)||void 0===n||n.call(e,i)})),o}),[]);(0,h.useEffect)((()=>(s.addTo(n.getMap()),()=>{s.remove()})),[]);const{longitude:o,latitude:a,offset:l,style:c,draggable:u=!1,popup:d=null,rotation:f=0,rotationAlignment:p="auto",pitchAlignment:g="auto"}=t;return(0,h.useEffect)((()=>{lh(s.getElement(),c)}),[c]),(0,h.useImperativeHandle)(e,(()=>s),[]),s.getLngLat().lng===o&&s.getLngLat().lat===a||s.setLngLat([o,a]),l&&!function(t,e){const n=Array.isArray(t)?t[0]:t?t.x:0,i=Array.isArray(t)?t[1]:t?t.y:0,r=Array.isArray(e)?e[0]:e?e.x:0,s=Array.isArray(e)?e[1]:e?e.y:0;return n===r&&i===s}(s.getOffset(),l)&&s.setOffset(l),s.isDraggable()!==u&&s.setDraggable(u),s.getRotation()!==f&&s.setRotation(f),s.getRotationAlignment()!==p&&s.setRotationAlignment(p),s.getPitchAlignment()!==g&&s.setPitchAlignment(g),s.getPopup()!==d&&s.setPopup(d),(0,oh.createPortal)(t.children,s.getElement())}))),(0,h.memo)((0,h.forwardRef)((function(t,e){const{map:n,mapLib:i}=(0,h.useContext)(rh),r=(0,h.useMemo)((()=>document.createElement("div")),[]),s=(0,h.useRef)({props:t});s.current.props=t;const o=(0,h.useMemo)((()=>{const e={...t},n=new i.Popup(e);return n.setLngLat([t.longitude,t.latitude]),n.once("open",(t=>{var e,n;null===(n=(e=s.current.props).onOpen)||void 0===n||n.call(e,t)})),n}),[]);if((0,h.useEffect)((()=>{const t=t=>{var e,n;null===(n=(e=s.current.props).onClose)||void 0===n||n.call(e,t)};return o.on("close",t),o.setDOMContent(r).addTo(n.getMap()),()=>{o.off("close",t),o.isOpen()&&o.remove()}}),[]),(0,h.useEffect)((()=>{lh(o.getElement(),t.style)}),[t.style]),(0,h.useImperativeHandle)(e,(()=>o),[]),o.isOpen()&&(o.getLngLat().lng===t.longitude&&o.getLngLat().lat===t.latitude||o.setLngLat([t.longitude,t.latitude]),t.offset&&!Gu(o.options.offset,t.offset)&&o.setOffset(t.offset),o.options.anchor===t.anchor&&o.options.maxWidth===t.maxWidth||(o.options.anchor=t.anchor,o.setMaxWidth(t.maxWidth)),o.options.className!==t.className)){const e=ch(o.options.className),n=ch(t.className);for(const t of e)n.has(t)||o.removeClassName(t);for(const t of n)e.has(t)||o.addClassName(t);o.options.className=t.className}return(0,oh.createPortal)(t.children,r)})));const uh=function(t,e,n,i){const r=(0,h.useContext)(rh),s=(0,h.useMemo)((()=>t(r)),[]);return(0,h.useEffect)((()=>{const t=i||n||e,o="function"==typeof e&&"function"==typeof n?e:null,a="function"==typeof n?n:"function"==typeof e?e:null,{map:l}=r;return l.hasControl(s)||(l.addControl(s,null==t?void 0:t.position),o&&o(r)),()=>{a&&a(r),l.hasControl(s)&&l.removeControl(s)}}),[]),s};(0,h.memo)((function(t){const e=uh((({mapLib:e})=>new e.AttributionControl(t)),{position:t.position});return(0,h.useEffect)((()=>{lh(e._container,t.style)}),[t.style]),null})),(0,h.memo)((function(t){const e=uh((({mapLib:e})=>new e.FullscreenControl({container:t.containerId&&document.getElementById(t.containerId)})),{position:t.position});return(0,h.useEffect)((()=>{lh(e._controlContainer,t.style)}),[t.style]),null})),(0,h.memo)((0,h.forwardRef)((function(t,e){const n=(0,h.useRef)({props:t}),i=uh((({mapLib:e})=>{const i=new e.GeolocateControl(t),r=i._setupUI;return i._setupUI=t=>{i._container.hasChildNodes()||r(t)},i.on("geolocate",(t=>{var e,i;null===(i=(e=n.current.props).onGeolocate)||void 0===i||i.call(e,t)})),i.on("error",(t=>{var e,i;null===(i=(e=n.current.props).onError)||void 0===i||i.call(e,t)})),i.on("outofmaxbounds",(t=>{var e,i;null===(i=(e=n.current.props).onOutOfMaxBounds)||void 0===i||i.call(e,t)})),i.on("trackuserlocationstart",(t=>{var e,i;null===(i=(e=n.current.props).onTrackUserLocationStart)||void 0===i||i.call(e,t)})),i.on("trackuserlocationend",(t=>{var e,i;null===(i=(e=n.current.props).onTrackUserLocationEnd)||void 0===i||i.call(e,t)})),i}),{position:t.position});return n.current.props=t,(0,h.useImperativeHandle)(e,(()=>i),[]),(0,h.useEffect)((()=>{lh(i._container,t.style)}),[t.style]),null}))),(0,h.memo)((function(t){const e=uh((({mapLib:e})=>new e.NavigationControl(t)),{position:t.position});return(0,h.useEffect)((()=>{lh(e._container,t.style)}),[t.style]),null})),(0,h.memo)((function(t){const e=uh((({mapLib:e})=>new e.ScaleControl(t)),{position:t.position}),n=(0,h.useRef)(t),i=n.current;n.current=t;const{style:r}=t;return void 0!==t.maxWidth&&t.maxWidth!==i.maxWidth&&(e.options.maxWidth=t.maxWidth),void 0!==t.unit&&t.unit!==i.unit&&e.setUnit(t.unit),(0,h.useEffect)((()=>{lh(e._container,r)}),[r]),null}));const hh=o.e(158).then(o.t.bind(o,158,23)),dh=h.forwardRef((function(t,e){return sh(t,e,hh)})),fh=Math.PI/180,ph=864e5,gh=2440588,mh=2451545,vh=23.4397*fh,yh=357.5291,bh=.98560028,_h=280.147,Ah=360.9856235;function wh(t,e,n){const{azimuth:i,altitude:r}=function(t,e,n){const i=fh*-n,r=fh*e,s=function(t){return function(t){return("number"==typeof t?t:t.getTime())/ph-.5+gh}(t)-mh}(t),o=function(t){const e=function(t){const e=t;return e+fh*(1.9148*Math.sin(e)+.02*Math.sin(2*e)+3e-4*Math.sin(3*e))+102.9372*fh+Math.PI}(fh*(yh+bh*t));return{declination:Eh(e,0),rightAscension:Ch(e,0)}}(s),a=function(t,e){return fh*(_h+Ah*t)-e}(s,i)-o.rightAscension;return{azimuth:xh(a,r,o.declination),altitude:Th(a,r,o.declination)}}(t,e,n);return[Math.sin(i)*Math.cos(r),Math.cos(i)*Math.cos(r),-Math.sin(r)]}function Ch(t,e){const n=t;return Math.atan2(Math.sin(n)*Math.cos(vh)-Math.tan(e)*Math.sin(vh),Math.cos(n))}function Eh(t,e){const n=t;return Math.asin(Math.sin(e)*Math.cos(vh)+Math.cos(e)*Math.sin(vh)*Math.sin(n))}function xh(t,e,n){const i=t,r=e,s=n;return Math.atan2(Math.sin(i),Math.cos(i)*Math.sin(r)-Math.tan(s)*Math.cos(r))}function Th(t,e,n){const i=t,r=e,s=n;return Math.asin(Math.sin(r)*Math.sin(s)+Math.cos(r)*Math.cos(s)*Math.cos(i))}class Sh{constructor(t,e){m(this,"opts",void 0),m(this,"source",void 0),this.opts=e,this.source=t}get value(){return this.source.value}getValue(){const t=this.source.getBuffer(),e=this.getAccessor();if(t)return[t,e];const{value:n}=this.source,{size:i}=e;let r=n;if(n&&n.length!==i){r=new Float32Array(i);const t=e.elementOffset||0;for(let e=0;e<i;++e)r[e]=n[t+e]}return r}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function Bh(t){return t.stride||t.size*t.bytesPerElement}function Ph(t,e){e.offset&&q.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=Bh(t),i=(void 0!==e.vertexOffset?e.vertexOffset:t.vertexOffset||0)*n+(e.elementOffset||0)*t.bytesPerElement+(t.offset||0);return{...e,offset:i,stride:n}}class Mh{constructor(t,e,n){m(this,"gl",void 0),m(this,"id",void 0),m(this,"size",void 0),m(this,"settings",void 0),m(this,"value",void 0),m(this,"doublePrecision",void 0),m(this,"_buffer",void 0),m(this,"state",void 0),this.gl=t,this.id=e.id||"",this.size=e.size||1;const i=e.logicalType||e.type,r=5130===i;let s,{defaultValue:o}=e;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0),s=r?5126:!i&&e.isIndexed?t&&Ho(t,Uo)?5125:5123:i||5126;let a=function(t){switch(t){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}(i||s||5126);this.doublePrecision=r,r&&!1===e.fp64&&(a=Float32Array),this.value=null,this.settings={...e,defaultType:a,defaultValue:o,logicalType:i,type:s,size:this.size,bytesPerElement:a.BYTES_PER_ELEMENT},this.state={...n,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:t,type:e}=this.settings;this._buffer=new vo(this.gl,{id:this.id,target:t?34963:34962,accessor:{type:e}})}return this._buffer}get byteOffset(){const t=this.getAccessor();return t.vertexOffset?t.vertexOffset*Bh(t):0}get numInstances(){return this.state.numInstances}set numInstances(t){this.state.numInstances=t}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Qe.release(this.state.allocatedValue)}getShaderAttributes(t,e){if(this.doublePrecision){const n={},i=this.value instanceof Float64Array,r=function(t,e){const n=Ph(t,e);return{high:n,low:{...n,offset:n.offset+4*t.size}}}(this.getAccessor(),e||{});return n[t]=new Sh(this,r.high),n["".concat(t,"64Low")]=i?new Sh(this,r.low):new Float32Array(this.size),n}if(e){const n=Ph(this.getAccessor(),e);return{[t]:new Sh(this,n)}}return{[t]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let t=null;if(this.state.constant&&this.value){const e=Array.from(this.value);t=[e,e]}else{const{value:e,numInstances:n,size:i}=this,r=n*i;if(e&&r&&e.length>=r){const n=new Array(i).fill(1/0),s=new Array(i).fill(-1/0);for(let t=0;t<r;)for(let r=0;r<i;r++){const i=e[t++];i<n[r]&&(n[r]=i),i>s[r]&&(s[r]=i)}t=[n,s]}}return this.state.bounds=t,t}setData(t){const{state:e}=this;let n;n=ArrayBuffer.isView(t)?{value:t}:t instanceof vo?{buffer:t}:t;const i={...this.settings,...n};if(e.bufferAccessor=i,e.bounds=null,n.constant){let t=n.value;if(t=this._normalizeValue(t,[],0),this.settings.normalized&&(t=this.normalizeConstant(t)),e.constant&&this._areValuesEqual(t,this.value))return!1;e.externalBuffer=null,e.constant=!0,this.value=t}else if(n.buffer){const t=n.buffer;e.externalBuffer=t,e.constant=!1,this.value=n.value||null;const r=n.value instanceof Float64Array;i.type=n.type||t.accessor.type,i.bytesPerElement=t.accessor.BYTES_PER_ELEMENT*(r?2:1),i.stride=Bh(i)}else if(n.value){this._checkExternalBuffer(n);let t=n.value;e.externalBuffer=null,e.constant=!1,this.value=t,i.bytesPerElement=t.BYTES_PER_ELEMENT,i.stride=Bh(i);const{buffer:r,byteOffset:s}=this;this.doublePrecision&&t instanceof Float64Array&&(t=kn(t,i));const o=t.byteLength+s+2*i.stride;r.byteLength<o&&r.reallocate(o),r.setAccessor(null),r.subData({data:t,offset:s}),i.type=n.type||r.accessor.type}return!0}updateSubBuffer(t={}){this.state.bounds=null;const e=this.value,{startOffset:n=0,endOffset:i}=t;this.buffer.subData({data:this.doublePrecision&&e instanceof Float64Array?kn(e,{size:this.size,startIndex:n,endIndex:i}):e.subarray(n,i),offset:n*e.BYTES_PER_ELEMENT+this.byteOffset})}allocate(t,e=!1){const{state:n}=this,i=n.allocatedValue,r=Qe.allocate(i,t+1,{size:this.size,type:this.settings.defaultType,copy:e});this.value=r;const{buffer:s,byteOffset:o}=this;return s.byteLength<r.byteLength+o&&(s.reallocate(r.byteLength+o),e&&i&&s.subData({data:i instanceof Float64Array?kn(i,this):i,offset:o})),n.allocatedValue=r,n.constant=!1,n.externalBuffer=null,n.bufferAccessor=this.settings,!0}_checkExternalBuffer(t){const{value:e}=t;if(!ArrayBuffer.isView(e))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const n=this.settings.defaultType;let i=!1;if(this.doublePrecision&&(i=e.BYTES_PER_ELEMENT<4),i)throw new Error("Attribute ".concat(this.id," does not support ").concat(e.constructor.name));e instanceof n||!this.settings.normalized||"normalized"in t||q.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(t){switch(this.settings.type){case 5120:return new Float32Array(t).map((t=>(t+128)/255*2-1));case 5122:return new Float32Array(t).map((t=>(t+32768)/65535*2-1));case 5121:return new Float32Array(t).map((t=>t/255));case 5123:return new Float32Array(t).map((t=>t/65535));default:return t}}_normalizeValue(t,e,n){const{defaultValue:i,size:r}=this.settings;if(Number.isFinite(t))return e[n]=t,e;if(!t){let t=r;for(;--t>=0;)e[n+t]=i[t];return e}switch(r){case 4:e[n+3]=Number.isFinite(t[3])?t[3]:i[3];case 3:e[n+2]=Number.isFinite(t[2])?t[2]:i[2];case 2:e[n+1]=Number.isFinite(t[1])?t[1]:i[1];case 1:e[n+0]=Number.isFinite(t[0])?t[0]:i[0];break;default:let s=r;for(;--s>=0;)e[n+s]=Number.isFinite(t[s])?t[s]:i[s]}return e}_areValuesEqual(t,e){if(!t||!e)return!1;const{size:n}=this;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}}const Ih=[],Lh=[];function Oh(t,e=0,n=1/0){let i=Ih;const r={index:-1,data:t,target:[]};return t?"function"==typeof t[Symbol.iterator]?i=t:t.length>0&&(Lh.length=t.length,i=Lh):i=Ih,(e>0||Number.isFinite(n))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(e,n),r.index=e-1),{iterable:i,objectInfo:r}}function Rh(t){return t&&t[Symbol.asyncIterator]}function Fh(t,e){const{size:n,stride:i,offset:r,startIndices:s,nested:o}=e,a=t.BYTES_PER_ELEMENT,l=i?i/a:n,c=r?r/a:0,u=Math.floor((t.length-c)/l);return(e,{index:i,target:r})=>{if(!s){const e=i*l+c;for(let i=0;i<n;i++)r[i]=t[e+i];return r}const a=s[i],h=s[i+1]||u;let d;if(o){d=new Array(h-a);for(let e=a;e<h;e++){const i=e*l+c;r=new Array(n);for(let e=0;e<n;e++)r[e]=t[i+e];d[e-a]=r}}else if(l===n)d=t.subarray(a*n+c,h*n+c);else{d=new t.constructor((h-a)*n);let e=0;for(let i=a;i<h;i++){const r=i*l+c;for(let i=0;i<n;i++)d[e++]=t[r+i]}}return d}}const kh=[],Dh=[[0,1/0]];function Nh(t){const{source:e,target:n,start:i=0,size:r,getData:s}=t,o=t.end||n.length,a=e.length,l=o-i;if(a>l)return void n.set(e.subarray(0,l),i);if(n.set(e,i),!s)return;let c=a;for(;c<l;){const t=s(c,e);for(let e=0;e<r;e++)n[i+c]=t[e]||0,c++}}const Uh={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function zh(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const n=t.type||"interpolation";return{...Uh[n],...e,...t,type:n}}function Gh(t,e){const n=e.getBuffer();return n?[n,{divisor:0,size:e.size,normalized:e.settings.normalized}]:e.value}function jh(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(t,'"'))}}function Vh(t){t.push(t.shift())}function Hh(t,e){const{doublePrecision:n,settings:i,value:r,size:s}=t,o=n&&r instanceof Float64Array?2:1;return(i.noAlloc?r.length:e*s)*o}function Wh({buffer:t,numInstances:e,attribute:n,fromLength:i,fromStartIndices:r,getData:s=(t=>t)}){const o=n.doublePrecision&&n.value instanceof Float64Array?2:1,a=n.size*o,l=n.byteOffset,c=n.startIndices,u=r&&c,h=Hh(n,e),d=n.isConstant;if(!u&&i>=h)return;const f=d?n.value:n.getBuffer().getData({srcByteOffset:l});if(n.settings.normalized&&!d){const t=s;s=(e,i)=>n.normalizeConstant(t(e,i))}const p=d?(t,e)=>s(f,e):(t,e)=>s(f.subarray(t,t+a),e),g=t.getData({length:i}),m=new Float32Array(h);!function({source:t,target:e,size:n,getData:i,sourceStartIndices:r,targetStartIndices:s}){if(!Array.isArray(s))return Nh({source:t,target:e,size:n,getData:i}),e;let o=0,a=0;const l=i&&((t,e)=>i(t+a,e)),c=Math.min(r.length,s.length);for(let i=1;i<c;i++){const c=r[i]*n,u=s[i]*n;Nh({source:t.subarray(o,c),target:e,start:a,end:u,size:n,getData:l}),o=c,a=u}a<e.length&&Nh({source:[],target:e,start:a,size:n,getData:l})}({source:g,target:m,sourceStartIndices:r,targetStartIndices:c,size:a,getData:p}),t.byteLength<m.byteLength+l&&t.reallocate(m.byteLength+l),t.subData({data:m,offset:l})}class Jh extends Mh{constructor(t,e){super(t,e,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:Dh}),m(this,"constant",!1),this.settings.update=e.update||(e.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(t){this.state.startIndices=t}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:t=!1}={}){const e=this.state.needsRedraw;return this.state.needsRedraw=e&&!t,e}getUpdateTriggers(){const{accessor:t}=this.settings;return[this.id].concat("function"!=typeof t&&t||[])}supportsTransition(){return Boolean(this.settings.transition)}getTransitionSetting(t){if(!t||!this.supportsTransition())return null;const{accessor:e}=this.settings,n=this.settings.transition,i=Array.isArray(e)?t[e.find((e=>t[e]))]:t[e];return zh(i,n)}setNeedsUpdate(t=this.id,e){if(this.state.needsUpdate=this.state.needsUpdate||t,this.setNeedsRedraw(t),e){const{startRow:t=0,endRow:n=1/0}=e;this.state.updateRanges=function(t,e){if(t===Dh)return t;if(e[0]<0&&(e[0]=0),e[0]>=e[1])return t;const n=[],i=t.length;let r=0;for(let s=0;s<i;s++){const i=t[s];i[1]<e[0]?(n.push(i),r=s+1):i[0]>e[1]?n.push(i):e=[Math.min(i[0],e[0]),Math.max(i[1],e[1])]}return n.splice(r,0,e),n}(this.state.updateRanges,[t,n])}else this.state.updateRanges=Dh}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=kh}setNeedsRedraw(t=this.id){this.state.needsRedraw=this.state.needsRedraw||t}allocate(t){const{state:e,settings:n}=this;return!n.noAlloc&&!!n.update&&(super.allocate(t,e.updateRanges!==Dh),!0)}updateBuffer({numInstances:t,data:e,props:n,context:i}){if(!this.needsUpdate())return!1;const{state:{updateRanges:r},settings:{update:s,noAlloc:o}}=this;let a=!0;if(s){for(const[o,a]of r)s.call(i,this,{data:e,startRow:o,endRow:a,props:n,numInstances:t});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[e,n]of r){const i=Number.isFinite(e)?this.getVertexOffset(e):0,r=Number.isFinite(n)?this.getVertexOffset(n):o||!Number.isFinite(t)?this.value.length:t*this.size;super.updateSubBuffer({startOffset:i,endOffset:r})}this._checkAttributeArray()}else a=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),a}setConstantValue(t){return void 0!==t&&"function"!=typeof t&&(this.setData({constant:!0,value:t})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(t){const{state:e}=this;return t?(this.clearNeedsUpdate(),e.lastExternalBuffer===t||(e.lastExternalBuffer=t,this.setNeedsRedraw(),this.setData(t)),!0):(e.lastExternalBuffer=null,!1)}setBinaryValue(t,e=null){const{state:n,settings:i}=this;if(!t)return n.binaryValue=null,n.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(n.binaryValue===t)return this.clearNeedsUpdate(),!0;if(n.binaryValue=t,this.setNeedsRedraw(),i.transform||e!==this.startIndices){ArrayBuffer.isView(t)&&(t={value:t});const r=t;sl(ArrayBuffer.isView(r.value),"invalid ".concat(i.accessor));const s=Boolean(r.size)&&r.size!==this.size;return n.binaryAccessor=Fh(r.value,{size:r.size||this.size,stride:r.stride,offset:r.offset,startIndices:e,nested:s}),!1}return this.clearNeedsUpdate(),this.setData(t),!0}getVertexOffset(t){const{startIndices:e}=this;return(e?t<e.length?e[t]:this.numInstances:t)*this.size}getShaderAttributes(){const t=this.settings.shaderAttributes||{[this.id]:null},e={};for(const n in t)Object.assign(e,super.getShaderAttributes(n,t[n]));return e}_autoUpdater(t,{data:e,startRow:n,endRow:i,props:r,numInstances:s}){if(t.constant)return;const{settings:o,state:a,value:l,size:c,startIndices:u}=t,{accessor:h,transform:d}=o,f=a.binaryAccessor||("function"==typeof h?h:r[h]);sl("function"==typeof f,'accessor "'.concat(h,'" is not a function'));let p=t.getVertexOffset(n);const{iterable:g,objectInfo:m}=Oh(e,n,i);for(const e of g){m.index++;let n=f(e,m);if(d&&(n=d.call(this,n)),u){const e=(m.index<u.length-1?u[m.index+1]:s)-u[m.index];if(n&&Array.isArray(n[0])){let e=p;for(const i of n)t._normalizeValue(i,l,e),e+=c}else n&&n.length>c?l.set(n,p):(t._normalizeValue(n,m.target,0),$({target:l,source:m.target,start:p,count:e}));p+=e*c}else t._normalizeValue(n,l,p),p+=c}}_validateAttributeUpdaters(){const{settings:t}=this;if(!t.noAlloc&&"function"!=typeof t.update)throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:t}=this,e=Math.min(4,this.size);if(t&&t.length>=e){let n=!0;switch(e){case 4:n=n&&Number.isFinite(t[3]);case 3:n=n&&Number.isFinite(t[2]);case 2:n=n&&Number.isFinite(t[1]);case 1:n=n&&Number.isFinite(t[0]);break;default:n=!1}if(!n)throw new Error("Illegal attribute generated for ".concat(this.id))}}}const qh="out vec4 transform_output;\nvoid main() {\n  transform_output = vec4(0);\n}",Kh="#version 300 es\n".concat(qh);function Xh(t,e){e=Array.isArray(e)?e:[e];const n=t.replace(/^\s+/,"").split(/\s+/),[i,r,s]=n;return e.includes(i)&&r&&s?{qualifier:i,type:r,name:s.split(";")[0]}:null}function Qh(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{version:e=100,input:n,inputType:i,output:r}=t;if(!n)return 300===e?Kh:e>300?"#version ".concat(e,"\n").concat(qh):"void main() {gl_FragColor = vec4(0);}";const s=function(t,e){switch(e){case"float":return"vec4(".concat(t,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(t,", 0.0, 1.0)");case"vec3":return"vec4(".concat(t,", 1.0)");case"vec4":return t;default:return Vi(!1),null}}(n,i);return e>=300?"#version ".concat(e," ").concat(300===e?"es":"","\nin ").concat(i," ").concat(n,";\nout vec4 ").concat(r,";\nvoid main() {\n  ").concat(r," = ").concat(s,";\n}"):"varying ".concat(i," ").concat(n,";\nvoid main() {\n  gl_FragColor = ").concat(s,";\n}")}class Yh extends ro{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(t){return Zr(t)}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};ts(t),super(t,e),this.initialize(e),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,eo(this.buffers)||this.bind((()=>this._unbindBuffers())),this.setProps(t),this}setProps(t){"program"in t&&(this.configuration=t.program&&t.program.configuration),"configuration"in t&&(this.configuration=t.configuration),"bindOnUse"in t&&(t=t.bindOnUse),"buffers"in t&&this.setBuffers(t.buffers)}setBuffers(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.bind((()=>{for(const e in t)this.setBuffer(e,t[e])})),this}setBuffer(t,e){const n=this._getVaryingIndex(t),{buffer:i,byteSize:r,byteOffset:s}=this._getBufferParams(e);return n<0?(this.unused[t]=i,Kr.warn("".concat(this.id," unused varying buffer ").concat(t))(),this):(this.buffers[n]=e,this.bindOnUse||this._bindBuffer(n,i,s,r),this)}begin(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(t),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(t){let e,n,i;return t instanceof vo==0?(i=t.buffer,n=t.byteSize,e=t.byteOffset):i=t,void 0===e&&void 0===n||(e=e||0,n=n||i.byteLength-e),{buffer:i,byteOffset:e,byteSize:n}}_getVaryingInfo(t){return this.configuration&&this.configuration.getVaryingInfo(t)}_getVaryingIndex(t){if(this.configuration)return this.configuration.getVaryingInfo(t).location;const e=Number(t);return Number.isFinite(e)?e:-1}_bindBuffers(){if(this.bindOnUse)for(const t in this.buffers){const{buffer:e,byteSize:n,byteOffset:i}=this._getBufferParams(this.buffers[t]);this._bindBuffer(t,e,i,n)}}_unbindBuffers(){if(this.bindOnUse)for(const t in this.buffers)this._bindBuffer(t,null)}_bindBuffer(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;const r=e&&e.handle;return r&&void 0!==i?this.gl.bindBufferRange(35982,t,r,n,i):this.gl.bindBufferBase(35982,t,r),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(t){this.gl.bindTransformFeedback(36386,this.handle)}}class Zh{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.gl=t,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(e),Object.seal(this)}setupResources(t){for(const e of this.bindings)this._setupTransformFeedback(e,t)}updateModelProps(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{varyings:e}=this;return e.length>0&&(t=Object.assign({},t,{varyings:e})),t}getDrawOptions(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=this.bindings[this.currentIndex],{sourceBuffers:n,transformFeedback:i}=e;return{attributes:Object.assign({},n,t.attributes),transformFeedback:i}}swap(){return!!this.feedbackMap&&(this.currentIndex=this._getNextIndex(),!0)}update(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._setupBuffers(t)}getBuffer(t){const{feedbackBuffers:e}=this.bindings[this.currentIndex],n=t?e[t]:null;return n?n instanceof vo?n:n.buffer:null}getData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{varyingName:e}=t,n=this.getBuffer(e);return n?n.getData():null}delete(){for(const t in this.resources)this.resources[t].delete()}_initialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._setupBuffers(t),this.varyings=t.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&Xs(Zr(this.gl))}_getFeedbackBuffers(t){const{sourceBuffers:e={}}=t,n={};if(this.bindings[this.currentIndex]&&Object.assign(n,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const t in this.feedbackMap){const i=this.feedbackMap[t];t in e&&(n[i]=t)}Object.assign(n,t.feedbackBuffers);for(const t in n){const i=n[t];if("string"==typeof i){const r=e[i],{byteLength:s,usage:o,accessor:a}=r;n[t]=this._createNewBuffer(t,{byteLength:s,usage:o,accessor:a})}}return n}_setupBuffers(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{sourceBuffers:e=null}=t;Object.assign(this.feedbackMap,t.feedbackMap);const n=this._getFeedbackBuffers(t);this._updateBindings({sourceBuffers:e,feedbackBuffers:n})}_setupTransformFeedback(t,e){let{model:n}=e;const{program:i}=n;t.transformFeedback=new Yh(this.gl,{program:i,buffers:t.feedbackBuffers})}_updateBindings(t){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],t),this.feedbackMap){const{sourceBuffers:t,feedbackBuffers:e}=this._swapBuffers(this.bindings[this.currentIndex]),n=this._getNextIndex();this.bindings[n]=this._updateBinding(this.bindings[n],{sourceBuffers:t,feedbackBuffers:e})}}_updateBinding(t,e){return t?(Object.assign(t.sourceBuffers,e.sourceBuffers),Object.assign(t.feedbackBuffers,e.feedbackBuffers),t.transformFeedback&&t.transformFeedback.setBuffers(t.feedbackBuffers),t):{sourceBuffers:Object.assign({},e.sourceBuffers),feedbackBuffers:Object.assign({},e.feedbackBuffers)}}_swapBuffers(t){if(!this.feedbackMap)return null;const e=Object.assign({},t.sourceBuffers),n=Object.assign({},t.feedbackBuffers);for(const i in this.feedbackMap){const r=this.feedbackMap[i];e[i]=t.feedbackBuffers[r],n[r]=t.sourceBuffers[i],Xs(n[r]instanceof vo)}return{sourceBuffers:e,feedbackBuffers:n}}_createNewBuffer(t,e){const n=new vo(this.gl,e);return this.resources[t]&&this.resources[t].delete(),this.resources[t]=n,n}_getNextIndex(){return(this.currentIndex+1)%2}}function $h(t){let e=100;const n=t.match(/[^\s]+/g);if(n.length>=2&&"#version"===n[0]){const t=parseInt(n[1],10);Number.isFinite(t)&&(e=t)}return e}const td={name:"transform",vs:"attribute float transform_elementID;\nvec2 transform_getPixelSizeHalf(vec2 size) {\n  return vec2(1.) / (2. * size);\n}\n\nvec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {\n  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);\n  float xIndex = transform_elementID - (yIndex * texSize[0]);\n  return vec2(xIndex, yIndex);\n}\nvec2 transform_getTexCoord(vec2 size) {\n  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);\n  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);\n  vec2 coord = indices / size + pixelSizeHalf;\n  return coord;\n}\nvec2 transform_getPos(vec2 size) {\n  vec2 texCoord = transform_getTexCoord(size);\n  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);\n  return pos;\n}\nvec4 transform_getInput(sampler2D texSampler, vec2 size) {\n  vec2 texCoord = transform_getTexCoord(size);\n  vec4 textureColor = texture2D(texSampler, texCoord);\n  return textureColor;\n}\n",fs:null},ed="transform_uSize_",nd="transform_position";const id={10241:9728,10240:9728,10242:33071,10243:33071};class rd{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.gl=t,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(e),Object.seal(this)}updateModelProps(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=this._processVertexShader(t);return Object.assign({},t,e)}getDrawOptions(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{sourceBuffers:e,sourceTextures:n,framebuffer:i,targetTexture:r}=this.bindings[this.currentIndex],s=Object.assign({},e,t.attributes),o=Object.assign({},t.uniforms),a=Object.assign({},t.parameters);let l=t.discard;if(this.hasSourceTextures||this.hasTargetTexture){s.transform_elementID=this.elementIDBuffer;for(const t in this.samplerTextureMap){const e=this.samplerTextureMap[t];o[t]=n[e]}this._setSourceTextureParameters();const t=function(t){let{sourceTextureMap:e,targetTextureVarying:n,targetTexture:i}=t;const r={};let s,o;n&&(({width:s,height:o}=i),r["".concat(ed).concat(n)]=[s,o]);for(const t in e)({width:s,height:o}=e[t]),r["".concat(ed).concat(t)]=[s,o];return r}({sourceTextureMap:n,targetTextureVarying:this.targetTextureVarying,targetTexture:r});Object.assign(o,t)}return this.hasTargetTexture&&(l=!1,a.viewport=[0,0,i.width,i.height]),{attributes:s,framebuffer:i,uniforms:o,discard:l,parameters:a}}swap(){return!!this._swapTexture&&(this.currentIndex=this._getNextIndex(),!0)}update(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._setupTextures(t)}getTargetTexture(){const{targetTexture:t}=this.bindings[this.currentIndex];return t}getData(){let{packed:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{framebuffer:e}=this.bindings[this.currentIndex],n=Fo(e);if(!t)return n;const i=n.constructor,r=function(t){switch(t){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return Vi(!1),null}}(this.targetTextureType),s=new i(n.length*r/4);let o=0;for(let t=0;t<n.length;t+=4)for(let e=0;e<r;e++)s[o++]=n[t+e];return s}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{_targetTextureVarying:e,_swapTexture:n}=t;this._swapTexture=n,this.targetTextureVarying=e,this.hasTargetTexture=e,this._setupTextures(t)}_createTargetTexture(t){const{sourceTextures:e,textureOrReference:n}=t;if(n instanceof Eo)return n;const i=e[n];return i?(this._targetRefTexName=n,this._createNewTexture(i)):null}_setupTextures(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{sourceBuffers:e,_sourceTextures:n={},_targetTexture:i}=t,r=this._createTargetTexture({sourceTextures:n,textureOrReference:i});this.hasSourceTextures=this.hasSourceTextures||n&&Object.keys(n).length>0,this._updateBindings({sourceBuffers:e,sourceTextures:n,targetTexture:r}),"elementCount"in t&&this._updateElementIDBuffer(t.elementCount)}_updateElementIDBuffer(t){if("number"!=typeof t||this.elementCount>=t)return;const e=new Float32Array(t);e.forEach(((t,e,n)=>{n[e]=e})),this.elementIDBuffer?this.elementIDBuffer.setData({data:e}):this.elementIDBuffer=new vo(this.gl,{data:e,accessor:{size:1}}),this.elementCount=t}_updateBindings(t){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],t),this._swapTexture){const{sourceTextures:t,targetTexture:e}=this._swapTextures(this.bindings[this.currentIndex]),n=this._getNextIndex();this.bindings[n]=this._updateBinding(this.bindings[n],{sourceTextures:t,targetTexture:e})}}_updateBinding(t,e){const{sourceBuffers:n,sourceTextures:i,targetTexture:r}=e;if(t||(t={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(t.sourceTextures,i),Object.assign(t.sourceBuffers,n),r){t.targetTexture=r;const{width:e,height:n}=r,{framebuffer:i}=t;i?(i.update({attachments:{36064:r},resizeAttachments:!1}),i.resize({width:e,height:n})):t.framebuffer=new Ko(this.gl,{id:"transform-framebuffer",width:e,height:n,attachments:{36064:r}})}return t}_setSourceTextureParameters(){const t=this.currentIndex,{sourceTextures:e}=this.bindings[t];for(const t in e)e[t].setParameters(id)}_swapTextures(t){if(!this._swapTexture)return null;const e=Object.assign({},t.sourceTextures);return e[this._swapTexture]=t.targetTexture,{sourceTextures:e,targetTexture:t.sourceTextures[this._swapTexture]}}_createNewTexture(t){const e=function(t,e){Xs(t instanceof Eo||t instanceof Lo||t instanceof Oo);const n=t.constructor,{gl:i,width:r,height:s,format:o,type:a,dataFormat:l,border:c,mipmaps:u}=t;return new n(i,Object.assign({width:r,height:s,format:o,type:a,dataFormat:l,border:c,mipmaps:u},{parameters:{10241:9728,10240:9728,10242:33071,10243:33071},pixelStore:{37440:!1}}))}(t);return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=e,e}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{sourceTextures:e,targetTexture:n}=this.bindings[this.currentIndex],{vs:i,uniforms:r,targetTextureType:s,inject:o,samplerTextureMap:a}=function(t){let{vs:e,sourceTextureMap:n,targetTextureVarying:i,targetTexture:r}=t,s=Object.keys(n).length,o=null;const a={};let l=e,c={};if(s>0||i){const t=l.split("\n"),e=t.slice();if(t.forEach(((t,r,l)=>{if(s>0){const i=function(t,e){const n={},i=function(t){return Xh(t,["attribute","in"])}(t);if(!i)return null;const{type:r,name:s}=i;if(s&&e[s]){const e="// ".concat(t," => Replaced by Transform with a sampler"),{samplerName:i,sizeName:o,uniformDeclerations:a}=function(t){const e="".concat("transform_uSampler_").concat(t),n="".concat(ed).concat(t);return{samplerName:e,sizeName:n,uniformDeclerations:"  uniform sampler2D ".concat(e,";\n  uniform vec2 ").concat(n,";")}}(s),l=function(t){switch(t){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return Vi(!1),null}}(r),c="  ".concat(r," ").concat(s," = transform_getInput(").concat(i,", ").concat(o,").").concat(l,";\n");return n[i]=s,{updatedLine:e,inject:{"vs:#decl":a,"vs:#main-start":c},samplerTextureMap:n}}return null}(t,n);if(i){const{updatedLine:t,inject:n}=i;e[r]=t,c=dr([c,n]),Object.assign(a,i.samplerTextureMap),s--}}i&&!o&&(o=function(t,e){const n=Xh(t,["varying","out"]);return n&&n.name===e?n.type:null}(t,i))})),i){Xs(r);const t="".concat(ed).concat(i),e="uniform vec2 ".concat(t,";\n"),n="     vec2 ".concat(nd," = transform_getPos(").concat(t,");\n     gl_Position = vec4(").concat(nd,", 0, 1.);\n");c=dr([c,{"vs:#decl":e,"vs:#main-start":n}])}l=e.join("\n")}return{vs:l,targetTextureType:o,inject:c,samplerTextureMap:a}}({vs:t.vs,sourceTextureMap:e,targetTextureVarying:this.targetTextureVarying,targetTexture:n}),l=dr([t.inject||{},o]);return this.targetTextureType=s,this.samplerTextureMap=a,{vs:i,fs:t._fs||Qh({version:$h(i),input:this.targetTextureVarying,inputType:s,output:"transform_output"}),modules:this.hasSourceTextures||this.targetTextureVarying?[td].concat(t.modules||[]):t.modules,uniforms:r,inject:l}}}let sd=null;const od=globalThis;class ad extends ro{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(t){return!(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).constantAttributeZero||Zr(t)||"Chrome"===function(t){if(!Js())return"Node";if(Ws(t))return"Electron";const e=("undefined"!=typeof navigator?navigator:{}).userAgent||"";if(e.indexOf("Edge")>-1)return"Edge";const n=-1!==e.indexOf("MSIE "),i=-1!==e.indexOf("Trident/");return n||i?"IE":od.chrome?"Chrome":od.safari?"Safari":od.mozInnerScreenX?"Firefox":"Unknown"}()}static getDefaultArray(t){return t.luma=t.luma||{},t.luma.defaultVertexArray||(t.luma.defaultVertexArray=new ad(t,{handle:null,isDefaultArray:!0})),t.luma.defaultVertexArray}static getMaxAttributes(t){return ad.MAX_ATTRIBUTES=ad.MAX_ATTRIBUTES||t.getParameter(34921),ad.MAX_ATTRIBUTES}static setConstant(t,e,n){switch(n.constructor){case Float32Array:ad._setConstantFloatArray(t,e,n);break;case Int32Array:ad._setConstantIntArray(t,e,n);break;case Uint32Array:ad._setConstantUintArray(t,e,n);break;default:Xs(!1)}}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=e.id||e.program&&e.program.id;super(t,Object.assign({},e,{id:n})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=e.isDefaultArray||!1,this.gl2=t,this.initialize(e),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return ad.getMaxAttributes(this.gl)}initialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.setProps(t)}setProps(t){return this}setElementBuffer(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return Xs(!t||34963===t.target,"elements must be GL.ELEMENT_ARRAY_BUFFER"),this.bind((()=>{this.gl.bindBuffer(34963,t?t.handle:null)})),this}setBuffer(t,e,n){if(34963===e.target)return this.setElementBuffer(e,n);const{size:i,type:r,stride:s,offset:o,normalized:a,integer:l,divisor:c}=n,{gl:u,gl2:h}=this;return t=Number(t),this.bind((()=>{u.bindBuffer(34962,e.handle),l?(Xs(Zr(u)),h.vertexAttribIPointer(t,i,r,s,o)):u.vertexAttribPointer(t,i,r,a,s,o),u.enableVertexAttribArray(t),h.vertexAttribDivisor(t,c||0)})),this}enable(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return!e&&0===t&&!ad.isSupported(this.gl,{constantAttributeZero:!0})||(t=Number(t),this.bind((()=>e?this.gl.enableVertexAttribArray(t):this.gl.disableVertexAttribArray(t)))),this}getConstantBuffer(t,e){const n=this._normalizeConstantArrayValue(e),i=n.byteLength*t,r=n.length*t;let s=!this.buffer;if(this.buffer=this.buffer||new vo(this.gl,i),s=s||this.buffer.reallocate(i),s=s||!this._compareConstantArrayValues(n,this.bufferValue),s){const t=function(t,e){var n;return new t((n=t.BYTES_PER_ELEMENT*e,(!sd||sd.byteLength<n)&&(sd=new ArrayBuffer(n)),sd),0,e)}(e.constructor,r);!function(t){let{target:e,source:n,start:i=0,count:r=1}=t;const s=n.length,o=r*s;let a=0;for(let t=i;a<s;a++)e[t++]=n[a];for(;a<o;)a<o-a?(e.copyWithin(i+a,i,i+a),a*=2):(e.copyWithin(i+a,i,i+o-a),a=o)}({target:t,source:n,start:0,count:r}),this.buffer.subData(t),this.bufferValue=e}return this.buffer}_normalizeConstantArrayValue(t){return Array.isArray(t)?new Float32Array(t):t}_compareConstantArrayValues(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}static _setConstantFloatArray(t,e,n){switch(n.length){case 1:t.vertexAttrib1fv(e,n);break;case 2:t.vertexAttrib2fv(e,n);break;case 3:t.vertexAttrib3fv(e,n);break;case 4:t.vertexAttrib4fv(e,n);break;default:Xs(!1)}}static _setConstantIntArray(t,e,n){switch(Xs(Zr(t)),n.length){case 1:t.vertexAttribI1iv(e,n);break;case 2:t.vertexAttribI2iv(e,n);break;case 3:t.vertexAttribI3iv(e,n);break;case 4:t.vertexAttribI4iv(e,n);break;default:Xs(!1)}}static _setConstantUintArray(t,e,n){switch(Xs(Zr(t)),n.length){case 1:t.vertexAttribI1uiv(e,n);break;case 2:t.vertexAttribI2uiv(e,n);break;case 3:t.vertexAttribI3uiv(e,n);break;case 4:t.vertexAttribI4uiv(e,n);break;default:Xs(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(t){return this.gl2.deleteVertexArray(t),[this.elements]}_bindHandle(t){this.gl2.bindVertexArray(t)}_getParameter(t,e){let{location:n}=e;return Xs(Number.isFinite(n)),this.bind((()=>34373===t?this.gl.getVertexAttribOffset(n,t):this.gl.getVertexAttrib(n,t)))}}const ld=/^(.+)__LOCATION_([0-9]+)$/,cd=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class ud{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=e.id||e.program&&e.program.id;this.id=n,this.gl=t,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new ad(t),no(this,"VertexArray","v6.0",cd),this.initialize(e),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(t)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:t}=this.vertexArrayObject;return this.values=new Array(t).fill(null),this.accessors=new Array(t).fill(null),this.unused={},this.drawParams=null,this}setProps(t){return"program"in t&&(this.configuration=t.program&&t.program.configuration),"configuration"in t&&(this.configuration=t.configuration),"attributes"in t&&this.setAttributes(t.attributes),"elements"in t&&this.setElementBuffer(t.elements),"bindOnUse"in t&&(t=t.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(t){return Object.assign(this.attributes,t),this.vertexArrayObject.bind((()=>{for(const e in t){const n=t[e];this._setAttribute(e,n)}this.gl.bindBuffer(34962,null)})),this}setElementBuffer(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.elements=t,this.elementsAccessor=e,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(t,e),this}setBuffer(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(34963===e.target)return this.setElementBuffer(e,n);const{location:i,accessor:r}=this._resolveLocationAndAccessor(t,e,e.accessor,n);return i>=0&&(this.values[i]=e,this.accessors[i]=r,this.clearDrawParams(),this.vertexArrayObject.setBuffer(i,e,r)),this}setConstant(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{location:i,accessor:r}=this._resolveLocationAndAccessor(t,e,Object.assign({size:e.length},n));return i>=0&&(e=this.vertexArrayObject._normalizeConstantArrayValue(e),this.values[i]=e,this.accessors[i]=r,this.clearDrawParams(),this.vertexArrayObject.enable(i,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind((()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new vo(this.gl,{accessor:{size:4}});for(let t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++)this.values[t]instanceof vo&&(this.gl.disableVertexAttribArray(t),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(t,1,5126,!1,0,0))})),this}bindBuffers(){return this.vertexArrayObject.bind((()=>{this.elements&&this.setElementBuffer(this.elements);for(let t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++){const e=this.values[t];e instanceof vo&&this.setBuffer(t,e)}})),this}bindForDraw(t,e,n){let i;return this.vertexArrayObject.bind((()=>{this._setConstantAttributes(t,e),i=n()})),i}_resolveLocationAndAccessor(t,e,n,i){const r={location:-1,accessor:null},{location:s,name:o}=this._getAttributeIndex(t);if(!Number.isFinite(s)||s<0)return this.unused[t]=e,Kr.once(3,(()=>"unused value ".concat(t," in ").concat(this.id)))(),r;const a=this._getAttributeInfo(o||s);if(!a)return r;const l=this.accessors[s]||{},c=fo.resolve(a.accessor,l,n,i),{size:u,type:h}=c;return Xs(Number.isFinite(u)&&Number.isFinite(h)),{location:s,accessor:c}}_getAttributeInfo(t){return this.configuration&&this.configuration.getAttributeInfo(t)}_getAttributeIndex(t){const e=Number(t);if(Number.isFinite(e))return{location:e};const n=ld.exec(t),i=n?n[1]:t,r=n?Number(n[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(i)+r,name:i}:{location:-1}}_setAttribute(t,e){if(e instanceof vo)this.setBuffer(t,e);else if(Array.isArray(e)&&e.length&&e[0]instanceof vo){const n=e[0],i=e[1];this.setBuffer(t,n,i)}else if(ArrayBuffer.isView(e)||Array.isArray(e)){const n=e;this.setConstant(t,n)}else{if(!(e.buffer instanceof vo))throw new Error("VertexArray: attributes must be Buffers or constants (i.e. typed array)");{const n=e;this.setBuffer(t,n.buffer,n)}}}_setConstantAttributes(t,e){const n=Math.max(0|t,0|e);let i=this.values[0];ArrayBuffer.isView(i)&&this._setConstantAttributeZero(i,n);for(let t=1;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++)i=this.values[t],ArrayBuffer.isView(i)&&this._setConstantAttribute(t,i)}_setConstantAttributeZero(t,e){if(ad.isSupported(this.gl,{constantAttributeZero:!0}))return void this._setConstantAttribute(0,t);const n=this.vertexArrayObject.getConstantBuffer(e,t);this.vertexArrayObject.setBuffer(0,n,this.accessors[0])}_setConstantAttribute(t,e){ad.setConstant(this.gl,t,e)}_updateDrawParams(){const t={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this._updateDrawParamsForLocation(t,e);return this.elements&&(t.elementCount=this.elements.getElementCount(this.elements.accessor),t.isIndexed=!0,t.indexType=this.elementsAccessor.type||this.elements.accessor.type,t.indexOffset=this.elementsAccessor.offset||0),t.indexCount===1/0&&(t.indexCount=0),t.vertexCount===1/0&&(t.vertexCount=0),t.instanceCount===1/0&&(t.instanceCount=0),t}_updateDrawParamsForLocation(t,e){const n=this.values[e],i=this.accessors[e];if(!n)return;const{divisor:r}=i,s=r>0;if(t.isInstanced=t.isInstanced||s,n instanceof vo){const e=n;if(s){const n=e.getVertexCount(i);t.instanceCount=Math.min(t.instanceCount,n)}else{const n=e.getVertexCount(i);t.vertexCount=Math.min(t.vertexCount,n)}}}setElements(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Kr.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(t,e)}}function hd(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{isInteger:n=!1}=e;if(Array.isArray(t)||ArrayBuffer.isView(t))return function(t,e){const{maxElts:n=16,size:i=1}=e;let r="[";for(let s=0;s<t.length&&s<n;++s)s>0&&(r+=",".concat(s%i==0?" ":"")),r+=hd(t[s],e);const s=t.length>n?"...":"]";return"".concat(r).concat(s)}(t,e);if(!Number.isFinite(t))return String(t);if(Math.abs(t)<1e-16)return n?"0":"0.";if(n)return t.toFixed(0);if(Math.abs(t)>100&&Math.abs(t)<1e4)return t.toFixed(0);const i=t.toPrecision(2);return i.indexOf(".0")===i.length-2?i.slice(0,-1):i}function dd(t,e,n,i){const{gl:r}=t;if(!e)return{[i]:"null","Format ":"N/A"};let s,o,a,l="NOT PROVIDED",c=1,u=0,h=0;if(n&&(l=n.type,c=n.size,l=String(l).replace("Array",""),s=-1!==l.indexOf("nt")),e instanceof vo){const t=e,{data:d,changed:f}=t.getDebugData();let p;if(o=f?"*":"",a=d,h=t.byteLength,u=h/d.BYTES_PER_ELEMENT/c,n){const t=n.divisor>0;p="".concat(t?"I ":"P "," ").concat(u," (x").concat(c,"=").concat(h," bytes ").concat(Ys(r,l),")")}else s=!0,p="".concat(h," bytes");return{[i]:"".concat(o).concat(hd(a,{size:c,isInteger:s})),"Format ":p}}return a=e,c=e.length,l=String(e.constructor.name).replace("Array",""),s=-1!==l.indexOf("nt"),{[i]:"".concat(hd(a,{size:c,isInteger:s})," (constant)"),"Format ":"".concat(c,"x").concat(l," (constant)")}}function fd(t,e){const{type:n,size:i}=e,r=Sa(n,i);return r?"".concat(t," (").concat(r.name,")"):t}function pd(t){let{header:e="Uniforms",program:n,uniforms:i,undefinedOnly:r=!1}=t;Xs(n);const s=".*Matrix",o=n._uniformSetters,a={},l=Object.keys(o).sort();let c=0;for(const t of l)t.match(".*_.*")||t.match(s)||gd({table:a,header:e,uniforms:i,uniformName:t,undefinedOnly:r})&&c++;for(const t of l)t.match(s)&&gd({table:a,header:e,uniforms:i,uniformName:t,undefinedOnly:r})&&c++;for(const t of l)a[t]||gd({table:a,header:e,uniforms:i,uniformName:t,undefinedOnly:r})&&c++;let u=0;const h={};if(!r)for(const t in i){const n=i[t];a[t]||(u++,h[t]={Type:"NOT USED: ".concat(n),[e]:hd(n)})}return{table:a,count:c,unusedTable:h,unusedCount:u}}function gd(t){let{table:e,header:n,uniforms:i,uniformName:r,undefinedOnly:s}=t;const o=i[r],a=function(t){return null!=t}(o);return!(s&&a||(e[r]={[n]:a?hd(o):"N/A","Uniform Type":a?o:"NOT PROVIDED"},0))}function md(t){const{type:e,size:n}=t.accessor,i=Sa(e,n);return i?"".concat(i.name," ").concat(t.name):t.name}const vd={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function yd(t,e){const{attributeMap:n=vd}=e||{};return n&&n[t]||t}function bd(t,e){let n;switch(t){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":n="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":n="vectors"}switch(n){case"vectors":e.size=e.size||3;break;case"uvs":e.size=e.size||2}Xs(Number.isFinite(e.size),"attribute ".concat(t," needs size"))}const _d=()=>{},Ad={};class wd{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{id:n=$s("model")}=e;Xs(Yr(t)),this.id=n,this.gl=t,this.id=e.id||$s("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(e)}initialize(t){this.props={},this.programManager=t.programManager||La.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:e=null,vs:n,fs:i,modules:r,defines:s,inject:o,varyings:a,bufferMode:l,transpileToGLSL100:c}=t;this.programProps={program:e,vs:n,fs:i,modules:r,defines:s,inject:o,varyings:a,bufferMode:l,transpileToGLSL100:c},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(t.moduleSettings))),this.drawMode=void 0!==t.drawMode?t.drawMode:4,this.vertexCount=t.vertexCount||0,this.geometryBuffers={},this.isInstanced=t.isInstanced||t.instanced||t.instanceCount>0,this._setModelProps(t),this.geometry={},Xs(void 0!==this.drawMode&&Number.isFinite(this.vertexCount),"Model needs drawMode and vertexCount")}setProps(t){this._setModelProps(t)}delete(){for(const t in this._attributes)this._attributes[t]!==this.attributes[t]&&this._attributes[t].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(t){const{program:e,vs:n,fs:i,modules:r,defines:s,inject:o,varyings:a,bufferMode:l,transpileToGLSL100:c}=t;this.programProps={program:e,vs:n,fs:i,modules:r,defines:s,inject:o,varyings:a,bufferMode:l,transpileToGLSL100:c},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(t){return this.drawMode=t,this}setVertexCount(t){return Xs(Number.isFinite(t)),this.vertexCount=t,this}setInstanceCount(t){return Xs(Number.isFinite(t)),this.instanceCount=t,this}setGeometry(t){return this.drawMode=t.drawMode,this.vertexCount=t.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=function(t,e,n){const i={};let r=e.indices;for(const n in e.attributes){const s=e.attributes[n],o=yd(n,undefined);if("indices"===n)r=s;else if(s.constant)i[o]=s.value;else{const e=s.value,r={...s};delete r.value,i[o]=[new vo(t,e),r],bd(n,r)}}if(r){const e=r.value||r;Xs(e instanceof Uint16Array||e instanceof Uint32Array,'attribute array for "indices" must be of integer type');const n={size:1,isIndexed:void 0===r.isIndexed||r.isIndexed};i.indices=[new vo(t,{data:e,target:34963}),n]}return i}(this.gl,t),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(eo(t))return this;const e={};for(const n in t){const i=t[n];e[n]=i.getValue?i.getValue():i}return this.vertexArray.setAttributes(e),this}setUniforms(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.assign(this.uniforms,t),this}getModuleUniforms(t){this._checkProgram();const e=this.programManager.getUniforms(this.program);return e?e(t):{}}updateModuleSettings(t){const e=this.getModuleUniforms(t||{});return this.setUniforms(e)}clear(t){return Mo(this.program.gl,t),this}draw(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._checkProgram();const{moduleSettings:e=null,framebuffer:n,uniforms:i={},attributes:r={},transformFeedback:s=this.transformFeedback,parameters:o={},vertexArray:a=this.vertexArray}=t;let l;this.setAttributes(r),this.updateModuleSettings(e),this.setUniforms(i),Kr.priority>=2&&(l=this._logDrawCallStart(2));const c=this.vertexArray.getDrawParams(),{isIndexed:u=c.isIndexed,indexType:h=c.indexType,indexOffset:d=c.indexOffset,vertexArrayInstanced:f=c.isInstanced}=this.props;f&&!this.isInstanced&&Kr.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:p,instanceCount:g}=this,{onBeforeRender:m=_d,onAfterRender:v=_d}=this.props;m(),this.program.setUniforms(this.uniforms);const y=this.program.draw(Object.assign(Ad,t,{logPriority:l,uniforms:null,framebuffer:n,parameters:o,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:a,transformFeedback:s,isIndexed:u,indexType:h,isInstanced:p,instanceCount:g,offset:u?d:0}));return v(),Kr.priority>=2&&this._logDrawCallEnd(l,a,n),y}transform(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{discard:e=!0,feedbackBuffers:n,unbindModels:i=[]}=t;let{parameters:r}=t;n&&this._setFeedbackBuffers(n),e&&(r=Object.assign({},r,{35977:e})),i.forEach((t=>t.vertexArray.unbindBuffers()));try{this.draw(Object.assign({},t,{parameters:r}))}finally{i.forEach((t=>t.vertexArray.bindBuffers()))}return this}render(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Kr.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(t).draw()}_setModelProps(t){Object.assign(this.props,t),"uniforms"in t&&this.setUniforms(t.uniforms),"pickable"in t&&(this.pickable=t.pickable),"instanceCount"in t&&(this.instanceCount=t.instanceCount),"geometry"in t&&this.setGeometry(t.geometry),"attributes"in t&&this.setAttributes(t.attributes),"_feedbackBuffers"in t&&this._setFeedbackBuffers(t._feedbackBuffers)}_checkProgram(){if(!this._programDirty&&this.programManager.stateHash===this._programManagerState)return;let{program:t}=this.programProps;if(t)this._managedProgram=!1;else{const{vs:e,fs:n,modules:i,inject:r,defines:s,varyings:o,bufferMode:a,transpileToGLSL100:l}=this.programProps;t=this.programManager.get({vs:e,fs:n,modules:i,inject:r,defines:s,varyings:o,bufferMode:a,transpileToGLSL100:l}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}Xs(t instanceof Ia,"Model needs a program"),this._programDirty=!1,t!==this.program&&(this.program=t,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new ud(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const t in this.geometryBuffers){const e=this.geometryBuffers[t][0]||this.geometryBuffers[t];e instanceof vo&&e.delete()}}_setAnimationProps(t){this.animated&&Xs(t,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(eo(t))return this;const{gl:e}=this.program;return this.transformFeedback=this.transformFeedback||new Yh(e,{program:this.program}),this.transformFeedback.setBuffers(t),this}_logDrawCallStart(t){const e=t>3?0:1e4;if(!(Date.now()-this.lastLogTime<e))return this.lastLogTime=Date.now(),Kr.group(2,">>> DRAWING MODEL ".concat(this.id),{collapsed:Kr.level<=2})(),t}_logDrawCallEnd(t,e,n,i){if(void 0===t)return;const r=function(t){let{vertexArray:e,header:n="Attributes"}=t;if(!e.configuration)return{};const i={};e.elements&&(i.ELEMENT_ARRAY_BUFFER=dd(e,e.elements,null,n));const r=e.values;for(const t in r){const s=e._getAttributeInfo(t);if(s){let o="".concat(t,": ").concat(s.name);const a=e.accessors[s.location];a&&(o="".concat(t,": ").concat(fd(s.name,a))),i[o]=dd(e,r[t],a,n)}}return i}({vertexArray:e,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:s,unusedTable:o,unusedCount:a}=pd({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,n)}),{table:l,count:c}=pd({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,n),undefinedOnly:!0});c>0&&Kr.log("MISSING UNIFORMS",Object.keys(l))(),a>0&&Kr.log("UNUSED UNIFORMS",Object.keys(o))();const u=function(t){const e={},n="Accessors for ".concat(t.id);for(const i of t.attributeInfos)if(i){const t=md(i);e["in ".concat(t)]={[n]:JSON.stringify(i.accessor)}}for(const i of t.varyingInfos)if(i){const t=md(i);e["out ".concat(t)]={[n]:JSON.stringify(i.accessor)}}return e}(this.vertexArray.configuration);Kr.table(t,r)(),Kr.table(t,s)(),Kr.table(t+1,u)(),i&&i.log({logLevel:2,message:"Rendered to ".concat(i.id)}),Kr.groupEnd(2)()}}class Cd{static isSupported(t){return Zr(t)}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.gl=t,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(e),Object.seal(this)}delete(){const{model:t,bufferTransform:e,textureTransform:n}=this;t&&t.delete(),e&&e.delete(),n&&n.delete()}run(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{clearRenderTarget:e=!0}=t,n=this._updateDrawOptions(t);e&&n.framebuffer&&n.framebuffer.clear({color:!0}),this.model.transform(n)}swap(){let t=!1;const e=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const n of e)t=t||n.swap();Xs(t,"Nothing to swap")}getBuffer(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(t)}getData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const n of e){const e=n.getData(t);if(e)return e}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"elementCount"in t&&this.model.setVertexCount(t.elementCount);const e=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const n of e)n.update(t)}_initialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{gl:e}=this;this._buildResourceTransforms(e,t),t=this._updateModelProps(t),this.model=new wd(e,Object.assign({},t,{fs:t.fs||Qh({version:$h(t.vs)}),id:t.id||"transform-model",drawMode:t.drawMode||0,vertexCount:t.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(t){let e=Object.assign({},t);const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const t of n)e=t.updateModelProps(e);return e}_buildResourceTransforms(t,e){(function(t){return!(eo(t.feedbackBuffers)&&eo(t.feedbackMap)&&!(t.varyings&&t.varyings.length>0))})(e)&&(this.bufferTransform=new Zh(t,e)),function(t){return!(eo(t._sourceTextures)&&!t._targetTexture&&!t._targetTextureVarying)}(e)&&(this.textureTransform=new rd(t,e)),Xs(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(t){let e=Object.assign({},t);const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const t of n)e=Object.assign(e,t.getDrawOptions(e));return e}}const Ed={interpolation:class{constructor({gl:t,attribute:e,timeline:n}){m(this,"gl",void 0),m(this,"type","interpolation"),m(this,"attributeInTransition",void 0),m(this,"settings",void 0),m(this,"attribute",void 0),m(this,"transition",void 0),m(this,"currentStartIndices",void 0),m(this,"currentLength",void 0),m(this,"transform",void 0),m(this,"buffers",void 0),this.gl=t,this.transition=new ll(n),this.attribute=e,this.attributeInTransition=new Jh(t,e.settings),this.currentStartIndices=e.startIndices,this.currentLength=0,this.transform=function(t,e){const n=jh(e.size);return new Cd(t,{vs:"\n#define SHADER_NAME interpolation-transition-vertex-shader\n\nuniform float time;\nattribute ATTRIBUTE_TYPE aFrom;\nattribute ATTRIBUTE_TYPE aTo;\nvarying ATTRIBUTE_TYPE vCurrent;\n\nvoid main(void) {\n  vCurrent = mix(aFrom, aTo, time);\n  gl_Position = vec4(0.0);\n}\n",defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"]})}(t,e);const i={byteLength:0,usage:35050};this.buffers=[new vo(t,i),new vo(t,i)]}get inProgress(){return this.transition.inProgress}start(t,e){if(t.duration<=0)return void this.transition.cancel();this.settings=t;const{gl:n,buffers:i,attribute:r}=this;Vh(i);const s={numInstances:e,attribute:r,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:t.enter};for(const t of i)Wh({buffer:t,...s});this.currentStartIndices=r.startIndices,this.currentLength=Hh(r,e),this.attributeInTransition.setData({buffer:i[1],value:r.value}),this.transition.start(t),this.transform.update({elementCount:Math.floor(this.currentLength/r.size),sourceBuffers:{aFrom:i[0],aTo:Gh(0,r)},feedbackBuffers:{vCurrent:i[1]}})}update(){const t=this.transition.update();if(t){const{duration:t,easing:e}=this.settings,{time:n}=this.transition;let i=n/t;e&&(i=e(i)),this.transform.run({uniforms:{time:i}})}return t}cancel(){this.transition.cancel(),this.transform.delete();for(const t of this.buffers)t.delete();this.buffers.length=0}},spring:class{constructor({gl:t,attribute:e,timeline:n}){m(this,"gl",void 0),m(this,"type","spring"),m(this,"attributeInTransition",void 0),m(this,"settings",void 0),m(this,"attribute",void 0),m(this,"transition",void 0),m(this,"currentStartIndices",void 0),m(this,"currentLength",void 0),m(this,"texture",void 0),m(this,"framebuffer",void 0),m(this,"transform",void 0),m(this,"buffers",void 0),this.gl=t,this.type="spring",this.transition=new ll(n),this.attribute=e,this.attributeInTransition=new Jh(t,{...e.settings,normalized:!1}),this.currentStartIndices=e.startIndices,this.currentLength=0,this.texture=function(t){return new Eo(t,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}(t),this.framebuffer=function(t,e){return new Ko(t,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{36064:e}})}(t,this.texture),this.transform=function(t,e,n){const i=jh(e.size);return new Cd(t,{framebuffer:n,vs:"\n#define SHADER_NAME spring-transition-vertex-shader\n\n#define EPSILON 0.00001\n\nuniform float stiffness;\nuniform float damping;\nattribute ATTRIBUTE_TYPE aPrev;\nattribute ATTRIBUTE_TYPE aCur;\nattribute ATTRIBUTE_TYPE aTo;\nvarying ATTRIBUTE_TYPE vNext;\nvarying float vIsTransitioningFlag;\n\nATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {\n  ATTRIBUTE_TYPE velocity = cur - prev;\n  ATTRIBUTE_TYPE delta = dest - cur;\n  ATTRIBUTE_TYPE spring = delta * stiffness;\n  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;\n  return spring + damper + velocity + cur;\n}\n\nvoid main(void) {\n  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;\n  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;\n\n  vNext = getNextValue(aCur, aPrev, aTo);\n  gl_Position = vec4(0, 0, 0, 1);\n  gl_PointSize = 100.0;\n}\n",fs:"\n#define SHADER_NAME spring-transition-is-transitioning-fragment-shader\n\nvarying float vIsTransitioningFlag;\n\nvoid main(void) {\n  if (vIsTransitioningFlag == 0.0) {\n    discard;\n  }\n  gl_FragColor = vec4(1.0);\n}",defines:{ATTRIBUTE_TYPE:i},varyings:["vNext"]})}(t,e,this.framebuffer);const i={byteLength:0,usage:35050};this.buffers=[new vo(t,i),new vo(t,i),new vo(t,i)]}get inProgress(){return this.transition.inProgress}start(t,e){const{gl:n,buffers:i,attribute:r}=this,s={numInstances:e,attribute:r,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:t.enter};for(const t of i)Wh({buffer:t,...s});this.settings=t,this.currentStartIndices=r.startIndices,this.currentLength=Hh(r,e),this.attributeInTransition.setData({buffer:i[1],value:r.value}),this.transition.start({...t,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/r.size),sourceBuffers:{aTo:Gh(0,r)}})}update(){const{buffers:t,transform:e,framebuffer:n,transition:i}=this;if(!i.update())return!1;const r=this.settings;return e.update({sourceBuffers:{aPrev:t[0],aCur:t[1]},feedbackBuffers:{vNext:t[2]}}),e.run({framebuffer:n,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:r.stiffness,damping:r.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),Vh(t),this.attributeInTransition.setData({buffer:t[1],value:this.attribute.value}),Fo(n)[0]>0||i.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(const t of this.buffers)t.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}};class xd{constructor(t,{id:e,timeline:n}){m(this,"id",void 0),m(this,"isSupported",void 0),m(this,"gl",void 0),m(this,"timeline",void 0),m(this,"transitions",void 0),m(this,"needsRedraw",void 0),m(this,"numInstances",void 0),this.id=e,this.gl=t,this.timeline=n,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=Cd.isSupported(t)}finalize(){for(const t in this.transitions)this._removeTransition(t)}update({attributes:t,transitions:e,numInstances:n}){this.numInstances=n||1;for(const n in t){const i=t[n],r=i.getTransitionSetting(e);r&&this._updateAttribute(n,i,r)}for(const n in this.transitions){const i=t[n];i&&i.getTransitionSetting(e)||this._removeTransition(n)}}hasAttribute(t){const e=this.transitions[t];return e&&e.inProgress}getAttributes(){const t={};for(const e in this.transitions){const n=this.transitions[e];n.inProgress&&(t[e]=n.attributeInTransition)}return t}run(){if(!this.isSupported||0===this.numInstances)return!1;for(const t in this.transitions)this.transitions[t].update()&&(this.needsRedraw=!0);const t=this.needsRedraw;return this.needsRedraw=!1,t}_removeTransition(t){this.transitions[t].cancel(),delete this.transitions[t]}_updateAttribute(t,e,n){const i=this.transitions[t];let r=!i||i.type!==n.type;if(r){if(!this.isSupported)return void q.warn("WebGL2 not supported by this browser. Transition for ".concat(t," is disabled."))();i&&this._removeTransition(t);const s=Ed[n.type];s?this.transitions[t]=new s({attribute:e,timeline:this.timeline,gl:this.gl}):(q.error("unsupported transition type '".concat(n.type,"'"))(),r=!1)}(r||e.needsRedraw())&&(this.needsRedraw=!0,this.transitions[t].start(n,this.numInstances))}}const Td="attributeManager.invalidate";class Sd{constructor(t,{id:e="attribute-manager",stats:n,timeline:i}={}){m(this,"id",void 0),m(this,"gl",void 0),m(this,"attributes",void 0),m(this,"updateTriggers",void 0),m(this,"needsRedraw",void 0),m(this,"userData",void 0),m(this,"stats",void 0),m(this,"attributeTransitionManager",void 0),m(this,"mergeBoundsMemoized",za(Dn)),this.id=e,this.gl=t,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=n,this.attributeTransitionManager=new xd(t,{id:"".concat(e,"-transitions"),timeline:i}),Object.seal(this)}finalize(){for(const t in this.attributes)this.attributes[t].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(t={clearRedrawFlags:!1}){const e=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!t.clearRedrawFlags,e&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(t){this._add(t)}addInstanced(t){this._add(t,{instanced:1})}remove(t){for(const e of t)void 0!==this.attributes[e]&&(this.attributes[e].delete(),delete this.attributes[e])}invalidate(t,e){const n=this._invalidateTrigger(t,e);Q(Td,this,t,n)}invalidateAll(t){for(const e in this.attributes)this.attributes[e].setNeedsUpdate(e,t);Q(Td,this,"all")}update({data:t,numInstances:e,startIndices:n=null,transitions:i,props:r={},buffers:s={},context:o={}}){let a=!1;Q("attributeManager.updateStart",this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const i in this.attributes){const l=this.attributes[i],c=l.settings.accessor;l.startIndices=n,l.numInstances=e,r[i]&&q.removed("props.".concat(i),"data.attributes.".concat(i))(),l.setExternalBuffer(s[i])||l.setBinaryValue("string"==typeof c?s[c]:void 0,t.startIndices)||"string"==typeof c&&!s[c]&&l.setConstantValue(r[c])||l.needsUpdate()&&(a=!0,this._updateAttribute({attribute:l,numInstances:e,data:t,props:r,context:o})),this.needsRedraw=this.needsRedraw||l.needsRedraw()}a&&Q("attributeManager.updateEnd",this,e),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:e,transitions:i})}updateTransition(){const{attributeTransitionManager:t}=this,e=t.run();return this.needsRedraw=this.needsRedraw||e,e}getAttributes(){return this.attributes}getBounds(t){const e=t.map((t=>{var e;return null===(e=this.attributes[t])||void 0===e?void 0:e.getBounds()}));return this.mergeBoundsMemoized(e)}getChangedAttributes(t={clearChangedFlags:!1}){const{attributes:e,attributeTransitionManager:n}=this,i={...n.getAttributes()};for(const r in e){const s=e[r];s.needsRedraw(t)&&!n.hasAttribute(r)&&(i[r]=s)}return i}getShaderAttributes(t,e={}){t||(t=this.getAttributes());const n={};for(const i in t)e[i]||Object.assign(n,t[i].getShaderAttributes());return n}_add(t,e={}){for(const n in t){const i=t[n];this.attributes[n]=this._createAttribute(n,i,e)}this._mapUpdateTriggersToAttributes()}_createAttribute(t,e,n){const i={...e,id:t,size:(e.isIndexed?1:e.size)||1,divisor:n.instanced?1:e.divisor||0};return new Jh(this.gl,i)}_mapUpdateTriggersToAttributes(){const t={};for(const e in this.attributes)this.attributes[e].getUpdateTriggers().forEach((n=>{t[n]||(t[n]=[]),t[n].push(e)}));this.updateTriggers=t}_invalidateTrigger(t,e){const{attributes:n,updateTriggers:i}=this,r=i[t];return r&&r.forEach((t=>{const i=n[t];i&&i.setNeedsUpdate(i.id,e)})),r}_updateAttribute(t){const{attribute:e,numInstances:n}=t;Q("attribute.updateStart",e),e.constant?e.setConstantValue(e.value):(e.allocate(n)&&Q("attribute.allocate",e,n),e.updateBuffer(t)&&(this.needsRedraw=!0,Q("attribute.updateEnd",e,n)))}}const Bd=1e-5;function Pd(t,e,n,i,r){const s=e-t;return(n-e)*r+-s*i+s+e}function Md(t,e){if(Array.isArray(t)){let n=0;for(let i=0;i<t.length;i++){const r=t[i]-e[i];n+=r*r}return Math.sqrt(n)}return Math.abs(t-e)}const Id={interpolation:class extends ll{get value(){return this._value}_onUpdate(){const{time:t,settings:{fromValue:e,toValue:n,duration:i,easing:r}}=this,s=r(t/i);this._value=an(e,n,s)}},spring:class extends ll{get value(){return this._currValue}_onUpdate(){const{fromValue:t,toValue:e,damping:n,stiffness:i}=this.settings,{_prevValue:r=t,_currValue:s=t}=this;let o=function(t,e,n,i,r){if(Array.isArray(n)){const s=[];for(let o=0;o<n.length;o++)s[o]=Pd(t[o],e[o],n[o],i,r);return s}return Pd(t,e,n,i,r)}(r,s,e,n,i);const a=Md(o,e),l=Md(o,s);a<Bd&&l<Bd&&(o=e,this.end()),this._prevValue=s,this._currValue=o}}};class Ld{constructor(t){this.transitions=new Map,this.timeline=t}get active(){return this.transitions.size>0}add(t,e,n,i){const{transitions:r}=this;if(r.has(t)){const n=r.get(t),{value:i=n.settings.fromValue}=n;e=i,this.remove(t)}if(!(i=zh(i)))return;const s=Id[i.type];if(!s)return void q.error("unsupported transition type '".concat(i.type,"'"))();const o=new s(this.timeline);o.start({...i,fromValue:e,toValue:n}),r.set(t,o)}remove(t){const{transitions:e}=this;e.has(t)&&(e.get(t).cancel(),e.delete(t))}update(){const t={};for(const[e,n]of this.transitions)n.update(),t[e]=n.value,n.inProgress||this.remove(e);return t}clear(){for(const t of this.transitions.keys())this.remove(t)}}function Od(t,e){if(!t.transitions)return!1;const n={},i=t[A];let r=!1;for(const s in t.transitions){const o=i[s],a=o&&o.type;("number"===a||"color"===a||"array"===a)&&Fd(t[s],e[s],o)&&(n[s]=!0,r=!0)}return!!r&&n}function Rd({newProps:t,oldProps:e,ignoreProps:n={},propTypes:i={},triggerName:r="props"}){if(e===t)return!1;if("object"!=typeof t||null===t)return"".concat(r," changed shallowly");if("object"!=typeof e||null===e)return"".concat(r," changed shallowly");for(const s of Object.keys(t))if(!(s in n)){if(!(s in e))return"".concat(r,".").concat(s," added");const n=Fd(t[s],e[s],i[s]);if(n)return"".concat(r,".").concat(s," ").concat(n)}for(const s of Object.keys(e))if(!(s in n)){if(!(s in t))return"".concat(r,".").concat(s," dropped");if(!Object.hasOwnProperty.call(t,s)){const n=Fd(t[s],e[s],i[s]);if(n)return"".concat(r,".").concat(s," ").concat(n)}}return!1}function Fd(t,e,n){let i=n&&n.equal;return i&&!i(t,e,n)?"changed deeply":i||(i=t&&e&&t.equals,!i||i.call(t,e))?i||e===t?null:"changed shallowly":"changed deeply"}function kd(t,e){if(null===e)return!0;const n=e.extensions,{extensions:i}=t;if(i===n)return!1;if(!n||!i)return!0;if(i.length!==n.length)return!0;for(let t=0;t<i.length;t++)if(!i[t].equals(n[t]))return!0;return!1}function Dd(t,e,n){let i=t.updateTriggers[n];i=null==i?{}:i;let r=e.updateTriggers[n];return r=null==r?{}:r,Rd({oldProps:r,newProps:i,triggerName:n})}function Nd(t,e){if(!e)return t;const n={...t,...e};if("defines"in e&&(n.defines={...t.defines,...e.defines}),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some((t=>"project64"===t.name)))){const t=n.modules.findIndex((t=>"project32"===t.name));t>=0&&n.modules.splice(t,1)}if("inject"in e)if(t.inject){const i={...t.inject};for(const t in e.inject)i[t]=(i[t]||"")+e.inject[t];n.inject=i}else n.inject=e.inject;return n}const Ud=[0,0,0];function zd(t,e,n=!1){const i=e.projectPosition(t);if(n&&e instanceof al){const[n,r,s=0]=t,o=e.getDistanceScales([n,r]);i[2]=s*o.unitsPerMeter[2]}return i}function Gd(t,{viewport:e,modelMatrix:n,coordinateSystem:i,coordinateOrigin:r,offsetMode:s}){let[o,a,l=0]=t;switch(n&&([o,a,l]=Zn([],[o,a,l,1],n)),i){case Li.LNGLAT:return zd([o,a,l],e,s);case Li.LNGLAT_OFFSETS:return zd([o+r[0],a+r[1],l+(r[2]||0)],e,s);case Li.METER_OFFSETS:return zd(xi(r,[o,a,l]),e,s);case Li.CARTESIAN:default:return e.isGeospatial?[o+r[0],a+r[1],l+r[2]]:e.projectPosition([o,a,l])}}const jd={10241:9987,10240:9729,10242:33071,10243:33071},Vd={},Hd={boolean:{validate:(t,e)=>!0,equal:(t,e,n)=>Boolean(t)===Boolean(e)},number:{validate:(t,e)=>Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)},color:{validate:(t,e)=>e.optional&&!t||qd(t)&&(3===t.length||4===t.length),equal:(t,e,n)=>tl(t,e,1)},accessor:{validate(t,e){const n=Kd(t);return"function"===n||n===Kd(e.value)},equal:(t,e,n)=>"function"==typeof e||tl(t,e,1)},array:{validate:(t,e)=>e.optional&&!t||qd(t),equal(t,e,n){const{compare:i}=n,r=Number.isInteger(i)?i:i?1:0;return i?tl(t,e,r):t===e}},object:{equal(t,e,n){if(n.ignore)return!0;const{compare:i}=n,r=Number.isInteger(i)?i:i?1:0;return i?tl(t,e,r):t===e}},function:{validate:(t,e)=>e.optional&&!t||"function"==typeof t,equal:(t,e,n)=>!n.compare&&!1!==n.ignore||t===e},data:{transform:(t,e,n)=>{const{dataTransform:i}=n.props;return i&&t?i(t):t}},image:{transform:(t,e,n)=>{const i=n.context;return i&&i.gl?function(t,e,n,i){if(n instanceof Eo)return n;n.constructor&&"Object"!==n.constructor.name&&(n={data:n});let r=null;n.compressed&&(r={10241:n.data.length>1?9985:9729});const s=new Eo(e,{...n,parameters:{...jd,...r,...i}});return Vd[s.id]=t,s}(n.id,i.gl,t,{...e.parameters,...n.props.textureParameters}):null},release:(t,e,n)=>{var i,r;i=n.id,(r=t)&&r instanceof Eo&&Vd[r.id]===i&&(r.delete(),delete Vd[r.id])}}};function Wd(t,e){switch(Kd(e)){case"object":return Jd(t,e);case"array":return Jd(t,{type:"array",value:e,compare:!1});case"boolean":return Jd(t,{type:"boolean",value:e});case"number":return Jd(t,{type:"number",value:e});case"function":return Jd(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function Jd(t,e){return"type"in e?{name:t,...Hd[e.type],...e}:"value"in e?{name:t,type:Kd(e.value),...e}:{name:t,type:"object",value:e}}function qd(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function Kd(t){return qd(t)?"array":null===t?"null":typeof t}function Xd(t,e){let n="_mergedDefaultProps";if(e)for(const t of e){const e=t.constructor;e&&(n+=":".concat(e.extensionName||e.name))}return Zd(t,n)||(t[n]=function(t,e){if(!t.prototype)return null;const n=Xd(Object.getPrototypeOf(t)),i=function(t){const e={},n={},i={};for(const[r,s]of Object.entries(t)){const t=null==s?void 0:s.deprecatedFor;if(t)i[r]=Array.isArray(t)?t:[t];else{const t=Wd(r,s);e[r]=t,n[r]=t.value}}return{propTypes:e,defaultProps:n,deprecatedProps:i}}(Zd(t,"defaultProps")||{}),r=Object.assign(Object.create(null),n,i.defaultProps),s=Object.assign(Object.create(null),null==n?void 0:n[A],i.propTypes),o=Object.assign(Object.create(null),null==n?void 0:n[w],i.deprecatedProps);for(const t of e){const e=Xd(t.constructor);e&&(Object.assign(r,e),Object.assign(s,e[A]),Object.assign(o,e[w]))}return function(t,e){const n=function(t){const e=t.componentName;return e||q.warn("".concat(t.name,".componentName not specified"))(),e||t.name}(e);Object.defineProperties(t,{id:{writable:!0,value:n}})}(r,t),function(t,e){const n={},i={};for(const t in e){const r=e[t],{name:s,value:o}=r;r.async&&(n[s]=o,i[s]=Qd(s))}t[C]=n,t[E]={},Object.defineProperties(t,i)}(r,s),function(t,e){for(const n in e)Object.defineProperty(t,n,{enumerable:!1,set(t){const i="".concat(this.id,": ").concat(n);for(const i of e[n])Yd(this,i)||(this[i]=t);q.deprecated(i,e[n].join("/"))()}})}(r,o),r[A]=s,r[w]=o,0!==e.length||Yd(t,"_propTypes")||(t._propTypes=s),r}(t,e||[]))}function Qd(t){return{enumerable:!0,set(e){"string"==typeof e||e instanceof Promise||Rh(e)?this[E][t]=e:this[x][t]=e},get(){if(this[x]){if(t in this[x])return this[x][t]||this[C][t];if(t in this[E]){const e=this[_]&&this[_].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[C][t]}}return this[C][t]}}}function Yd(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Zd(t,e){return Yd(t,e)&&t[e]}let $d=0;class tf{constructor(...t){m(this,"id",void 0),m(this,"props",void 0),m(this,"count",void 0),this.props=function(t,e){let n;for(let t=e.length-1;t>=0;t--){const i=e[t];"extensions"in i&&(n=i.extensions)}const i=Xd(t.constructor,n),r=Object.create(i);r[_]=t,r[E]={},r[x]={};for(let t=0;t<e.length;++t){const n=e[t];for(const t in n)r[t]=n[t]}return Object.freeze(r),r}(this,t),this.id=this.props.id,this.count=$d++}clone(t){const{props:e}=this,n={};for(const t in e[C])t in e[x]?n[t]=e[x][t]:t in e[E]&&(n[t]=e[E][t]);return new this.constructor({...e,...n,...t})}}m(tf,"componentName","Component"),m(tf,"defaultProps",{});const ef=Object.freeze({});class nf{constructor(t){m(this,"component",void 0),m(this,"onAsyncPropUpdated",void 0),m(this,"asyncProps",void 0),m(this,"oldProps",void 0),m(this,"oldAsyncProps",void 0),this.component=t,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const t in this.asyncProps){const e=this.asyncProps[t];e&&e.type&&e.type.release&&e.type.release(e.resolvedValue,e.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||ef}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(t){return t in this.asyncProps}getAsyncProp(t){const e=this.asyncProps[t];return e&&e.resolvedValue}isAsyncPropLoading(t){if(t){const e=this.asyncProps[t];return Boolean(e&&e.pendingLoadCount>0&&e.pendingLoadCount!==e.resolvedLoadCount)}for(const t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(t,e){this._watchPromise(t,Promise.resolve(e))}setAsyncProps(t){this.component=t[_]||this.component;const e=t[x]||{},n=t[E]||t,i=t[C]||{};for(const t in e){const n=e[t];this._createAsyncPropData(t,i[t]),this._updateAsyncProp(t,n),e[t]=this.getAsyncProp(t)}for(const t in n){const e=n[t];this._createAsyncPropData(t,i[t]),this._updateAsyncProp(t,e)}}_fetch(t,e){return null}_onResolve(t,e){}_onError(t,e){}_updateAsyncProp(t,e){this._didAsyncInputValueChange(t,e)&&("string"==typeof e&&(e=this._fetch(t,e)),e instanceof Promise?this._watchPromise(t,e):Rh(e)?this._resolveAsyncIterable(t,e):this._setPropValue(t,e))}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const t in this.asyncProps)Object.defineProperty(this.oldAsyncProps,t,{enumerable:!0,value:this.oldProps[t]})}}_didAsyncInputValueChange(t,e){const n=this.asyncProps[t];return e!==n.resolvedValue&&e!==n.lastValue&&(n.lastValue=e,!0)}_setPropValue(t,e){this._freezeAsyncOldProps();const n=this.asyncProps[t];n&&(e=this._postProcessValue(n,e),n.resolvedValue=e,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount)}_setAsyncPropValue(t,e,n){const i=this.asyncProps[t];i&&n>=i.resolvedLoadCount&&void 0!==e&&(this._freezeAsyncOldProps(),i.resolvedValue=e,i.resolvedLoadCount=n,this.onAsyncPropUpdated(t,e))}_watchPromise(t,e){const n=this.asyncProps[t];if(n){n.pendingLoadCount++;const i=n.pendingLoadCount;e.then((e=>{this.component&&(e=this._postProcessValue(n,e),this._setAsyncPropValue(t,e,i),this._onResolve(t,e))})).catch((e=>{this._onError(t,e)}))}}async _resolveAsyncIterable(t,e){if("data"!==t)return void this._setPropValue(t,e);const n=this.asyncProps[t];if(!n)return;n.pendingLoadCount++;const i=n.pendingLoadCount;let r=[],s=0;for await(const n of e){if(!this.component)return;const{dataTransform:e}=this.component.props;r=e?e(n,r):r.concat(n),Object.defineProperty(r,"__diff",{enumerable:!1,value:[{startRow:s,endRow:r.length}]}),s=r.length,this._setAsyncPropValue(t,r,i)}this._onResolve(t,r)}_postProcessValue(t,e){const n=t.type;return n&&this.component&&(n.release&&n.release(t.resolvedValue,n,this.component),n.transform)?n.transform(e,n,this.component):e}_createAsyncPropData(t,e){if(!this.asyncProps[t]){const n=this.component&&this.component.props[A];this.asyncProps[t]={type:n&&n[t],lastValue:null,resolvedValue:e,pendingLoadCount:0,resolvedLoadCount:0}}}}class rf extends nf{constructor({attributeManager:t,layer:e}){super(e),m(this,"attributeManager",void 0),m(this,"needsRedraw",void 0),m(this,"needsUpdate",void 0),m(this,"subLayers",void 0),m(this,"usesPickingColorCache",void 0),m(this,"hasPickingBuffer",void 0),m(this,"changeFlags",void 0),m(this,"viewport",void 0),m(this,"uniformTransitions",void 0),m(this,"propsInTransition",void 0),this.attributeManager=t,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(t,e){const n=this.layer,i=null==n?void 0:n.props.fetch;return i?i(e,{propName:t,layer:n}):super._fetch(t,e)}_onResolve(t,e){const n=this.layer;if(n){const i=n.props.onDataLoad;"data"===t&&i&&i(e,{propName:t,layer:n})}}_onError(t,e){const n=this.layer;n&&n.raiseError(e,"loading ".concat(t," of ").concat(this.layer))}}const sf=2**24-1,of=Object.freeze([]),af=za((({oldViewport:t,viewport:e})=>t.equals(e)));let lf=new Uint8ClampedArray(0);const cf={data:{type:"data",value:of,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:n,loaders:i,loadOptions:r,signal:s})=>{const{resourceManager:o}=n.context;var a;r=r||n.getLoadOptions(),i=i||n.props.loaders,s&&(r={...r,fetch:{...null===(a=r)||void 0===a?void 0:a.fetch,signal:s}});let l=o.contains(t);return l||r||(o.add({resourceId:t,data:qe(t,i),persistent:!1}),l=!0),l?o.subscribe({resourceId:t,onChange:t=>{var i;return null===(i=n.internalState)||void 0===i?void 0:i.reloadAsyncProp(e,t)},consumerId:n.id,requestId:e}):qe(t,i,r)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Li.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,100*-t]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class uf extends tf{constructor(...t){super(...t),m(this,"internalState",null),m(this,"lifecycle","Awaiting state"),m(this,"context",void 0),m(this,"state",void 0),m(this,"parent",null)}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let t=this;for(;t.parent;)t=t.parent;return t}toString(){const t=this.constructor.layerName||this.constructor.name;return"".concat(t,"({id: '").concat(this.props.id,"'})")}project(t){sl(this.internalState);const e=this.internalState.viewport||this.context.viewport,n=Gd(t,{viewport:e,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,r,s]=Bi(n,e.pixelProjectionMatrix);return 2===t.length?[i,r]:[i,r,s]}unproject(t){return sl(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(t)}projectPosition(t,e){return sl(this.internalState),function(t,e){const{viewport:n,coordinateSystem:i,coordinateOrigin:r,modelMatrix:s,fromCoordinateSystem:o,fromCoordinateOrigin:a}=function(t){const{viewport:e,modelMatrix:n,coordinateOrigin:i}=t;let{coordinateSystem:r,fromCoordinateSystem:s,fromCoordinateOrigin:o}=t;return r===Li.DEFAULT&&(r=e.isGeospatial?Li.LNGLAT:Li.CARTESIAN),void 0===s&&(s=r),void 0===o&&(o=i),{viewport:e,coordinateSystem:r,coordinateOrigin:i,modelMatrix:n,fromCoordinateSystem:s,fromCoordinateOrigin:o}}(e),{autoOffset:l=!0}=e,{geospatialOrigin:c=Ud,shaderCoordinateOrigin:u=Ud,offsetMode:h=!1}=l?qa(n,i,r):{},d=Gd(t,{viewport:n,modelMatrix:s,coordinateSystem:o,coordinateOrigin:a,offsetMode:h});h&&function(t,e,n){t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2]}(d,d,n.projectPosition(c||u));return d}(t,{viewport:this.internalState.viewport||this.context.viewport,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...e})}get isComposite(){return!1}setState(t){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,t),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return!!this.internalState&&!this.internalState.isAsyncPropLoading()}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(t){for(const e of this.getModels())e.updateModuleSettings(t)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:t}=this.props;return t===Li.DEFAULT||t===Li.LNGLAT||t===Li.CARTESIAN}onHover(t,e){return this.props.onHover&&this.props.onHover(t,e)||!1}onClick(t,e){return this.props.onClick&&this.props.onClick(t,e)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(t,e=[]){return e[0]=t+1&255,e[1]=t+1>>8&255,e[2]=t+1>>8>>8&255,e}decodePickingColor(t){sl(t instanceof Uint8Array);const[e,n,i]=t;return e+256*n+65536*i-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&void 0!==this.state.numInstances?this.state.numInstances:function(t){if(null===(e=t)||"object"!=typeof e)throw new Error("count(): argument not an object");var e;if("function"==typeof t.count)return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(function(t){return null!==t&&"object"==typeof t&&t.constructor===Object}(t))return Object.keys(t).length;throw new Error("count(): argument not a container")}(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var t;return null===(t=this.getAttributeManager())||void 0===t?void 0:t.getBounds(["positions","instancePositions"])}getShaders(t){for(const e of this.props.extensions)t=Nd(t,e.getShaders.call(this,e));return t}shouldUpdateState(t){return t.changeFlags.propsOrDataChanged}updateState(t){const e=this.getAttributeManager(),{dataChanged:n}=t.changeFlags;if(n&&e)if(Array.isArray(n))for(const t of n)e.invalidateAll(t);else e.invalidateAll();if(e){const{props:n}=t,i=this.internalState.hasPickingBuffer,r=Number.isInteger(n.highlightedObjectIndex)||n.pickable||n.extensions.some((t=>t.getNeedsPickingBuffer.call(this,t)));if(i!==r){this.internalState.hasPickingBuffer=r;const{pickingColors:t,instancePickingColors:n}=e.attributes,i=t||n;i&&(r&&i.constant&&(i.constant=!1,e.invalidate(i.id)),i.value||r||(i.constant=!0,i.value=[0,0,0]))}}}finalizeState(t){for(const t of this.getModels())t.delete();const e=this.getAttributeManager();e&&e.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(t){for(const e of this.getModels())e.draw(t)}getPickingInfo({info:t,mode:e,sourceLayer:n}){const{index:i}=t;return i>=0&&Array.isArray(this.props.data)&&(t.object=this.props.data[i]),t}raiseError(t,e){var n,i,r,s;e&&(t=new Error("".concat(e,": ").concat(t.message),{cause:t})),null!==(n=(i=this.props).onError)&&void 0!==n&&n.call(i,t)||null===(r=this.context)||void 0===r||null===(s=r.onError)||void 0===s||s.call(r,t,this)}getNeedsRedraw(t={clearRedrawFlags:!1}){return this._getNeedsRedraw(t)}needsUpdate(){return!!this.internalState&&(this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()))}hasUniformTransition(){var t;return(null===(t=this.internalState)||void 0===t?void 0:t.uniformTransitions.active)||!1}activateViewport(t){if(!this.internalState)return;const e=this.internalState.viewport;this.internalState.viewport=t,e&&af({oldViewport:e,viewport:t})||(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(t="all"){const e=this.getAttributeManager();e&&("all"===t?e.invalidateAll():e.invalidate(t))}updateAttributes(t){for(const e of this.getModels())this._setModelAttributes(e,t)}_updateAttributes(){const t=this.getAttributeManager();if(!t)return;const e=this.props,n=this.getNumInstances(),i=this.getStartIndices();t.update({data:e.data,numInstances:n,startIndices:i,props:e,transitions:e.transitions,buffers:e.data.attributes,context:this});const r=t.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(r)}_updateAttributeTransition(){const t=this.getAttributeManager();t&&t.updateTransition()}_updateUniformTransition(){const{uniformTransitions:t}=this.internalState;if(t.active){const e=t.update(),n=Object.create(this.props);for(const t in e)Object.defineProperty(n,t,{value:e[t]});return n}return this.props}calculateInstancePickingColors(t,{numInstances:e}){if(t.constant)return;const n=Math.floor(lf.length/3);if(this.internalState.usesPickingColorCache=!0,n<e){e>sf&&q.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),lf=Qe.allocate(lf,e,{size:3,copy:!0,maxCount:Math.max(e,sf)});const t=Math.floor(lf.length/3),i=[];for(let e=n;e<t;e++)this.encodePickingColor(e,i),lf[3*e+0]=i[0],lf[3*e+1]=i[1],lf[3*e+2]=i[2]}t.value=lf.subarray(0,3*e)}_setModelAttributes(t,e){const n=this.getAttributeManager(),i=t.userData.excludeAttributes||{},r=n.getShaderAttributes(e,i);t.setAttributes(r)}disablePickingIndex(t){const e=this.props.data;if(!("attributes"in e))return void this._disablePickingIndex(t);const{pickingColors:n,instancePickingColors:i}=this.getAttributeManager().attributes,r=n||i,s=r&&e.attributes&&e.attributes[r.id];if(s&&s.value){const n=s.value,i=this.encodePickingColor(t);for(let t=0;t<e.length;t++){const e=r.getVertexOffset(t);n[e]===i[0]&&n[e+1]===i[1]&&n[e+2]===i[2]&&this._disablePickingIndex(t)}}else this._disablePickingIndex(t)}_disablePickingIndex(t){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,i=e||n;if(!i)return;const r=i.getVertexOffset(t),s=i.getVertexOffset(t+1);i.buffer.subData({data:new Uint8Array(s-r),offset:r})}restorePickingColors(){const{pickingColors:t,instancePickingColors:e}=this.getAttributeManager().attributes,n=t||e;n&&(this.internalState.usesPickingColorCache&&n.value.buffer!==lf.buffer&&(n.value=lf.subarray(0,n.value.length)),n.updateSubBuffer({startOffset:0}))}_initialize(){sl(!this.internalState),sl(Number.isFinite(this.props.coordinateSystem)),Q("layer.initialize",this);const t=this._getAttributeManager();t&&t.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new rf({attributeManager:t,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(q.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),t)}),this.internalState.uniformTransitions=new Ld(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(t){Q("layer.matched",this,this===t);const{state:e,internalState:n}=t;this!==t&&(this.internalState=n,this.state=e,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const t=this.needsUpdate();if(Q("layer.update",this,t),!t)return;const e=this.props,n=this.context,i=this.internalState,r=n.viewport,s=this._updateUniformTransition();i.propsInTransition=s,n.viewport=i.viewport||r,this.props=s;try{const t=this._getUpdateParams(),e=this.getModels();if(n.gl)this.updateState(t);else try{this.updateState(t)}catch(t){}for(const e of this.props.extensions)e.updateState.call(this,t,e);const i=this.getModels()[0]!==e[0];this._postUpdate(t,i)}finally{n.viewport=r,this.props=e,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){Q("layer.finalize",this),this.finalizeState(this.context);for(const t of this.props.extensions)t.finalizeState.call(this,this.context,t)}_drawLayer({moduleParameters:t=null,uniforms:e={},parameters:n={}}){this._updateAttributeTransition();const i=this.props,r=this.context;this.props=this.internalState.propsInTransition||i;const s=this.props.opacity;e.opacity=Math.pow(s,1/2.2);try{t&&this.setModuleParameters(t);const{getPolygonOffset:i}=this.props,s=i&&i(e)||[0,0];Is(r.gl,{polygonOffset:s}),Ls(r.gl,n,(()=>{const i={moduleParameters:t,uniforms:e,parameters:n,context:r};for(const t of this.props.extensions)t.draw.call(this,i,t);this.draw(i)}))}finally{this.props=i}}getChangeFlags(){var t;return null===(t=this.internalState)||void 0===t?void 0:t.changeFlags}setChangeFlags(t){if(!this.internalState)return;const{changeFlags:e}=this.internalState;for(const n in t)if(t[n]){let i=!1;if("dataChanged"===n){const r=t[n],s=e[n];r&&Array.isArray(s)&&(e.dataChanged=Array.isArray(r)?s.concat(r):r,i=!0)}e[n]||(e[n]=t[n],i=!0),i&&Q("layer.changeFlag",this,n,t)}const n=Boolean(e.dataChanged||e.updateTriggersChanged||e.propsChanged||e.extensionsChanged);e.propsOrDataChanged=n,e.somethingChanged=n||e.viewportChanged||e.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(t,e){const n=function(t,e){const n=Rd({newProps:t,oldProps:e,propTypes:t[A],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=function(t,e){if(null===e)return"oldProps is null, initial diff";let n=!1;const{dataComparator:i,_dataDiff:r}=t;return i?i(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied"),n&&r&&(n=r(t.data,e.data)||n),n}(t,e);let r=!1;return i||(r=function(t,e){if(null===e)return{all:!0};if("all"in t.updateTriggers&&Dd(t,e,"all"))return{all:!0};const n={};let i=!1;for(const r in t.updateTriggers)"all"!==r&&Dd(t,e,r)&&(n[r]=!0,i=!0);return!!i&&n}(t,e)),{dataChanged:i,propsChanged:n,updateTriggersChanged:r,extensionsChanged:kd(t,e),transitionsChanged:Od(t,e)}}(t,e);if(n.updateTriggersChanged)for(const t in n.updateTriggersChanged)n.updateTriggersChanged[t]&&this.invalidateAttribute(t);if(n.transitionsChanged)for(const r in n.transitionsChanged){var i;this.internalState.uniformTransitions.add(r,e[r],t[r],null===(i=t.transitions)||void 0===i?void 0:i[r])}return this.setChangeFlags(n)}validateProps(){!function(t){const e=t[A];for(const n in e){const i=e[n],{validate:r}=i;if(r&&!r(t[n],i))throw new Error("Invalid prop ".concat(n,": ").concat(t[n]))}}(this.props)}updateAutoHighlight(t){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(t)}_updateAutoHighlight(t){const e={pickingSelectedColor:t.picked?t.color:null},{highlightColor:n}=this.props;t.picked&&"function"==typeof n&&(e.pickingHighlightColor=n(t)),this.setModuleParameters(e),this.setNeedsRedraw()}_getAttributeManager(){const t=this.context;return new Sd(t.gl,{id:this.props.id,stats:t.stats,timeline:t.timeline})}_postUpdate(t,e){const{props:n,oldProps:i}=t;this.setNeedsRedraw(),this._updateAttributes();const{model:r}=this.state;null==r||r.setInstanceCount(this.getNumInstances());const{autoHighlight:s,highlightedObjectIndex:o,highlightColor:a}=n;if(e||i.autoHighlight!==s||i.highlightedObjectIndex!==o||i.highlightColor!==a){const t={};s||(t.pickingSelectedColor=null),Array.isArray(a)&&(t.pickingHighlightColor=a),(e||o!==i.highlightedObjectIndex)&&(t.pickingSelectedColor=Number.isFinite(o)&&o>=0?this.encodePickingColor(o):null),this.setModuleParameters(t)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(t){if(!this.internalState)return!1;let e=!1;e=e||this.internalState.needsRedraw&&this.id;const n=this.getAttributeManager(),i=!!n&&n.getNeedsRedraw(t);if(e=e||i,e)for(const t of this.props.extensions)t.onNeedsRedraw.call(this,t);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!t.clearRedrawFlags,e}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}m(uf,"defaultProps",cf),m(uf,"layerName","Layer");class hf extends uf{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every((t=>t.isLoaded))}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(t){}setState(t){super.setState(t),this.setNeedsUpdate()}getPickingInfo({info:t}){const{object:e}=t;return e&&e.__source&&e.__source.parent&&e.__source.parent.id===this.id?(t.object=e.__source.object,t.index=e.__source.index,t):t}filterSubLayer(t){return!0}shouldRenderSubLayer(t,e){return e&&e.length}getSubLayerClass(t,e){const{_subLayerProps:n}=this.props;return n&&n[t]&&n[t].type||e}getSubLayerRow(t,e,n){return t.__source={parent:this,object:e,index:n},t}getSubLayerAccessor(t){if("function"==typeof t){const e={index:-1,data:this.props.data,target:[]};return(n,i)=>n&&n.__source?(e.index=n.__source.index,t(n.__source.object,e)):t(n,i)}return t}getSubLayerProps(t={}){var e;const{opacity:n,pickable:i,visible:r,parameters:s,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:l,highlightColor:c,coordinateSystem:u,coordinateOrigin:h,wrapLongitude:d,positionFormat:f,modelMatrix:p,extensions:g,fetch:m,operation:v,_subLayerProps:y}=this.props,b={id:"",updateTriggers:{},opacity:n,pickable:i,visible:r,parameters:s,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:l,highlightColor:c,coordinateSystem:u,coordinateOrigin:h,wrapLongitude:d,positionFormat:f,modelMatrix:p,extensions:g,fetch:m,operation:v},_=y&&t.id&&y[t.id],w=_&&_.updateTriggers,C=t.id||"sublayer";if(_){const e=this.props[A],n=t.type?t.type._propTypes:{};for(const t in _){const i=n[t]||e[t];i&&"accessor"===i.type&&(_[t]=this.getSubLayerAccessor(_[t]))}}Object.assign(b,t,_),b.id="".concat(this.props.id,"-").concat(C),b.updateTriggers={all:null===(e=this.props.updateTriggers)||void 0===e?void 0:e.all,...t.updateTriggers,...w};for(const t of g){const e=t.getSubLayerProps.call(this,t);e&&Object.assign(b,e,{updateTriggers:Object.assign(b.updateTriggers,e.updateTriggers)})}return b}_updateAutoHighlight(t){for(const e of this.getSubLayers())e.updateAutoHighlight(t)}_getAttributeManager(){return null}_postUpdate(t,e){let n=this.internalState.subLayers;const i=!n||this.needsUpdate();i&&(n=Y(this.renderLayers(),Boolean),this.internalState.subLayers=n),Q("compositeLayer.renderLayers",this,i,n);for(const t of n)t.parent=this}}function df({data:t,getIndex:e,dataRange:n,replace:i}){const{startRow:r=0,endRow:s=1/0}=n,o=t.length;let a=o,l=o;for(let n=0;n<o;n++){const i=e(t[n]);if(a>n&&i>=r&&(a=n),i>=s){l=n;break}}let c=a;const u=l-a!==i.length?t.slice(l):void 0;for(let e=0;e<i.length;e++)t[c++]=i[e];if(u){for(let e=0;e<u.length;e++)t[c++]=u[e];t.length=c}return{startRow:a,endRow:a+i.length}}m(hf,"layerName","CompositeLayer");const ff={name:"project32",dependencies:[Xa],vs:"\nvec4 project_position_to_clipspace(\n  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition\n) {\n  vec3 projectedPosition = project_position(position, position64Low);\n  mat3 rotation;\n  if (project_needs_rotation(projectedPosition, rotation)) {\n    // offset is specified as ENU\n    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe\n    offset = rotation * offset;\n  }\n  commonPosition = vec4(projectedPosition + offset, 1.0);\n  return project_common_position_to_clipspace(commonPosition);\n}\n\nvec4 project_position_to_clipspace(\n  vec3 position, vec3 position64Low, vec3 offset\n) {\n  vec4 commonPosition;\n  return project_position_to_clipspace(position, position64Low, offset, commonPosition);\n}\n"},pf={pickingSelectedColor:null,pickingHighlightColor:new Uint8Array([0,255,255,255]),pickingActive:!1,pickingAttribute:!1},gf={inject:{"vs:DECKGL_FILTER_GL_POSITION":"\n    // for picking depth values\n    picking_setPickingAttribute(position.z / position.w);\n  ","vs:DECKGL_FILTER_COLOR":"\n  picking_setPickingColor(geometry.pickingColor);\n  ","fs:#decl":"\nuniform bool picking_uAttribute;\n  ","fs:DECKGL_FILTER_COLOR":{order:99,injection:"\n  // use highlight color if this fragment belongs to the selected object.\n  color = picking_filterHighlightColor(color);\n\n  // use picking color if rendering to picking FBO.\n  color = picking_filterPickingColor(color);\n    "}},...{name:"picking",vs:"uniform bool picking_uActive;\nuniform bool picking_uAttribute;\nuniform vec3 picking_uSelectedColor;\nuniform bool picking_uSelectedColorValid;\n\nout vec4 picking_vRGBcolor_Avalid;\n\nconst float COLOR_SCALE = 1. / 255.;\n\nbool picking_isColorValid(vec3 color) {\n  return dot(color, vec3(1.0)) > 0.001;\n}\n\nbool isVertexPicked(vec3 vertexColor) {\n  return\n    picking_uSelectedColorValid &&\n    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));\n}\n\nvoid picking_setPickingColor(vec3 pickingColor) {\n  if (picking_uActive) {\n    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));\n\n    if (!picking_uAttribute) {\n      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;\n    }\n  } else {\n    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));\n  }\n}\n\nvoid picking_setPickingAttribute(float value) {\n  if (picking_uAttribute) {\n    picking_vRGBcolor_Avalid.r = value;\n  }\n}\nvoid picking_setPickingAttribute(vec2 value) {\n  if (picking_uAttribute) {\n    picking_vRGBcolor_Avalid.rg = value;\n  }\n}\nvoid picking_setPickingAttribute(vec3 value) {\n  if (picking_uAttribute) {\n    picking_vRGBcolor_Avalid.rgb = value;\n  }\n}\n",fs:"uniform bool picking_uActive;\nuniform vec3 picking_uSelectedColor;\nuniform vec4 picking_uHighlightColor;\n\nin vec4 picking_vRGBcolor_Avalid;\nvec4 picking_filterHighlightColor(vec4 color) {\n  if (picking_uActive) {\n    return color;\n  }\n  bool selected = bool(picking_vRGBcolor_Avalid.a);\n\n  if (selected) {\n    float highLightAlpha = picking_uHighlightColor.a;\n    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);\n    float highLightRatio = highLightAlpha / blendedAlpha;\n\n    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);\n    return vec4(blendedRGB, blendedAlpha);\n  } else {\n    return color;\n  }\n}\nvec4 picking_filterPickingColor(vec4 color) {\n  if (picking_uActive) {\n    if (picking_vRGBcolor_Avalid.a == 0.0) {\n      discard;\n    }\n    return picking_vRGBcolor_Avalid;\n  }\n  return color;\n}\nvec4 picking_filterColor(vec4 color) {\n  vec4 highightColor = picking_filterHighlightColor(color);\n  return picking_filterPickingColor(highightColor);\n}\n\n",getUniforms:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:pf;const e={};if(void 0!==t.pickingSelectedColor)if(t.pickingSelectedColor){const n=t.pickingSelectedColor.slice(0,3);e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=n}else e.picking_uSelectedColorValid=0;if(t.pickingHighlightColor){const n=Array.from(t.pickingHighlightColor,(t=>t/255));Number.isFinite(n[3])||(n[3]=1),e.picking_uHighlightColor=n}return void 0!==t.pickingActive&&(e.picking_uActive=Boolean(t.pickingActive),e.picking_uAttribute=Boolean(t.pickingAttribute)),e}}},mf={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class vf{static get DRAW_MODE(){return mf}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{id:e=$s("geometry"),drawMode:n=mf.TRIANGLES,attributes:i={},indices:r=null,vertexCount:s=null}=t;this.id=e,this.drawMode=0|n,this.attributes={},this.userData={},this._setAttributes(i,r),this.vertexCount=s||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(t){return"Geometry ".concat(this.id," attribute ").concat(t)}_setAttributes(t,e){e&&(this.indices=ArrayBuffer.isView(e)?{value:e,size:1}:e);for(const e in t){let n=t[e];n=ArrayBuffer.isView(n)?{value:n}:n,Xs(ArrayBuffer.isView(n.value),"".concat(this._print(e),": must be typed array or object with value as typed array")),"POSITION"!==e&&"positions"!==e||n.size||(n.size=3),"indices"===e?(Xs(!this.indices),this.indices=n):this.attributes[e]=n}return this.indices&&void 0!==this.indices.isIndexed&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(t,e){if(e)return e.value.length;let n=1/0;for(const e in t){const i=t[e],{value:r,size:s,constant:o}=i;!o&&r&&s>=1&&(n=Math.min(n,r.length/s))}return Xs(Number.isFinite(n)),n}}const yf=()=>{},bf={10241:9987,10240:9729,10242:33071,10243:33071};function _f(t,e,n,i){const r=Math.min(n/e.width,i/e.height),s=Math.floor(e.width*r),o=Math.floor(e.height*r);return 1===r?{data:e,width:s,height:o}:(t.canvas.height=o,t.canvas.width=s,t.clearRect(0,0,s,o),t.drawImage(e,0,0,e.width,e.height,0,0,s,o),{data:t.canvas,width:s,height:o})}function Af(t){return t&&(t.id||t.url)}function wf(t,e,n){for(let i=0;i<e.length;i++){const{icon:r,xOffset:s}=e[i];t[Af(r)]={...r,x:s,y:n}}}class Cf{constructor(t,{onUpdate:e=yf,onError:n=yf}){m(this,"gl",void 0),m(this,"onUpdate",void 0),m(this,"onError",void 0),m(this,"_loadOptions",null),m(this,"_texture",null),m(this,"_externalTexture",null),m(this,"_mapping",{}),m(this,"_textureParameters",null),m(this,"_pendingCount",0),m(this,"_autoPacking",!1),m(this,"_xOffset",0),m(this,"_yOffset",0),m(this,"_rowHeight",0),m(this,"_buffer",4),m(this,"_canvasWidth",1024),m(this,"_canvasHeight",0),m(this,"_canvas",null),this.gl=t,this.onUpdate=e,this.onError=n}finalize(){var t;null===(t=this._texture)||void 0===t||t.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(t){const e=this._autoPacking?Af(t):t;return this._mapping[e]||{}}setProps({loadOptions:t,autoPacking:e,iconAtlas:n,iconMapping:i,textureParameters:r}){var s;t&&(this._loadOptions=t),void 0!==e&&(this._autoPacking=e),i&&(this._mapping=i),n&&(null===(s=this._texture)||void 0===s||s.delete(),this._texture=null,this._externalTexture=n),r&&(this._textureParameters=r)}get isLoaded(){return 0===this._pendingCount}packIcons(t,e){if(!this._autoPacking||"undefined"==typeof document)return;const n=Object.values(function(t,e,n){if(!t||!e)return null;n=n||{};const i={},{iterable:r,objectInfo:s}=Oh(t);for(const t of r){s.index++;const r=e(t,s),o=Af(r);if(!r)throw new Error("Icon is missing.");if(!r.url)throw new Error("Icon url is missing.");i[o]||n[o]&&r.url===n[o].url||(i[o]={...r,source:t,sourceIndex:s.index})}return i}(t,e,this._mapping)||{});if(n.length>0){const{mapping:t,xOffset:e,yOffset:i,rowHeight:r,canvasHeight:s}=function({icons:t,buffer:e,mapping:n={},xOffset:i=0,yOffset:r=0,rowHeight:s=0,canvasWidth:o}){let a=[];for(let l=0;l<t.length;l++){const c=t[l];if(!n[Af(c)]){const{height:t,width:l}=c;i+l+e>o&&(wf(n,a,r),i=0,r=s+r+e,s=0,a=[]),a.push({icon:c,xOffset:i}),i=i+l+e,s=Math.max(s,t)}}return a.length>0&&wf(n,a,r),{mapping:n,rowHeight:s,xOffset:i,yOffset:r,canvasWidth:o,canvasHeight:(l=s+r+e,Math.pow(2,Math.ceil(Math.log2(l))))};var l}({icons:n,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=r,this._mapping=t,this._xOffset=e,this._yOffset=i,this._canvasHeight=s,this._texture||(this._texture=new Eo(this.gl,{width:this._canvasWidth,height:this._canvasHeight,parameters:this._textureParameters||bf})),this._texture.height!==this._canvasHeight&&(this._texture=function(t,e,n,i){const r=t.width,s=t.height,o=new Eo(t.gl,{width:e,height:n,parameters:i});return function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{sourceX:i=0,sourceY:r=0,targetMipmaplevel:s=0,targetInternalFormat:o=6408}=n;let{targetX:a,targetY:l,targetZ:c,width:u,height:h}=n;const{framebuffer:d,deleteFramebuffer:f}=Do(t);Xs(d);const{gl:p,handle:g}=d,m=void 0!==a||void 0!==l||void 0!==c;a=a||0,l=l||0,c=c||0;const v=p.bindFramebuffer(36160,g);Xs(e);let y=null;if(e instanceof Co&&(y=e,u=Number.isFinite(u)?u:y.width,h=Number.isFinite(h)?h:y.height,y.bind(0),e=y.target),m)switch(e){case 3553:case 34067:p.copyTexSubImage2D(e,s,a,l,i,r,u,h);break;case 35866:case 32879:ts(p).copyTexSubImage3D(e,s,a,l,c,i,r,u,h)}else p.copyTexImage2D(e,s,o,i,r,u,h,0);y&&y.unbind(),p.bindFramebuffer(36160,v||null),f&&d.delete()}(t,o,{targetY:0,width:r,height:s}),t.delete(),o}(this._texture,this._canvasWidth,this._canvasHeight,this._textureParameters||bf)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(n)}}_loadIcons(t){const e=this._canvas.getContext("2d",{willReadFrequently:!0});for(const n of t)this._pendingCount++,qe(n.url,this._loadOptions).then((t=>{const i=Af(n),r=this._mapping[i],{x:s,y:o,width:a,height:l}=r,{data:c,width:u,height:h}=_f(e,t,a,l);this._texture.setSubImageData({data:c,x:s+(a-u)/2,y:o+(l-h)/2,width:u,height:h}),r.width=u,r.height=h,this._texture.generateMipmap(),this.onUpdate()})).catch((t=>{this.onError({url:n.url,source:n.source,sourceIndex:n.sourceIndex,loadOptions:this._loadOptions,error:t})})).finally((()=>{this._pendingCount--}))}}const Ef=[0,0,0,255],xf={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:t=>t.position},getIcon:{type:"accessor",value:t=>t.icon},getColor:{type:"accessor",value:Ef},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0}};class Tf extends uf{constructor(...t){super(...t),m(this,"state",void 0)}getShaders(){return super.getShaders({vs:"#define SHADER_NAME icon-layer-vertex-shader\n\nattribute vec2 positions;\n\nattribute vec3 instancePositions;\nattribute vec3 instancePositions64Low;\nattribute float instanceSizes;\nattribute float instanceAngles;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute vec4 instanceIconFrames;\nattribute float instanceColorModes;\nattribute vec2 instanceOffsets;\nattribute vec2 instancePixelOffset;\n\nuniform float sizeScale;\nuniform vec2 iconsTextureDim;\nuniform float sizeMinPixels;\nuniform float sizeMaxPixels;\nuniform bool billboard;\nuniform int sizeUnits;\n\nvarying float vColorMode;\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\nvarying vec2 uv;\n\nvec2 rotate_by_angle(vec2 vertex, float angle) {\n  float angle_radian = angle * PI / 180.0;\n  float cos_angle = cos(angle_radian);\n  float sin_angle = sin(angle_radian);\n  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);\n  return rotationMatrix * vertex;\n}\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n  geometry.uv = positions;\n  geometry.pickingColor = instancePickingColors;\n  uv = positions;\n\n  vec2 iconSize = instanceIconFrames.zw;\n  float sizePixels = clamp(\n    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits), \n    sizeMinPixels, sizeMaxPixels\n  );\n  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;\n  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;\n  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;\n  pixelOffset += instancePixelOffset;\n  pixelOffset.y *= -1.0;\n\n  if (billboard)  {\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\n    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n    vec3 offset = vec3(pixelOffset, 0.0);\n    DECKGL_FILTER_SIZE(offset, geometry);\n    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n\n  } else {\n    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);\n    DECKGL_FILTER_SIZE(offset_common, geometry);\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position); \n    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  }\n\n  vTextureCoords = mix(\n    instanceIconFrames.xy,\n    instanceIconFrames.xy + iconSize,\n    (positions.xy + 1.0) / 2.0\n  ) / iconsTextureDim;\n\n  vColor = instanceColors;\n  DECKGL_FILTER_COLOR(vColor, geometry);\n\n  vColorMode = instanceColorModes;\n}\n",fs:"#define SHADER_NAME icon-layer-fragment-shader\n\nprecision highp float;\n\nuniform float opacity;\nuniform sampler2D iconsTexture;\nuniform float alphaCutoff;\n\nvarying float vColorMode;\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\nvarying vec2 uv;\n\nvoid main(void) {\n  geometry.uv = uv;\n\n  vec4 texColor = texture2D(iconsTexture, vTextureCoords);\n  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);\n  float a = texColor.a * opacity * vColor.a;\n\n  if (a < alphaCutoff) {\n    discard;\n  }\n\n  gl_FragColor = vec4(color, a);\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[ff,gf]})}initializeState(){this.state={iconManager:new Cf(this.context.gl,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:5121,accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:Ef},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(t){super.updateState(t);const{props:e,oldProps:n,changeFlags:i}=t,r=this.getAttributeManager(),{iconAtlas:s,iconMapping:o,data:a,getIcon:l,textureParameters:c}=e,{iconManager:u}=this.state,h=s||this.internalState.isAsyncPropLoading("iconAtlas");if(u.setProps({loadOptions:e.loadOptions,autoPacking:!h,iconAtlas:s,iconMapping:h?o:null,textureParameters:c}),h?n.iconMapping!==e.iconMapping&&r.invalidate("getIcon"):(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getIcon))&&u.packIcons(a,l),i.extensionsChanged){var d;const{gl:t}=this.context;null===(d=this.state.model)||void 0===d||d.delete(),this.state.model=this._getModel(t),r.invalidateAll()}}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(t){super.finalizeState(t),this.state.iconManager.finalize()}draw({uniforms:t}){const{sizeScale:e,sizeMinPixels:n,sizeMaxPixels:i,sizeUnits:r,billboard:s,alphaCutoff:o}=this.props,{iconManager:a}=this.state,l=a.getTexture();l&&this.state.model.setUniforms(t).setUniforms({iconsTexture:l,iconsTextureDim:[l.width,l.height],sizeUnits:Ri[r],sizeScale:e,sizeMinPixels:n,sizeMaxPixels:i,billboard:s,alphaCutoff:o}).draw()}_getModel(t){return new wd(t,{...this.getShaders(),id:this.props.id,geometry:new vf({drawMode:6,attributes:{positions:{size:2,value:new Float32Array([-1,-1,-1,1,1,1,1,-1])}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(t){var e;const n=null===(e=this.getCurrentLayer())||void 0===e?void 0:e.props.onIconError;n?n(t):q.error(t.error.message)()}getInstanceOffset(t){const{width:e,height:n,anchorX:i=e/2,anchorY:r=n/2}=this.state.iconManager.getIconMapping(t);return[e/2-i,n/2-r]}getInstanceColorMode(t){return this.state.iconManager.getIconMapping(t).mask?1:0}getInstanceIconFrame(t){const{x:e,y:n,width:i,height:r}=this.state.iconManager.getIconMapping(t);return[e,n,i,r]}}m(Tf,"defaultProps",xf),m(Tf,"layerName","IconLayer");const Sf=[0,0,0,255],Bf={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:t=>t.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:Sf},getLineColor:{type:"accessor",value:Sf},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class Pf extends uf{getShaders(){return super.getShaders({vs:"#define SHADER_NAME scatterplot-layer-vertex-shader\n\nattribute vec3 positions;\n\nattribute vec3 instancePositions;\nattribute vec3 instancePositions64Low;\nattribute float instanceRadius;\nattribute float instanceLineWidths;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform float radiusScale;\nuniform float radiusMinPixels;\nuniform float radiusMaxPixels;\nuniform float lineWidthScale;\nuniform float lineWidthMinPixels;\nuniform float lineWidthMaxPixels;\nuniform float stroked;\nuniform bool filled;\nuniform bool antialiasing;\nuniform bool billboard;\nuniform int radiusUnits;\nuniform int lineWidthUnits;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying vec2 unitPosition;\nvarying float innerUnitRadius;\nvarying float outerRadiusPixels;\n\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n  outerRadiusPixels = clamp(\n    project_size_to_pixel(radiusScale * instanceRadius, radiusUnits),\n    radiusMinPixels, radiusMaxPixels\n  );\n  float lineWidthPixels = clamp(\n    project_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),\n    lineWidthMinPixels, lineWidthMaxPixels\n  );\n  outerRadiusPixels += stroked * lineWidthPixels / 2.0;\n  float edgePadding = antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;\n  unitPosition = edgePadding * positions.xy;\n  geometry.uv = unitPosition;\n  geometry.pickingColor = instancePickingColors;\n\n  innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;\n  \n  if (billboard) {\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\n    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n    vec3 offset = edgePadding * positions * outerRadiusPixels;\n    DECKGL_FILTER_SIZE(offset, geometry);\n    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n  } else {\n    vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);\n    DECKGL_FILTER_SIZE(offset, geometry);\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);\n    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  }\n  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);\n  DECKGL_FILTER_COLOR(vFillColor, geometry);\n  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);\n  DECKGL_FILTER_COLOR(vLineColor, geometry);\n}\n",fs:"#define SHADER_NAME scatterplot-layer-fragment-shader\n\nprecision highp float;\n\nuniform bool filled;\nuniform float stroked;\nuniform bool antialiasing;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying vec2 unitPosition;\nvarying float innerUnitRadius;\nvarying float outerRadiusPixels;\n\nvoid main(void) {\n  geometry.uv = unitPosition;\n\n  float distToCenter = length(unitPosition) * outerRadiusPixels;\n  float inCircle = antialiasing ? \n    smoothedge(distToCenter, outerRadiusPixels) : \n    step(distToCenter, outerRadiusPixels);\n\n  if (inCircle == 0.0) {\n    discard;\n  }\n\n  if (stroked > 0.5) {\n    float isLine = antialiasing ? \n      smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :\n      step(innerUnitRadius * outerRadiusPixels, distToCenter);\n\n    if (filled) {\n      gl_FragColor = mix(vFillColor, vLineColor, isLine);\n    } else {\n      if (isLine == 0.0) {\n        discard;\n      }\n      gl_FragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);\n    }\n  } else if (!filled) {\n    discard;\n  } else {\n    gl_FragColor = vFillColor;\n  }\n\n  gl_FragColor.a *= inCircle;\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[ff,gf]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(t){if(super.updateState(t),t.changeFlags.extensionsChanged){var e;const{gl:t}=this.context;null===(e=this.state.model)||void 0===e||e.delete(),this.state.model=this._getModel(t),this.getAttributeManager().invalidateAll()}}draw({uniforms:t}){const{radiusUnits:e,radiusScale:n,radiusMinPixels:i,radiusMaxPixels:r,stroked:s,filled:o,billboard:a,antialiasing:l,lineWidthUnits:c,lineWidthScale:u,lineWidthMinPixels:h,lineWidthMaxPixels:d}=this.props;this.state.model.setUniforms(t).setUniforms({stroked:s?1:0,filled:o,billboard:a,antialiasing:l,radiusUnits:Ri[e],radiusScale:n,radiusMinPixels:i,radiusMaxPixels:r,lineWidthUnits:Ri[c],lineWidthScale:u,lineWidthMinPixels:h,lineWidthMaxPixels:d}).draw()}_getModel(t){return new wd(t,{...this.getShaders(),id:this.props.id,geometry:new vf({drawMode:6,vertexCount:4,attributes:{positions:{size:3,value:new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,1,0])}}}),isInstanced:!0})}}m(Pf,"defaultProps",Bf),m(Pf,"layerName","ScatterplotLayer");const Mf=.75,If=[];class Lf extends Tf{constructor(...t){super(...t),m(this,"state",void 0)}getShaders(){return{...super.getShaders(),fs:"#define SHADER_NAME multi-icon-layer-fragment-shader\n\nprecision highp float;\n\nuniform float opacity;\nuniform sampler2D iconsTexture;\nuniform float gamma;\nuniform bool sdf;\nuniform float alphaCutoff;\nuniform float sdfBuffer;\nuniform float outlineBuffer;\nuniform vec4 outlineColor;\n\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\nvarying vec2 uv;\n\nvoid main(void) {\n  geometry.uv = uv;\n\n  if (!picking_uActive) {\n    float alpha = texture2D(iconsTexture, vTextureCoords).a;\n    vec4 color = vColor;\n    if (sdf) {\n      float distance = alpha;\n      alpha = smoothstep(sdfBuffer - gamma, sdfBuffer + gamma, distance);\n\n      if (outlineBuffer > 0.0) {\n        float inFill = alpha;\n        float inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);\n        color = mix(outlineColor, vColor, inFill);\n        alpha = inBorder;\n      }\n    }\n    float a = alpha * color.a;\n    \n    if (a < alphaCutoff) {\n      discard;\n    }\n\n    gl_FragColor = vec4(color.rgb, a * opacity);\n  }\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n"}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:5121,size:3,accessor:(t,{index:e,target:n})=>this.encodePickingColor(e,n)}})}updateState(t){super.updateState(t);const{props:e,oldProps:n}=t;let{outlineColor:i}=e;i!==n.outlineColor&&(i=i.map((t=>t/255)),i[3]=Number.isFinite(i[3])?i[3]:1,this.setState({outlineColor:i})),!e.sdf&&e.outlineWidth&&q.warn("".concat(this.id,": fontSettings.sdf is required to render outline"))()}draw(t){const{sdf:e,smoothing:n,outlineWidth:i}=this.props,{outlineColor:r}=this.state,s=i?Math.max(n,Mf*(1-i)):-1;if(t.uniforms={...t.uniforms,sdfBuffer:Mf,outlineBuffer:s,gamma:n,sdf:Boolean(e),outlineColor:r},super.draw(t),e&&i){const{iconManager:t}=this.state;t.getTexture()&&this.state.model.draw({uniforms:{outlineBuffer:Mf}})}}getInstanceOffset(t){return t?Array.from(t).flatMap((t=>super.getInstanceOffset(t))):If}getInstanceColorMode(t){return 1}getInstanceIconFrame(t){return t?Array.from(t).flatMap((t=>super.getInstanceIconFrame(t))):If}}m(Lf,"defaultProps",{getIconOffsets:{type:"accessor",value:t=>t.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}}),m(Lf,"layerName","MultiIconLayer");const Of=1e20;class Rf{constructor({fontSize:t=24,buffer:e=3,radius:n=8,cutoff:i=.25,fontFamily:r="sans-serif",fontWeight:s="normal",fontStyle:o="normal"}={}){this.buffer=e,this.cutoff=i,this.radius=n;const a=this.size=t+4*e,l=this._createCanvas(a),c=this.ctx=l.getContext("2d",{willReadFrequently:!0});c.font=`${o} ${s} ${t}px ${r}`,c.textBaseline="alphabetic",c.textAlign="left",c.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:i,actualBoundingBoxLeft:r,actualBoundingBoxRight:s}=this.ctx.measureText(t),o=Math.ceil(n),a=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(s-r))),l=Math.min(this.size-this.buffer,o+Math.ceil(i)),c=a+2*this.buffer,u=l+2*this.buffer,h=Math.max(c*u,0),d=new Uint8ClampedArray(h),f={data:d,width:c,height:u,glyphWidth:a,glyphHeight:l,glyphTop:o,glyphLeft:0,glyphAdvance:e};if(0===a||0===l)return f;const{ctx:p,buffer:g,gridInner:m,gridOuter:v}=this;p.clearRect(g,g,a,l),p.fillText(t,g,g+o);const y=p.getImageData(g,g,a,l);v.fill(Of,0,h),m.fill(0,0,h);for(let t=0;t<l;t++)for(let e=0;e<a;e++){const n=y.data[4*(t*a+e)+3]/255;if(0===n)continue;const i=(t+g)*c+e+g;if(1===n)v[i]=0,m[i]=Of;else{const t=.5-n;v[i]=t>0?t*t:0,m[i]=t<0?t*t:0}}Ff(v,0,0,c,u,c,this.f,this.v,this.z),Ff(m,g,g,a,l,c,this.f,this.v,this.z);for(let t=0;t<h;t++){const e=Math.sqrt(v[t])-Math.sqrt(m[t]);d[t]=Math.round(255-255*(e/this.radius+this.cutoff))}return f}}function Ff(t,e,n,i,r,s,o,a,l){for(let c=e;c<e+i;c++)kf(t,n*s+c,s,r,o,a,l);for(let c=n;c<n+r;c++)kf(t,c*s+e,1,i,o,a,l)}function kf(t,e,n,i,r,s,o){s[0]=0,o[0]=-Of,o[1]=Of,r[0]=t[e];for(let a=1,l=0,c=0;a<i;a++){r[a]=t[e+a*n];const i=a*a;do{const t=s[l];c=(r[a]-r[t]+i-t*t)/(a-t)/2}while(c<=o[l]&&--l>-1);l++,s[l]=a,o[l]=c,o[l+1]=Of}for(let a=0,l=0;a<i;a++){for(;o[l+1]<a;)l++;const i=s[l],c=a-i;t[e+a*n]=r[i]+c*c}}const Df=[];function Nf(t,e,n,i){let r=0;for(let o=e;o<n;o++){var s;r+=(null===(s=i[t[o]])||void 0===s?void 0:s.layoutWidth)||0}return r}function Uf(t,e,n,i,r,s){let o=e,a=0;for(let l=e;l<n;l++){const e=Nf(t,l,l+1,r);a+e>i&&(o<l&&s.push(l),o=l,a=0),a+=e}return a}function zf(t,e,n,i,r=0,s){void 0===s&&(s=t.length);const o=[];return"break-all"===e?Uf(t,r,s,n,i,o):function(t,e,n,i,r,s){let o=e,a=e,l=e,c=0;for(let u=e;u<n;u++)if(" "===t[u]?l=u+1:" "!==t[u+1]&&u+1!==n||(l=u+1),l>a){let e=Nf(t,a,l,r);c+e>i&&(o<a&&(s.push(a),o=a,c=0),e>i&&(e=Uf(t,a,l,i,r,s),o=s[s.length-1])),a=l,c+=e}}(t,r,s,n,i,o),o}function Gf(t,e,n,i,r,s){let o=0,a=0;for(let s=e;s<n;s++){const e=t[s],n=i[e];n?(a||(a=n.layoutHeight),r[s]=o+n.layoutWidth/2,o+=n.layoutWidth):(q.warn("Missing character: ".concat(e," (").concat(e.codePointAt(0),")"))(),r[s]=o,o+=32)}s[0]=o,s[1]=a}class jf{constructor(t=5){m(this,"limit",void 0),m(this,"_cache",{}),m(this,"_order",[]),this.limit=t}get(t){const e=this._cache[t];return e&&(this._deleteOrder(t),this._appendOrder(t)),e}set(t,e){this._cache[t]?(this.delete(t),this._cache[t]=e,this._appendOrder(t)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[t]=e,this._appendOrder(t))}delete(t){this._cache[t]&&(delete this._cache[t],this._deleteOrder(t))}_deleteOrder(t){const e=this._order.indexOf(t);e>=0&&this._order.splice(e,1)}_appendOrder(t){this._order.push(t)}}const Vf={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:function(){const t=[];for(let e=32;e<128;e++)t.push(String.fromCharCode(e));return t}(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1};let Hf=new jf(3);function Wf(t,e){for(let n=0;n<t.length;n++)e.data[4*n+3]=t[n]}function Jf(t,e,n,i){t.font="".concat(i," ").concat(n,"px ").concat(e),t.fillStyle="#000",t.textBaseline="alphabetic",t.textAlign="left"}class qf{constructor(){m(this,"props",{...Vf}),m(this,"_key",void 0),m(this,"_atlas",void 0)}get texture(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:t,buffer:e}=this.props;return(1.2*t+2*e)/t}setProps(t={}){Object.assign(this.props,t),this._key=this._getKey();const e=function(t,e){let n;n="string"==typeof e?new Set(Array.from(e)):new Set(e);const i=Hf.get(t);if(!i)return n;for(const t in i.mapping)n.has(t)&&n.delete(t);return n}(this._key,this.props.characterSet),n=Hf.get(this._key);if(n&&0===e.size)return void(this._atlas!==n&&(this._atlas=n));const i=this._generateFontAtlas(e,n);this._atlas=i,Hf.set(this._key,i)}_generateFontAtlas(t,e){const{fontFamily:n,fontWeight:i,fontSize:r,buffer:s,sdf:o,radius:a,cutoff:l}=this.props;let c=e&&e.data;c||(c=document.createElement("canvas"),c.width=1024);const u=c.getContext("2d",{willReadFrequently:!0});Jf(u,n,r,i);const{mapping:h,canvasHeight:d,xOffset:f,yOffset:p}=function({characterSet:t,getFontWidth:e,fontHeight:n,buffer:i,maxCanvasWidth:r,mapping:s={},xOffset:o=0,yOffset:a=0}){let l=0,c=o;const u=n+2*i;for(const o of t)if(!s[o]){const t=e(o);c+t+2*i>r&&(c=0,l++),s[o]={x:c+i,y:a+l*u+i,width:t,height:u,layoutWidth:t,layoutHeight:n},c+=t+2*i}return{mapping:s,xOffset:c,yOffset:a+l*u,canvasHeight:(h=a+(l+1)*u,Math.pow(2,Math.ceil(Math.log2(h))))};var h}({getFontWidth:t=>u.measureText(t).width,fontHeight:1.2*r,buffer:s,characterSet:t,maxCanvasWidth:1024,...e&&{mapping:e.mapping,xOffset:e.xOffset,yOffset:e.yOffset}});if(c.height!==d){const t=u.getImageData(0,0,c.width,c.height);c.height=d,u.putImageData(t,0,0)}if(Jf(u,n,r,i),o){const e=new Rf({fontSize:r,buffer:s,radius:a,cutoff:l,fontFamily:n,fontWeight:"".concat(i)});for(const n of t){const{data:t,width:i,height:s,glyphTop:o}=e.draw(n);h[n].width=i,h[n].layoutOffsetY=.9*r-o;const a=u.createImageData(i,s);Wf(t,a),u.putImageData(a,h[n].x,h[n].y)}}else for(const e of t)u.fillText(e,h[e].x,h[e].y+s+.9*r);return{xOffset:f,yOffset:p,mapping:h,data:c,width:c.width,height:c.height}}_getKey(){const{fontFamily:t,fontWeight:e,fontSize:n,buffer:i,sdf:r,radius:s,cutoff:o}=this.props;return r?"".concat(t," ").concat(e," ").concat(n," ").concat(i," ").concat(s," ").concat(o):"".concat(t," ").concat(e," ").concat(n," ").concat(i)}}const Kf={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:t=>t.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class Xf extends uf{constructor(...t){super(...t),m(this,"state",void 0)}getShaders(){return super.getShaders({vs:"#define SHADER_NAME text-background-layer-vertex-shader\n\nattribute vec2 positions;\n\nattribute vec3 instancePositions;\nattribute vec3 instancePositions64Low;\nattribute vec4 instanceRects;\nattribute float instanceSizes;\nattribute float instanceAngles;\nattribute vec2 instancePixelOffsets;\nattribute float instanceLineWidths;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute vec3 instancePickingColors;\n\nuniform bool billboard;\nuniform float opacity;\nuniform float sizeScale;\nuniform float sizeMinPixels;\nuniform float sizeMaxPixels;\nuniform vec4 padding;\nuniform int sizeUnits;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying float vLineWidth;\nvarying vec2 uv;\nvarying vec2 dimensions;\n\nvec2 rotate_by_angle(vec2 vertex, float angle) {\n  float angle_radian = radians(angle);\n  float cos_angle = cos(angle_radian);\n  float sin_angle = sin(angle_radian);\n  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);\n  return rotationMatrix * vertex;\n}\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n  geometry.uv = positions;\n  geometry.pickingColor = instancePickingColors;\n  uv = positions;\n  vLineWidth = instanceLineWidths;\n  float sizePixels = clamp(\n    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),\n    sizeMinPixels, sizeMaxPixels\n  );\n\n  dimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;\n\n  vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);\n  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);\n  pixelOffset += instancePixelOffsets;\n  pixelOffset.y *= -1.0;\n\n  if (billboard)  {\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\n    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n    vec3 offset = vec3(pixelOffset, 0.0);\n    DECKGL_FILTER_SIZE(offset, geometry);\n    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n  } else {\n    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);\n    DECKGL_FILTER_SIZE(offset_common, geometry);\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);\n    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  }\n  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);\n  DECKGL_FILTER_COLOR(vFillColor, geometry);\n  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);\n  DECKGL_FILTER_COLOR(vLineColor, geometry);\n}\n",fs:"#define SHADER_NAME text-background-layer-fragment-shader\n\nprecision highp float;\n\nuniform bool stroked;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying float vLineWidth;\nvarying vec2 uv;\nvarying vec2 dimensions;\n\nvoid main(void) {\n  geometry.uv = uv;\n\n  vec2 pixelPosition = uv * dimensions;\n  if (stroked) {\n    float distToEdge = min(\n      min(pixelPosition.x, dimensions.x - pixelPosition.x),\n      min(pixelPosition.y, dimensions.y - pixelPosition.y)\n    );\n    float isBorder = smoothedge(distToEdge, vLineWidth);\n    gl_FragColor = mix(vFillColor, vLineColor, isBorder);\n  } else {\n    gl_FragColor = vFillColor;\n  }\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[ff,gf]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(t){super.updateState(t);const{changeFlags:e}=t;if(e.extensionsChanged){var n;const{gl:t}=this.context;null===(n=this.state.model)||void 0===n||n.delete(),this.state.model=this._getModel(t),this.getAttributeManager().invalidateAll()}}draw({uniforms:t}){const{billboard:e,sizeScale:n,sizeUnits:i,sizeMinPixels:r,sizeMaxPixels:s,getLineWidth:o}=this.props;let{padding:a}=this.props;a.length<4&&(a=[a[0],a[1],a[0],a[1]]),this.state.model.setUniforms(t).setUniforms({billboard:e,stroked:Boolean(o),padding:a,sizeUnits:Ri[i],sizeScale:n,sizeMinPixels:r,sizeMaxPixels:s}).draw()}_getModel(t){return new wd(t,{...this.getShaders(),id:this.props.id,geometry:new vf({drawMode:6,vertexCount:4,attributes:{positions:{size:2,value:new Float32Array([0,0,1,0,1,1,0,1])}}}),isInstanced:!0})}}m(Xf,"defaultProps",Kf),m(Xf,"layerName","TextBackgroundLayer");const Qf={start:1,middle:0,end:-1},Yf={top:1,center:0,bottom:-1},Zf=[0,0,0,255],$f={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:Zf},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:Vf.characterSet},fontFamily:Vf.fontFamily,fontWeight:Vf.fontWeight,lineHeight:1,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:Zf},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:t=>t.text},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:Zf},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class tp extends hf{constructor(...t){super(...t),m(this,"state",void 0),m(this,"getBoundingRect",((t,e)=>{let{size:[n,i]}=this.transformParagraph(t,e);const{fontSize:r}=this.state.fontAtlasManager.props;n/=r,i/=r;const{getTextAnchor:s,getAlignmentBaseline:o}=this.props;return[(Qf["function"==typeof s?s(t,e):s]-1)*n/2,(Yf["function"==typeof o?o(t,e):o]-1)*i/2,n,i]})),m(this,"getIconOffsets",((t,e)=>{const{getTextAnchor:n,getAlignmentBaseline:i}=this.props,{x:r,y:s,rowWidth:o,size:[a,l]}=this.transformParagraph(t,e),c=Qf["function"==typeof n?n(t,e):n],u=Yf["function"==typeof i?i(t,e):i],h=r.length,d=new Array(2*h);let f=0;for(let t=0;t<h;t++){const e=(1-c)*(a-o[t])/2;d[f++]=(c-1)*a/2+e+r[t],d[f++]=(u-1)*l/2+s[t]}return d}))}initializeState(){this.state={styleVersion:0,fontAtlasManager:new qf},this.props.maxWidth>0&&q.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(t){const{props:e,oldProps:n,changeFlags:i}=t;(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||e.lineHeight!==n.lineHeight||e.wordBreak!==n.wordBreak||e.maxWidth!==n.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:t}){return t.object=t.index>=0?this.props.data[t.index]:null,t}_updateFontAtlas(){const{fontSettings:t,fontFamily:e,fontWeight:n}=this.props,{fontAtlasManager:i,characterSet:r}=this.state,s={...t,characterSet:r,fontFamily:e,fontWeight:n};if(!i.mapping)return i.setProps(s),!0;for(const t in s)if(s[t]!==i.props[t])return i.setProps(s),!0;return!1}_updateText(){var t;const{data:e,characterSet:n}=this.props,i=null===(t=e.attributes)||void 0===t?void 0:t.getText;let r,{getText:s}=this.props,o=e.startIndices;const a="auto"===n&&new Set;if(i&&o){const{texts:t,characterCount:n}=function({value:t,length:e,stride:n,offset:i,startIndices:r,characterSet:s}){const o=t.BYTES_PER_ELEMENT,a=n?n/o:1,l=i?i/o:0,c=r[e]||Math.ceil((t.length-l)/a),u=s&&new Set,h=new Array(e);let d=t;if(a>1||l>0){d=new(0,t.constructor)(c);for(let e=0;e<c;e++)d[e]=t[e*a+l]}for(let t=0;t<e;t++){const e=r[t],n=r[t+1]||c,i=d.subarray(e,n);h[t]=String.fromCodePoint.apply(null,i),u&&i.forEach(u.add,u)}if(u)for(const t of u)s.add(String.fromCodePoint(t));return{texts:h,characterCount:c}}({...ArrayBuffer.isView(i)?{value:i}:i,length:e.length,startIndices:o,characterSet:a});r=n,s=(e,{index:n})=>t[n]}else{const{iterable:t,objectInfo:n}=Oh(e);o=[0],r=0;for(const e of t){n.index++;const t=Array.from(s(e,n)||"");a&&t.forEach(a.add,a),r+=t.length,o.push(r)}}this.setState({getText:s,startIndices:o,numInstances:r,characterSet:a||n})}transformParagraph(t,e){const{fontAtlasManager:n}=this.state,i=n.mapping,r=this.state.getText,{wordBreak:s,lineHeight:o,maxWidth:a}=this.props;return function(t,e,n,i,r){const s=Array.from(t),o=s.length,a=new Array(o),l=new Array(o),c=new Array(o),u=("break-word"===n||"break-all"===n)&&isFinite(i)&&i>0,h=[0,0],d=[0,0];let f=0,p=0,g=0;for(let t=0;t<=o;t++){const v=s[t];if("\n"!==v&&t!==o||(g=t),g>p){const t=u?zf(s,n,i,r,p,g):Df;for(let n=0;n<=t.length;n++){const i=0===n?p:t[n-1],o=n<t.length?t[n]:g;Gf(s,i,o,r,a,d);for(let t=i;t<o;t++){var m;const e=(null===(m=r[s[t]])||void 0===m?void 0:m.layoutOffsetY)||0;l[t]=f+d[1]/2+e,c[t]=d[0]}f+=d[1]*e,h[0]=Math.max(h[0],d[0])}p=g}"\n"===v&&(a[p]=0,l[p]=0,c[p]=0,p++)}return h[1]=f,{x:a,y:l,rowWidth:c,size:h}}(r(t,e)||"",o,s,a*n.props.fontSize,i)}renderLayers(){const{startIndices:t,numInstances:e,getText:n,fontAtlasManager:{scale:i,texture:r,mapping:s},styleVersion:o}=this.state,{data:a,_dataDiff:l,getPosition:c,getColor:u,getSize:h,getAngle:d,getPixelOffset:f,getBackgroundColor:p,getBorderColor:g,getBorderWidth:m,backgroundPadding:v,background:y,billboard:b,fontSettings:_,outlineWidth:A,outlineColor:w,sizeScale:C,sizeUnits:E,sizeMinPixels:x,sizeMaxPixels:T,transitions:S,updateTriggers:B}=this.props,P=this.getSubLayerClass("characters",Lf),M=this.getSubLayerClass("background",Xf);return[y&&new M({getFillColor:p,getLineColor:g,getLineWidth:m,padding:v,getPosition:c,getSize:h,getAngle:d,getPixelOffset:f,billboard:b,sizeScale:C,sizeUnits:E,sizeMinPixels:x,sizeMaxPixels:T,transitions:S&&{getPosition:S.getPosition,getAngle:S.getAngle,getSize:S.getSize,getFillColor:S.getBackgroundColor,getLineColor:S.getBorderColor,getLineWidth:S.getBorderWidth,getPixelOffset:S.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:B.getPosition,getAngle:B.getAngle,getSize:B.getSize,getFillColor:B.getBackgroundColor,getLineColor:B.getBorderColor,getLineWidth:B.getBorderWidth,getPixelOffset:B.getPixelOffset,getBoundingRect:{getText:B.getText,getTextAnchor:B.getTextAnchor,getAlignmentBaseline:B.getAlignmentBaseline,styleVersion:o}}}),{data:a.attributes&&a.attributes.background?{length:a.length,attributes:a.attributes.background}:a,_dataDiff:l,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new P({sdf:_.sdf,smoothing:Number.isFinite(_.smoothing)?_.smoothing:Vf.smoothing,outlineWidth:A/(_.radius||Vf.radius),outlineColor:w,iconAtlas:r,iconMapping:s,getPosition:c,getColor:u,getSize:h,getAngle:d,getPixelOffset:f,billboard:b,sizeScale:C*i,sizeUnits:E,sizeMinPixels:x*i,sizeMaxPixels:T*i,transitions:S&&{getPosition:S.getPosition,getAngle:S.getAngle,getColor:S.getColor,getSize:S.getSize,getPixelOffset:S.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:B.getText,getPosition:B.getPosition,getAngle:B.getAngle,getColor:B.getColor,getSize:B.getSize,getPixelOffset:B.getPixelOffset,getIconOffsets:{getTextAnchor:B.getTextAnchor,getAlignmentBaseline:B.getAlignmentBaseline,styleVersion:o}}}),{data:a,_dataDiff:l,startIndices:t,numInstances:e,getIconOffsets:this.getIconOffsets,getIcon:n})]}static set fontAtlasCacheLimit(t){!function(t){q.assert(Number.isFinite(t)&&t>=3,"Invalid cache limit"),Hf=new jf(t)}(t)}}m(tp,"defaultProps",$f),m(tp,"layerName","TextLayer");class ep{constructor(t){m(this,"opts",void 0),m(this,"typedArrayManager",void 0),m(this,"indexStarts",[0]),m(this,"vertexStarts",[0]),m(this,"vertexCount",0),m(this,"instanceCount",0),m(this,"attributes",void 0),m(this,"_attributeDefs",void 0),m(this,"data",void 0),m(this,"getGeometry",void 0),m(this,"geometryBuffer",void 0),m(this,"buffers",void 0),m(this,"positionSize",void 0),m(this,"normalize",void 0);const{attributes:e={}}=t;this.typedArrayManager=Qe,this.attributes={},this._attributeDefs=e,this.opts=t,this.updateGeometry(t)}updateGeometry(t){Object.assign(this.opts,t);const{data:e,buffers:n={},getGeometry:i,geometryBuffer:r,positionFormat:s,dataChanged:o,normalize:a=!0}=this.opts;if(this.data=e,this.getGeometry=i,this.positionSize=r&&r.size||("XY"===s?2:3),this.buffers=n,this.normalize=a,r&&(sl(e.startIndices),this.getGeometry=this.getGeometryFromBuffer(r),a||(n.positions=r)),this.geometryBuffer=n.positions,Array.isArray(o))for(const t of o)this._rebuildGeometry(t);else this._rebuildGeometry()}updatePartialGeometry({startRow:t,endRow:e}){this._rebuildGeometry({startRow:t,endRow:e})}getGeometryFromBuffer(t){const e=t.value||t;return ArrayBuffer.isView(e)?Fh(e,{size:this.positionSize,offset:t.offset,stride:t.stride,startIndices:this.data.startIndices}):null}_allocate(t,e){const{attributes:n,buffers:i,_attributeDefs:r,typedArrayManager:s}=this;for(const o in r)if(o in i)s.release(n[o]),n[o]=null;else{const i=r[o];i.copy=e,n[o]=s.allocate(n[o],t,i)}}_forEachGeometry(t,e,n){const{data:i,getGeometry:r}=this,{iterable:s,objectInfo:o}=Oh(i,e,n);for(const e of s)o.index++,t(r?r(e,o):null,o.index)}_rebuildGeometry(t){if(!this.data)return;let{indexStarts:e,vertexStarts:n,instanceCount:i}=this;const{data:r,geometryBuffer:s}=this,{startRow:o=0,endRow:a=1/0}=t||{},l={};if(t||(e=[0],n=[0]),this.normalize||!s)this._forEachGeometry(((t,e)=>{const i=t&&this.normalizeGeometry(t);l[e]=i,n[e+1]=n[e]+(i?this.getGeometrySize(i):0)}),o,a),i=n[n.length-1];else if(n=r.startIndices,i=n[r.length]||0,ArrayBuffer.isView(s))i=i||s.length/this.positionSize;else if(s instanceof vo){const t=s.accessor.stride||4*this.positionSize;i=i||s.byteLength/t}else if(s.buffer){const t=s.stride||4*this.positionSize;i=i||s.buffer.byteLength/t}else if(s.value){const t=s.value,e=s.stride/t.BYTES_PER_ELEMENT||this.positionSize;i=i||t.length/e}this._allocate(i,Boolean(t)),this.indexStarts=e,this.vertexStarts=n,this.instanceCount=i;const c={};this._forEachGeometry(((t,r)=>{const s=l[r]||t;c.vertexStart=n[r],c.indexStart=e[r];const o=r<n.length-1?n[r+1]:i;c.geometrySize=o-n[r],c.geometryIndex=r,this.updateGeometryAttributes(s,c)}),o,a),this.vertexCount=e[e.length-1]}}function np(t,e,n={}){const i=function(t,e={}){return Math.sign(function(t,e={}){const{start:n=0,end:i=t.length}=e,r=e.size||2;let s=0;for(let e=n,o=i-r;e<i;e+=r)s+=(t[e]-t[o])*(t[e+1]+t[o+1]),o=e;return s/2}(t,e))}(t,n);return i!==e&&(function(t,e){const{start:n=0,end:i=t.length,size:r=2}=e,s=(i-n)/r,o=Math.floor(s/2);for(let e=0;e<o;++e){const i=n+e*r,o=n+(s-1-e)*r;for(let e=0;e<r;++e){const n=t[i+e];t[i+e]=t[o+e],t[o+e]=n}}}(t,n),!0)}function ip(t,e,n,i,r=[]){let s,o;if(8&n)s=(i[3]-t[1])/(e[1]-t[1]),o=3;else if(4&n)s=(i[1]-t[1])/(e[1]-t[1]),o=1;else if(2&n)s=(i[2]-t[0])/(e[0]-t[0]),o=2;else{if(!(1&n))return null;s=(i[0]-t[0])/(e[0]-t[0]),o=0}for(let n=0;n<t.length;n++)r[n]=(1&o)===n?i[o]:s*(e[n]-t[n])+t[n];return r}function rp(t,e){let n=0;return t[0]<e[0]?n|=1:t[0]>e[2]&&(n|=2),t[1]<e[1]?n|=4:t[1]>e[3]&&(n|=8),n}function sp(t,e){const n=e.length,i=t.length;if(i>0){let r=!0;for(let s=0;s<n;s++)if(t[i-n+s]!==e[s]){r=!1;break}if(r)return!1}for(let r=0;r<n;r++)t[i+r]=e[r];return!0}function op(t,e){const n=e.length;for(let i=0;i<n;i++)t[i]=e[i]}function ap(t,e,n,i,r=[]){const s=i+e*n;for(let e=0;e<n;e++)r[e]=t[s+e];return r}function lp(t,e){const{size:n=2,broken:i=!1,gridResolution:r=10,gridOffset:s=[0,0],startIndex:o=0,endIndex:a=t.length}=e||{},l=(a-o)/n;let c=[];const u=[c],h=ap(t,0,n,o);let d,f;const p=fp(h,r,s,[]),g=[];sp(c,h);for(let e=1;e<l;e++){for(d=ap(t,e,n,o,d),f=rp(d,p);f;){ip(h,d,f,p,g);const t=rp(g,p);t&&(ip(h,g,t,p,g),f=t),sp(c,g),op(h,g),pp(p,r,f),i&&c.length>n&&(c=[],u.push(c),sp(c,h)),f=rp(d,p)}sp(c,d),op(h,d)}return i?u:u[0]}const cp=0;function up(t,e){for(let n=0;n<e.length;n++)t.push(e[n]);return t}function hp(t,e=null,n){if(!t.length)return[];const{size:i=2,gridResolution:r=10,gridOffset:s=[0,0],edgeTypes:o=!1}=n||{},a=[],l=[{pos:t,types:o?new Array(t.length/i).fill(1):null,holes:e||[]}],c=[[],[]];let u=[];for(;l.length;){const{pos:t,types:e,holes:n}=l.shift();gp(t,i,n[0]||t.length,c),u=fp(c[0],r,s,u);const h=rp(c[1],u);if(h){let r=dp(t,e,i,0,n[0]||t.length,u,h);const s={pos:r[0].pos,types:r[0].types,holes:[]},a={pos:r[1].pos,types:r[1].types,holes:[]};l.push(s,a);for(let l=0;l<n.length;l++)r=dp(t,e,i,n[l],n[l+1]||t.length,u,h),r[0]&&(s.holes.push(s.pos.length),s.pos=up(s.pos,r[0].pos),o&&(s.types=up(s.types,r[0].types))),r[1]&&(a.holes.push(a.pos.length),a.pos=up(a.pos,r[1].pos),o&&(a.types=up(a.types,r[1].types)))}else{const i={positions:t};o&&(i.edgeTypes=e),n.length&&(i.holeIndices=n),a.push(i)}}return a}function dp(t,e,n,i,r,s,o){const a=(r-i)/n,l=[],c=[],u=[],h=[],d=[];let f,p,g;const m=ap(t,a-1,n,i);let v=Math.sign(8&o?m[1]-s[3]:m[0]-s[2]),y=e&&e[a-1],b=0,_=0;for(let r=0;r<a;r++)f=ap(t,r,n,i,f),p=Math.sign(8&o?f[1]-s[3]:f[0]-s[2]),g=e&&e[i/n+r],p&&v&&v!==p&&(ip(m,f,o,s,d),sp(l,d)&&u.push(y),sp(c,d)&&h.push(y)),p<=0?(sp(l,f)&&u.push(g),b-=p):u.length&&(u[u.length-1]=cp),p>=0?(sp(c,f)&&h.push(g),_+=p):h.length&&(h[h.length-1]=cp),op(m,f),v=p,y=g;return[b?{pos:l,types:e&&u}:null,_?{pos:c,types:e&&h}:null]}function fp(t,e,n,i){const r=Math.floor((t[0]-n[0])/e)*e+n[0],s=Math.floor((t[1]-n[1])/e)*e+n[1];return i[0]=r,i[1]=s,i[2]=r+e,i[3]=s+e,i}function pp(t,e,n){8&n?(t[1]+=e,t[3]+=e):4&n?(t[1]-=e,t[3]-=e):2&n?(t[0]+=e,t[2]+=e):1&n&&(t[0]-=e,t[2]-=e)}function gp(t,e,n,i){let r=1/0,s=-1/0,o=1/0,a=-1/0;for(let i=0;i<n;i+=e){const e=t[i],n=t[i+1];r=e<r?e:r,s=e>s?e:s,o=n<o?n:o,a=n>a?n:a}return i[0][0]=r,i[0][1]=o,i[1][0]=s,i[1][1]=a,i}function mp(t,e,n,i){let r=-1,s=-1;for(let o=n+1;o<i;o+=e){const e=Math.abs(t[o]);e>r&&(r=e,s=o-1)}return s}function vp(t,e,n,i,r=85.051129){const s=t[n],o=t[i-e];if(Math.abs(s-o)>180){const i=ap(t,0,e,n);i[0]+=360*Math.round((o-s)/360),sp(t,i),i[1]=Math.sign(i[1])*r,sp(t,i),i[0]=s,sp(t,i)}}function yp(t,e,n,i){let r,s=t[0];for(let o=n;o<i;o+=e){r=t[o];const e=r-s;(e>180||e<-180)&&(r-=360*Math.round(e/360)),t[o]=s=r}}function bp(t,e){let n;const i=t.length/e;for(let r=0;r<i&&(n=t[r*e],(n+180)%360==0);r++);const r=360*-Math.round(n/360);if(0!==r)for(let n=0;n<i;n++)t[n*e]+=r}class _p extends ep{constructor(t){super({...t,attributes:{positions:{size:3,padding:18,initialize:!0,type:t.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(t){return this.attributes[t]}getGeometryFromBuffer(t){return this.normalize?super.getGeometryFromBuffer(t):null}normalizeGeometry(t){return this.normalize?function(t,e,n,i){let r;if(Array.isArray(t[0])){const n=t.length*e;r=new Array(n);for(let n=0;n<t.length;n++)for(let i=0;i<e;i++)r[n*e+i]=t[n][i]||0}else r=t;return n?lp(r,{size:e,gridResolution:n}):i?function(t,e){const{size:n=2,startIndex:i=0,endIndex:r=t.length,normalize:s=!0}=e||{},o=t.slice(i,r);yp(o,n,0,r-i);const a=lp(o,{size:n,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(s)for(const t of a)bp(t,n);return a}(r,{size:e}):r}(t,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):t}getGeometrySize(t){if(Ap(t)){let e=0;for(const n of t)e+=this.getGeometrySize(n);return e}const e=this.getPathLength(t);return e<2?0:this.isClosed(t)?e<3?0:e+2:e}updateGeometryAttributes(t,e){if(0!==e.geometrySize)if(t&&Ap(t))for(const n of t){const t=this.getGeometrySize(n);e.geometrySize=t,this.updateGeometryAttributes(n,e),e.vertexStart+=t}else this._updateSegmentTypes(t,e),this._updatePositions(t,e)}_updateSegmentTypes(t,e){const n=this.attributes.segmentTypes,i=!!t&&this.isClosed(t),{vertexStart:r,geometrySize:s}=e;n.fill(0,r,r+s),i?(n[r]=4,n[r+s-2]=4):(n[r]+=1,n[r+s-2]+=2),n[r+s-1]=4}_updatePositions(t,e){const{positions:n}=this.attributes;if(!n||!t)return;const{vertexStart:i,geometrySize:r}=e,s=new Array(3);for(let e=i,o=0;o<r;e++,o++)this.getPointOnPath(t,o,s),n[3*e]=s[0],n[3*e+1]=s[1],n[3*e+2]=s[2]}getPathLength(t){return t.length/this.positionSize}getPointOnPath(t,e,n=[]){const{positionSize:i}=this;e*i>=t.length&&(e+=1-t.length/i);const r=e*i;return n[0]=t[r],n[1]=t[r+1],n[2]=3===i&&t[r+2]||0,n}isClosed(t){if(!this.normalize)return Boolean(this.opts.loop);const{positionSize:e}=this,n=t.length-e;return t[0]===t[n]&&t[1]===t[n+1]&&(2===e||t[2]===t[n+2])}}function Ap(t){return Array.isArray(t[0])}const wp=[0,0,0,255],Cp={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:t=>t.path},getColor:{type:"accessor",value:wp},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},Ep={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class xp extends uf{constructor(...t){super(...t),m(this,"state",void 0)}getShaders(){return super.getShaders({vs:"#define SHADER_NAME path-layer-vertex-shader\n\nattribute vec2 positions;\n\nattribute float instanceTypes;\nattribute vec3 instanceStartPositions;\nattribute vec3 instanceEndPositions;\nattribute vec3 instanceLeftPositions;\nattribute vec3 instanceRightPositions;\nattribute vec3 instanceLeftPositions64Low;\nattribute vec3 instanceStartPositions64Low;\nattribute vec3 instanceEndPositions64Low;\nattribute vec3 instanceRightPositions64Low;\nattribute float instanceStrokeWidths;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\n\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nuniform float jointType;\nuniform float capType;\nuniform float miterLimit;\nuniform bool billboard;\nuniform int widthUnits;\n\nuniform float opacity;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\nvarying vec2 vPathPosition;\nvarying float vPathLength;\nvarying float vJointType;\n\nconst float EPSILON = 0.001;\nconst vec3 ZERO_OFFSET = vec3(0.0);\n\nfloat flipIfTrue(bool flag) {\n  return -(float(flag) * 2. - 1.);\n}\nvec3 getLineJoinOffset(\n  vec3 prevPoint, vec3 currPoint, vec3 nextPoint,\n  vec2 width\n) {\n  bool isEnd = positions.x > 0.0;\n  float sideOfPath = positions.y;\n  float isJoint = float(sideOfPath == 0.0);\n\n  vec3 deltaA3 = (currPoint - prevPoint);\n  vec3 deltaB3 = (nextPoint - currPoint);\n\n  mat3 rotationMatrix;\n  bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);\n  if (needsRotation) {\n    deltaA3 = deltaA3 * rotationMatrix;\n    deltaB3 = deltaB3 * rotationMatrix;\n  }\n  vec2 deltaA = deltaA3.xy / width;\n  vec2 deltaB = deltaB3.xy / width;\n\n  float lenA = length(deltaA);\n  float lenB = length(deltaB);\n\n  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);\n  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);\n\n  vec2 perpA = vec2(-dirA.y, dirA.x);\n  vec2 perpB = vec2(-dirB.y, dirB.x);\n  vec2 tangent = dirA + dirB;\n  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;\n  vec2 miterVec = vec2(-tangent.y, tangent.x);\n  vec2 dir = isEnd ? dirA : dirB;\n  vec2 perp = isEnd ? perpA : perpB;\n  float L = isEnd ? lenA : lenB;\n  float sinHalfA = abs(dot(miterVec, perp));\n  float cosHalfA = abs(dot(dirA, miterVec));\n  float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);\n  float cornerPosition = sideOfPath * turnDirection;\n\n  float miterSize = 1.0 / max(sinHalfA, EPSILON);\n  miterSize = mix(\n    min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),\n    miterSize,\n    step(0.0, cornerPosition)\n  );\n\n  vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))\n    * (sideOfPath + isJoint * turnDirection);\n  bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));\n  bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));\n  bool isCap = isStartCap || isEndCap;\n  if (isCap) {\n    offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);\n    vJointType = capType;\n  } else {\n    vJointType = jointType;\n  }\n  vPathLength = L;\n  vCornerOffset = offsetVec;\n  vMiterLength = dot(vCornerOffset, miterVec * turnDirection);\n  vMiterLength = isCap ? isJoint : vMiterLength;\n\n  vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);\n  vPathPosition = vec2(\n    dot(offsetFromStartOfPath, perp),\n    dot(offsetFromStartOfPath, dir)\n  );\n  geometry.uv = vPathPosition;\n\n  float isValid = step(instanceTypes, 3.5);\n  vec3 offset = vec3(offsetVec * width * isValid, 0.0);\n\n  if (needsRotation) {\n    offset = rotationMatrix * offset;\n  }\n  return offset;\n}\nvoid clipLine(inout vec4 position, vec4 refPosition) {\n  if (position.w < EPSILON) {\n    float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);\n    position = refPosition + (position - refPosition) * r;\n  }\n}\n\nvoid main() {\n  geometry.pickingColor = instancePickingColors;\n\n  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);\n\n  float isEnd = positions.x;\n\n  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);\n  vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);\n\n  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);\n  vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);\n\n  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);\n  vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);\n\n  geometry.worldPosition = currPosition;\n  vec2 widthPixels = vec2(clamp(\n    project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),\n    widthMinPixels, widthMaxPixels) / 2.0);\n  vec3 width;\n\n  if (billboard) {\n    vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);\n    vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);\n    vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);\n\n    clipLine(prevPositionScreen, currPositionScreen);\n    clipLine(nextPositionScreen, currPositionScreen);\n    clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));\n\n    width = vec3(widthPixels, 0.0);\n    DECKGL_FILTER_SIZE(width, geometry);\n\n    vec3 offset = getLineJoinOffset(\n      prevPositionScreen.xyz / prevPositionScreen.w,\n      currPositionScreen.xyz / currPositionScreen.w,\n      nextPositionScreen.xyz / nextPositionScreen.w,\n      project_pixel_size_to_clipspace(width.xy)\n    );\n\n    DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);\n    gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);\n  } else {\n    prevPosition = project_position(prevPosition, prevPosition64Low);\n    currPosition = project_position(currPosition, currPosition64Low);\n    nextPosition = project_position(nextPosition, nextPosition64Low);\n\n    width = vec3(project_pixel_size(widthPixels), 0.0);\n    DECKGL_FILTER_SIZE(width, geometry);\n\n    vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);\n    geometry.position = vec4(currPosition + offset, 1.0);\n    gl_Position = project_common_position_to_clipspace(geometry.position);\n    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  }\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#define SHADER_NAME path-layer-fragment-shader\n\nprecision highp float;\n\nuniform float miterLimit;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\nvarying vec2 vPathPosition;\nvarying float vPathLength;\nvarying float vJointType;\n\nvoid main(void) {\n  geometry.uv = vPathPosition;\n\n  if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {\n    if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {\n      discard;\n    }\n    if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {\n      discard;\n    }\n  }\n  gl_FragColor = vColor;\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[ff,gf]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({positions:{size:3,vertexOffset:1,type:5130,fp64:this.use64bitPositions(),transition:Ep,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:5121,update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:Ep,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,accessor:"getColor",transition:Ep,defaultValue:wp},instancePickingColors:{size:3,type:5121,accessor:(t,{index:e,target:n})=>this.encodePickingColor(t&&t.__source?t.__source.index:e,n)}}),this.setState({pathTesselator:new _p({fp64:this.use64bitPositions()})})}updateState(t){super.updateState(t);const{props:e,changeFlags:n}=t,i=this.getAttributeManager();if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPath)){const{pathTesselator:t}=this.state,r=e.data.attributes||{};t.updateGeometry({data:e.data,geometryBuffer:r.getPath,buffers:r,normalize:!e._pathType,loop:"loop"===e._pathType,getGeometry:e.getPath,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:n.dataChanged}),this.setState({numInstances:t.instanceCount,startIndices:t.vertexStarts}),n.dataChanged||i.invalidateAll()}if(n.extensionsChanged){var r;const{gl:t}=this.context;null===(r=this.state.model)||void 0===r||r.delete(),this.state.model=this._getModel(t),i.invalidateAll()}}getPickingInfo(t){const e=super.getPickingInfo(t),{index:n}=e,{data:i}=this.props;return i[0]&&i[0].__source&&(e.object=i.find((t=>t.__source.index===n))),e}disablePickingIndex(t){const{data:e}=this.props;if(e[0]&&e[0].__source)for(let n=0;n<e.length;n++)e[n].__source.index===t&&this._disablePickingIndex(n);else super.disablePickingIndex(t)}draw({uniforms:t}){const{jointRounded:e,capRounded:n,billboard:i,miterLimit:r,widthUnits:s,widthScale:o,widthMinPixels:a,widthMaxPixels:l}=this.props;this.state.model.setUniforms(t).setUniforms({jointType:Number(e),capType:Number(n),billboard:i,widthUnits:Ri[s],widthScale:o,miterLimit:r,widthMinPixels:a,widthMaxPixels:l}).draw()}_getModel(t){return new wd(t,{...this.getShaders(),id:this.props.id,geometry:new vf({drawMode:4,attributes:{indices:new Uint16Array([0,1,2,1,4,2,1,3,4,3,5,4]),positions:{value:new Float32Array([0,0,0,-1,0,1,1,-1,1,1,1,0]),size:2}}}),isInstanced:!0})}calculatePositions(t){const{pathTesselator:e}=this.state;t.startIndices=e.vertexStarts,t.value=e.get("positions")}calculateSegmentTypes(t){const{pathTesselator:e}=this.state;t.startIndices=e.vertexStarts,t.value=e.get("segmentTypes")}}m(xp,"defaultProps",Cp),m(xp,"layerName","PathLayer");const Tp="#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))\n\nstruct AmbientLight {\n vec3 color;\n};\n\nstruct PointLight {\n vec3 color;\n vec3 position;\n vec3 attenuation;\n};\n\nstruct DirectionalLight {\n  vec3 color;\n  vec3 direction;\n};\n\nuniform AmbientLight lighting_uAmbientLight;\nuniform PointLight lighting_uPointLight[MAX_LIGHTS];\nuniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];\nuniform int lighting_uPointLightCount;\nuniform int lighting_uDirectionalLightCount;\n\nuniform bool lighting_uEnabled;\n\nfloat getPointLightAttenuation(PointLight pointLight, float distance) {\n  return pointLight.attenuation.x\n       + pointLight.attenuation.y * distance\n       + pointLight.attenuation.z * distance * distance;\n}\n\n#endif\n",Sp={lightSources:{}};function Bp(){let{color:t=[0,0,0],intensity:e=1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.map((t=>t*e/255))}const Pp={name:"lights",vs:Tp,fs:Tp,getUniforms:function t(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Sp;if("lightSources"in e){const{ambientLight:t,pointLights:n,directionalLights:i}=e.lightSources||{};return t||n&&n.length>0||i&&i.length>0?Object.assign({},function(t){let{ambientLight:e,pointLights:n=[],directionalLights:i=[]}=t;const r={};return r["lighting_uAmbientLight.color"]=e?Bp(e):[0,0,0],n.forEach(((t,e)=>{r["lighting_uPointLight[".concat(e,"].color")]=Bp(t),r["lighting_uPointLight[".concat(e,"].position")]=t.position,r["lighting_uPointLight[".concat(e,"].attenuation")]=t.attenuation||[1,0,0]})),r.lighting_uPointLightCount=n.length,i.forEach(((t,e)=>{r["lighting_uDirectionalLight[".concat(e,"].color")]=Bp(t),r["lighting_uDirectionalLight[".concat(e,"].direction")]=t.direction})),r.lighting_uDirectionalLightCount=i.length,r}({ambientLight:t,pointLights:n,directionalLights:i}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in e){const n={pointLights:[],directionalLights:[]};for(const t of e.lights||[])switch(t.type){case"ambient":n.ambientLight=t;break;case"directional":n.directionalLights.push(t);break;case"point":n.pointLights.push(t)}return t({lightSources:n})}return{}},defines:{MAX_LIGHTS:3}},Mp="\nuniform float lighting_uAmbient;\nuniform float lighting_uDiffuse;\nuniform float lighting_uShininess;\nuniform vec3  lighting_uSpecularColor;\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {\n    vec3 halfway_direction = normalize(light_direction + view_direction);\n    float lambertian = dot(light_direction, normal_worldspace);\n    float specular = 0.0;\n    if (lambertian > 0.0) {\n      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);\n      specular = pow(specular_angle, lighting_uShininess);\n    }\n    lambertian = max(lambertian, 0.0);\n    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;\n}\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = surfaceColor;\n\n  if (lighting_uEnabled) {\n    vec3 view_direction = normalize(cameraPosition - position_worldspace);\n    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uPointLightCount) {\n        break;\n      }\n      PointLight pointLight = lighting_uPointLight[i];\n      vec3 light_position_worldspace = pointLight.position;\n      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n    }\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uDirectionalLightCount) {\n        break;\n      }\n      DirectionalLight directionalLight = lighting_uDirectionalLight[i];\n      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n    }\n  }\n  return lightColor;\n}\n\nvec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = vec3(0, 0, 0);\n  vec3 surfaceColor = vec3(0, 0, 0);\n\n  if (lighting_uEnabled) {\n    vec3 view_direction = normalize(cameraPosition - position_worldspace);\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uPointLightCount) {\n        break;\n      }\n      PointLight pointLight = lighting_uPointLight[i];\n      vec3 light_position_worldspace = pointLight.position;\n      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n    }\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uDirectionalLightCount) {\n        break;\n      }\n      DirectionalLight directionalLight = lighting_uDirectionalLight[i];\n      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n    }\n  }\n  return lightColor;\n}\n",Ip={};function Lp(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ip;if(!("material"in t))return{};const{material:e}=t;return e?function(t){const{ambient:e=.35,diffuse:n=.6,shininess:i=32,specularColor:r=[30,30,30]}=t;return{lighting_uAmbient:e,lighting_uDiffuse:n,lighting_uShininess:i,lighting_uSpecularColor:r.map((t=>t/255))}}(e):{lighting_uEnabled:!1}}const Op={name:"gouraud-lighting",dependencies:[Pp],vs:Mp,defines:{LIGHTING_VERTEX:1},getUniforms:Lp},Rp={name:"phong-lighting",dependencies:[Pp],fs:Mp,defines:{LIGHTING_FRAGMENT:1},getUniforms:Lp};var Fp=o(187),kp=o.n(Fp);const Dp={isClosed:!0};function Np(t){return"positions"in t?t.positions:t}function Up(t){return"holeIndices"in t?t.holeIndices:null}function zp(t,e,n,i,r){let s=e;const o=n.length;for(let e=0;e<o;e++)for(let r=0;r<i;r++)t[s++]=n[e][r]||0;if(!function(t){const e=t[0],n=t[t.length-1];return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]}(n))for(let e=0;e<i;e++)t[s++]=n[0][e]||0;return Dp.start=e,Dp.end=s,Dp.size=i,np(t,r,Dp),s}function Gp(t,e,n,i,r=0,s,o){const a=(s=s||n.length)-r;if(a<=0)return e;let l=e;for(let e=0;e<a;e++)t[l++]=n[r+e];if(!function(t,e,n,i){for(let r=0;r<e;r++)if(t[n+r]!==t[i-e+r])return!1;return!0}(n,i,r,s))for(let e=0;e<i;e++)t[l++]=n[r+e];return Dp.start=e,Dp.end=l,Dp.size=i,np(t,o,Dp),l}function jp(t,e,n){const i=t.length/3;let r=0;for(let s=0;s<i;s++){const o=(s+1)%i;r+=t[3*s+e]*t[3*o+n],r-=t[3*o+e]*t[3*s+n]}return Math.abs(r/2)}function Vp(t,e,n,i){const r=t.length/3;for(let s=0;s<r;s++){const r=3*s,o=t[r+0],a=t[r+1],l=t[r+2];t[r+e]=o,t[r+n]=a,t[r+i]=l}}class Hp extends ep{constructor(t){const{fp64:e,IndexType:n=Uint32Array}=t;super({...t,attributes:{positions:{size:3,type:e?Float64Array:Float32Array},vertexValid:{type:Uint8ClampedArray,size:1},indices:{type:n,size:1}}})}get(t){const{attributes:e}=this;return"indices"===t?e.indices&&e.indices.subarray(0,this.vertexCount):e[t]}updateGeometry(t){super.updateGeometry(t);const e=this.buffers.indices;if(e)this.vertexCount=(e.value||e).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(t){if(this.normalize){const e=function(t,e){!function(t){if(t=t&&t.positions||t,!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error("invalid polygon")}(t);const n=[],i=[];if("positions"in t){const{positions:r,holeIndices:s}=t;if(s){let t=0;for(let o=0;o<=s.length;o++)t=Gp(n,t,r,e,s[o-1],s[o],0===o?1:-1),i.push(t);return i.pop(),{positions:n,holeIndices:i}}t=r}if(!function(t){return Array.isArray(t[0])}(t))return Gp(n,0,t,e,0,n.length,1),n;if(!function(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}(t)){let r=0;for(const[s,o]of t.entries())r=zp(n,r,o,e,0===s?1:-1),i.push(r);return i.pop(),{positions:n,holeIndices:i}}return zp(n,0,t,e,1),n}(t,this.positionSize);return this.opts.resolution?hp(Np(e),Up(e),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?function(t,e=null,n){const{size:i=2,normalize:r=!0,edgeTypes:s=!1}=n||{};e=e||[];const o=[],a=[];let l=0,c=0;for(let r=0;r<=e.length;r++){const s=e[r]||t.length,u=c,h=mp(t,i,l,s);for(let e=h;e<s;e++)o[c++]=t[e];for(let e=l;e<h;e++)o[c++]=t[e];yp(o,i,u,c),vp(o,i,u,c,null==n?void 0:n.maxLatitude),l=s,a[r]=c}a.pop();const u=hp(o,a,{size:i,gridResolution:360,gridOffset:[-180,-180],edgeTypes:s});if(r)for(const t of u)bp(t.positions,i);return u}(Np(e),Up(e),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):e}return t}getGeometrySize(t){if(Wp(t)){let e=0;for(const n of t)e+=this.getGeometrySize(n);return e}return Np(t).length/this.positionSize}getGeometryFromBuffer(t){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(t):null}updateGeometryAttributes(t,e){if(t&&Wp(t))for(const n of t){const t=this.getGeometrySize(n);e.geometrySize=t,this.updateGeometryAttributes(n,e),e.vertexStart+=t,e.indexStart=this.indexStarts[e.geometryIndex+1]}else this._updateIndices(t,e),this._updatePositions(t,e),this._updateVertexValid(t,e)}_updateIndices(t,{geometryIndex:e,vertexStart:n,indexStart:i}){const{attributes:r,indexStarts:s,typedArrayManager:o}=this;let a=r.indices;if(!a||!t)return;let l=i;const c=function(t,e,n,i){let r=Up(t);r&&(r=r.map((t=>t/e)));let s=Np(t);const o=i&&3===e;if(n){const t=s.length;s=s.slice();const i=[];for(let r=0;r<t;r+=e){i[0]=s[r],i[1]=s[r+1],o&&(i[2]=s[r+2]);const t=n(i);s[r]=t[0],s[r+1]=t[1],o&&(s[r+2]=t[2])}}if(o){const t=jp(s,0,1),e=jp(s,0,2),i=jp(s,1,2);if(!t&&!e&&!i)return[];t>e&&t>i||(e>i?(n||(s=s.slice()),Vp(s,0,2,1)):(n||(s=s.slice()),Vp(s,2,0,1)))}return kp()(s,r,e)}(t,this.positionSize,this.opts.preproject,this.opts.full3d);a=o.allocate(a,i+c.length,{copy:!0});for(let t=0;t<c.length;t++)a[l++]=c[t]+n;s[e+1]=i+c.length,r.indices=a}_updatePositions(t,{vertexStart:e,geometrySize:n}){const{attributes:{positions:i},positionSize:r}=this;if(!i||!t)return;const s=Np(t);for(let t=e,o=0;o<n;t++,o++){const e=s[o*r],n=s[o*r+1],a=r>2?s[o*r+2]:0;i[3*t]=e,i[3*t+1]=n,i[3*t+2]=a}}_updateVertexValid(t,{vertexStart:e,geometrySize:n}){const{positionSize:i}=this,r=this.attributes.vertexValid,s=t&&Up(t);if(t&&t.edgeTypes?r.set(t.edgeTypes,e):r.fill(1,e,e+n),s)for(let t=0;t<s.length;t++)r[e+s[t]/i-1]=0;r[e+n-1]=0}}function Wp(t){return Array.isArray(t)&&t.length>0&&!Number.isFinite(t[0])}const Jp="\nattribute vec2 vertexPositions;\nattribute float vertexValid;\n\nuniform bool extruded;\nuniform bool isWireframe;\nuniform float elevationScale;\nuniform float opacity;\n\nvarying vec4 vColor;\n\nstruct PolygonProps {\n  vec4 fillColors;\n  vec4 lineColors;\n  vec3 positions;\n  vec3 nextPositions;\n  vec3 pickingColors;\n  vec3 positions64Low;\n  vec3 nextPositions64Low;\n  float elevations;\n};\n\nvec3 project_offset_normal(vec3 vector) {\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {\n    return normalize(vector * project_uCommonUnitsPerWorldUnit);\n  }\n  return project_normal(vector);\n}\n\nvoid calculatePosition(PolygonProps props) {\n#ifdef IS_SIDE_VERTEX\n  if(vertexValid < 0.5){\n    gl_Position = vec4(0.);\n    return;\n  }\n#endif\n\n  vec3 pos;\n  vec3 pos64Low;\n  vec3 normal;\n  vec4 colors = isWireframe ? props.lineColors : props.fillColors;\n\n  geometry.worldPosition = props.positions;\n  geometry.worldPositionAlt = props.nextPositions;\n  geometry.pickingColor = props.pickingColors;\n\n#ifdef IS_SIDE_VERTEX\n  pos = mix(props.positions, props.nextPositions, vertexPositions.x);\n  pos64Low = mix(props.positions64Low, props.nextPositions64Low, vertexPositions.x);\n#else\n  pos = props.positions;\n  pos64Low = props.positions64Low;\n#endif\n\n  if (extruded) {\n    pos.z += props.elevations * vertexPositions.y * elevationScale;\n  }\n  gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);\n\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  if (extruded) {\n  #ifdef IS_SIDE_VERTEX\n    normal = vec3(\n      props.positions.y - props.nextPositions.y + (props.positions64Low.y - props.nextPositions64Low.y),\n      props.nextPositions.x - props.positions.x + (props.nextPositions64Low.x - props.positions64Low.x),\n      0.0);\n    normal = project_offset_normal(normal);\n  #else\n    normal = project_normal(vec3(0.0, 0.0, 1.0));\n  #endif\n    geometry.normal = normal;\n    vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, normal);\n    vColor = vec4(lightColor, colors.a * opacity);\n  } else {\n    vColor = vec4(colors.rgb, colors.a * opacity);\n  }\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",qp="#define SHADER_NAME solid-polygon-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 positions64Low;\nattribute float elevations;\nattribute vec4 fillColors;\nattribute vec4 lineColors;\nattribute vec3 pickingColors;\n\n".concat(Jp,"\n\nvoid main(void) {\n  PolygonProps props;\n\n  props.positions = positions;\n  props.positions64Low = positions64Low;\n  props.elevations = elevations;\n  props.fillColors = fillColors;\n  props.lineColors = lineColors;\n  props.pickingColors = pickingColors;\n\n  calculatePosition(props);\n}\n"),Kp="#define SHADER_NAME solid-polygon-layer-vertex-shader-side\n#define IS_SIDE_VERTEX\n\n\nattribute vec3 instancePositions;\nattribute vec3 nextPositions;\nattribute vec3 instancePositions64Low;\nattribute vec3 nextPositions64Low;\nattribute float instanceElevations;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute vec3 instancePickingColors;\n\n".concat(Jp,"\n\nvoid main(void) {\n  PolygonProps props;\n\n  #if RING_WINDING_ORDER_CW == 1\n    props.positions = instancePositions;\n    props.positions64Low = instancePositions64Low;\n    props.nextPositions = nextPositions;\n    props.nextPositions64Low = nextPositions64Low;\n  #else\n    props.positions = nextPositions;\n    props.positions64Low = nextPositions64Low;\n    props.nextPositions = instancePositions;\n    props.nextPositions64Low = instancePositions64Low;\n  #endif\n  props.elevations = instanceElevations;\n  props.fillColors = instanceFillColors;\n  props.lineColors = instanceLineColors;\n  props.pickingColors = instancePickingColors;\n\n  calculatePosition(props);\n}\n"),Xp=[0,0,0,255],Qp={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:t=>t.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:Xp},getLineColor:{type:"accessor",value:Xp},material:!0},Yp={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class Zp extends uf{constructor(...t){super(...t),m(this,"state",void 0)}getShaders(t){return super.getShaders({vs:"top"===t?qp:Kp,fs:"#define SHADER_NAME solid-polygon-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",defines:{RING_WINDING_ORDER_CW:this.props._normalize||"CCW"!==this.props._windingOrder?1:0},modules:[ff,Op,gf]})}get wrapLongitude(){return!1}initializeState(){const{gl:t,viewport:e}=this.context;let{coordinateSystem:n}=this.props;const{_full3d:i}=this.props;let r;e.isGeospatial&&n===Li.DEFAULT&&(n=Li.LNGLAT),n===Li.LNGLAT&&(r=i?e.projectPosition.bind(e):e.projectFlat.bind(e)),this.setState({numInstances:0,polygonTesselator:new Hp({preproject:r,fp64:this.use64bitPositions(),IndexType:!t||Wo(t,Uo)?Uint32Array:Uint16Array})});const s=this.getAttributeManager(),o=!0;s.remove(["instancePickingColors"]),s.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:o},positions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:Yp,accessor:"getPolygon",update:this.calculatePositions,noAlloc:o,shaderAttributes:{positions:{vertexOffset:0,divisor:0},instancePositions:{vertexOffset:0,divisor:1},nextPositions:{vertexOffset:1,divisor:1}}},vertexValid:{size:1,divisor:1,type:5121,update:this.calculateVertexValid,noAlloc:o},elevations:{size:1,transition:Yp,accessor:"getElevation",shaderAttributes:{elevations:{divisor:0},instanceElevations:{divisor:1}}},fillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:Yp,accessor:"getFillColor",defaultValue:Xp,shaderAttributes:{fillColors:{divisor:0},instanceFillColors:{divisor:1}}},lineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:Yp,accessor:"getLineColor",defaultValue:Xp,shaderAttributes:{lineColors:{divisor:0},instanceLineColors:{divisor:1}}},pickingColors:{size:3,type:5121,accessor:(t,{index:e,target:n})=>this.encodePickingColor(t&&t.__source?t.__source.index:e,n),shaderAttributes:{pickingColors:{divisor:0},instancePickingColors:{divisor:1}}}})}getPickingInfo(t){const e=super.getPickingInfo(t),{index:n}=e,{data:i}=this.props;return i[0]&&i[0].__source&&(e.object=i.find((t=>t.__source.index===n))),e}disablePickingIndex(t){const{data:e}=this.props;if(e[0]&&e[0].__source)for(let n=0;n<e.length;n++)e[n].__source.index===t&&this._disablePickingIndex(n);else super.disablePickingIndex(t)}draw({uniforms:t}){const{extruded:e,filled:n,wireframe:i,elevationScale:r}=this.props,{topModel:s,sideModel:o,polygonTesselator:a}=this.state,l={...t,extruded:Boolean(e),elevationScale:r};o&&(o.setInstanceCount(a.instanceCount-1),o.setUniforms(l),i&&(o.setDrawMode(3),o.setUniforms({isWireframe:!0}).draw()),n&&(o.setDrawMode(6),o.setUniforms({isWireframe:!1}).draw())),s&&(s.setVertexCount(a.vertexCount),s.setUniforms(l).draw())}updateState(t){super.updateState(t),this.updateGeometry(t);const{props:e,oldProps:n,changeFlags:i}=t,r=this.getAttributeManager();var s;(i.extensionsChanged||e.filled!==n.filled||e.extruded!==n.extruded)&&(null===(s=this.state.models)||void 0===s||s.forEach((t=>t.delete())),this.setState(this._getModels(this.context.gl)),r.invalidateAll())}updateGeometry({props:t,oldProps:e,changeFlags:n}){if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPolygon)){const{polygonTesselator:e}=this.state,i=t.data.attributes||{};e.updateGeometry({data:t.data,normalize:t._normalize,geometryBuffer:i.getPolygon,buffers:i,getGeometry:t.getPolygon,positionFormat:t.positionFormat,wrapLongitude:t.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:n.dataChanged,full3d:t._full3d}),this.setState({numInstances:e.instanceCount,startIndices:e.vertexStarts}),n.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(t){const{id:e,filled:n,extruded:i}=this.props;let r,s;if(n){const n=this.getShaders("top");n.defines.NON_INSTANCED_MODEL=1,r=new wd(t,{...n,id:"".concat(e,"-top"),drawMode:4,attributes:{vertexPositions:new Float32Array([0,1])},uniforms:{isWireframe:!1,isSideVertex:!1},vertexCount:0,isIndexed:!0})}return i&&(s=new wd(t,{...this.getShaders("side"),id:"".concat(e,"-side"),geometry:new vf({drawMode:1,vertexCount:4,attributes:{vertexPositions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),instanceCount:0,isInstanced:1}),s.userData.excludeAttributes={indices:!0}),{models:[s,r].filter(Boolean),topModel:r,sideModel:s}}calculateIndices(t){const{polygonTesselator:e}=this.state;t.startIndices=e.indexStarts,t.value=e.get("indices")}calculatePositions(t){const{polygonTesselator:e}=this.state;t.startIndices=e.vertexStarts,t.value=e.get("positions")}calculateVertexValid(t){t.value=this.state.polygonTesselator.get("vertexValid")}}m(Zp,"defaultProps",Qp),m(Zp,"layerName","SolidPolygonLayer");const $p={circle:{type:Pf,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:Tf,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:tp,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},tg={type:xp,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},eg={type:Zp,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function ng({type:t,props:e}){const n={};for(const i in e)n[i]=t.defaultProps[e[i]];return n}function ig(t,e){const{transitions:n,updateTriggers:i}=t.props,r={updateTriggers:{},transitions:n&&{getPosition:n.geometry}};for(const s in e){const o=e[s];let a=t.props[s];s.startsWith("get")&&(a=t.getSubLayerAccessor(a),r.updateTriggers[o]=i[s],n&&(r.transitions[o]=n[s])),r[o]=a}return r}function rg(t,e,n={}){const i={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:r=0,endRow:s=t.length}=n;for(let n=r;n<s;n++){const r=t[n],{geometry:s}=r;if(s)if("GeometryCollection"===s.type){q.assert(Array.isArray(s.geometries),"GeoJSON does not have geometries array");const{geometries:t}=s;for(let s=0;s<t.length;s++)sg(t[s],i,e,r,n)}else sg(s,i,e,r,n)}return i}function sg(t,e,n,i,r){const{type:s,coordinates:o}=t,{pointFeatures:a,lineFeatures:l,polygonFeatures:c,polygonOutlineFeatures:u}=e;if(function(t,e){let n=og[t];for(q.assert(n,"Unknown GeoJSON type ".concat(t));e&&--n>0;)e=e[0];return e&&Number.isFinite(e[0])}(s,o))switch(s){case"Point":a.push(n({geometry:t},i,r));break;case"MultiPoint":o.forEach((t=>{a.push(n({geometry:{type:"Point",coordinates:t}},i,r))}));break;case"LineString":l.push(n({geometry:t},i,r));break;case"MultiLineString":o.forEach((t=>{l.push(n({geometry:{type:"LineString",coordinates:t}},i,r))}));break;case"Polygon":c.push(n({geometry:t},i,r)),o.forEach((t=>{u.push(n({geometry:{type:"LineString",coordinates:t}},i,r))}));break;case"MultiPolygon":o.forEach((t=>{c.push(n({geometry:{type:"Polygon",coordinates:t}},i,r)),t.forEach((t=>{u.push(n({geometry:{type:"LineString",coordinates:t}},i,r))}))}))}else q.warn("".concat(s," coordinates are malformed"))()}const og={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function ag(t){return t.geometry.coordinates}const lg=["points","linestrings","polygons"],cg={...ng($p.circle),...ng($p.icon),...ng($p.text),...ng(tg),...ng(eg),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:t=>t.properties.icon},getText:{type:"accessor",value:t=>t.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class ug extends hf{initializeState(){this.state={layerProps:{},features:{}}}updateState({props:t,changeFlags:e}){if(!e.dataChanged)return;const{data:n}=this.props,i=n&&"points"in n&&"polygons"in n&&"lines"in n;this.setState({binary:i}),i?this._updateStateBinary({props:t,changeFlags:e}):this._updateStateJSON({props:t,changeFlags:e})}_updateStateBinary({props:t,changeFlags:e}){const n=function(t,e){const n={points:{},lines:{},polygons:{},polygonsOutline:{}},{points:i,lines:r,polygons:s}=t,o=function(t,e){const n={points:null,lines:null,polygons:null};for(const i in n){const r=t[i].globalFeatureIds.value;n[i]=new Uint8ClampedArray(3*r.length);const s=[];for(let t=0;t<r.length;t++)e(r[t],s),n[i][3*t+0]=s[0],n[i][3*t+1]=s[1],n[i][3*t+2]=s[2]}return n}(t,e);return n.points.data={length:i.positions.value.length/i.positions.size,attributes:{...i.attributes,getPosition:i.positions,instancePickingColors:{size:3,value:o.points}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},n.lines.data={length:r.pathIndices.value.length-1,startIndices:r.pathIndices.value,attributes:{...r.attributes,getPath:r.positions,instancePickingColors:{size:3,value:o.lines}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},n.lines._pathType="open",n.polygons.data={length:s.polygonIndices.value.length-1,startIndices:s.polygonIndices.value,attributes:{...s.attributes,getPolygon:s.positions,pickingColors:{size:3,value:o.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},n.polygons._normalize=!1,s.triangles&&(n.polygons.data.attributes.indices=s.triangles.value),n.polygonsOutline.data={length:s.primitivePolygonIndices.value.length-1,startIndices:s.primitivePolygonIndices.value,attributes:{...s.attributes,getPath:s.positions,instancePickingColors:{size:3,value:o.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},n.polygonsOutline._pathType="open",n}(t.data,this.encodePickingColor);this.setState({layerProps:n})}_updateStateJSON({props:t,changeFlags:e}){const n=function(t){if(Array.isArray(t))return t;switch(q.assert(t.type,"GeoJSON does not have type"),t.type){case"Feature":return[t];case"FeatureCollection":return q.assert(Array.isArray(t.features),"GeoJSON does not have features array"),t.features;default:return[{geometry:t}]}}(t.data),i=this.getSubLayerRow.bind(this);let r={};const s={};if(Array.isArray(e.dataChanged)){const t=this.state.features;for(const e in t)r[e]=t[e].slice(),s[e]=[];for(const o of e.dataChanged){const e=rg(n,i,o);for(const n in t)s[n].push(df({data:r[n],getIndex:t=>t.__source.index,dataRange:o,replace:e[n]}))}}else r=rg(n,i);const o=function(t,e){const n={points:{},lines:{},polygons:{},polygonsOutline:{}},{pointFeatures:i,lineFeatures:r,polygonFeatures:s,polygonOutlineFeatures:o}=t;return n.points.data=i,n.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),n.points.getPosition=ag,n.lines.data=r,n.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),n.lines.getPath=ag,n.polygons.data=s,n.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),n.polygons.getPolygon=ag,n.polygonsOutline.data=o,n.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),n.polygonsOutline.getPath=ag,n}(r,s);this.setState({features:r,featuresDiff:s,layerProps:o})}getPickingInfo(t){const e=super.getPickingInfo(t),{index:n,sourceLayer:i}=e;return e.featureType=lg.find((t=>i.id.startsWith("".concat(this.id,"-").concat(t,"-")))),n>=0&&i.id.startsWith("".concat(this.id,"-points-text"))&&this.state.binary&&(e.index=this.props.data.points.globalFeatureIds.value[n]),e}_updateAutoHighlight(t){const e="".concat(this.id,"-points-"),n="points"===t.featureType;for(const i of this.getSubLayers())i.id.startsWith(e)===n&&i.updateAutoHighlight(t)}_renderPolygonLayer(){const{extruded:t,wireframe:e}=this.props,{layerProps:n}=this.state,i="polygons-fill",r=this.shouldRenderSubLayer(i,n.polygons.data)&&this.getSubLayerClass(i,eg.type);if(r){const s=ig(this,eg.props),o=t&&e;return o||delete s.getLineColor,s.updateTriggers.lineColors=o,new r(s,this.getSubLayerProps({id:i,updateTriggers:s.updateTriggers}),n.polygons)}return null}_renderLineLayers(){const{extruded:t,stroked:e}=this.props,{layerProps:n}=this.state,i="polygons-stroke",r="linestrings",s=!t&&e&&this.shouldRenderSubLayer(i,n.polygonsOutline.data)&&this.getSubLayerClass(i,tg.type),o=this.shouldRenderSubLayer(r,n.lines.data)&&this.getSubLayerClass(r,tg.type);if(s||o){const t=ig(this,tg.props);return[s&&new s(t,this.getSubLayerProps({id:i,updateTriggers:t.updateTriggers}),n.polygonsOutline),o&&new o(t,this.getSubLayerProps({id:r,updateTriggers:t.updateTriggers}),n.lines)]}return null}_renderPointLayers(){const{pointType:t}=this.props,{layerProps:e,binary:n}=this.state;let{highlightedObjectIndex:i}=this.props;!n&&Number.isFinite(i)&&(i=e.points.data.findIndex((t=>t.__source.index===i)));const r=new Set(t.split("+")),s=[];for(const t of r){const r="points-".concat(t),o=$p[t],a=o&&this.shouldRenderSubLayer(r,e.points.data)&&this.getSubLayerClass(r,o.type);if(a){const l=ig(this,o.props);let c=e.points;if("text"===t&&n){const{instancePickingColors:t,...e}=c.data.attributes;c={...c,data:{...c.data,attributes:e}}}s.push(new a(l,this.getSubLayerProps({id:r,updateTriggers:l.updateTriggers,highlightedObjectIndex:i}),c))}}return s}renderLayers(){const{extruded:t}=this.props,e=this._renderPolygonLayer();return[!t&&e,this._renderLineLayers(),this._renderPointLayers(),t&&e]}getSubLayerAccessor(t){const{binary:e}=this.state;return e&&"function"==typeof t?(e,n)=>{const{data:i,index:r}=n,s=function(t,e){if(!t)return null;const n="startIndices"in t?t.startIndices[e]:e,i=t.featureIds.value[n];return-1!==n?function(t,e,n){const i={properties:{...t.properties[e]}};for(const e in t.numericProps)i.properties[e]=t.numericProps[e].value[n];return i}(t,i,n):null}(i,r);return t(s,n)}:super.getSubLayerAccessor(t)}}m(ug,"layerName","GeoJsonLayer"),m(ug,"defaultProps",cg);const hg=[0,0,0,255],dg=[0,0,1],fg={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:t=>t.position},getNormal:{type:"accessor",value:dg},getColor:{type:"accessor",value:hg},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};class pg extends uf{getShaders(){return super.getShaders({vs:"#define SHADER_NAME point-cloud-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 instanceNormals;\nattribute vec4 instanceColors;\nattribute vec3 instancePositions;\nattribute vec3 instancePositions64Low;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform float radiusPixels;\nuniform int sizeUnits;\n\nvarying vec4 vColor;\nvarying vec2 unitPosition;\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n  geometry.normal = project_normal(instanceNormals);\n  unitPosition = positions.xy;\n  geometry.uv = unitPosition;\n  geometry.pickingColor = instancePickingColors;\n  vec3 offset = vec3(positions.xy * project_size_to_pixel(radiusPixels, sizeUnits), 0.0);\n  DECKGL_FILTER_SIZE(offset, geometry);\n\n  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n  vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);\n  vColor = vec4(lightColor, instanceColors.a * opacity);\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#define SHADER_NAME point-cloud-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying vec2 unitPosition;\n\nvoid main(void) {\n  geometry.uv = unitPosition;\n\n  float distToCenter = length(unitPosition);\n\n  if (distToCenter > 1.0) {\n    discard;\n  }\n\n  gl_FragColor = vColor;\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[ff,Op,gf]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:dg},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:hg}})}updateState(t){const{changeFlags:e,props:n}=t;if(super.updateState(t),e.extensionsChanged){var i;const{gl:t}=this.context;null===(i=this.state.model)||void 0===i||i.delete(),this.state.model=this._getModel(t),this.getAttributeManager().invalidateAll()}e.dataChanged&&function(t){const{header:e,attributes:n}=t;e&&n&&(t.length=e.vertexCount,n.POSITION&&(n.instancePositions=n.POSITION),n.NORMAL&&(n.instanceNormals=n.NORMAL),n.COLOR_0&&(n.instanceColors=n.COLOR_0))}(n.data)}draw({uniforms:t}){const{pointSize:e,sizeUnits:n}=this.props;this.state.model.setUniforms(t).setUniforms({sizeUnits:Ri[n],radiusPixels:e}).draw()}_getModel(t){const e=[];for(let t=0;t<3;t++){const n=t/3*Math.PI*2;e.push(2*Math.cos(n),2*Math.sin(n),0)}return new wd(t,{...this.getShaders(),id:this.props.id,geometry:new vf({drawMode:4,attributes:{positions:new Float32Array(e)}}),isInstanced:!0})}}m(pg,"layerName","PointCloudLayer"),m(pg,"defaultProps",fg);const gg={name:"pbr",vs:"uniform mat4 u_MVPMatrix;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_NormalMatrix;\n\nvarying vec3 pbr_vPosition;\nvarying vec2 pbr_vUV;\n\n#ifdef HAS_NORMALS\n# ifdef HAS_TANGENTS\nvarying mat3 pbr_vTBN;\n# else\nvarying vec3 pbr_vNormal;\n# endif\n#endif\n\nvoid pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)\n{\n  vec4 pos = u_ModelMatrix * position;\n  pbr_vPosition = vec3(pos.xyz) / pos.w;\n\n#ifdef HAS_NORMALS\n#ifdef HAS_TANGENTS\n  vec3 normalW = normalize(vec3(u_NormalMatrix * vec4(normal.xyz, 0.0)));\n  vec3 tangentW = normalize(vec3(u_ModelMatrix * vec4(tangent.xyz, 0.0)));\n  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;\n  pbr_vTBN = mat3(tangentW, bitangentW, normalW);\n#else\n  pbr_vNormal = normalize(vec3(u_ModelMatrix * vec4(normal.xyz, 0.0)));\n#endif\n#endif\n\n#ifdef HAS_UV\n  pbr_vUV = uv;\n#else\n  pbr_vUV = vec2(0.,0.);\n#endif\n}\n",fs:"#if defined(USE_TEX_LOD) && !defined(FEATURE_GLSL_TEXTURE_LOD)\n# error PBR fragment shader: Texture LOD is not available\n#endif\n\n#if !defined(HAS_TANGENTS) && !defined(FEATURE_GLSL_DERIVATIVES)\n# error PBR fragment shader: Derivatives are not available\n#endif\n\n\n#if (__VERSION__ < 300)\n  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL1COND; INCR)\n#else\n  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL2COND; INCR)\n#endif\n\nprecision highp float;\n\nuniform bool pbr_uUnlit;\n\n#ifdef USE_IBL\nuniform samplerCube u_DiffuseEnvSampler;\nuniform samplerCube u_SpecularEnvSampler;\nuniform sampler2D u_brdfLUT;\nuniform vec2 u_ScaleIBLAmbient;\n#endif\n\n#ifdef HAS_BASECOLORMAP\nuniform sampler2D u_BaseColorSampler;\n#endif\n#ifdef HAS_NORMALMAP\nuniform sampler2D u_NormalSampler;\nuniform float u_NormalScale;\n#endif\n#ifdef HAS_EMISSIVEMAP\nuniform sampler2D u_EmissiveSampler;\nuniform vec3 u_EmissiveFactor;\n#endif\n#ifdef HAS_METALROUGHNESSMAP\nuniform sampler2D u_MetallicRoughnessSampler;\n#endif\n#ifdef HAS_OCCLUSIONMAP\nuniform sampler2D u_OcclusionSampler;\nuniform float u_OcclusionStrength;\n#endif\n\n#ifdef ALPHA_CUTOFF\nuniform float u_AlphaCutoff;\n#endif\n\nuniform vec2 u_MetallicRoughnessValues;\nuniform vec4 u_BaseColorFactor;\n\nuniform vec3 u_Camera;\n#ifdef PBR_DEBUG\nuniform vec4 u_ScaleDiffBaseMR;\nuniform vec4 u_ScaleFGDSpec;\n#endif\n\nvarying vec3 pbr_vPosition;\n\nvarying vec2 pbr_vUV;\n\n#ifdef HAS_NORMALS\n#ifdef HAS_TANGENTS\nvarying mat3 pbr_vTBN;\n#else\nvarying vec3 pbr_vNormal;\n#endif\n#endif\n\n\nstruct PBRInfo\n{\n  float NdotL;\n  float NdotV;\n  float NdotH;\n  float LdotH;\n  float VdotH;\n  float perceptualRoughness;\n  float metalness;\n  vec3 reflectance0;\n  vec3 reflectance90;\n  float alphaRoughness;\n  vec3 diffuseColor;\n  vec3 specularColor;\n  vec3 n;\n  vec3 v;\n};\n\nconst float M_PI = 3.141592653589793;\nconst float c_MinRoughness = 0.04;\n\nvec4 SRGBtoLINEAR(vec4 srgbIn)\n{\n#ifdef MANUAL_SRGB\n#ifdef SRGB_FAST_APPROXIMATION\n  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));\n#else\n  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);\n  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );\n#endif\n  return vec4(linOut,srgbIn.w);;\n#else\n  return srgbIn;\n#endif\n}\n\nvec3 getNormal()\n{\n#ifndef HAS_TANGENTS\n  vec3 pos_dx = dFdx(pbr_vPosition);\n  vec3 pos_dy = dFdy(pbr_vPosition);\n  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));\n  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));\n  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);\n\n#ifdef HAS_NORMALS\n  vec3 ng = normalize(pbr_vNormal);\n#else\n  vec3 ng = cross(pos_dx, pos_dy);\n#endif\n\n  t = normalize(t - ng * dot(ng, t));\n  vec3 b = normalize(cross(ng, t));\n  mat3 tbn = mat3(t, b, ng);\n#else\n  mat3 tbn = pbr_vTBN;\n#endif\n\n#ifdef HAS_NORMALMAP\n  vec3 n = texture2D(u_NormalSampler, pbr_vUV).rgb;\n  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_NormalScale, u_NormalScale, 1.0)));\n#else\n  vec3 n = normalize(tbn[2].xyz);\n#endif\n\n  return n;\n}\n\n\n#ifdef USE_IBL\nvec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)\n{\n  float mipCount = 9.0;\n  float lod = (pbrInputs.perceptualRoughness * mipCount);\n  vec3 brdf = SRGBtoLINEAR(texture2D(u_brdfLUT,\n    vec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;\n  vec3 diffuseLight = SRGBtoLINEAR(textureCube(u_DiffuseEnvSampler, n)).rgb;\n\n#ifdef USE_TEX_LOD\n  vec3 specularLight = SRGBtoLINEAR(textureCubeLod(u_SpecularEnvSampler, reflection, lod)).rgb;\n#else\n  vec3 specularLight = SRGBtoLINEAR(textureCube(u_SpecularEnvSampler, reflection)).rgb;\n#endif\n\n  vec3 diffuse = diffuseLight * pbrInputs.diffuseColor;\n  vec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);\n  diffuse *= u_ScaleIBLAmbient.x;\n  specular *= u_ScaleIBLAmbient.y;\n\n  return diffuse + specular;\n}\n#endif\n\n\nvec3 diffuse(PBRInfo pbrInputs)\n{\n  return pbrInputs.diffuseColor / M_PI;\n}\n\nvec3 specularReflection(PBRInfo pbrInputs)\n{\n  return pbrInputs.reflectance0 +\n    (pbrInputs.reflectance90 - pbrInputs.reflectance0) *\n    pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);\n}\n\n\n\nfloat geometricOcclusion(PBRInfo pbrInputs)\n{\n  float NdotL = pbrInputs.NdotL;\n  float NdotV = pbrInputs.NdotV;\n  float r = pbrInputs.alphaRoughness;\n\n  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));\n  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));\n  return attenuationL * attenuationV;\n}\n\n\n\n\n\nfloat microfacetDistribution(PBRInfo pbrInputs)\n{\n  float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;\n  float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;\n  return roughnessSq / (M_PI * f * f);\n}\n\nvoid PBRInfo_setAmbientLight(inout PBRInfo pbrInputs) {\n  pbrInputs.NdotL = 1.0;\n  pbrInputs.NdotH = 0.0;\n  pbrInputs.LdotH = 0.0;\n  pbrInputs.VdotH = 1.0;\n}\n\nvoid PBRInfo_setDirectionalLight(inout PBRInfo pbrInputs, vec3 lightDirection) {\n  vec3 n = pbrInputs.n;\n  vec3 v = pbrInputs.v;\n  vec3 l = normalize(lightDirection);\n  vec3 h = normalize(l+v);\n\n  pbrInputs.NdotL = clamp(dot(n, l), 0.001, 1.0);\n  pbrInputs.NdotH = clamp(dot(n, h), 0.0, 1.0);\n  pbrInputs.LdotH = clamp(dot(l, h), 0.0, 1.0);\n  pbrInputs.VdotH = clamp(dot(v, h), 0.0, 1.0);\n}\n\nvoid PBRInfo_setPointLight(inout PBRInfo pbrInputs, PointLight pointLight) {\n  vec3 light_direction = normalize(pointLight.position - pbr_vPosition);\n  PBRInfo_setDirectionalLight(pbrInputs, light_direction);\n}\n\nvec3 calculateFinalColor(PBRInfo pbrInputs, vec3 lightColor) {\n  vec3 F = specularReflection(pbrInputs);\n  float G = geometricOcclusion(pbrInputs);\n  float D = microfacetDistribution(pbrInputs);\n  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);\n  vec3 specContrib = F * G * D / (4.0 * pbrInputs.NdotL * pbrInputs.NdotV);\n  return pbrInputs.NdotL * lightColor * (diffuseContrib + specContrib);\n}\n\nvec4 pbr_filterColor(vec4 colorUnused)\n{\n#ifdef HAS_BASECOLORMAP\n  vec4 baseColor = SRGBtoLINEAR(texture2D(u_BaseColorSampler, pbr_vUV)) * u_BaseColorFactor;\n#else\n  vec4 baseColor = u_BaseColorFactor;\n#endif\n\n#ifdef ALPHA_CUTOFF\n  if (baseColor.a < u_AlphaCutoff) {\n    discard;\n  }\n#endif\n\n  vec3 color = vec3(0, 0, 0);\n\n  if(pbr_uUnlit){\n    color.rgb = baseColor.rgb;\n  }\n  else{\n\n\n    float perceptualRoughness = u_MetallicRoughnessValues.y;\n    float metallic = u_MetallicRoughnessValues.x;\n#ifdef HAS_METALROUGHNESSMAP\n\n    vec4 mrSample = texture2D(u_MetallicRoughnessSampler, pbr_vUV);\n    perceptualRoughness = mrSample.g * perceptualRoughness;\n    metallic = mrSample.b * metallic;\n#endif\n    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);\n    metallic = clamp(metallic, 0.0, 1.0);\n\n    float alphaRoughness = perceptualRoughness * perceptualRoughness;\n\n    vec3 f0 = vec3(0.04);\n    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);\n    diffuseColor *= 1.0 - metallic;\n    vec3 specularColor = mix(f0, baseColor.rgb, metallic);\n    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);\n\n\n\n    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);\n    vec3 specularEnvironmentR0 = specularColor.rgb;\n    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;\n\n    vec3 n = getNormal();\n    vec3 v = normalize(u_Camera - pbr_vPosition);\n\n    float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);\n    vec3 reflection = -normalize(reflect(v, n));\n\n    PBRInfo pbrInputs = PBRInfo(\n      0.0,\n      NdotV,\n      0.0,\n      0.0,\n      0.0,\n      perceptualRoughness,\n      metallic,\n      specularEnvironmentR0,\n      specularEnvironmentR90,\n      alphaRoughness,\n      diffuseColor,\n      specularColor,\n      n,\n      v\n    );\n\n#ifdef USE_LIGHTS\n    PBRInfo_setAmbientLight(pbrInputs);\n    color += calculateFinalColor(pbrInputs, lighting_uAmbientLight.color);\n    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uDirectionalLightCount, i++) {\n      if (i < lighting_uDirectionalLightCount) {\n        PBRInfo_setDirectionalLight(pbrInputs, lighting_uDirectionalLight[i].direction);\n        color += calculateFinalColor(pbrInputs, lighting_uDirectionalLight[i].color);\n      }\n    }\n    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uPointLightCount, i++) {\n      if (i < lighting_uPointLightCount) {\n        PBRInfo_setPointLight(pbrInputs, lighting_uPointLight[i]);\n        float attenuation = getPointLightAttenuation(lighting_uPointLight[i], distance(lighting_uPointLight[i].position, pbr_vPosition));\n        color += calculateFinalColor(pbrInputs, lighting_uPointLight[i].color / attenuation);\n      }\n    }\n#endif\n#ifdef USE_IBL\n    color += getIBLContribution(pbrInputs, n, reflection);\n#endif\n#ifdef HAS_OCCLUSIONMAP\n    float ao = texture2D(u_OcclusionSampler, pbr_vUV).r;\n    color = mix(color, color * ao, u_OcclusionStrength);\n#endif\n\n#ifdef HAS_EMISSIVEMAP\n    vec3 emissive = SRGBtoLINEAR(texture2D(u_EmissiveSampler, pbr_vUV)).rgb * u_EmissiveFactor;\n    color += emissive;\n#endif\n\n#ifdef PBR_DEBUG\n\n\n\n\n\n    color = mix(color, baseColor.rgb, u_ScaleDiffBaseMR.y);\n    color = mix(color, vec3(metallic), u_ScaleDiffBaseMR.z);\n    color = mix(color, vec3(perceptualRoughness), u_ScaleDiffBaseMR.w);\n#endif\n\n  }\n\n  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);\n}\n",defines:{LIGHTING_FRAGMENT:1},dependencies:[Pp]};class mg{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{id:e}=t;this.id=e||$s(this.constructor.name),this.display=!0,this.position=new In,this.rotation=new In,this.scale=new In(1,1,1),this.matrix=new ri,this.userData={},this.props={},this._setScenegraphNodeProps(t)}delete(){}setProps(t){return this._setScenegraphNodeProps(t),this}toString(){return"{type: ScenegraphNode, id: ".concat(this.id,")}")}getBounds(){return null}setPosition(t){return Xs(3===t.length,"setPosition requires vector argument"),this.position=t,this}setRotation(t){return Xs(3===t.length,"setRotation requires vector argument"),this.rotation=t,this}setScale(t){return Xs(3===t.length,"setScale requires vector argument"),this.scale=t,this}setMatrix(t){arguments.length>1&&void 0!==arguments[1]&&!arguments[1]?this.matrix=t:this.matrix.copy(t)}setMatrixComponents(t){let{position:e,rotation:n,scale:i,update:r=!0}=t;return e&&this.setPosition(e),n&&this.setRotation(n),i&&this.setScale(i),r&&this.updateMatrix(),this}updateMatrix(){const t=this.position,e=this.rotation,n=this.scale;return this.matrix.identity(),this.matrix.translate(t),this.matrix.rotateXYZ(e),this.matrix.scale(n),this}update(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{position:e,rotation:n,scale:i}=t;return e&&this.setPosition(e),n&&this.setRotation(n),i&&this.setScale(i),this.updateMatrix(),this}getCoordinateUniforms(t,e){Xs(t),e=e||this.matrix;const n=new ri(t).multiplyRight(e),i=n.invert(),r=i.transpose();return{viewMatrix:t,modelMatrix:e,objectMatrix:e,worldMatrix:n,worldInverseMatrix:i,worldInverseTransposeMatrix:r}}_setScenegraphNodeProps(t){"display"in t&&(this.display=t.display),"position"in t&&this.setPosition(t.position),"rotation"in t&&this.setRotation(t.rotation),"scale"in t&&this.setScale(t.scale),"matrix"in t&&this.setMatrix(t.matrix),Object.assign(this.props,t)}}class vg extends mg{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t=Array.isArray(t)?{children:t}:t;const{children:e=[]}=t;Kr.assert(e.every((t=>t instanceof mg)),"every child must an instance of ScenegraphNode"),super(t),this.children=e}add(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(const t of e)Array.isArray(t)?this.add(...t):this.children.push(t);return this}remove(t){const e=this.children,n=e.indexOf(t);return n>-1&&e.splice(n,1),this}removeAll(){return this.children=[],this}delete(){this.children.forEach((t=>t.delete())),this.removeAll(),super.delete()}getBounds(){const t=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse(((e,n)=>{let{worldMatrix:i}=n;const r=e.getBounds();if(!r)return;const[s,o]=r,a=new In(s).add(o).divide([2,2,2]);i.transformAsPoint(a,a);const l=new In(o).subtract(s).divide([2,2,2]);i.transformAsVector(l,l);for(let e=0;e<8;e++){const n=new In(1&e?-1:1,2&e?-1:1,4&e?-1:1).multiply(l).add(a);for(let e=0;e<3;e++)t[0][e]=Math.min(t[0][e],n[e]),t[1][e]=Math.max(t[1][e],n[e])}})),Number.isFinite(t[0][0])?t:null}traverse(t){let{worldMatrix:e=new ri}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=new ri(e).multiplyRight(this.matrix);for(const e of this.children)e instanceof vg?e.traverse(t,{worldMatrix:n}):t(e,{worldMatrix:n})}}let yg;class bg extends pn{static get ZERO(){return yg||(yg=new bg(0,0,0,0),Object.freeze(yg)),yg}constructor(t=0,e=0,n=0,i=0){super(-0,-0,-0,-0),en(t)&&1===arguments.length?this.copy(t):($e.debug&&(hn(t),hn(e),hn(n),hn(i)),this[0]=t,this[1]=e,this[2]=n,this[3]=i)}set(t,e,n,i){return this[0]=t,this[1]=e,this[2]=n,this[3]=i,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}fromObject(t){return $e.debug&&(hn(t.x),hn(t.y),hn(t.z),hn(t.w)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t.w=this[3],t}get ELEMENTS(){return 4}get z(){return this[2]}set z(t){this[2]=hn(t)}get w(){return this[3]}set w(t){this[3]=hn(t)}transform(t){return wn(this,this,t),this.check()}transformByMatrix3(t){return Bn(this,this,t),this.check()}transformByMatrix2(t){return function(t,e,n){const i=e[0],r=e[1];t[0]=n[0]*i+n[2]*r,t[1]=n[1]*i+n[3]*r,t[2]=e[2],t[3]=e[3]}(this,this,t),this.check()}transformByQuaternion(t){return En(this,this,t),this.check()}applyMatrix4(t){return t.transform(this,this),this}}function _g(t,e,n){var i=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=n[0],f=n[1],p=n[2],g=n[3],m=n[4],v=n[5],y=n[6],b=n[7],_=n[8];return t[0]=d*i+f*o+p*c,t[1]=d*r+f*a+p*u,t[2]=d*s+f*l+p*h,t[3]=g*i+m*o+v*c,t[4]=g*r+m*a+v*u,t[5]=g*s+m*l+v*h,t[6]=y*i+b*o+_*c,t[7]=y*r+b*a+_*u,t[8]=y*s+b*l+_*h,t}function Ag(t,e,n){var i=n[0],r=n[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=r*e[3],t[4]=r*e[4],t[5]=r*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function wg(){var t=new mn(4);return mn!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Cg(t,e,n){n*=.5;var i=Math.sin(n);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(n),t}function Eg(t,e,n){var i=e[0],r=e[1],s=e[2],o=e[3],a=n[0],l=n[1],c=n[2],u=n[3];return t[0]=i*u+o*a+r*c-s*l,t[1]=r*u+o*l+s*a-i*c,t[2]=s*u+o*c+i*l-r*a,t[3]=o*u-i*a-r*l-s*c,t}var xg,Tg,Sg,Bg,Pg=Yn,Mg=function(t){var e=t[0],n=t[1],i=t[2],r=t[3];return Math.hypot(e,n,i,r)},Ig=function(t){var e=t[0],n=t[1],i=t[2],r=t[3];return e*e+n*n+i*i+r*r},Lg=(xg=vn(),Tg=bn(1,0,0),Sg=bn(0,1,0),function(t,e,n){var i=_n(e,n);return i<-.999999?(An(xg,Tg,e),xn(xg)<1e-6&&An(xg,Sg,e),function(t,e){var n=e[0],i=e[1],r=e[2],s=n*n+i*i+r*r;s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s}(xg,xg),Cg(t,xg,Math.PI),t):i>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(An(xg,e,n),t[0]=xg[0],t[1]=xg[1],t[2]=xg[2],t[3]=1+i,function(t,e){var n=e[0],i=e[1],r=e[2],s=e[3],o=n*n+i*i+r*r+s*s;return o>0&&(o=1/Math.sqrt(o)),t[0]=n*o,t[1]=i*o,t[2]=r*o,t[3]=s*o,t}(t,t))});wg(),wg(),Bg=new mn(9),mn!=Float32Array&&(Bg[1]=0,Bg[2]=0,Bg[3]=0,Bg[5]=0,Bg[6]=0,Bg[7]=0),Bg[0]=1,Bg[4]=1,Bg[8]=1;const Og=[0,0,0,1];class Rg extends un{constructor(t=0,e=0,n=0,i=1){super(-0,-0,-0,-0),Array.isArray(t)&&1===arguments.length?this.copy(t):this.set(t,e,n,i)}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}set(t,e,n,i){return this[0]=t,this[1]=e,this[2]=n,this[3]=i,this.check()}fromObject(t){return this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this.check()}fromMatrix3(t){return function(t,e){var n,i=e[0]+e[4]+e[8];if(i>0)n=Math.sqrt(i+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var r=0;e[4]>e[0]&&(r=1),e[8]>e[3*r+r]&&(r=2);var s=(r+1)%3,o=(r+2)%3;n=Math.sqrt(e[3*r+r]-e[3*s+s]-e[3*o+o]+1),t[r]=.5*n,n=.5/n,t[3]=(e[3*s+o]-e[3*o+s])*n,t[s]=(e[3*s+r]+e[3*r+s])*n,t[o]=(e[3*o+r]+e[3*r+o])*n}}(this,t),this.check()}fromAxisRotation(t,e){return Cg(this,t,e),this.check()}identity(){return function(t){t[0]=0,t[1]=0,t[2]=0,t[3]=1}(this),this.check()}setAxisAngle(t,e){return this.fromAxisRotation(t,e)}get ELEMENTS(){return 4}get x(){return this[0]}set x(t){this[0]=hn(t)}get y(){return this[1]}set y(t){this[1]=hn(t)}get z(){return this[2]}set z(t){this[2]=hn(t)}get w(){return this[3]}set w(t){this[3]=hn(t)}len(){return Mg(this)}lengthSquared(){return Ig(this)}dot(t){return function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}(this,t)}rotationTo(t,e){return Lg(this,t,e),this.check()}add(t){return function(t,e,n){t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3]}(this,this,t),this.check()}calculateW(){return function(t,e){var n=e[0],i=e[1],r=e[2];t[0]=n,t[1]=i,t[2]=r,t[3]=Math.sqrt(Math.abs(1-n*n-i*i-r*r))}(this,this),this.check()}conjugate(){return function(t,e){t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3]}(this,this),this.check()}invert(){return function(t,e){var n=e[0],i=e[1],r=e[2],s=e[3],o=n*n+i*i+r*r+s*s,a=o?1/o:0;t[0]=-n*a,t[1]=-i*a,t[2]=-r*a,t[3]=s*a}(this,this),this.check()}lerp(t,e,n){return void 0===n?this.lerp(this,t,e):(function(t,e,n,i){var r=e[0],s=e[1],o=e[2],a=e[3];t[0]=r+i*(n[0]-r),t[1]=s+i*(n[1]-s),t[2]=o+i*(n[2]-o),t[3]=a+i*(n[3]-a)}(this,t,e,n),this.check())}multiplyRight(t){return Eg(this,this,t),this.check()}multiplyLeft(t){return Eg(this,t,this),this.check()}normalize(){const t=this.len(),e=t>0?1/t:0;return this[0]=this[0]*e,this[1]=this[1]*e,this[2]=this[2]*e,this[3]=this[3]*e,0===t&&(this[3]=1),this.check()}rotateX(t){return function(t,e,n){n*=.5;var i=e[0],r=e[1],s=e[2],o=e[3],a=Math.sin(n),l=Math.cos(n);t[0]=i*l+o*a,t[1]=r*l+s*a,t[2]=s*l-r*a,t[3]=o*l-i*a}(this,this,t),this.check()}rotateY(t){return function(t,e,n){n*=.5;var i=e[0],r=e[1],s=e[2],o=e[3],a=Math.sin(n),l=Math.cos(n);t[0]=i*l-s*a,t[1]=r*l+o*a,t[2]=s*l+i*a,t[3]=o*l-r*a}(this,this,t),this.check()}rotateZ(t){return function(t,e,n){n*=.5;var i=e[0],r=e[1],s=e[2],o=e[3],a=Math.sin(n),l=Math.cos(n);t[0]=i*l+r*a,t[1]=r*l-i*a,t[2]=s*l+o*a,t[3]=o*l-s*a}(this,this,t),this.check()}scale(t){return Pg(this,this,t),this.check()}slerp(t,e,n){let i,r,s;switch(arguments.length){case 1:({start:i=Og,target:r,ratio:s}=t);break;case 2:i=this,r=t,s=e;break;default:i=t,r=e,s=n}return function(t,e,n,i){var r,s,o,a,l,c=e[0],u=e[1],h=e[2],d=e[3],f=n[0],p=n[1],g=n[2],m=n[3];(s=c*f+u*p+h*g+d*m)<0&&(s=-s,f=-f,p=-p,g=-g,m=-m),1-s>gn?(r=Math.acos(s),o=Math.sin(r),a=Math.sin((1-i)*r)/o,l=Math.sin(i*r)/o):(a=1-i,l=i),t[0]=a*c+l*f,t[1]=a*u+l*p,t[2]=a*h+l*g,t[3]=a*d+l*m}(this,i,r,s),this.check()}transformVector4(t,e=new bg){return function(t,e,n){var i=e[0],r=e[1],s=e[2],o=n[0],a=n[1],l=n[2],c=n[3],u=c*i+a*s-l*r,h=c*r+l*i-o*s,d=c*s+o*r-a*i,f=-o*i-a*r-l*s;t[0]=u*c+f*-o+h*-l-d*-a,t[1]=h*c+f*-a+d*-o-u*-l,t[2]=d*c+f*-l+u*-a-h*-o,t[3]=e[3]}(e,t,this),dn(e,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(t,e){return this.setAxisAngle(t,e)}premultiply(t){return this.multiplyLeft(t)}multiply(t){return this.multiplyRight(t)}}const Fg={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},kg={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function Dg(t){if(!t._animation){const e=kg[t.componentType],n=Fg[t.type],i=n*t.count,{buffer:r,byteOffset:s}=t.bufferView.data,o=new e(r,s+(t.byteOffset||0),i);if(1===n)t._animation=Array.from(o);else{const e=[];for(let t=0;t<o.length;t+=n)e.push(Array.from(o.slice(t,t+n)));t._animation=e}}return t._animation}const Ng=new ri,Ug=new Rg;class zg{constructor(t){this.startTime=0,this.playing=!0,this.speed=1,this.channels=[],Object.assign(this,t)}animate(t){if(!this.playing)return;const e=(t/1e3-this.startTime)*this.speed;this.channels.forEach((t=>{let{sampler:n,target:i,path:r}=t;(function(t,e,n,i){let{input:r,interpolation:s,output:o}=e;const a=t%r[r.length-1],l=r.findIndex((t=>t>=a)),c=Math.max(0,l-1);if(!Array.isArray(n[i]))switch(i){case"translation":n[i]=[0,0,0];break;case"rotation":n[i]=[0,0,0,1];break;case"scale":n[i]=[1,1,1];break;default:Kr.warn("Bad animation path ".concat(i))()}Xs(n[i].length===o[c].length);const u=r[c],h=r[l];switch(s){case"STEP":!function(t,e,n){for(let i=0;i<n.length;i++)t[e][i]=n[i]}(n,i,o[c]);break;case"LINEAR":if(h>u){const t=(a-u)/(h-u);!function(t,e,n,i,r){if("rotation"===e){Ug.slerp({start:n,target:i,ratio:r});for(let n=0;n<Ug.length;n++)t[e][n]=Ug[n]}else for(let s=0;s<n.length;s++)t[e][s]=r*i[s]+(1-r)*n[s]}(n,i,o[c],o[l],t)}break;case"CUBICSPLINE":if(h>u){const t=(a-u)/(h-u),e=h-u;!function(t,e,n){let{p0:i,outTangent0:r,inTangent1:s,p1:o,tDiff:a,ratio:l}=n;for(let n=0;n<t[e].length;n++){const c=r[n]*a,u=s[n]*a;t[e][n]=(2*Math.pow(l,3)-3*Math.pow(l,2)+1)*i[n]+(Math.pow(l,3)-2*Math.pow(l,2)+l)*c+(-2*Math.pow(l,3)+3*Math.pow(l,2))*o[n]+(Math.pow(l,3)-Math.pow(l,2))*u}}(n,i,{p0:o[3*c+1],outTangent0:o[3*c+2],inTangent1:o[3*l+0],p1:o[3*l+1],tDiff:e,ratio:t})}break;default:Kr.warn("Interpolation ".concat(s," not supported"))()}})(e,n,i,r),function(t,e){if(e.matrix.identity(),t.translation&&e.matrix.translate(t.translation),t.rotation){const n=Ng.fromQuaternion(t.rotation);e.matrix.multiplyRight(n)}t.scale&&e.matrix.scale(t.scale)}(i,i._node)}))}}class Gg{constructor(t){this.animations=t.animations.map(((e,n)=>{const i=e.name||"Animation-".concat(n),r=e.samplers.map((e=>{let{input:n,interpolation:i="LINEAR",output:r}=e;return{input:Dg(t.accessors[n]),interpolation:i,output:Dg(t.accessors[r])}})),s=e.channels.map((e=>{let{sampler:n,target:i}=e;return{sampler:r[n],target:t.nodes[i.node],path:i.path}}));return new zg({name:i,channels:s})}))}animate(t){this.setTime(t)}setTime(t){this.animations.forEach((e=>e.animate(t)))}getAnimations(){return this.animations}}class jg extends mg{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(e),this.onBeforeRender=null,this.AfterRender=null,t instanceof wd?(this.model=t,this._setModelNodeProps(e)):this.model=new wd(t,e),this.bounds=null,this.managedResources=e.managedResources||[]}setProps(t){return super.setProps(t),this._setModelNodeProps(t),this}getBounds(){return this.bounds}delete(){this.model&&(this.model.delete(),this.model=null),this.managedResources.forEach((t=>t.delete())),this.managedResources=[]}draw(){return this.model.draw(...arguments)}setUniforms(){return this.model.setUniforms(...arguments),this}setAttributes(){return this.model.setAttributes(...arguments),this}updateModuleSettings(){return this.model.updateModuleSettings(...arguments),this}_setModelNodeProps(t){this.model.setProps(t)}}class Vg{constructor(t,e){let{attributes:n,material:i,pbrDebug:r,imageBasedLightingEnvironment:s,lights:o,useTangents:a}=e;this.gl=t,this.defines={MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},Ho(t,Go)&&(this.defines.USE_TEX_LOD=1),this.uniforms={u_Camera:[0,0,0],u_MetallicRoughnessValues:[1,1]},this.parameters={},this.generatedTextures=[],s&&(this.uniforms.u_DiffuseEnvSampler=s.getDiffuseEnvSampler(),this.uniforms.u_SpecularEnvSampler=s.getSpecularEnvSampler(),this.uniforms.u_brdfLUT=s.getBrdfTexture(),this.uniforms.u_ScaleIBLAmbient=[1,1]),r&&(this.uniforms.u_ScaleDiffBaseMR=[0,0,0,0],this.uniforms.u_ScaleFGDSpec=[0,0,0,0]),this.defineIfPresent(n.NORMAL,"HAS_NORMALS"),this.defineIfPresent(n.TANGENT&&a,"HAS_TANGENTS"),this.defineIfPresent(n.TEXCOORD_0,"HAS_UV"),this.defineIfPresent(s,"USE_IBL"),this.defineIfPresent(o,"USE_LIGHTS"),this.defineIfPresent(r,"PBR_DEBUG"),i&&this.parseMaterial(i)}defineIfPresent(t,e){t&&(this.defines[e]=1)}parseTexture(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=t.texture&&t.texture.sampler&&t.texture.sampler.parameters||{},r=t.texture.source.image;let s,o={};r.compressed?(s=r,o={[this.gl.TEXTURE_MIN_FILTER]:r.data.length>1?this.gl.LINEAR_MIPMAP_NEAREST:this.gl.LINEAR}):s={data:r};const a=new Eo(this.gl,{id:t.name||t.id,parameters:{...i,...o},pixelStore:{[this.gl.UNPACK_FLIP_Y_WEBGL]:!1},...s});this.uniforms[e]=a,this.defineIfPresent(n,n),this.generatedTextures.push(a)}parsePbrMetallicRoughness(t){t.baseColorTexture&&this.parseTexture(t.baseColorTexture,"u_BaseColorSampler","HAS_BASECOLORMAP"),this.uniforms.u_BaseColorFactor=t.baseColorFactor||[1,1,1,1],t.metallicRoughnessTexture&&this.parseTexture(t.metallicRoughnessTexture,"u_MetallicRoughnessSampler","HAS_METALROUGHNESSMAP");const{metallicFactor:e=1,roughnessFactor:n=1}=t;this.uniforms.u_MetallicRoughnessValues=[e,n]}parseMaterial(t){if(this.uniforms.pbr_uUnlit=Boolean(t.unlit),t.pbrMetallicRoughness&&this.parsePbrMetallicRoughness(t.pbrMetallicRoughness),t.normalTexture){this.parseTexture(t.normalTexture,"u_NormalSampler","HAS_NORMALMAP");const{scale:e=1}=t.normalTexture;this.uniforms.u_NormalScale=e}if(t.occlusionTexture){this.parseTexture(t.occlusionTexture,"u_OcclusionSampler","HAS_OCCLUSIONMAP");const{strength:e=1}=t.occlusionTexture;this.uniforms.u_OcclusionStrength=e}if(t.emissiveTexture&&(this.parseTexture(t.emissiveTexture,"u_EmissiveSampler","HAS_EMISSIVEMAP"),this.uniforms.u_EmissiveFactor=t.emissiveFactor||[0,0,0]),"MASK"===t.alphaMode){const{alphaCutoff:e=.5}=t;this.defines.ALPHA_CUTOFF=1,this.uniforms.u_AlphaCutoff=e}else"BLEND"===t.alphaMode&&(Kr.warn("BLEND alphaMode might not work well because it requires mesh sorting")(),Object.assign(this.parameters,{blend:!0,blendEquation:this.gl.FUNC_ADD,blendFunc:[this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA]}))}delete(){this.generatedTextures.forEach((t=>t.delete()))}}function Hg(t,e){return Zr(t)?"#version 300 es\n".concat(e):e}const Wg={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Jg={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};class qg{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.gl=t,this.options=Object.assign({},Jg,e)}instantiate(t){return this.gltf=t,(t.scenes||[]).map((t=>this.createScene(t)))}createAnimator(){return Array.isArray(this.gltf.animations)?new Gg(this.gltf):null}createScene(t){const e=(t.nodes||[]).map((t=>this.createNode(t)));return new vg({id:t.name||t.id,children:e})}createNode(t){if(!t._node){const e=(t.children||[]).map((t=>this.createNode(t)));t.mesh&&e.push(this.createMesh(t.mesh));const n=new vg({id:t.name||t.id,children:e});if(t.matrix)n.setMatrix(t.matrix);else{if(n.matrix.identity(),t.translation&&n.matrix.translate(t.translation),t.rotation){const e=(new ri).fromQuaternion(t.rotation);n.matrix.multiplyRight(e)}t.scale&&n.matrix.scale(t.scale)}t._node=n}return t._node}createMesh(t){if(!t._mesh){const e=(t.primitives||[]).map(((e,n)=>this.createPrimitive(e,n,t))),n=new vg({id:t.name||t.id,children:e});t._mesh=n}return t._mesh}getVertexCount(t){Kr.warn("getVertexCount() not found")()}createPrimitive(t,e,n){const i=function(t,e){const{id:n,drawMode:i,vertexCount:r,attributes:s,modelOptions:o}=e,a=new Vg(t,e);Kr.info(4,"createGLTFModel defines: ",a.defines)();const l=[];l.push(...a.generatedTextures),l.push(...Object.values(s).map((t=>t.buffer)));const c=new jg(t,{id:n,drawMode:i,vertexCount:r,modules:[gg],parameters:a.parameters,vs:Hg(t,"\n#if (__VERSION__ < 300)\n  #define _attr attribute\n#else\n  #define _attr in\n#endif\n\n  _attr vec4 POSITION;\n\n  #ifdef HAS_NORMALS\n    _attr vec4 NORMAL;\n  #endif\n\n  #ifdef HAS_TANGENTS\n    _attr vec4 TANGENT;\n  #endif\n\n  #ifdef HAS_UV\n    _attr vec2 TEXCOORD_0;\n  #endif\n\n  void main(void) {\n    vec4 _NORMAL = vec4(0.);\n    vec4 _TANGENT = vec4(0.);\n    vec2 _TEXCOORD_0 = vec2(0.);\n\n    #ifdef HAS_NORMALS\n      _NORMAL = NORMAL;\n    #endif\n\n    #ifdef HAS_TANGENTS\n      _TANGENT = TANGENT;\n    #endif\n\n    #ifdef HAS_UV\n      _TEXCOORD_0 = TEXCOORD_0;\n    #endif\n\n    pbr_setPositionNormalTangentUV(POSITION, _NORMAL, _TANGENT, _TEXCOORD_0);\n    gl_Position = u_MVPMatrix * POSITION;\n  }\n"),fs:Hg(t,"\n#if (__VERSION__ < 300)\n  #define fragmentColor gl_FragColor\n#else\n  out vec4 fragmentColor;\n#endif\n\n  void main(void) {\n    fragmentColor = pbr_filterColor(vec4(0));\n  }\n"),managedResources:l,...o,defines:{...a.defines,...o.defines}});return c.setProps({attributes:s}),c.setUniforms(a.uniforms),c}(this.gl,Object.assign({id:t.name||"".concat(n.name||n.id,"-primitive-").concat(e),drawMode:t.mode||4,vertexCount:t.indices?t.indices.count:this.getVertexCount(t.attributes),attributes:this.createAttributes(t.attributes,t.indices),material:t.material},this.options));return i.bounds=[t.attributes.POSITION.min,t.attributes.POSITION.max],i}createAttributes(t,e){const n={};return Object.keys(t).forEach((e=>{n[e]=this.createAccessor(t[e],this.createBuffer(t[e],this.gl.ARRAY_BUFFER))})),e&&(n.indices=this.createAccessor(e,this.createBuffer(e,this.gl.ELEMENT_ARRAY_BUFFER))),Kr.info(4,"glTF Attributes",{attributes:t,indices:e,generated:n})(),n}createBuffer(t,e){t.bufferView||(t.bufferView={});const{bufferView:n}=t;return n.lumaBuffers||(n.lumaBuffers={}),n.lumaBuffers[e]||(n.lumaBuffers[e]=new vo(this.gl,{id:"from-".concat(n.id),data:n.data||t.value,target:e})),n.lumaBuffers[e]}createAccessor(t,e){return new fo({buffer:e,offset:t.byteOffset||0,stride:t.bufferView.byteStride||0,type:t.componentType,size:Wg[t.type]})}createSampler(t){return t}needsPOT(){return!1}}const Kg=null,Xg=null,Qg=null,Yg=null,Zg="3.4.14",$g={};async function tm(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return n&&(e=function(t,e,n){if(t.startsWith("http"))return t;const i=n.modules||{};return i[t]?i[t]:ae?n.CDN?(re(n.CDN.startsWith("http")),"".concat(n.CDN,"/").concat(e,"@").concat(Zg,"/dist/libs/").concat(t)):le?"../src/libs/".concat(t):"modules/".concat(e,"/src/libs/").concat(t):"modules/".concat(e,"/dist/libs/").concat(t)}(e,n,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})),$g[e]=$g[e]||async function(e){if(e.endsWith("wasm")){const t=await fetch(e);return await t.arrayBuffer()}if(!ae)try{return t&&Qg&&await Qg(e)}catch{return null}if(le)return importScripts(e);const n=await fetch(e);return function(t,e){if(!ae)return Yg&&Yg(t,e);if(le)return eval.call(oe,t),null;const n=document.createElement("script");n.id=e;try{n.appendChild(document.createTextNode(t))}catch(e){n.text=t}return document.body.appendChild(n),null}(await n.text(),e)}(e),await $g[e]}const em="3.4.14",nm="https://unpkg.com/@loaders.gl/textures@".concat(em,"/dist/libs/basis_encoder.wasm"),im="https://unpkg.com/@loaders.gl/textures@".concat(em,"/dist/libs/basis_encoder.js");let rm,sm;async function om(t){const e=t.modules||{};return e.basis?e.basis:(rm=rm||async function(t){let e=null,n=null;return[e,n]=await Promise.all([await tm("basis_transcoder.js","textures",t),await tm("basis_transcoder.wasm","textures",t)]),e=e||globalThis.BASIS,await function(t,e){const n={};return e&&(n.wasmBinary=e),new Promise((e=>{t(n).then((t=>{const{BasisFile:n,initializeBasis:i}=t;i(),e({BasisFile:n})}))}))}(e,n)}(t),await rm)}async function am(t){const e=t.modules||{};return e.basisEncoder?e.basisEncoder:(sm=sm||async function(t){let e=null,n=null;return[e,n]=await Promise.all([await tm(im,"textures",t),await tm(nm,"textures",t)]),e=e||globalThis.BASIS,await function(t,e){const n={};return e&&(n.wasmBinary=e),new Promise((e=>{t(n).then((t=>{const{BasisFile:n,KTX2File:i,initializeBasis:r,BasisEncoder:s}=t;r(),e({BasisFile:n,KTX2File:i,BasisEncoder:s})}))}))}(e,n)}(t),await sm)}const lm=["","WEBKIT_","MOZ_"],cm={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let um=null;var hm,dm,fm,pm,gm,mm,vm,ym,bm;new Uint8Array([0]),(bm=hm||(hm={}))[bm.NONE=0]="NONE",bm[bm.BASISLZ=1]="BASISLZ",bm[bm.ZSTD=2]="ZSTD",bm[bm.ZLIB=3]="ZLIB",function(t){t[t.BASICFORMAT=0]="BASICFORMAT"}(dm||(dm={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.ETC1S=163]="ETC1S",t[t.UASTC=166]="UASTC"}(fm||(fm={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.SRGB=1]="SRGB"}(pm||(pm={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.LINEAR=1]="LINEAR",t[t.SRGB=2]="SRGB",t[t.ITU=3]="ITU",t[t.NTSC=4]="NTSC",t[t.SLOG=5]="SLOG",t[t.SLOG2=6]="SLOG2"}(gm||(gm={})),function(t){t[t.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",t[t.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(mm||(mm={})),function(t){t[t.RGB=0]="RGB",t[t.RRR=3]="RRR",t[t.GGG=4]="GGG",t[t.AAA=15]="AAA"}(vm||(vm={})),function(t){t[t.RGB=0]="RGB",t[t.RGBA=3]="RGBA",t[t.RRR=4]="RRR",t[t.RRRG=5]="RRRG"}(ym||(ym={}));const _m=[171,75,84,88,32,50,48,187,13,10,26,10],Am={etc1:{basisFormat:0,compressed:!0,format:36196},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:33776},bc3:{basisFormat:3,compressed:!0,format:33779},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:35840},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:35842},"astc-4x4":{basisFormat:10,compressed:!0,format:37808},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};function wm(t,e,n){const i=new t(new Uint8Array(e));try{if(!i.startTranscoding())throw new Error("Failed to start basis transcoding");const t=i.getNumImages(),e=[];for(let r=0;r<t;r++){const t=i.getNumLevels(r),s=[];for(let e=0;e<t;e++)s.push(Cm(i,r,e,n));e.push(s)}return e}finally{i.close(),i.delete()}}function Cm(t,e,n,i){const r=t.getImageWidth(e,n),s=t.getImageHeight(e,n),o=t.getHasAlpha(),{compressed:a,format:l,basisFormat:c}=Tm(i,o),u=t.getImageTranscodedSizeInBytes(e,n,c),h=new Uint8Array(u);if(!t.transcodeImage(h,e,n,c,0,0))throw new Error("failed to start Basis transcoding");return{width:r,height:s,data:h,compressed:a,format:l,hasAlpha:o}}function Em(t,e,n){const i=new t(new Uint8Array(e));try{if(!i.startTranscoding())throw new Error("failed to start KTX2 transcoding");const t=i.getLevels(),e=[];for(let r=0;r<t;r++){e.push(xm(i,r,n));break}return[e]}finally{i.close(),i.delete()}}function xm(t,e,n){const{alphaFlag:i,height:r,width:s}=t.getImageLevelInfo(e,0,0),{compressed:o,format:a,basisFormat:l}=Tm(n,i),c=t.getImageTranscodedSizeInBytes(e,0,0,l),u=new Uint8Array(c);if(!t.transcodeImage(u,e,0,0,l,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:s,height:r,data:u,compressed:o,levelSize:c,hasAlpha:i,format:a}}function Tm(t,e){let n=t&&t.basis&&t.basis.format;return"auto"===n&&(n=Sm()),"object"==typeof n&&(n=e?n.alpha:n.noAlpha),n=n.toLowerCase(),Am[n]}function Sm(){const t=function(t){if(!um){t=t||function(){try{return document.createElement("canvas").getContext("webgl")}catch(t){return null}}()||void 0,um=new Set;for(const e of lm)for(const n in cm)if(t&&t.getExtension("".concat(e).concat(n))){const t=cm[n];um.add(t)}}return um}();return t.has("astc")?"astc-4x4":t.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:t.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:t.has("etc1")?"etc1":t.has("etc2")?"etc2":"rgb565"}const Bm={...{name:"Basis",id:ae?"basis":"basis-nodejs",module:"textures",version:"3.4.14",worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},parse:async function(t,e){if("auto"===e.basis.containerFormat){if(function(t){const e=new Uint8Array(t);return!(e.byteLength<_m.length||e[0]!==_m[0]||e[1]!==_m[1]||e[2]!==_m[2]||e[3]!==_m[3]||e[4]!==_m[4]||e[5]!==_m[5]||e[6]!==_m[6]||e[7]!==_m[7]||e[8]!==_m[8]||e[9]!==_m[9]||e[10]!==_m[10]||e[11]!==_m[11])}(t))return Em((await am(e)).KTX2File,t,e);const{BasisFile:n}=await om(e);return wm(n,t,e)}if("encoder"===e.basis.module){const n=await am(e);return"ktx2"===e.basis.containerFormat?Em(n.KTX2File,t,e):wm(n.BasisFile,t,e)}{const{BasisFile:n}=await om(e);return wm(n,t,e)}}};function Pm(t,e,n){if(t.byteLength<=e+n)return"";const i=new DataView(t);let r="";for(let t=0;t<n;t++)r+=String.fromCharCode(i.getUint8(e+t));return r}function Mm(t,e){if(!t)throw new Error(e||"assert failed: gltf")}function Im(t,e){if(t.startsWith("data:")||t.startsWith("http:")||t.startsWith("https:"))return t;const n=e.baseUri||e.uri;if(!n)throw new Error("'baseUri' must be provided to resolve relative url ".concat(t));return n.substr(0,n.lastIndexOf("/")+1)+t}function Lm(t,e){return dt(t>=0),dt(e>0),t+(e-1)&~(e-1)}function Om(t,e,n){let i;if(t instanceof ArrayBuffer)i=new Uint8Array(t);else{const e=t.byteOffset,n=t.byteLength;i=new Uint8Array(t.buffer||t.arrayBuffer,e,n)}return e.set(i,n),n+Lm(i.byteLength,4)}const Rm=["SCALAR","VEC2","VEC3","VEC4"],Fm=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],km=new Map(Fm),Dm={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Nm={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Um={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function zm(t){return Rm[t-1]||Rm[0]}function Gm(t){const e=km.get(t.constructor);if(!e)throw new Error("Illegal typed array");return e}function jm(t,e){const n=Um[t.componentType],i=Dm[t.type],r=Nm[t.componentType],s=t.count*i,o=t.count*i*r;return Mm(o>=0&&o<=e.byteLength),{ArrayType:n,length:s,byteLength:o}}function Vm(t){let{images:e,bufferViews:n}=t;e=e||[],n=n||[];const i=e.map((t=>t.bufferView));n=n.filter((t=>!i.includes(t)));const r=n.reduce(((t,e)=>t+e.byteLength),0),s=e.reduce(((t,e)=>{const{width:n,height:i}=e.image;return t+n*i}),0);return r+Math.ceil(4*s*1.33)}const Hm={asset:{version:"2.0",generator:"loaders.gl"},buffers:[]};class Wm{constructor(t){m(this,"gltf",void 0),m(this,"sourceBuffers",void 0),m(this,"byteLength",void 0),this.gltf=t||{json:{...Hm},buffers:[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(t){return this.json[t]}getExtraData(t){return(this.json.extras||{})[t]}getExtension(t){const e=this.getUsedExtensions().find((e=>e===t)),n=this.json.extensions||{};return e?n[t]||!0:null}getRequiredExtension(t){return this.getRequiredExtensions().find((e=>e===t))?this.getExtension(t):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(t,e){return(t.extensions||{})[e]}getScene(t){return this.getObject("scenes",t)}getNode(t){return this.getObject("nodes",t)}getSkin(t){return this.getObject("skins",t)}getMesh(t){return this.getObject("meshes",t)}getMaterial(t){return this.getObject("materials",t)}getAccessor(t){return this.getObject("accessors",t)}getTexture(t){return this.getObject("textures",t)}getSampler(t){return this.getObject("samplers",t)}getImage(t){return this.getObject("images",t)}getBufferView(t){return this.getObject("bufferViews",t)}getBuffer(t){return this.getObject("buffers",t)}getObject(t,e){if("object"==typeof e)return e;const n=this.json[t]&&this.json[t][e];if(!n)throw new Error("glTF file error: Could not find ".concat(t,"[").concat(e,"]"));return n}getTypedArrayForBufferView(t){const e=(t=this.getBufferView(t)).buffer,n=this.gltf.buffers[e];Mm(n);const i=(t.byteOffset||0)+n.byteOffset;return new Uint8Array(n.arrayBuffer,i,t.byteLength)}getTypedArrayForAccessor(t){t=this.getAccessor(t);const e=this.getBufferView(t.bufferView),n=this.getBuffer(e.buffer).data,{ArrayType:i,length:r}=jm(t,e);return new i(n,e.byteOffset+t.byteOffset,r)}getTypedArrayForImageData(t){t=this.getAccessor(t);const e=this.getBufferView(t.bufferView),n=this.getBuffer(e.buffer).data,i=e.byteOffset||0;return new Uint8Array(n,i,e.byteLength)}addApplicationData(t,e){return this.json[t]=e,this}addExtraData(t,e){return this.json.extras=this.json.extras||{},this.json.extras[t]=e,this}addObjectExtension(t,e,n){return t.extensions=t.extensions||{},t.extensions[e]=n,this.registerUsedExtension(e),this}setObjectExtension(t,e,n){(t.extensions||{})[e]=n}removeObjectExtension(t,e){const n=t.extensions||{},i=n[e];return delete n[e],i}addExtension(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Mm(e),this.json.extensions=this.json.extensions||{},this.json.extensions[t]=e,this.registerUsedExtension(t),e}addRequiredExtension(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Mm(e),this.addExtension(t,e),this.registerRequiredExtension(t),e}registerUsedExtension(t){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find((e=>e===t))||this.json.extensionsUsed.push(t)}registerRequiredExtension(t){this.registerUsedExtension(t),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find((e=>e===t))||this.json.extensionsRequired.push(t)}removeExtension(t){if(!this.getExtension(t))return;this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,t),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,t),this.json.extensions&&delete this.json.extensions[t],Array.isArray(this.json.extensionsRemoved)||(this.json.extensionsRemoved=[]);const e=this.json.extensionsRemoved;e.includes(t)||e.push(t)}setDefaultScene(t){this.json.scene=t}addScene(t){const{nodeIndices:e}=t;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:e}),this.json.scenes.length-1}addNode(t){const{meshIndex:e,matrix:n}=t;this.json.nodes=this.json.nodes||[];const i={mesh:e};return n&&(i.matrix=n),this.json.nodes.push(i),this.json.nodes.length-1}addMesh(t){const{attributes:e,indices:n,material:i,mode:r=4}=t,s={primitives:[{attributes:this._addAttributes(e),mode:r}]};if(n){const t=this._addIndices(n);s.primitives[0].indices=t}return Number.isFinite(i)&&(s.primitives[0].material=i),this.json.meshes=this.json.meshes||[],this.json.meshes.push(s),this.json.meshes.length-1}addPointCloud(t){const e={primitives:[{attributes:this._addAttributes(t),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(e),this.json.meshes.length-1}addImage(t,e){const n=Bc(t),i=e||(null==n?void 0:n.mimeType),r={bufferView:this.addBufferView(t),mimeType:i};return this.json.images=this.json.images||[],this.json.images.push(r),this.json.images.length-1}addBufferView(t){const e=t.byteLength;Mm(Number.isFinite(e)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(t);const n={buffer:0,byteOffset:this.byteLength,byteLength:e};return this.byteLength+=Lm(e,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(n),this.json.bufferViews.length-1}addAccessor(t,e){const n={bufferView:t,type:zm(e.size),componentType:e.componentType,count:e.count,max:e.max,min:e.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(n),this.json.accessors.length-1}addBinaryBuffer(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{size:3};const n=this.addBufferView(t);let i={min:e.min,max:e.max};i.min&&i.max||(i=this._getAccessorMinMax(t,e.size));const r={size:e.size,componentType:Gm(t),count:Math.round(t.length/e.size),min:i.min,max:i.max};return this.addAccessor(n,Object.assign(r,e))}addTexture(t){const{imageIndex:e}=t,n={source:e};return this.json.textures=this.json.textures||[],this.json.textures.push(n),this.json.textures.length-1}addMaterial(t){return this.json.materials=this.json.materials||[],this.json.materials.push(t),this.json.materials.length-1}createBinaryChunk(){var t,e;this.gltf.buffers=[];const n=this.byteLength,i=new ArrayBuffer(n),r=new Uint8Array(i);let s=0;for(const t of this.sourceBuffers||[])s=Om(t,r,s);null!==(t=this.json)&&void 0!==t&&null!==(e=t.buffers)&&void 0!==e&&e[0]?this.json.buffers[0].byteLength=n:this.json.buffers=[{byteLength:n}],this.gltf.binary=i,this.sourceBuffers=[i]}_removeStringFromArray(t,e){let n=!0;for(;n;){const i=t.indexOf(e);i>-1?t.splice(i,1):n=!1}}_addAttributes(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e={};for(const n in t){const i=t[n],r=this._getGltfAttributeName(n),s=this.addBinaryBuffer(i.value,i);e[r]=s}return e}_addIndices(t){return this.addBinaryBuffer(t,{size:1})}_getGltfAttributeName(t){switch(t.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return t}}_getAccessorMinMax(t,e){const n={min:null,max:null};if(t.length<e)return n;n.min=[],n.max=[];const i=t.subarray(0,e);for(const t of i)n.min.push(t),n.max.push(t);for(let i=e;i<t.length;i+=e)for(let r=0;r<e;r++)n.min[0+r]=Math.min(n.min[0+r],t[i+r]),n.max[0+r]=Math.max(n.max[0+r],t[i+r]);return n}}const Jm="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",qm="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",Km=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),Xm=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),Qm={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Ym={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};let Zm;const $m="EXT_meshopt_compression",tv=$m;async function ev(t,e){var n;const i=new Wm(t);if(null==e||null===(n=e.gltf)||void 0===n||!n.decompressMeshes)return;const r=[];for(const e of t.json.bufferViews||[])r.push(nv(i,e));await Promise.all(r),i.removeExtension($m)}async function nv(t,e){const n=t.getObjectExtension(e,$m);if(n){const{byteOffset:i=0,byteLength:r=0,byteStride:s,count:o,mode:a,filter:l="NONE",buffer:c}=n,u=t.gltf.buffers[c],h=new Uint8Array(u.arrayBuffer,u.byteOffset+i,r),d=new Uint8Array(t.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);return await async function(t,e,n,i,r){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NONE";const o=await async function(){return Zm||(Zm=async function(){let t=Jm;WebAssembly.validate(Km)&&(t=qm,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;++n){const i=t.charCodeAt(n);e[n]=i>96?i-71:i>64?i-65:i>47?i+4:i>46?63:62}let n=0;for(let i=0;i<t.length;++i)e[n++]=e[i]<60?Xm[e[i]]:64*(e[i]-60)+e[++i];return e.buffer.slice(0,n)}(t),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}()),Zm}();!function(t,e,n,i,r,s,o){const a=t.exports.sbrk,l=i+3&-4,c=a(l*r),u=a(s.length),h=new Uint8Array(t.exports.memory.buffer);h.set(s,u);const d=e(c,i,r,u,s.length);if(0===d&&o&&o(c,l,r),n.set(h.subarray(c,c+i*r)),a(c-a(0)),0!==d)throw new Error("Malformed buffer data: ".concat(d))}(o,o.exports[Ym[r]],t,e,n,i,o.exports[Qm[s||"NONE"]])}(d,o,s,h,a,l),d}return null}const iv={};function rv(t){if(void 0===iv[t]){const e=qt?function(t){switch(t){case"image/avif":case"image/webp":return function(t){try{return 0===document.createElement("canvas").toDataURL(t).indexOf("data:".concat(t))}catch{return!1}}(t);default:return!0}}(t):function(t){const e=["image/png","image/jpeg","image/gif"],{_parseImageNode:n,_imageFormatsNode:i=e}=globalThis;return Boolean(n)&&i.includes(t)}(t);iv[t]=e}return iv[t]}const sv="EXT_texture_webp",ov=sv;function av(t,e){const n=new Wm(t);if(!rv("image/webp")){if(n.getRequiredExtensions().includes(sv))throw new Error("gltf: Required extension ".concat(sv," not supported by browser"));return}const{json:i}=n;for(const t of i.textures||[]){const e=n.getObjectExtension(t,sv);e&&(t.source=e.source),n.removeObjectExtension(t,sv)}n.removeExtension(sv)}const lv="KHR_texture_basisu",cv=lv;function uv(t,e){const n=new Wm(t),{json:i}=n;for(const t of i.textures||[]){const e=n.getObjectExtension(t,lv);e&&(t.source=e.source),n.removeObjectExtension(t,lv)}n.removeExtension(lv)}const hv={draco:{decoderType:"object"==typeof WebAssembly?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}},dv={name:"Draco",id:ae?"draco":"draco-nodejs",module:"draco",shapes:["mesh"],version:"3.4.14",worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:hv};function fv(t){let e=1/0,n=1/0,i=1/0,r=-1/0,s=-1/0,o=-1/0;const a=t.POSITION?t.POSITION.value:[],l=a&&a.length;for(let t=0;t<l;t+=3){const l=a[t],c=a[t+1],u=a[t+2];e=l<e?l:e,n=c<n?c:n,i=u<i?u:i,r=l>r?l:r,s=c>s?c:s,o=u>o?u:o}return[[e,n,i],[r,s,o]]}class pv{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Map;m(this,"name",void 0),m(this,"type",void 0),m(this,"nullable",void 0),m(this,"metadata",void 0),this.name=t,this.type=e,this.nullable=n,this.metadata=i}get typeId(){return this.type&&this.type.typeId}clone(){return new pv(this.name,this.type,this.nullable,this.metadata)}compareTo(t){return this.name===t.name&&this.type===t.type&&this.nullable===t.nullable&&this.metadata===t.metadata}toString(){return"".concat(this.type).concat(this.nullable?", nullable":"").concat(this.metadata?", metadata: ".concat(this.metadata):"")}}let gv,mv,vv,yv,bv,_v,Av,wv,Cv=((Ev={})[Ev.NONE=0]="NONE",Ev[Ev.Null=1]="Null",Ev[Ev.Int=2]="Int",Ev[Ev.Float=3]="Float",Ev[Ev.Binary=4]="Binary",Ev[Ev.Utf8=5]="Utf8",Ev[Ev.Bool=6]="Bool",Ev[Ev.Decimal=7]="Decimal",Ev[Ev.Date=8]="Date",Ev[Ev.Time=9]="Time",Ev[Ev.Timestamp=10]="Timestamp",Ev[Ev.Interval=11]="Interval",Ev[Ev.List=12]="List",Ev[Ev.Struct=13]="Struct",Ev[Ev.Union=14]="Union",Ev[Ev.FixedSizeBinary=15]="FixedSizeBinary",Ev[Ev.FixedSizeList=16]="FixedSizeList",Ev[Ev.Map=17]="Map",Ev[Ev.Dictionary=-1]="Dictionary",Ev[Ev.Int8=-2]="Int8",Ev[Ev.Int16=-3]="Int16",Ev[Ev.Int32=-4]="Int32",Ev[Ev.Int64=-5]="Int64",Ev[Ev.Uint8=-6]="Uint8",Ev[Ev.Uint16=-7]="Uint16",Ev[Ev.Uint32=-8]="Uint32",Ev[Ev.Uint64=-9]="Uint64",Ev[Ev.Float16=-10]="Float16",Ev[Ev.Float32=-11]="Float32",Ev[Ev.Float64=-12]="Float64",Ev[Ev.DateDay=-13]="DateDay",Ev[Ev.DateMillisecond=-14]="DateMillisecond",Ev[Ev.TimestampSecond=-15]="TimestampSecond",Ev[Ev.TimestampMillisecond=-16]="TimestampMillisecond",Ev[Ev.TimestampMicrosecond=-17]="TimestampMicrosecond",Ev[Ev.TimestampNanosecond=-18]="TimestampNanosecond",Ev[Ev.TimeSecond=-19]="TimeSecond",Ev[Ev.TimeMillisecond=-20]="TimeMillisecond",Ev[Ev.TimeMicrosecond=-21]="TimeMicrosecond",Ev[Ev.TimeNanosecond=-22]="TimeNanosecond",Ev[Ev.DenseUnion=-23]="DenseUnion",Ev[Ev.SparseUnion=-24]="SparseUnion",Ev[Ev.IntervalDayTime=-25]="IntervalDayTime",Ev[Ev.IntervalYearMonth=-26]="IntervalYearMonth",Ev);var Ev;class xv{static isNull(t){return t&&t.typeId===Cv.Null}static isInt(t){return t&&t.typeId===Cv.Int}static isFloat(t){return t&&t.typeId===Cv.Float}static isBinary(t){return t&&t.typeId===Cv.Binary}static isUtf8(t){return t&&t.typeId===Cv.Utf8}static isBool(t){return t&&t.typeId===Cv.Bool}static isDecimal(t){return t&&t.typeId===Cv.Decimal}static isDate(t){return t&&t.typeId===Cv.Date}static isTime(t){return t&&t.typeId===Cv.Time}static isTimestamp(t){return t&&t.typeId===Cv.Timestamp}static isInterval(t){return t&&t.typeId===Cv.Interval}static isList(t){return t&&t.typeId===Cv.List}static isStruct(t){return t&&t.typeId===Cv.Struct}static isUnion(t){return t&&t.typeId===Cv.Union}static isFixedSizeBinary(t){return t&&t.typeId===Cv.FixedSizeBinary}static isFixedSizeList(t){return t&&t.typeId===Cv.FixedSizeList}static isMap(t){return t&&t.typeId===Cv.Map}static isDictionary(t){return t&&t.typeId===Cv.Dictionary}get typeId(){return Cv.NONE}compareTo(t){return this===t}}Symbol.toStringTag,Symbol.toStringTag,gv=Symbol.toStringTag;class Tv extends xv{constructor(t,e){super(),m(this,"isSigned",void 0),m(this,"bitWidth",void 0),this.isSigned=t,this.bitWidth=e}get typeId(){return Cv.Int}get[gv](){return"Int"}toString(){return"".concat(this.isSigned?"I":"Ui","nt").concat(this.bitWidth)}}class Sv extends Tv{constructor(){super(!0,8)}}class Bv extends Tv{constructor(){super(!0,16)}}class Pv extends Tv{constructor(){super(!0,32)}}class Mv extends Tv{constructor(){super(!1,8)}}class Iv extends Tv{constructor(){super(!1,16)}}class Lv extends Tv{constructor(){super(!1,32)}}mv=Symbol.toStringTag;class Ov extends xv{constructor(t){super(),m(this,"precision",void 0),this.precision=t}get typeId(){return Cv.Float}get[mv](){return"Float"}toString(){return"Float".concat(this.precision)}}class Rv extends Ov{constructor(){super(32)}}class Fv extends Ov{constructor(){super(64)}}Symbol.toStringTag,Symbol.toStringTag,vv=Symbol.toStringTag,yv=Symbol.toStringTag,bv=Symbol.toStringTag,_v=Symbol.toStringTag,Av=Symbol.toStringTag;class kv extends xv{constructor(t,e){super(),m(this,"listSize",void 0),m(this,"children",void 0),this.listSize=t,this.children=[e]}get typeId(){return Cv.FixedSizeList}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get[Av](){return"FixedSizeList"}toString(){return"FixedSizeList[".concat(this.listSize,"]<").concat(this.valueType,">")}}wv=Symbol.toStringTag;class Dv{constructor(t,e){m(this,"fields",void 0),m(this,"metadata",void 0),function(t,e){if(!t)throw new Error("loader assertion failed.")}(Array.isArray(t)),function(t){const e={};for(const n of t)e[n.name]&&console.warn("Schema: duplicated field name",n.name,n),e[n.name]=!0}(t),this.fields=t,this.metadata=e||new Map}compareTo(t){if(this.metadata!==t.metadata)return!1;if(this.fields.length!==t.fields.length)return!1;for(let e=0;e<this.fields.length;++e)if(!this.fields[e].compareTo(t.fields[e]))return!1;return!0}select(){const t=Object.create(null);for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];for(const e of n)t[e]=!0;const r=this.fields.filter((e=>t[e.name]));return new Dv(r,this.metadata)}selectAt(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=e.map((t=>this.fields[t])).filter(Boolean);return new Dv(i,this.metadata)}assign(t){let e,n=this.metadata;if(t instanceof Dv){const i=t;e=i.fields,n=Nv(Nv(new Map,this.metadata),i.metadata)}else e=t;const i=Object.create(null);for(const t of this.fields)i[t.name]=t;for(const t of e)i[t.name]=t;const r=Object.values(i);return new Dv(r,n)}}function Nv(t,e){return new Map([...t||new Map,...e||new Map])}function Uv(t,e,n){return function(t,e,n){const i=function(t){switch(t.constructor){case Int8Array:return new Sv;case Uint8Array:return new Mv;case Int16Array:return new Bv;case Uint16Array:return new Iv;case Int32Array:return new Pv;case Uint32Array:return new Lv;case Float32Array:return new Rv;case Float64Array:return new Fv;default:throw new Error("array type not supported")}}(e.value),r=n||function(t){const e=new Map;return"byteOffset"in t&&e.set("byteOffset",t.byteOffset.toString(10)),"byteStride"in t&&e.set("byteStride",t.byteStride.toString(10)),"normalized"in t&&e.set("normalized",t.normalized.toString()),e}(e);return new pv(t,new kv(e.size,new pv("value",i)),!1,r)}(t,e,n?zv(n.metadata):void 0)}function zv(t){const e=new Map;for(const n in t)e.set("".concat(n,".string"),JSON.stringify(t[n]));return e}const Gv={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},jv={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array};class Vv{constructor(t){m(this,"draco",void 0),m(this,"decoder",void 0),m(this,"metadataQuerier",void 0),this.draco=t,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=new this.draco.DecoderBuffer;n.Init(new Int8Array(t),t.byteLength),this._disableAttributeTransforms(e);const i=this.decoder.GetEncodedGeometryType(n),r=i===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let t;switch(i){case this.draco.TRIANGULAR_MESH:t=this.decoder.DecodeBufferToMesh(n,r);break;case this.draco.POINT_CLOUD:t=this.decoder.DecodeBufferToPointCloud(n,r);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!t.ok()||!r.ptr){const e="DRACO decompression failed: ".concat(t.error_msg());throw new Error(e)}const s=this._getDracoLoaderData(r,i,e),o=this._getMeshData(r,s,e),a=fv(o.attributes),l=function(t,e,n){const i=zv(e.metadata),r=[],s=function(t){const e={};for(const n in t){const i=t[n];e[i.name||"undefined"]=i}return e}(e.attributes);for(const e in t){const n=Uv(e,t[e],s[e]);r.push(n)}if(n){const t=Uv("indices",n);r.push(t)}return new Dv(r,i)}(o.attributes,s,o.indices);return{loader:"draco",loaderData:s,header:{vertexCount:r.num_points(),boundingBox:a},...o,schema:l}}finally{this.draco.destroy(n),r&&this.draco.destroy(r)}}_getDracoLoaderData(t,e,n){const i=this._getTopLevelMetadata(t),r=this._getDracoAttributes(t,n);return{geometry_type:e,num_attributes:t.num_attributes(),num_points:t.num_points(),num_faces:t instanceof this.draco.Mesh?t.num_faces():0,metadata:i,attributes:r}}_getDracoAttributes(t,e){const n={};for(let i=0;i<t.num_attributes();i++){const r=this.decoder.GetAttribute(t,i),s=this._getAttributeMetadata(t,i);n[r.unique_id()]={unique_id:r.unique_id(),attribute_type:r.attribute_type(),data_type:r.data_type(),num_components:r.num_components(),byte_offset:r.byte_offset(),byte_stride:r.byte_stride(),normalized:r.normalized(),attribute_index:i,metadata:s};const o=this._getQuantizationTransform(r,e);o&&(n[r.unique_id()].quantization_transform=o);const a=this._getOctahedronTransform(r,e);a&&(n[r.unique_id()].octahedron_transform=a)}return n}_getMeshData(t,e,n){const i=this._getMeshAttributes(e,t,n);if(!i.POSITION)throw new Error("DRACO: No position attribute found.");return t instanceof this.draco.Mesh?"triangle-strip"===n.topology?{topology:"triangle-strip",mode:4,attributes:i,indices:{value:this._getTriangleStripIndices(t),size:1}}:{topology:"triangle-list",mode:5,attributes:i,indices:{value:this._getTriangleListIndices(t),size:1}}:{topology:"point-list",mode:0,attributes:i}}_getMeshAttributes(t,e,n){const i={};for(const r of Object.values(t.attributes)){const t=this._deduceAttributeName(r,n);r.name=t;const{value:s,size:o}=this._getAttributeValues(e,r);i[t]={value:s,size:o,byteOffset:r.byte_offset,byteStride:r.byte_stride,normalized:r.normalized}}return i}_getTriangleListIndices(t){const e=3*t.num_faces(),n=4*e,i=this.draco._malloc(n);try{return this.decoder.GetTrianglesUInt32Array(t,n,i),new Uint32Array(this.draco.HEAPF32.buffer,i,e).slice()}finally{this.draco._free(i)}}_getTriangleStripIndices(t){const e=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(t,e),function(t){const e=t.size(),n=new Int32Array(e);for(let i=0;i<e;i++)n[i]=t.GetValue(i);return n}(e)}finally{this.draco.destroy(e)}}_getAttributeValues(t,e){const n=jv[e.data_type],i=e.num_components,r=t.num_points()*i,s=r*n.BYTES_PER_ELEMENT,o=function(t,e){switch(e){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32;default:return t.DT_INVALID}}(this.draco,n);let a;const l=this.draco._malloc(s);try{const i=this.decoder.GetAttribute(t,e.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(t,i,o,s,l),a=new n(this.draco.HEAPF32.buffer,l,r).slice()}finally{this.draco._free(l)}return{value:a,size:i}}_deduceAttributeName(t,e){const n=t.unique_id;for(const[t,i]of Object.entries(e.extraAttributes||{}))if(i===n)return t;const i=t.attribute_type;for(const t in Gv)if(this.draco[t]===i)return Gv[t];const r=e.attributeNameEntry||"name";return t.metadata[r]?t.metadata[r].string:"CUSTOM_ATTRIBUTE_".concat(n)}_getTopLevelMetadata(t){const e=this.decoder.GetMetadata(t);return this._getDracoMetadata(e)}_getAttributeMetadata(t,e){const n=this.decoder.GetAttributeMetadata(t,e);return this._getDracoMetadata(n)}_getDracoMetadata(t){if(!t||!t.ptr)return{};const e={},n=this.metadataQuerier.NumEntries(t);for(let i=0;i<n;i++){const n=this.metadataQuerier.GetEntryName(t,i);e[n]=this._getDracoMetadataField(t,n)}return e}_getDracoMetadataField(t,e){const n=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(t,e,n);const i=function(t){const e=t.size(),n=new Int32Array(e);for(let i=0;i<e;i++)n[i]=t.GetValue(i);return n}(n);return{int:this.metadataQuerier.GetIntEntry(t,e),string:this.metadataQuerier.GetStringEntry(t,e),double:this.metadataQuerier.GetDoubleEntry(t,e),intArray:i}}finally{this.draco.destroy(n)}}_disableAttributeTransforms(t){const{quantizedAttributes:e=[],octahedronAttributes:n=[]}=t,i=[...e,...n];for(const t of i)this.decoder.SkipAttributeTransform(this.draco[t])}_getQuantizationTransform(t,e){const{quantizedAttributes:n=[]}=e,i=t.attribute_type();if(n.map((t=>this.decoder[t])).includes(i)){const e=new this.draco.AttributeQuantizationTransform;try{if(e.InitFromAttribute(t))return{quantization_bits:e.quantization_bits(),range:e.range(),min_values:new Float32Array([1,2,3]).map((t=>e.min_value(t)))}}finally{this.draco.destroy(e)}}return null}_getOctahedronTransform(t,e){const{octahedronAttributes:n=[]}=e,i=t.attribute_type();if(n.map((t=>this.decoder[t])).includes(i)){const e=new this.draco.AttributeQuantizationTransform;try{if(e.InitFromAttribute(t))return{quantization_bits:e.quantization_bits()}}finally{this.draco.destroy(e)}}return null}}const Hv="https://www.gstatic.com/draco/versioned/decoders/".concat("1.5.5"),Wv="".concat(Hv,"/draco_decoder.js"),Jv="".concat(Hv,"/draco_wasm_wrapper.js"),qv="".concat(Hv,"/draco_decoder.wasm");let Kv;"https://raw.githubusercontent.com/google/draco/".concat("1.4.1","/javascript/draco_encoder.js");const Xv={...dv,parse:async function(t,e){const{draco:n}=await async function(t){const e=t.modules||{};return Kv=e.draco3d?Kv||e.draco3d.createDecoderModule({}).then((t=>({draco:t}))):Kv||async function(t){let e,n;return"js"===(t.draco&&t.draco.decoderType)?e=await tm(Wv,"draco",t):[e,n]=await Promise.all([await tm(Jv,"draco",t),await tm(qv,"draco",t)]),e=e||globalThis.DracoDecoderModule,await function(t,e){const n={};return e&&(n.wasmBinary=e),new Promise((e=>{t({...n,onModuleLoaded:t=>e({draco:t})})}))}(e,n)}(t),await Kv}(e),i=new Vv(n);try{return i.parseSync(t,null==e?void 0:e.draco)}finally{i.destroy()}}};function Qv(t){const{buffer:e,size:n,count:i}=function(t){let e=t,n=1,i=0;return t&&t.value&&(e=t.value,n=t.size||1),e&&(ArrayBuffer.isView(e)||(e=function(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return t?Array.isArray(t)?new e(t):!n||t instanceof e?t:new e(t):null}(e,Float32Array)),i=e.length/n),{buffer:e,size:n,count:i}}(t);return{value:e,size:n,byteOffset:0,count:i,type:zm(n),componentType:Gm(e)}}const Yv="KHR_draco_mesh_compression",Zv=Yv;function $v(t,e,n){const i=new Wm(t);for(const t of ry(i))i.getObjectExtension(t,Yv)}async function ty(t,e,n){var i;if(null==e||null===(i=e.gltf)||void 0===i||!i.decompressMeshes)return;const r=new Wm(t),s=[];for(const t of ry(r))r.getObjectExtension(t,Yv)&&s.push(ny(r,t,e,n));await Promise.all(s),r.removeExtension(Yv)}function ey(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=new Wm(t);for(const t of n.json.meshes||[])iy(t,e),n.addRequiredExtension(Yv)}async function ny(t,e,n,i){const r=t.getObjectExtension(e,Yv);if(!r)return;const s=t.getTypedArrayForBufferView(r.bufferView),o=xe(s.buffer,s.byteOffset),{parse:a}=i,l={...n};delete l["3d-tiles"];const c=await a(o,Xv,l,i),u=function(t){const e={};for(const n in t){const i=t[n];if("indices"!==n){const t=Qv(i);e[n]=t}}return e}(c.attributes);for(const[n,i]of Object.entries(u))if(n in e.attributes){const r=e.attributes[n],s=t.getAccessor(r);null!=s&&s.min&&null!=s&&s.max&&(i.min=s.min,i.max=s.max)}e.attributes=u,c.indices&&(e.indices=Qv(c.indices)),function(t){if(!t.attributes&&Object.keys(t.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}(e)}function iy(t,e){var n;let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,r=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;if(!r.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const o=r.DracoWriter.encodeSync({attributes:t}),a=null==s||null===(n=s.parseSync)||void 0===n?void 0:n.call(s,{attributes:t}),l=r._addFauxAttributes(a.attributes),c=r.addBufferView(o);return{primitives:[{attributes:l,mode:i,extensions:{[Yv]:{bufferView:c,attributes:l}}}]}}function*ry(t){for(const e of t.json.meshes||[])for(const t of e.primitives)yield t}var sy;!function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL1ROW0=3]="COL1ROW0",t[t.COL1ROW1=4]="COL1ROW1",t[t.COL1ROW2=5]="COL1ROW2",t[t.COL2ROW0=6]="COL2ROW0",t[t.COL2ROW1=7]="COL2ROW1",t[t.COL2ROW2=8]="COL2ROW2"}(sy||(sy={}));const oy=Object.freeze([1,0,0,0,1,0,0,0,1]);class ay extends Nn{static get IDENTITY(){return cy||(cy=new ay,Object.freeze(cy)),cy}static get ZERO(){return ly||(ly=new ay([0,0,0,0,0,0,0,0,0]),Object.freeze(ly)),ly}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return sy}constructor(t,...e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(t)?this.copy(t):e.length>0?this.copy([t,...e]):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this.check()}identity(){return this.copy(oy)}fromObject(t){return this.check()}fromQuaternion(t){return function(t,e){var n=e[0],i=e[1],r=e[2],s=e[3],o=n+n,a=i+i,l=r+r,c=n*o,u=i*o,h=i*a,d=r*o,f=r*a,p=r*l,g=s*o,m=s*a,v=s*l;t[0]=1-h-p,t[3]=u-v,t[6]=d+m,t[1]=u+v,t[4]=1-c-p,t[7]=f-g,t[2]=d-m,t[5]=f+g,t[8]=1-c-h}(this,t),this.check()}set(t,e,n,i,r,s,o,a,l){return this[0]=t,this[1]=e,this[2]=n,this[3]=i,this[4]=r,this[5]=s,this[6]=o,this[7]=a,this[8]=l,this.check()}setRowMajor(t,e,n,i,r,s,o,a,l){return this[0]=t,this[1]=i,this[2]=o,this[3]=e,this[4]=r,this[5]=a,this[6]=n,this[7]=s,this[8]=l,this.check()}determinant(){return function(t){var e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*(c*s-o*l)+n*(-c*r+o*a)+i*(l*r-s*a)}(this)}transpose(){return function(t,e){if(t===e){var n=e[1],i=e[2],r=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=i,t[7]=r}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8]}(this,this),this.check()}invert(){return function(t,e){var n=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=u*o-a*c,d=-u*s+a*l,f=c*s-o*l,p=n*h+i*d+r*f;p&&(p=1/p,t[0]=h*p,t[1]=(-u*i+r*c)*p,t[2]=(a*i-r*o)*p,t[3]=d*p,t[4]=(u*n-r*l)*p,t[5]=(-a*n+r*s)*p,t[6]=f*p,t[7]=(-c*n+i*l)*p,t[8]=(o*n-i*s)*p)}(this,this),this.check()}multiplyLeft(t){return _g(this,t,this),this.check()}multiplyRight(t){return _g(this,this,t),this.check()}rotate(t){return function(t,e,n){var i=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=Math.sin(n),f=Math.cos(n);t[0]=f*i+d*o,t[1]=f*r+d*a,t[2]=f*s+d*l,t[3]=f*o-d*i,t[4]=f*a-d*r,t[5]=f*l-d*s,t[6]=c,t[7]=u,t[8]=h}(this,this,t),this.check()}scale(t){return Array.isArray(t)?Ag(this,this,t):Ag(this,this,[t,t]),this.check()}translate(t){return function(t,e,n){var i=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=n[0],f=n[1];t[0]=i,t[1]=r,t[2]=s,t[3]=o,t[4]=a,t[5]=l,t[6]=d*i+f*o+c,t[7]=d*r+f*a+u,t[8]=d*s+f*l+h}(this,this,t),this.check()}transform(t,e){let n;switch(t.length){case 2:n=Xn(e||[-0,-0],t,this);break;case 3:n=Cn(e||[-0,-0,-0],t,this);break;case 4:n=Bn(e||[-0,-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return dn(n,t.length),n}transformVector(t,e){return this.transform(t,e)}transformVector2(t,e){return this.transform(t,e)}transformVector3(t,e){return this.transform(t,e)}}let ly,cy;const uy={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},hy={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},dy="KHR_texture_transform",fy=dy,py=new In,gy=new ay,my=new ay;async function vy(t,e){if(!new Wm(t).getExtension(dy))return;const n=t.json.materials||[];for(let e=0;e<n.length;e++)yy(e,t)}function yy(t,e){var n,i,r;const s=[],o=null===(n=e.json.materials)||void 0===n?void 0:n[t],a=null==o||null===(i=o.pbrMetallicRoughness)||void 0===i?void 0:i.baseColorTexture;a&&by(e,t,a,s);const l=null==o?void 0:o.emissiveTexture;l&&by(e,t,l,s);const c=null==o?void 0:o.normalTexture;c&&by(e,t,c,s);const u=null==o?void 0:o.occlusionTexture;u&&by(e,t,u,s);const h=null==o||null===(r=o.pbrMetallicRoughness)||void 0===r?void 0:r.metallicRoughnessTexture;h&&by(e,t,h,s)}function by(t,e,n,i){const r=function(t,e){var n;const i=null===(n=t.extensions)||void 0===n?void 0:n[dy],{texCoord:r=0}=t,{texCoord:s=r}=i;if(!(-1!==e.findIndex((t=>{let[e,n]=t;return e===r&&n===s})))){const n=function(t){const{offset:e=[0,0],rotation:n=0,scale:i=[1,1]}=t,r=(new ay).set(1,0,0,0,1,0,e[0],e[1],1),s=gy.set(Math.cos(n),Math.sin(n),0,-Math.sin(n),Math.cos(n),0,0,0,1),o=my.set(i[0],0,0,0,i[1],0,0,0,1);return r.multiplyRight(s).multiplyRight(o)}(i);return r!==s&&(t.texCoord=s),e.push([r,s]),{originalTexCoord:r,texCoord:s,matrix:n}}return null}(n,i);if(!r)return;const s=t.json.meshes||[];for(const n of s)for(const i of n.primitives){const n=i.material;Number.isFinite(n)&&e===n&&_y(t,i,r)}}function _y(t,e,n){const{originalTexCoord:i,texCoord:r,matrix:s}=n,o=e.attributes["TEXCOORD_".concat(i)];if(Number.isFinite(o)){var a;const n=null===(a=t.json.accessors)||void 0===a?void 0:a[o];if(n&&n.bufferView){var l;const o=null===(l=t.json.bufferViews)||void 0===l?void 0:l[n.bufferView];if(o){const{arrayBuffer:a,byteOffset:l}=t.buffers[o.buffer],c=(l||0)+(n.byteOffset||0)+(o.byteOffset||0),{ArrayType:u,length:h}=jm(n,o),d=hy[n.componentType],f=uy[n.type],p=o.byteStride||d*f,g=new Float32Array(h);for(let t=0;t<n.count;t++){const e=new u(a,c+t*p,2);py.set(e[0],e[1],1),py.transformByMatrix3(s),g.set([py[0],py[1]],t*f)}i===r?function(t,e,n,i){t.componentType=5126,n.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength}),e.buffer=n.length-1,e.byteLength=i.buffer.byteLength,e.byteOffset=0,delete e.byteStride}(n,o,t.buffers,g):function(t,e,n,i,r){i.buffers.push({arrayBuffer:r.buffer,byteOffset:0,byteLength:r.buffer.byteLength});const s=i.json.bufferViews;if(!s)return;s.push({buffer:i.buffers.length-1,byteLength:r.buffer.byteLength,byteOffset:0});const o=i.json.accessors;o&&(o.push({bufferView:(null==s?void 0:s.length)-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),n.attributes["TEXCOORD_".concat(t)]=o.length-1)}(r,n,e,t,g)}}}}const Ay="KHR_lights_punctual",wy=Ay;async function Cy(t){const e=new Wm(t),{json:n}=e,i=e.getExtension(Ay);i&&(e.json.lights=i.lights,e.removeExtension(Ay));for(const t of n.nodes||[]){const n=e.getObjectExtension(t,Ay);n&&(t.light=n.light),e.removeObjectExtension(t,Ay)}}async function Ey(t){const e=new Wm(t),{json:n}=e;if(n.lights){const t=e.addExtension(Ay);Mm(!t.lights),t.lights=n.lights,delete n.lights}if(e.json.lights){for(const t of e.json.lights){const n=t.node;e.addObjectExtension(n,Ay,t)}delete e.json.lights}}const xy="KHR_materials_unlit",Ty=xy;async function Sy(t){const e=new Wm(t),{json:n}=e;for(const t of n.materials||[])t.extensions&&t.extensions.KHR_materials_unlit&&(t.unlit=!0),e.removeObjectExtension(t,xy);e.removeExtension(xy)}function By(t){const e=new Wm(t),{json:n}=e;if(e.materials)for(const t of n.materials||[])t.unlit&&(delete t.unlit,e.addObjectExtension(t,xy,{}),e.addExtension(xy))}const Py="KHR_techniques_webgl",My=Py;async function Iy(t){const e=new Wm(t),{json:n}=e,i=e.getExtension(Py);if(i){const t=function(t,e){const{programs:n=[],shaders:i=[],techniques:r=[]}=t,s=new TextDecoder;return i.forEach((t=>{if(!Number.isFinite(t.bufferView))throw new Error("KHR_techniques_webgl: no shader code");t.code=s.decode(e.getTypedArrayForBufferView(t.bufferView))})),n.forEach((t=>{t.fragmentShader=i[t.fragmentShader],t.vertexShader=i[t.vertexShader]})),r.forEach((t=>{t.program=n[t.program]})),r}(i,e);for(const i of n.materials||[]){const n=e.getObjectExtension(i,Py);n&&(i.technique=Object.assign({},n,t[n.technique]),i.technique.values=Oy(i.technique,e)),e.removeObjectExtension(i,Py)}e.removeExtension(Py)}}async function Ly(t,e){}function Oy(t,e){const n=Object.assign({},t.values);return Object.keys(t.uniforms||{}).forEach((e=>{t.uniforms[e].value&&!(e in n)&&(n[e]=t.uniforms[e].value)})),Object.keys(n).forEach((t=>{"object"==typeof n[t]&&void 0!==n[t].index&&(n[t].texture=e.getTexture(n[t].index))})),n}const Ry="EXT_feature_metadata",Fy=Ry;async function ky(t){!function(t){var e;const n=t.getExtension(Ry),i=null==n||null===(e=n.schema)||void 0===e?void 0:e.classes,r=null==n?void 0:n.featureTables;if((null==n?void 0:n.featureTextures)&&console.warn('featureTextures is not yet supported in the "EXT_feature_metadata" extension.'),i&&r)for(const e in i){const n=i[e],s=Uy(r,e);s&&Dy(t,s,n)}}(new Wm(t))}function Dy(t,e,n){for(const r in n.properties){var i;const s=n.properties[r],o=null==e||null===(i=e.properties)||void 0===i?void 0:i[r],a=e.count;if(o){const e=Ny(t,s,a,o);o.data=e}}}function Ny(t,e,n,i){const r=i.bufferView;let s=t.getTypedArrayForBufferView(r);switch(e.type){case"STRING":{const e=i.stringOffsetBufferView;s=function(t,e,n){const i=[],r=new TextDecoder("utf8");let s=0;for(let o=0;o<n;o++){const n=e[4*(o+1)]-e[4*o],a=t.subarray(s,n+s),l=r.decode(a);i.push(l),s+=n}return i}(s,t.getTypedArrayForBufferView(e),n);break}}return s}function Uy(t,e){for(const n in t){const i=t[n];if(i.class===e)return i}return null}const zy=[e,n,i,r,a,l,c,s,u];function Gy(t,e){var n;const i=(null==e||null===(n=e.gltf)||void 0===n?void 0:n.excludeExtensions)||{};return!(t in i&&!i[t])}const jy="KHR_binary_glTF",Vy={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},Hy={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class Wy{constructor(){m(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}}),m(this,"json",void 0)}normalize(t,e){this.json=t.json;const n=t.json;switch(n.asset&&n.asset.version){case"2.0":return;case void 0:case"1.0":break;default:return void console.warn("glTF: Unknown version ".concat(n.asset.version))}if(!e.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(n),this._convertTopLevelObjectsToArrays(n),function(t){const e=new Wm(t),{json:n}=e;for(const t of n.images||[]){const n=e.getObjectExtension(t,jy);n&&Object.assign(t,n),e.removeObjectExtension(t,jy)}n.buffers&&n.buffers[0]&&delete n.buffers[0].uri,e.removeExtension(jy)}(t),this._convertObjectIdsToArrayIndices(n),this._updateObjects(n),this._updateMaterial(n)}_addAsset(t){t.asset=t.asset||{},t.asset.version="2.0",t.asset.generator=t.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(t){for(const e in Vy)this._convertTopLevelObjectToArray(t,e)}_convertTopLevelObjectToArray(t,e){const n=t[e];if(n&&!Array.isArray(n)){t[e]=[];for(const i in n){const r=n[i];r.id=r.id||i;const s=t[e].length;t[e].push(r),this.idToIndexMap[e][i]=s}}}_convertObjectIdsToArrayIndices(t){for(const e in Vy)this._convertIdsToIndices(t,e);"scene"in t&&(t.scene=this._convertIdToIndex(t.scene,"scene"));for(const e of t.textures)this._convertTextureIds(e);for(const e of t.meshes)this._convertMeshIds(e);for(const e of t.nodes)this._convertNodeIds(e);for(const e of t.scenes)this._convertSceneIds(e)}_convertTextureIds(t){t.source&&(t.source=this._convertIdToIndex(t.source,"image"))}_convertMeshIds(t){for(const e of t.primitives){const{attributes:t,indices:n,material:i}=e;for(const e in t)t[e]=this._convertIdToIndex(t[e],"accessor");n&&(e.indices=this._convertIdToIndex(n,"accessor")),i&&(e.material=this._convertIdToIndex(i,"material"))}}_convertNodeIds(t){t.children&&(t.children=t.children.map((t=>this._convertIdToIndex(t,"node")))),t.meshes&&(t.meshes=t.meshes.map((t=>this._convertIdToIndex(t,"mesh"))))}_convertSceneIds(t){t.nodes&&(t.nodes=t.nodes.map((t=>this._convertIdToIndex(t,"node"))))}_convertIdsToIndices(t,e){t[e]||(console.warn("gltf v1: json doesn't contain attribute ".concat(e)),t[e]=[]);for(const n of t[e])for(const t in n){const e=n[t],i=this._convertIdToIndex(e,t);n[t]=i}}_convertIdToIndex(t,e){const n=Hy[e];if(n in this.idToIndexMap){const i=this.idToIndexMap[n][t];if(!Number.isFinite(i))throw new Error("gltf v1: failed to resolve ".concat(e," with id ").concat(t));return i}return t}_updateObjects(t){for(const t of this.json.buffers)delete t.type}_updateMaterial(t){for(const r of t.materials){var e,n,i;r.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const s=(null===(e=r.values)||void 0===e?void 0:e.tex)||(null===(n=r.values)||void 0===n?void 0:n.texture2d_0)||(null===(i=r.values)||void 0===i?void 0:i.diffuseTex),o=t.textures.findIndex((t=>t.id===s));-1!==o&&(r.pbrMetallicRoughness.baseColorTexture={index:o})}}}const Jy={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},qy={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Ky={magFilter:10240,minFilter:10241,wrapS:10242,wrapT:10243},Xy={10240:9729,10241:9986,10242:10497,10243:10497};class Qy{constructor(){m(this,"baseUri",""),m(this,"json",{}),m(this,"buffers",[]),m(this,"images",[])}postProcess(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{json:n,buffers:i=[],images:r=[],baseUri:s=""}=t;return Mm(n),this.baseUri=s,this.json=n,this.buffers=i,this.images=r,this._resolveTree(this.json,e),this.json}_resolveTree(t){t.bufferViews&&(t.bufferViews=t.bufferViews.map(((t,e)=>this._resolveBufferView(t,e)))),t.images&&(t.images=t.images.map(((t,e)=>this._resolveImage(t,e)))),t.samplers&&(t.samplers=t.samplers.map(((t,e)=>this._resolveSampler(t,e)))),t.textures&&(t.textures=t.textures.map(((t,e)=>this._resolveTexture(t,e)))),t.accessors&&(t.accessors=t.accessors.map(((t,e)=>this._resolveAccessor(t,e)))),t.materials&&(t.materials=t.materials.map(((t,e)=>this._resolveMaterial(t,e)))),t.meshes&&(t.meshes=t.meshes.map(((t,e)=>this._resolveMesh(t,e)))),t.nodes&&(t.nodes=t.nodes.map(((t,e)=>this._resolveNode(t,e)))),t.skins&&(t.skins=t.skins.map(((t,e)=>this._resolveSkin(t,e)))),t.scenes&&(t.scenes=t.scenes.map(((t,e)=>this._resolveScene(t,e)))),void 0!==t.scene&&(t.scene=t.scenes[this.json.scene])}getScene(t){return this._get("scenes",t)}getNode(t){return this._get("nodes",t)}getSkin(t){return this._get("skins",t)}getMesh(t){return this._get("meshes",t)}getMaterial(t){return this._get("materials",t)}getAccessor(t){return this._get("accessors",t)}getCamera(t){return null}getTexture(t){return this._get("textures",t)}getSampler(t){return this._get("samplers",t)}getImage(t){return this._get("images",t)}getBufferView(t){return this._get("bufferViews",t)}getBuffer(t){return this._get("buffers",t)}_get(t,e){if("object"==typeof e)return e;const n=this.json[t]&&this.json[t][e];return n||console.warn("glTF file error: Could not find ".concat(t,"[").concat(e,"]")),n}_resolveScene(t,e){return t.id=t.id||"scene-".concat(e),t.nodes=(t.nodes||[]).map((t=>this.getNode(t))),t}_resolveNode(t,e){return t.id=t.id||"node-".concat(e),t.children&&(t.children=t.children.map((t=>this.getNode(t)))),void 0!==t.mesh?t.mesh=this.getMesh(t.mesh):void 0!==t.meshes&&t.meshes.length&&(t.mesh=t.meshes.reduce(((t,e)=>{const n=this.getMesh(e);return t.id=n.id,t.primitives=t.primitives.concat(n.primitives),t}),{primitives:[]})),void 0!==t.camera&&(t.camera=this.getCamera(t.camera)),void 0!==t.skin&&(t.skin=this.getSkin(t.skin)),t}_resolveSkin(t,e){return t.id=t.id||"skin-".concat(e),t.inverseBindMatrices=this.getAccessor(t.inverseBindMatrices),t}_resolveMesh(t,e){return t.id=t.id||"mesh-".concat(e),t.primitives&&(t.primitives=t.primitives.map((t=>{const e=(t={...t}).attributes;t.attributes={};for(const n in e)t.attributes[n]=this.getAccessor(e[n]);return void 0!==t.indices&&(t.indices=this.getAccessor(t.indices)),void 0!==t.material&&(t.material=this.getMaterial(t.material)),t}))),t}_resolveMaterial(t,e){if(t.id=t.id||"material-".concat(e),t.normalTexture&&(t.normalTexture={...t.normalTexture},t.normalTexture.texture=this.getTexture(t.normalTexture.index)),t.occlusionTexture&&(t.occlustionTexture={...t.occlustionTexture},t.occlusionTexture.texture=this.getTexture(t.occlusionTexture.index)),t.emissiveTexture&&(t.emmisiveTexture={...t.emmisiveTexture},t.emissiveTexture.texture=this.getTexture(t.emissiveTexture.index)),t.emissiveFactor||(t.emissiveFactor=t.emmisiveTexture?[1,1,1]:[0,0,0]),t.pbrMetallicRoughness){t.pbrMetallicRoughness={...t.pbrMetallicRoughness};const e=t.pbrMetallicRoughness;e.baseColorTexture&&(e.baseColorTexture={...e.baseColorTexture},e.baseColorTexture.texture=this.getTexture(e.baseColorTexture.index)),e.metallicRoughnessTexture&&(e.metallicRoughnessTexture={...e.metallicRoughnessTexture},e.metallicRoughnessTexture.texture=this.getTexture(e.metallicRoughnessTexture.index))}return t}_resolveAccessor(t,e){var n,i;if(t.id=t.id||"accessor-".concat(e),void 0!==t.bufferView&&(t.bufferView=this.getBufferView(t.bufferView)),t.bytesPerComponent=(n=t.componentType,qy[n]),t.components=(i=t.type,Jy[i]),t.bytesPerElement=t.bytesPerComponent*t.components,t.bufferView){const e=t.bufferView.buffer,{ArrayType:n,byteLength:i}=jm(t,t.bufferView),r=(t.bufferView.byteOffset||0)+(t.byteOffset||0)+e.byteOffset;let s=e.arrayBuffer.slice(r,r+i);t.bufferView.byteStride&&(s=this._getValueFromInterleavedBuffer(e,r,t.bufferView.byteStride,t.bytesPerElement,t.count)),t.value=new n(s)}return t}_getValueFromInterleavedBuffer(t,e,n,i,r){const s=new Uint8Array(r*i);for(let o=0;o<r;o++){const r=e+o*n;s.set(new Uint8Array(t.arrayBuffer.slice(r,r+i)),o*i)}return s.buffer}_resolveTexture(t,e){return t.id=t.id||"texture-".concat(e),t.sampler="sampler"in t?this.getSampler(t.sampler):Xy,t.source=this.getImage(t.source),t}_resolveSampler(t,e){t.id=t.id||"sampler-".concat(e),t.parameters={};for(const e in t){const n=this._enumSamplerParameter(e);void 0!==n&&(t.parameters[n]=t[e])}return t}_enumSamplerParameter(t){return Ky[t]}_resolveImage(t,e){t.id=t.id||"image-".concat(e),void 0!==t.bufferView&&(t.bufferView=this.getBufferView(t.bufferView));const n=this.images[e];return n&&(t.image=n),t}_resolveBufferView(t,e){const n=t.buffer,i={id:"bufferView-".concat(e),...t,buffer:this.buffers[n]},r=this.buffers[n].arrayBuffer;let s=this.buffers[n].byteOffset||0;return"byteOffset"in t&&(s+=t.byteOffset),i.data=new Uint8Array(r,s,t.byteLength),i}_resolveCamera(t,e){return t.id=t.id||"camera-".concat(e),t.perspective,t.orthographic,t}}const Yy=1735152710,Zy=12,$y=8,tb=1313821514,eb=5130562,nb=0,ib=1,rb=0,sb=!0;function ob(t,e,n,i){const r=new Uint8Array(e.buffer,n,i),s=new TextDecoder("utf8").decode(r);return t.json=JSON.parse(s),Lm(i,4)}function ab(t,e,n,i){return t.header.hasBinChunk=!0,t.binChunks.push({byteOffset:n,byteLength:i,arrayBuffer:e.buffer}),Lm(i,4)}async function lb(t,e){var n,i,r,s;let o=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;!function(t,e,n,i){if(i.uri&&(t.baseUri=i.uri),e instanceof ArrayBuffer&&!function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=new DataView(t),{magic:r=Yy}=n,s=i.getUint32(e,!1);return s===r||s===Yy}(e,n,i)&&(e=(new TextDecoder).decode(e)),"string"==typeof e)t.json=function(t){try{return JSON.parse(t)}catch(e){throw new Error('Failed to parse JSON from data starting with "'.concat(function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;return"string"==typeof t?t.slice(0,e):ArrayBuffer.isView(t)?Pm(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?Pm(t,0,e):""}(t),'"'))}}(e);else if(e instanceof ArrayBuffer){const r={};n=function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const r=new DataView(e),s=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return"".concat(String.fromCharCode(t.getUint8(e+0))).concat(String.fromCharCode(t.getUint8(e+1))).concat(String.fromCharCode(t.getUint8(e+2))).concat(String.fromCharCode(t.getUint8(e+3)))}(r,n+0),o=r.getUint32(n+4,sb),a=r.getUint32(n+8,sb);switch(Object.assign(t,{header:{byteOffset:n,byteLength:a,hasBinChunk:!1},type:s,version:o,json:{},binChunks:[]}),n+=Zy,t.version){case 1:return function(t,e,n){dt(t.header.byteLength>Zy+$y);const i=e.getUint32(n+0,sb),r=e.getUint32(n+4,sb);return n+=$y,dt(r===rb),ob(t,e,n,i),(n+=i)+ab(t,e,n,t.header.byteLength)}(t,r,n);case 2:return function(t,e,n,i){return dt(t.header.byteLength>Zy+$y),function(t,e,n,i){for(;n+8<=t.header.byteLength;){const r=e.getUint32(n+0,sb),s=e.getUint32(n+4,sb);switch(n+=$y,s){case tb:ob(t,e,n,r);break;case eb:ab(t,e,n,r);break;case nb:i.strict||ob(t,e,n,r);break;case ib:i.strict||ab(t,e,n,r)}n+=Lm(r,4)}}(t,e,n,i),n+t.header.byteLength}(t,r,n,i={});default:throw new Error("Invalid GLB version ".concat(t.version,". Only supports v1 and v2."))}}(r,e,n,i.glb),Mm("glTF"===r.type,"Invalid GLB magic string ".concat(r.type)),t._glb=r,t.json=r.json}else Mm(!1,"GLTF: must be ArrayBuffer or string");const r=t.json.buffers||[];if(t.buffers=new Array(r.length).fill(null),t._glb&&t._glb.header.hasBinChunk){const{binChunks:e}=t._glb;t.buffers[0]={arrayBuffer:e[0].arrayBuffer,byteOffset:e[0].byteOffset,byteLength:e[0].byteLength}}const s=t.json.images||[];t.images=new Array(s.length).fill({})}(t,e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o),function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(new Wy).normalize(t,e)}(t,{normalize:null==o||null===(n=o.gltf)||void 0===n?void 0:n.normalize}),function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const i=zy.filter((t=>Gy(t.name,e)));for(const s of i){var r;null===(r=s.preprocess)||void 0===r||r.call(s,t,e,n)}}(t,o,a);const l=[];if(null!=o&&null!==(i=o.gltf)&&void 0!==i&&i.loadBuffers&&t.json.buffers&&await async function(t,e,n){const i=t.json.buffers||[];for(let o=0;o<i.length;++o){const a=i[o];if(a.uri){var r,s;const{fetch:i}=n;Mm(i);const l=Im(a.uri,e),c=await(null==n||null===(r=n.fetch)||void 0===r?void 0:r.call(n,l)),u=await(null==c||null===(s=c.arrayBuffer)||void 0===s?void 0:s.call(c));t.buffers[o]={arrayBuffer:u,byteOffset:0,byteLength:u.byteLength},delete a.uri}else null===t.buffers[o]&&(t.buffers[o]={arrayBuffer:new ArrayBuffer(a.byteLength),byteOffset:0,byteLength:a.byteLength})}}(t,o,a),null!=o&&null!==(r=o.gltf)&&void 0!==r&&r.loadImages){const e=async function(t,e,n){const i=function(t){const e=new Set,n=t.json.textures||[];for(const t of n)void 0!==t.source&&e.add(t.source);return Array.from(e).sort()}(t),r=t.json.images||[],s=[];for(const o of i)s.push(cb(t,r[o],o,e,n));return await Promise.all(s)}(t,o,a);l.push(e)}const c=async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const i=zy.filter((t=>Gy(t.name,e)));for(const s of i){var r;await(null===(r=s.decode)||void 0===r?void 0:r.call(s,t,e,n))}}(t,o,a);return l.push(c),await Promise.all(l),null!=o&&null!==(s=o.gltf)&&void 0!==s&&s.postProcess?function(t,e){return(new Qy).postProcess(t,e)}(t,o):t}async function cb(t,e,n,i,r){const{fetch:s,parse:o}=r;let a;if(e.uri&&!e.hasOwnProperty("bufferView")){const t=Im(e.uri,i),n=await s(t);a=await n.arrayBuffer(),e.bufferView={data:a}}if(Number.isFinite(e.bufferView)){const n=function(t,e,n){const i=t.bufferViews[n];Mm(i);const r=e[i.buffer];Mm(r);const s=(i.byteOffset||0)+r.byteOffset;return new Uint8Array(r.arrayBuffer,s,i.byteLength)}(t.json,t.buffers,e.bufferView);a=xe(n.buffer,n.byteOffset,n.byteLength)}Mm(a,"glTF image has no data");let l=await o(a,[Mc,Bm],{mimeType:e.mimeType,basis:i.basis||{format:Sm()}},r);l&&l[0]&&(l={compressed:!0,mipmaps:!1,width:l[0].width,height:l[0].height,data:l[0]}),t.images=t.images||[],t.images[n]=l}const ub={name:"glTF",id:"gltf",module:"gltf",version:"3.4.14",extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;e={...ub.options,...e},e.gltf={...ub.options.gltf,...e.gltf};const{byteOffset:i=0}=e;return await lb({},t,i,e,n)},options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0,postProcess:!0},log:console},deprecatedOptions:{fetchImages:"gltf.loadImages",createImages:"gltf.loadImages",decompress:"gltf.decompressMeshes",postProcess:"gltf.postProcess",gltf:{decompress:"gltf.decompressMeshes"}}};const hb=Math.PI/180,db=new Float32Array(16),fb=new Float32Array(12);function pb(t,e,n){const i=e[0]*hb,r=e[1]*hb,s=e[2]*hb,o=Math.sin(s),a=Math.sin(i),l=Math.sin(r),c=Math.cos(s),u=Math.cos(i),h=Math.cos(r),d=n[0],f=n[1],p=n[2];t[0]=d*h*u,t[1]=d*l*u,t[2]=d*-a,t[3]=f*(-l*c+h*a*o),t[4]=f*(h*c+l*a*o),t[5]=f*u*o,t[6]=p*(l*o+h*a*c),t[7]=p*(-h*o+l*a*c),t[8]=p*u*c}function gb(t){return t[0]=t[0],t[1]=t[1],t[2]=t[2],t[3]=t[4],t[4]=t[5],t[5]=t[6],t[6]=t[8],t[7]=t[9],t[8]=t[10],t[9]=t[12],t[10]=t[13],t[11]=t[14],t.subarray(0,12)}const mb={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrix__LOCATION_0:{size:3,elementOffset:0},instanceModelMatrix__LOCATION_1:{size:3,elementOffset:3},instanceModelMatrix__LOCATION_2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(t,{startRow:e,endRow:n}){const{data:i,getOrientation:r,getScale:s,getTranslation:o,getTransformMatrix:a}=this.props,l=Array.isArray(a),c=l&&16===a.length,u=Array.isArray(s),h=Array.isArray(r),d=Array.isArray(o),f=c||!l&&Boolean(a(i[0]));t.constant=f?c:h&&u&&d;const p=t.value;if(t.constant){let e;f?(db.set(a),e=gb(db)):(e=fb,pb(e,r,s),e.set(o,9)),t.value=new Float32Array(e)}else{let l=e*t.size;const{iterable:g,objectInfo:m}=Oh(i,e,n);for(const t of g){let e;m.index++,f?(db.set(c?a:a(t,m)),e=gb(db)):(e=fb,pb(e,h?r:r(t,m),u?s:s(t,m)),e.set(d?o:o(t,m),9)),p[l++]=e[0],p[l++]=e[1],p[l++]=e[2],p[l++]=e[3],p[l++]=e[4],p[l++]=e[5],p[l++]=e[6],p[l++]=e[7],p[l++]=e[8],p[l++]=e[9],p[l++]=e[10],p[l++]=e[11]}}}};function vb(t,e){return e===Li.CARTESIAN||e===Li.METER_OFFSETS||e===Li.DEFAULT&&!t.isGeospatial}const yb=[255,255,255,255],bb={scenegraph:{type:"object",value:null,async:!0},getScene:t=>t&&t.scenes?"object"==typeof t.scene?t.scene:t.scenes[t.scene||0]:t,getAnimator:t=>t&&t.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:yb},_lighting:"flat",_imageBasedLightingEnvironment:null,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[ub]};class _b extends uf{constructor(...t){super(...t),m(this,"state",void 0)}getShaders(){const t=[ff,gf];return"pbr"===this.props._lighting&&t.push(gg),super.getShaders({vs:"#version 300 es\nin vec3 instancePositions;\nin vec3 instancePositions64Low;\nin vec4 instanceColors;\nin vec3 instancePickingColors;\nin mat3 instanceModelMatrix;\nin vec3 instanceTranslation;\nuniform float sizeScale;\nuniform float sizeMinPixels;\nuniform float sizeMaxPixels;\nuniform mat4 sceneModelMatrix;\nuniform bool composeModelMatrix;\nin vec4 POSITION;\n\n#ifdef HAS_UV\n  in vec2 TEXCOORD_0;\n#endif\n\n#ifdef MODULE_PBR\n  #ifdef HAS_NORMALS\n    in vec4 NORMAL;\n  #endif\n#endif\nout vec4 vColor;\n#ifndef MODULE_PBR\n  #ifdef HAS_UV\n    out vec2 vTEXCOORD_0;\n  #endif\n#endif\nvoid main(void) {\n  #if defined(HAS_UV) && !defined(MODULE_PBR)\n    vTEXCOORD_0 = TEXCOORD_0;\n    geometry.uv = vTEXCOORD_0;\n  #endif\n\n  geometry.worldPosition = instancePositions;\n  geometry.pickingColor = instancePickingColors;\n\n  vec3 normal = vec3(0.0, 0.0, 1.0);\n  #ifdef MODULE_PBR\n    #ifdef HAS_NORMALS\n      normal = instanceModelMatrix * (sceneModelMatrix * vec4(NORMAL.xyz, 0.0)).xyz;\n    #endif\n  #endif\n\n  float originalSize = project_size_to_pixel(sizeScale);\n  float clampedSize = clamp(originalSize, sizeMinPixels, sizeMaxPixels);\n\n  vec3 pos = (instanceModelMatrix * (sceneModelMatrix * POSITION).xyz) * sizeScale * (clampedSize / originalSize) + instanceTranslation;\n  if(composeModelMatrix) {\n    DECKGL_FILTER_SIZE(pos, geometry);\n    geometry.normal = project_normal(normal);\n    geometry.worldPosition += pos;\n    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\n  }\n  else {\n    pos = project_size(pos);\n    DECKGL_FILTER_SIZE(pos, geometry);\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);\n    geometry.normal = project_normal(normal);\n  }\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  #ifdef MODULE_PBR\n    pbr_vPosition = geometry.position.xyz;\n    #ifdef HAS_NORMALS\n      pbr_vNormal = geometry.normal;\n    #endif\n\n    #ifdef HAS_UV\n      pbr_vUV = TEXCOORD_0;\n    #else\n      pbr_vUV = vec2(0., 0.);\n    #endif\n    geometry.uv = pbr_vUV;\n  #endif\n\n  vColor = instanceColors;\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#version 300 es\nuniform float opacity;\nin vec4 vColor;\n\nout vec4 fragmentColor;\n#ifndef MODULE_PBR\n  #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)\n    in vec2 vTEXCOORD_0;\n    uniform sampler2D u_BaseColorSampler;\n  #endif\n#endif\n\nvoid main(void) {\n  #ifdef MODULE_PBR\n    fragmentColor = vColor * pbr_filterColor(vec4(0));\n    geometry.uv = pbr_vUV;\n  #else\n    #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)\n      fragmentColor = vColor * texture2D(u_BaseColorSampler, vTEXCOORD_0);\n      geometry.uv = vTEXCOORD_0;\n    #else\n      fragmentColor = vColor;\n    #endif\n  #endif\n\n  fragmentColor.a *= opacity;\n  DECKGL_FILTER_COLOR(fragmentColor, geometry);\n}\n",modules:t})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:5121,size:this.props.colorFormat.length,accessor:"getColor",normalized:!0,defaultValue:yb,transition:!0},instanceModelMatrix:mb})}updateState(t){super.updateState(t);const{props:e,oldProps:n}=t;e.scenegraph!==n.scenegraph?this._updateScenegraph():e._animations!==n._animations&&this._applyAnimationsProp(this.state.scenegraph,this.state.animator,e._animations)}finalizeState(t){super.finalizeState(t),this._deleteScenegraph()}_updateScenegraph(){const t=this.props,{gl:e}=this.context;let n=null;if(t.scenegraph instanceof mg)n={scenes:[t.scenegraph]};else if(t.scenegraph&&!t.scenegraph.gltf){const i=t.scenegraph,r=function(t,e,n){const i=new qg(t,n);return{scenes:i.instantiate(e),animator:i.createAnimator()}}(e,i,this._getModelOptions());n={gltf:i,...r},async function(t){const e=[];return t.scenes.forEach((t=>{t.traverse((t=>{Object.values(t.model.getUniforms()).forEach((t=>{!1===t.loaded&&e.push(t)}))}))})),await async function(t){for(;e.some((t=>!t.loaded));)await new Promise((t=>requestAnimationFrame(t)))}()}(r).then((()=>this.setNeedsRedraw()))}else t.scenegraph&&(q.deprecated("ScenegraphLayer.props.scenegraph","Use GLTFLoader instead of GLTFScenegraphLoader")(),n=t.scenegraph);const i={layer:this,gl:e},r=t.getScene(n,i),s=t.getAnimator(n,i);r instanceof mg?(this._deleteScenegraph(),this._applyAllAttributes(r),this._applyAnimationsProp(r,s,t._animations),this.setState({scenegraph:r,animator:s})):null!==r&&q.warn("invalid scenegraph:",r)()}_applyAllAttributes(t){if(this.state.attributesAvailable){const e=this.getAttributeManager().getAttributes();t.traverse((t=>{this._setModelAttributes(t.model,e)}))}}_applyAnimationsProp(t,e,n){if(!t||!e||!n)return;const i=e.getAnimations();Object.keys(n).sort().forEach((t=>{const e=n[t];if("*"===t)i.forEach((t=>{Object.assign(t,e)}));else if(Number.isFinite(Number(t))){const n=Number(t);n>=0&&n<i.length?Object.assign(i[n],e):q.warn("animation ".concat(t," not found"))()}else{const n=i.find((({name:e})=>e===t));n?Object.assign(n,e):q.warn("animation ".concat(t," not found"))()}}))}_deleteScenegraph(){const{scenegraph:t}=this.state;t instanceof mg&&t.delete()}_getModelOptions(){const{_imageBasedLightingEnvironment:t}=this.props;let e=null;return t&&(e="function"==typeof t?t({gl:this.context.gl,layer:this}):t),{gl:this.context.gl,waitForFullLoad:!0,imageBasedLightingEnvironment:e,modelOptions:{isInstanced:!0,transpileToGLSL100:!Zr(this.context.gl),...this.getShaders()},useTangents:!1}}updateAttributes(t){this.setState({attributesAvailable:!0}),this.state.scenegraph&&this.state.scenegraph.traverse((e=>{this._setModelAttributes(e.model,t)}))}draw({moduleParameters:t=null,parameters:e={},context:n}){if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(n.timeline.getTime()),this.setNeedsRedraw());const{viewport:i}=this.context,{sizeScale:r,sizeMinPixels:s,sizeMaxPixels:o,opacity:a,coordinateSystem:l}=this.props,c=this.getNumInstances();this.state.scenegraph.traverse(((n,{worldMatrix:u})=>{n.model.setInstanceCount(c),n.updateModuleSettings(t),n.draw({parameters:e,uniforms:{sizeScale:r,opacity:a,sizeMinPixels:s,sizeMaxPixels:o,composeModelMatrix:vb(i,l),sceneModelMatrix:u,u_Camera:n.model.getUniforms().project_uCameraPosition}})}))}}function Ab(t,e){(t.COLOR_0||t.colors)&&e||(t.colors={constant:!0,value:new Float32Array([1,1,1])}),q.assert(t.positions||t.POSITION,'no "postions" or "POSITION" attribute in mesh')}function wb(t,e){if(t.attributes)return Ab(t.attributes,e),t instanceof vf?t:new vf(t);if(t.positions||t.POSITION)return Ab(t,e),new vf({attributes:t});throw Error("Invalid mesh")}m(_b,"defaultProps",bb),m(_b,"layerName","ScenegraphLayer");class Cb extends uf{constructor(...t){super(...t),m(this,"state",void 0)}getShaders(){const t=!Zr(this.context.gl),e={};return Ho(this.context.gl,zo)&&(e.DERIVATIVES_AVAILABLE=1),super.getShaders({vs:"#version 300 es\n#define SHADER_NAME simple-mesh-layer-vs\nuniform float sizeScale;\nuniform bool composeModelMatrix;\nin vec3 positions;\nin vec3 normals;\nin vec3 colors;\nin vec2 texCoords;\nin vec3 instancePositions;\nin vec3 instancePositions64Low;\nin vec4 instanceColors;\nin vec3 instancePickingColors;\nin mat3 instanceModelMatrix;\nin vec3 instanceTranslation;\nout vec2 vTexCoord;\nout vec3 cameraPosition;\nout vec3 normals_commonspace;\nout vec4 position_commonspace;\nout vec4 vColor;\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n  geometry.uv = texCoords;\n  geometry.pickingColor = instancePickingColors;\n\n  vTexCoord = texCoords;\n  cameraPosition = project_uCameraPosition;\n  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);\n\n  vec3 pos = (instanceModelMatrix * positions) * sizeScale + instanceTranslation;\n\n  if (composeModelMatrix) {\n    DECKGL_FILTER_SIZE(pos, geometry);\n    normals_commonspace = project_normal(instanceModelMatrix * normals);\n    geometry.worldPosition += pos;\n    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);\n    geometry.position = position_commonspace;\n  }\n  else {\n    pos = project_size(pos);\n    DECKGL_FILTER_SIZE(pos, geometry);\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);\n    geometry.position = position_commonspace;\n    normals_commonspace = project_normal(instanceModelMatrix * normals);\n  }\n\n  geometry.normal = normals_commonspace;\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME simple-mesh-layer-fs\n\nprecision highp float;\n\nuniform bool hasTexture;\nuniform sampler2D sampler;\nuniform bool flatShading;\nuniform float opacity;\n\nin vec2 vTexCoord;\nin vec3 cameraPosition;\nin vec3 normals_commonspace;\nin vec4 position_commonspace;\nin vec4 vColor;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  geometry.uv = vTexCoord;\n\n  vec3 normal;\n  if (flatShading) {\n#ifdef DERIVATIVES_AVAILABLE\n    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));\n#else\n    normal = vec3(0.0, 0.0, 1.0);\n#endif\n  } else {\n    normal = normals_commonspace;\n  }\n\n  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;\n  DECKGL_FILTER_COLOR(color, geometry);\n\n  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);\n  fragColor = vec4(lightColor, color.a * opacity);\n}\n",modules:[ff,Rp,gf],transpileToGLSL100:t,defines:e})}getBounds(){var t;if(this.props._instanced)return super.getBounds();let e=this.state.positionBounds;if(e)return e;const{mesh:n}=this.props;if(!n)return null;if(e=null===(t=n.header)||void 0===t?void 0:t.boundingBox,!e){const{attributes:t}=wb(n,this.props._useMeshColors);t.POSITION=t.POSITION||t.positions,e=fv(t)}return this.state.positionBounds=e,e}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:5130,fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:5121,transition:!0,size:this.props.colorFormat.length,normalized:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:mb}),this.setState({emptyTexture:new Eo(this.context.gl,{data:new Uint8Array(4),width:1,height:1})})}updateState(t){super.updateState(t);const{props:e,oldProps:n,changeFlags:i}=t;if(e.mesh!==n.mesh||i.extensionsChanged){var r;if(this.state.positionBounds=null,null===(r=this.state.model)||void 0===r||r.delete(),e.mesh){this.state.model=this.getModel(e.mesh);const t=e.mesh.attributes||e.mesh;this.setState({hasNormals:Boolean(t.NORMAL||t.normals)})}this.getAttributeManager().invalidateAll()}e.texture!==n.texture&&this.setTexture(e.texture),this.state.model&&this.state.model.setDrawMode(this.props.wireframe?3:4)}finalizeState(t){super.finalizeState(t),this.state.emptyTexture.delete()}draw({uniforms:t}){if(!this.state.model)return;const{viewport:e}=this.context,{sizeScale:n,coordinateSystem:i,_instanced:r}=this.props;this.state.model.setUniforms(t).setUniforms({sizeScale:n,composeModelMatrix:!r||vb(e,i),flatShading:!this.state.hasNormals}).draw()}getModel(t){const e=new wd(this.context.gl,{...this.getShaders(),id:this.props.id,geometry:wb(t,this.props._useMeshColors),isInstanced:!0}),{texture:n}=this.props,{emptyTexture:i}=this.state;return e.setUniforms({sampler:n||i,hasTexture:Boolean(n)}),e}setTexture(t){const{emptyTexture:e,model:n}=this.state;n&&n.setUniforms({sampler:t||e,hasTexture:Boolean(t)})}}m(Cb,"defaultProps",{mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_useMeshColors:{type:"boolean",value:!1},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:[0,0,0,255]},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0}}),m(Cb,"layerName","SimpleMeshLayer");class Eb extends Cb{getShaders(){const t=super.getShaders();return t.modules.push(gg),{...t,vs:"#version 300 es\n#define SHADER_NAME simple-mesh-layer-vs\nuniform float sizeScale;\nuniform bool composeModelMatrix;\nuniform bool pickFeatureIds;\nin vec3 positions;\nin vec3 normals;\nin vec3 colors;\nin vec2 texCoords;\nin vec4 uvRegions;\nin vec3 featureIdsPickingColors;\nin vec4 instanceColors;\nin vec3 instancePickingColors;\nin mat3 instanceModelMatrix;\nout vec2 vTexCoord;\nout vec3 cameraPosition;\nout vec3 normals_commonspace;\nout vec4 position_commonspace;\nout vec4 vColor;\n\nvec2 applyUVRegion(vec2 uv) {\n  #ifdef HAS_UV_REGIONS\n    return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;\n  #else\n    return uv;\n  #endif\n}\n\nvoid main(void) {\n  vec2 uv = applyUVRegion(texCoords);\n  geometry.uv = uv;\n\n  if (pickFeatureIds) {\n    geometry.pickingColor = featureIdsPickingColors;\n  } else {\n    geometry.pickingColor = instancePickingColors;\n  }\n\n  vTexCoord = uv;\n  cameraPosition = project_uCameraPosition;\n  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);\n\n  vec3 pos = (instanceModelMatrix * positions) * sizeScale;\n  vec3 projectedPosition = project_position(positions);\n  position_commonspace = vec4(projectedPosition, 1.0);\n  gl_Position = project_common_position_to_clipspace(position_commonspace);\n\n  geometry.position = position_commonspace;\n  normals_commonspace = project_normal(instanceModelMatrix * normals);\n  geometry.normal = normals_commonspace;\n\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  #ifdef MODULE_PBR\n    pbr_vPosition = geometry.position.xyz;\n    #ifdef HAS_NORMALS\n      pbr_vNormal = geometry.normal;\n    #endif\n\n    #ifdef HAS_UV\n      pbr_vUV = uv;\n    #else\n      pbr_vUV = vec2(0., 0.);\n    #endif\n    geometry.uv = pbr_vUV;\n  #endif\n\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME simple-mesh-layer-fs\n\nprecision highp float;\n\nuniform bool hasTexture;\nuniform sampler2D sampler;\nuniform bool flatShading;\nuniform float opacity;\n\nin vec2 vTexCoord;\nin vec3 cameraPosition;\nin vec3 normals_commonspace;\nin vec4 position_commonspace;\nin vec4 vColor;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  \n#ifdef MODULE_PBR\n\n  fragColor = vColor * pbr_filterColor(vec4(0));\n  geometry.uv = pbr_vUV;\n  fragColor.a *= opacity;\n\n#else\n\n  geometry.uv = vTexCoord;\n\n  vec3 normal;\n  if (flatShading) {\n#ifdef DERIVATIVES_AVAILABLE\n    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));\n#else\n    normal = vec3(0.0, 0.0, 1.0);\n#endif\n  } else {\n    normal = normals_commonspace;\n  }\n\n  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;\n  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);\n  fragColor = vec4(lightColor, color.a * opacity);\n\n#endif\n\n  DECKGL_FILTER_COLOR(fragColor, geometry);\n}\n"}}initializeState(){const{featureIds:t}=this.props;super.initializeState();const e=this.getAttributeManager();t&&e.add({featureIdsPickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(t){super.updateState(t);const{props:e,oldProps:n}=t;e.pbrMaterial!==n.pbrMaterial&&this.updatePbrMaterialUniforms(e.pbrMaterial)}draw(t){const{featureIds:e}=this.props;this.state.model&&(this.state.model.setUniforms({u_Camera:this.state.model.getUniforms().project_uCameraPosition,pickFeatureIds:Boolean(e)}),super.draw(t))}getModel(t){const{id:e,pbrMaterial:n}=this.props,i=this.parseMaterial(n,t);this.setState({materialParser:i});const r=this.getShaders();var s;return(s=t.attributes).COLOR_0||s.colors||(s.colors={constant:!0,value:new Float32Array([1,1,1])}),new wd(this.context.gl,{...this.getShaders(),id:e,geometry:t,defines:{...r.defines,...null==i?void 0:i.defines,HAS_UV_REGIONS:t.attributes.uvRegions},parameters:null==i?void 0:i.parameters,isInstanced:!0})}updatePbrMaterialUniforms(t){const{model:e}=this.state;if(e){const{mesh:n}=this.props,i=this.parseMaterial(t,n);this.setState({materialParser:i}),e.setUniforms(i.uniforms)}}parseMaterial(t,e){var n;const i=Boolean(t.pbrMetallicRoughness&&t.pbrMetallicRoughness.baseColorTexture);return null===(n=this.state.materialParser)||void 0===n||n.delete(),new Vg(this.context.gl,{attributes:{NORMAL:e.attributes.normals,TEXCOORD_0:e.attributes.texCoords},material:{unlit:i,...t},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(t){const e=this.props.featureIds,n=new Uint8ClampedArray(e.length*t.size),i=[];for(let t=0;t<e.length;t++)this.encodePickingColor(e[t],i),n[3*t]=i[0],n[3*t+1]=i[1],n[3*t+2]=i[2];t.value=n}finalizeState(t){var e;super.finalizeState(t),null===(e=this.state.materialParser)||void 0===e||e.delete(),this.setState({materialParser:null})}}m(Eb,"layerName","MeshLayer"),m(Eb,"defaultProps",{pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}});const xb={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,PI_OVER_TWO:Math.PI/2,PI_OVER_FOUR:Math.PI/4,PI_OVER_SIX:Math.PI/6,TWO_PI:2*Math.PI},Tb=6378137,Sb=6378137,Bb=6356752.314245179;function Pb(t){return t}Math.max(Tb,Sb,Bb),new In;const Mb=new In,Ib=new In,Lb=new In,Ob=new In,Rb={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},Fb={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},kb={east:new In,north:new In,up:new In,west:new In,south:new In,down:new In},Db=new In,Nb=new In,Ub=new In;function zb(t,e,n,i,r,s){const o=Rb[e]&&Rb[e][n];let a,l,c;fn(o&&(!i||i===o));const u=Ob.copy(r);if(ln(u.x,0,1e-14)&&ln(u.y,0,1e-14)){const t=Math.sign(u.z);a=Db.fromArray(Fb[e]),"east"!==e&&"west"!==e&&a.scale(t),l=Nb.fromArray(Fb[n]),"east"!==n&&"west"!==n&&l.scale(t),c=Ub.fromArray(Fb[i]),"east"!==i&&"west"!==i&&c.scale(t)}else{const{up:r,east:s,north:o}=kb;s.set(-u.y,u.x,0).normalize(),t.geodeticSurfaceNormal(u,r),o.copy(r).cross(s);const{down:h,west:d,south:f}=kb;h.copy(r).scale(-1),d.copy(s).scale(-1),f.copy(o).scale(-1),a=kb[e],l=kb[n],c=kb[i]}return s[0]=a.x,s[1]=a.y,s[2]=a.z,s[3]=0,s[4]=l.x,s[5]=l.y,s[6]=l.z,s[7]=0,s[8]=c.x,s[9]=c.y,s[10]=c.z,s[11]=0,s[12]=u.x,s[13]=u.y,s[14]=u.z,s[15]=1,s}const Gb=new In,jb=new In,Vb=new In,Hb=new In,Wb=new In,Jb=new In;class qb{constructor(t=0,e=0,n=0){m(this,"radii",void 0),m(this,"radiiSquared",void 0),m(this,"radiiToTheFourth",void 0),m(this,"oneOverRadii",void 0),m(this,"oneOverRadiiSquared",void 0),m(this,"minimumRadius",void 0),m(this,"maximumRadius",void 0),m(this,"centerToleranceSquared",xb.EPSILON1),m(this,"squaredXOverSquaredZ",void 0),fn(t>=0),fn(e>=0),fn(n>=0),this.radii=new In(t,e,n),this.radiiSquared=new In(t*t,e*e,n*n),this.radiiToTheFourth=new In(t*t*t*t,e*e*e*e,n*n*n*n),this.oneOverRadii=new In(0===t?0:1/t,0===e?0:1/e,0===n?0:1/n),this.oneOverRadiiSquared=new In(0===t?0:1/(t*t),0===e?0:1/(e*e),0===n?0:1/(n*n)),this.minimumRadius=Math.min(t,e,n),this.maximumRadius=Math.max(t,e,n),0!==this.radiiSquared.z&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(t){return this===t||Boolean(t&&this.radii.equals(t.radii))}toString(){return this.radii.toString()}cartographicToCartesian(t,e=[0,0,0]){const n=jb,i=Vb,[,,r]=t;this.geodeticSurfaceNormalCartographic(t,n),i.copy(this.radiiSquared).scale(n);const s=Math.sqrt(n.dot(i));return i.scale(1/s),n.scale(r),i.add(n),i.to(e)}cartesianToCartographic(t,e=[0,0,0]){Jb.from(t);const n=this.scaleToGeodeticSurface(Jb,Hb);if(!n)return;const i=this.geodeticSurfaceNormal(n,jb),r=Wb;r.copy(Jb).subtract(n);return function(t,e,n=Pb){return"longitude"in e?(e.longitude=n(t[0]),e.latitude=n(t[1]),e.height=t[2]):"x"in e?(e.x=n(t[0]),e.y=n(t[1]),e.z=t[2]):(e[0]=n(t[0]),e[1]=n(t[1]),e[2]=t[2]),e}([Math.atan2(i.y,i.x),Math.asin(i.z),Math.sign(_n(r,Jb))*yn(r)],e,$e._cartographicRadians?Pb:rn)}eastNorthUpToFixedFrame(t,e=new ri){return zb(this,"east","north","up",t,e)}localFrameToFixedFrame(t,e,n,i,r=new ri){return zb(this,t,e,n,i,r)}geocentricSurfaceNormal(t,e=[0,0,0]){return Gb.from(t).normalize().to(e)}geodeticSurfaceNormalCartographic(t,e=[0,0,0]){const n=function(t,e=[]){return function(t,e=[],n=Pb){return"longitude"in t?(e[0]=n(t.longitude),e[1]=n(t.latitude),e[2]=t.height):"x"in t?(e[0]=n(t.x),e[1]=n(t.y),e[2]=t.z):(e[0]=n(t[0]),e[1]=n(t[1]),e[2]=t[2]),e}(t,e,$e._cartographicRadians?Pb:nn)}(t),i=n[0],r=n[1],s=Math.cos(r);return Gb.set(s*Math.cos(i),s*Math.sin(i),Math.sin(r)).normalize(),Gb.to(e)}geodeticSurfaceNormal(t,e=[0,0,0]){return Gb.from(t).scale(this.oneOverRadiiSquared).normalize().to(e)}scaleToGeodeticSurface(t,e){return function(t,e,n=[]){const{oneOverRadii:i,oneOverRadiiSquared:r,centerToleranceSquared:s}=e;Mb.from(t);const o=Mb.x,a=Mb.y,l=Mb.z,c=i.x,u=i.y,h=i.z,d=o*o*c*c,f=a*a*u*u,p=l*l*h*h,g=d+f+p,m=Math.sqrt(1/g);if(!Number.isFinite(m))return;const v=Ib;if(v.copy(t).scale(m),g<s)return v.to(n);const y=r.x,b=r.y,_=r.z,A=Lb;A.set(v.x*y*2,v.y*b*2,v.z*_*2);let w,C,E,x,T=(1-m)*Mb.len()/(.5*A.len()),S=0;do{T-=S,w=1/(1+T*y),C=1/(1+T*b),E=1/(1+T*_);const t=w*w,e=C*C,n=E*E;x=d*t+f*e+p*n-1,S=x/(-2*(d*(t*w)*y+f*(e*C)*b+p*(n*E)*_))}while(Math.abs(x)>xb.EPSILON12);return Mb.scale([w,C,E]).to(n)}(t,this,e)}scaleToGeocentricSurface(t,e=[0,0,0]){Hb.from(t);const n=Hb.x,i=Hb.y,r=Hb.z,s=this.oneOverRadiiSquared,o=1/Math.sqrt(n*n*s.x+i*i*s.y+r*r*s.z);return Hb.multiplyScalar(o).to(e)}transformPositionToScaledSpace(t,e=[0,0,0]){return Hb.from(t).scale(this.oneOverRadii).to(e)}transformPositionFromScaledSpace(t,e=[0,0,0]){return Hb.from(t).scale(this.radii).to(e)}getSurfaceNormalIntersectionWithZAxis(t,e=0,n=[0,0,0]){fn(ln(this.radii.x,this.radii.y,xb.EPSILON15)),fn(this.radii.z>0),Hb.from(t);const i=Hb.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(i)>=this.radii.z-e))return Hb.set(0,0,i).to(n)}}function Kb(){let t;if("undefined"!=typeof window&&window.performance)t=window.performance.now();else if("undefined"!=typeof process&&process.hrtime){const e=process.hrtime();t=1e3*e[0]+e[1]/1e6}else t=Date.now();return t}m(qb,"WGS84",new qb(Tb,Sb,Bb));class Xb{constructor(t,e){this.name=void 0,this.type=void 0,this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=t,this.type=e,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(t){return this.sampleSize=t,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(t){return this._count+=t,this._samples++,this._checkSampling(),this}subtractCount(t){return this._count-=t,this._samples++,this._checkSampling(),this}addTime(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=Kb(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(Kb()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Qb{constructor(t){this.id=void 0,this.stats={},this.id=t.id,this.stats={},this._initializeStats(t.stats),Object.seal(this)}get(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"count";return this._getOrCreate({name:t,type:e})}get size(){return Object.keys(this.stats).length}reset(){for(const t of Object.values(this.stats))t.reset();return this}forEach(t){for(const e of Object.values(this.stats))t(e)}getTable(){const t={};return this.forEach((e=>{t[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}})),t}_initializeStats(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach((t=>this._getOrCreate(t)))}_getOrCreate(t){const{name:e,type:n}=t;let i=this.stats[e];return i||(i=t instanceof Xb?t:new Xb(e,n),this.stats[e]=i),i}}const Yb={id:"request-scheduler",throttleRequests:!0,maxRequests:6};class Zb{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};m(this,"props",void 0),m(this,"stats",void 0),m(this,"activeRequestCount",0),m(this,"requestQueue",[]),m(this,"requestMap",new Map),m(this,"deferredUpdate",null),this.props={...Yb,...t},this.stats=new Qb({id:this.props.id}),this.stats.get("Queued Requests"),this.stats.get("Active Requests"),this.stats.get("Cancelled Requests"),this.stats.get("Queued Requests Ever"),this.stats.get("Active Requests Ever")}scheduleRequest(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>0;if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(t))return this.requestMap.get(t);const n={handle:t,priority:0,getPriority:e},i=new Promise((t=>(n.resolve=t,n)));return this.requestQueue.push(n),this.requestMap.set(t,i),this._issueNewRequests(),i}_issueRequest(t){const{handle:e,resolve:n}=t;let i=!1;const r=()=>{i||(i=!0,this.requestMap.delete(e),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,n?n({done:r}):Promise.resolve({done:r})}_issueNewRequests(){this.deferredUpdate||(this.deferredUpdate=setTimeout((()=>this._issueNewRequestsAsync()),0))}_issueNewRequestsAsync(){this.deferredUpdate=null;const t=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(0!==t){this._updateAllRequests();for(let e=0;e<t;++e){const t=this.requestQueue.shift();t&&this._issueRequest(t)}}}_updateAllRequests(){const t=this.requestQueue;for(let e=0;e<t.length;++e){const n=t[e];this._updateRequest(n)||(t.splice(e,1),this.requestMap.delete(n.handle),e--)}t.sort(((t,e)=>t.priority-e.priority))}_updateRequest(t){return t.priority=t.getPriority(t.handle),!(t.priority<0&&(t.resolve(null),1))}}class $b{constructor(t,e,n){m(this,"item",void 0),m(this,"previous",void 0),m(this,"next",void 0),this.item=t,this.previous=e,this.next=n}}class t_{constructor(){m(this,"head",null),m(this,"tail",null),m(this,"_length",0)}get length(){return this._length}add(t){const e=new $b(t,this.tail,null);return this.tail?(this.tail.next=e,this.tail=e):(this.head=e,this.tail=e),++this._length,e}remove(t){t&&(t.previous&&t.next?(t.previous.next=t.next,t.next.previous=t.previous):t.previous?(t.previous.next=null,this.tail=t.previous):t.next?(t.next.previous=null,this.head=t.next):(this.head=null,this.tail=null),t.next=null,t.previous=null,--this._length)}splice(t,e){t!==e&&(this.remove(e),this._insert(t,e))}_insert(t,e){const n=t.next;t.next=e,this.tail===t?this.tail=e:n.previous=e,e.next=n,e.previous=t,++this._length}}class e_{constructor(){m(this,"_list",void 0),m(this,"_sentinel",void 0),m(this,"_trimTiles",void 0),this._list=new t_,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(t){const e=t._cacheNode;e&&this._list.splice(this._sentinel,e)}add(t,e,n){e._cacheNode||(e._cacheNode=this._list.add(e),n&&n(t,e))}unloadTile(t,e,n){const i=e._cacheNode;i&&(this._list.remove(i),e._cacheNode=null,n&&n(t,e))}unloadTiles(t,e){const n=this._trimTiles;this._trimTiles=!1;const i=this._list,r=1024*t.maximumMemoryUsage*1024,s=this._sentinel;let o=i.head;for(;o!==s&&(t.gpuMemoryUsageInBytes>r||n);){const n=o.item;o=o.next,this.unloadTile(t,n,e)}}trim(){this._trimTiles=!0}}new In,new In;const n_=new In,i_=new In;class r_{constructor(t=[0,0,0],e=0){m(this,"center",void 0),m(this,"radius",void 0),this.radius=-0,this.center=new In,this.fromCenterRadius(t,e)}fromCenterRadius(t,e){return this.center.from(t),this.radius=e,this}fromCornerPoints(t,e){return e=n_.from(e),this.center=(new In).from(t).add(e).scale(.5),this.radius=this.center.distance(e),this}equals(t){return this===t||Boolean(t)&&this.center.equals(t.center)&&this.radius===t.radius}clone(){return new r_(this.center,this.radius)}union(t){const e=this.center,n=this.radius,i=t.center,r=t.radius,s=n_.copy(i).subtract(e),o=s.magnitude();if(n>=o+r)return this.clone();if(r>=o+n)return t.clone();const a=.5*(n+o+r);return i_.copy(s).scale((-n+a)/o).add(e),this.center.copy(i_),this.radius=a,this}expand(t){const e=n_.from(t).subtract(this.center).magnitude();return e>this.radius&&(this.radius=e),this}transform(t){this.center.transform(t);const e=function(t,e){var n=e[0],i=e[1],r=e[2],s=e[4],o=e[5],a=e[6],l=e[8],c=e[9],u=e[10];return t[0]=Math.hypot(n,i,r),t[1]=Math.hypot(s,o,a),t[2]=Math.hypot(l,c,u),t}(n_,t);return this.radius=Math.max(e[0],Math.max(e[1],e[2]))*this.radius,this}distanceSquaredTo(t){const e=this.distanceTo(t);return e*e}distanceTo(t){const e=n_.from(t).subtract(this.center);return Math.max(0,e.len()-this.radius)}intersectPlane(t){const e=this.center,n=this.radius,i=t.normal.dot(e)+t.distance;return i<-n?-1:i<n?0:1}}const s_=new In,o_=new In,a_=new In,l_=new In,c_=new In,u_=new In,h_=new In;class d_{constructor(t=[0,0,0],e=[0,0,0,0,0,0,0,0,0]){m(this,"center",void 0),m(this,"halfAxes",void 0),this.center=(new In).from(t),this.halfAxes=new ay(e)}get halfSize(){const t=this.halfAxes.getColumn(0),e=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2);return[new In(t).len(),new In(e).len(),new In(n).len()]}get quaternion(){const t=this.halfAxes.getColumn(0),e=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2),i=new In(t).normalize(),r=new In(e).normalize(),s=new In(n).normalize();return(new Rg).fromMatrix3(new ay([...i,...r,...s]))}fromCenterHalfSizeQuaternion(t,e,n){const i=new Rg(n),r=(new ay).fromQuaternion(i);return r[0]=r[0]*e[0],r[1]=r[1]*e[0],r[2]=r[2]*e[0],r[3]=r[3]*e[1],r[4]=r[4]*e[1],r[5]=r[5]*e[1],r[6]=r[6]*e[2],r[7]=r[7]*e[2],r[8]=r[8]*e[2],this.center=(new In).from(t),this.halfAxes=r,this}clone(){return new d_(this.center,this.halfAxes)}equals(t){return this===t||Boolean(t)&&this.center.equals(t.center)&&this.halfAxes.equals(t.halfAxes)}getBoundingSphere(t=new r_){const e=this.halfAxes,n=e.getColumn(0,a_),i=e.getColumn(1,l_),r=e.getColumn(2,c_),s=s_.copy(n).add(i).add(r);return t.center.copy(this.center),t.radius=s.magnitude(),t}intersectPlane(t){const e=this.center,n=t.normal,i=this.halfAxes,r=n.x,s=n.y,o=n.z,a=Math.abs(r*i[0]+s*i[1]+o*i[2])+Math.abs(r*i[3]+s*i[4]+o*i[5])+Math.abs(r*i[6]+s*i[7]+o*i[8]),l=n.dot(e)+t.distance;return l<=-a?-1:l>=a?1:0}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}distanceSquaredTo(t){const e=o_.from(t).subtract(this.center),n=this.halfAxes,i=n.getColumn(0,a_),r=n.getColumn(1,l_),s=n.getColumn(2,c_),o=i.magnitude(),a=r.magnitude(),l=s.magnitude();i.normalize(),r.normalize(),s.normalize();let c,u=0;return c=Math.abs(e.dot(i))-o,c>0&&(u+=c*c),c=Math.abs(e.dot(r))-a,c>0&&(u+=c*c),c=Math.abs(e.dot(s))-l,c>0&&(u+=c*c),u}computePlaneDistances(t,e,n=[-0,-0]){let i=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY;const s=this.center,o=this.halfAxes,a=o.getColumn(0,a_),l=o.getColumn(1,l_),c=o.getColumn(2,c_),u=u_.copy(a).add(l).add(c).add(s),h=h_.copy(u).subtract(t);let d=e.dot(h);return i=Math.min(d,i),r=Math.max(d,r),u.copy(s).add(a).add(l).subtract(c),h.copy(u).subtract(t),d=e.dot(h),i=Math.min(d,i),r=Math.max(d,r),u.copy(s).add(a).subtract(l).add(c),h.copy(u).subtract(t),d=e.dot(h),i=Math.min(d,i),r=Math.max(d,r),u.copy(s).add(a).subtract(l).subtract(c),h.copy(u).subtract(t),d=e.dot(h),i=Math.min(d,i),r=Math.max(d,r),s.copy(u).subtract(a).add(l).add(c),h.copy(u).subtract(t),d=e.dot(h),i=Math.min(d,i),r=Math.max(d,r),s.copy(u).subtract(a).add(l).subtract(c),h.copy(u).subtract(t),d=e.dot(h),i=Math.min(d,i),r=Math.max(d,r),s.copy(u).subtract(a).subtract(l).add(c),h.copy(u).subtract(t),d=e.dot(h),i=Math.min(d,i),r=Math.max(d,r),s.copy(u).subtract(a).subtract(l).subtract(c),h.copy(u).subtract(t),d=e.dot(h),i=Math.min(d,i),r=Math.max(d,r),n[0]=i,n[1]=r,n}transform(t){this.center.transformAsPoint(t);const e=this.halfAxes.getColumn(0,a_);e.transformAsPoint(t);const n=this.halfAxes.getColumn(1,l_);n.transformAsPoint(t);const i=this.halfAxes.getColumn(2,c_);return i.transformAsPoint(t),this.halfAxes=new ay([...e,...n,...i]),this}getTransform(){throw new Error("not implemented")}}const f_=new In,p_=new In;class g_{constructor(t=[0,0,1],e=0){m(this,"normal",void 0),m(this,"distance",void 0),this.normal=new In,this.distance=-0,this.fromNormalDistance(t,e)}fromNormalDistance(t,e){return fn(Number.isFinite(e)),this.normal.from(t).normalize(),this.distance=e,this}fromPointNormal(t,e){t=f_.from(t),this.normal.from(e).normalize();const n=-this.normal.dot(t);return this.distance=n,this}fromCoefficients(t,e,n,i){return this.normal.set(t,e,n),fn(ln(this.normal.len(),1)),this.distance=i,this}clone(){return new g_(this.normal,this.distance)}equals(t){return ln(this.distance,t.distance)&&ln(this.normal,t.normal)}getPointDistance(t){return this.normal.dot(t)+this.distance}transform(t){const e=p_.copy(this.normal).transformAsVector(t).normalize(),n=this.normal.scale(-this.distance).transform(t);return this.fromPointNormal(n,e)}projectPointOntoPlane(t,e=[0,0,0]){t=f_.from(t);const n=this.getPointDistance(t),i=p_.copy(this.normal).scale(n);return t.subtract(i).to(e)}}const m_=[new In([1,0,0]),new In([0,1,0]),new In([0,0,1])],v_=new In,y_=new In;new g_(new In(1,0,0),0);class b_{constructor(t=[]){m(this,"planes",void 0),this.planes=t}fromBoundingSphere(t){this.planes.length=2*m_.length;const e=t.center,n=t.radius;let i=0;for(const t of m_){let r=this.planes[i],s=this.planes[i+1];r||(r=this.planes[i]=new g_),s||(s=this.planes[i+1]=new g_);const o=v_.copy(t).scale(-n).add(e);t.dot(o),r.fromPointNormal(o,t);const a=v_.copy(t).scale(n).add(e),l=y_.copy(t).negate();l.dot(a),s.fromPointNormal(a,l),i+=2}return this}computeVisibility(t){let e=1;for(const n of this.planes)switch(t.intersectPlane(n)){case-1:return-1;case 0:e=0}return e}computeVisibilityWithPlaneMask(t,e){if(fn(Number.isFinite(e),"parentPlaneMask is required."),e===b_.MASK_OUTSIDE||e===b_.MASK_INSIDE)return e;let n=b_.MASK_INSIDE;const i=this.planes;for(let r=0;r<this.planes.length;++r){const s=r<31?1<<r:0;if(r<31&&0==(e&s))continue;const o=i[r],a=t.intersectPlane(o);if(-1===a)return b_.MASK_OUTSIDE;0===a&&(n|=s)}return n}}m(b_,"MASK_OUTSIDE",4294967295),m(b_,"MASK_INSIDE",0),m(b_,"MASK_INDETERMINATE",2147483647),new In,new In,new In,new In,new In,new In,new In,new In,new In,new In,new In,new In,new In,new In,new In,new In,new In,Math.PI;const __=new ay,A_=new ay,w_=new ay,C_=new ay,E_=new ay;const x_=[1,0,0],T_=[2,2,1];function S_(t){let e=0;for(let n=0;n<3;++n){const i=t[__.getElementIndex(T_[n],x_[n])];e+=2*i*i}return Math.sqrt(e)}function B_(t,e){const n=xb.EPSILON15;let i=0,r=1;for(let e=0;e<3;++e){const n=Math.abs(t[__.getElementIndex(T_[e],x_[e])]);n>i&&(r=e,i=n)}const s=x_[r],o=T_[r];let a=1,l=0;if(Math.abs(t[__.getElementIndex(o,s)])>n){const e=(t[__.getElementIndex(o,o)]-t[__.getElementIndex(s,s)])/2/t[__.getElementIndex(o,s)];let n;n=e<0?-1/(-e+Math.sqrt(1+e*e)):1/(e+Math.sqrt(1+e*e)),a=1/Math.sqrt(1+n*n),l=n*a}return ay.IDENTITY.to(e),e[__.getElementIndex(s,s)]=e[__.getElementIndex(o,o)]=a,e[__.getElementIndex(o,s)]=l,e[__.getElementIndex(s,o)]=-l,e}const P_=new In,M_=new In,I_=new In,L_=new In,O_=new In,R_=new ay,F_={diagonal:new ay,unitary:new ay},k_=new In,D_=new In,N_=new b_([new g_,new g_,new g_,new g_,new g_,new g_]);function U_(t,e){const{cameraDirection:n,cameraUp:i,height:r}=t,{metersPerUnit:s}=t.distanceScales,o=G_(t,t.center),a=qb.WGS84.eastNorthUpToFixedFrame(o),l=t.unprojectPosition(t.cameraPosition),c=qb.WGS84.cartographicToCartesian(l,new In),u=new In(a.transformAsVector(new In(n).scale(s))).normalize(),h=new In(a.transformAsVector(new In(i).scale(s))).normalize();!function(t){const e=t.getFrustumPlanes(),n=z_(e.near,t.cameraPosition),i=G_(t,n),r=G_(t,t.cameraPosition,D_);let s=0;N_.planes[s++].fromPointNormal(i,k_.copy(i).subtract(r));for(const r in e){if("near"===r)continue;const o=G_(t,z_(e[r],n,D_),D_);N_.planes[s++].fromPointNormal(o,k_.copy(i).subtract(o))}}(t);const d=t.constructor,{longitude:f,latitude:p,width:g,bearing:m,zoom:v}=t;return{camera:{position:c,direction:u,up:h},viewport:t,topDownViewport:new d({longitude:f,latitude:p,height:r,width:g,bearing:m,zoom:v,pitch:0}),height:r,cullingVolume:N_,frameNumber:e,sseDenominator:1.15}}function z_(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new In;const i=t.normal.dot(e);return n.copy(t.normal).scale(t.distance-i).add(e),n}function G_(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new In;const i=t.unprojectPosition(e);return qb.WGS84.cartographicToCartesian(i,n)}const j_=6356752.314245179,V_=new In;function H_(t,e,n){const i=qb.WGS84.cartographicToCartesian([t.xmax,t.ymax,t.zmax],new In),r=Math.sqrt(Math.pow(i[0]-n[0],2)+Math.pow(i[1]-n[1],2)+Math.pow(i[2]-n[2],2));return Math.log2(j_/(r+e[2]))}const W_={ADD:1,REPLACE:2},J_={EMPTY:"empty",SCENEGRAPH:"scenegraph",POINTCLOUD:"pointcloud",MESH:"mesh"},q_="I3S",K_="TILES3D",X_="geometricError";function Q_(t){return null!=t}const Y_=new In,Z_=new In,$_=new In,tA=new In;function eA(t,e,n){if(dt(t,"3D Tile: boundingVolume must be defined"),t.box)return function(t,e,n){const i=new In(t[0],t[1],t[2]);e.transform(i,i);let r=[];if(10===t.length){const e=t.slice(3,6),n=new Rg;n.fromArray(t,6);const i=new In([1,0,0]),s=new In([0,1,0]),o=new In([0,0,1]);i.transformByQuaternion(n),i.scale(e[0]),s.transformByQuaternion(n),s.scale(e[1]),o.transformByQuaternion(n),o.scale(e[2]),r=[...i.toArray(),...s.toArray(),...o.toArray()]}else r=[...t.slice(3,6),...t.slice(6,9),...t.slice(9,12)];const s=e.transformAsVector(r.slice(0,3)),o=e.transformAsVector(r.slice(3,6)),a=e.transformAsVector(r.slice(6,9)),l=new ay([s[0],s[1],s[2],o[0],o[1],o[2],a[0],a[1],a[2]]);return Q_(n)?(n.center=i,n.halfAxes=l,n):new d_(i,l)}(t.box,e,n);if(t.region){const[e,n,i,r,s,o]=t.region,a=qb.WGS84.cartographicToCartesian([sn(e),sn(r),s],$_),l=qb.WGS84.cartographicToCartesian([sn(i),sn(n),o],tA),c=(new In).addVectors(a,l).multiplyScalar(.5),u=(new In).subVectors(a,l).len()/2;return nA([c[0],c[1],c[2],u],new ri)}if(t.sphere)return nA(t.sphere,e,n);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function nA(t,e,n){const i=new In(t[0],t[1],t[2]);e.transform(i,i);const r=e.getScale(Z_),s=Math.max(Math.max(r[0],r[1]),r[2]),o=t[3]*s;return Q_(n)?(n.center=i,n.radius=o,n):new r_(i,o)}function iA(t,e){qb.WGS84.cartesianToCartographic(e,Y_),t[0][0]=Math.min(t[0][0],Y_[0]),t[0][1]=Math.min(t[0][1],Y_[1]),t[0][2]=Math.min(t[0][2],Y_[2]),t[1][0]=Math.max(t[1][0],Y_[0]),t[1][1]=Math.max(t[1][1],Y_[1]),t[1][2]=Math.max(t[1][2],Y_[2])}new In,new In,new ri,new In,new In,new In;const rA=new In,sA=new In,oA=new In,aA=new In,lA=new In,cA=new ri,uA=new ri;function hA(t,e){const{topDownViewport:n}=e,i=t.header.mbs[1],r=t.header.mbs[0],s=t.header.mbs[2],o=t.header.mbs[3],a=[...t.boundingVolume.center],l=n.unprojectPosition(n.cameraPosition);qb.WGS84.cartographicToCartesian(l,rA),sA.copy(rA).subtract(a).normalize(),qb.WGS84.eastNorthUpToFixedFrame(a,cA),uA.copy(cA).invert(),oA.copy(rA).transform(uA);const c=Math.sqrt(oA[0]*oA[0]+oA[1]*oA[1]),u=c*c/oA[2];aA.copy([oA[0],oA[1],u]);const h=aA.transform(cA).subtract(a).normalize(),d=sA.cross(h).normalize().scale(o).add(a),f=qb.WGS84.cartesianToCartographic(d),p=n.project([r,i,s]),g=n.project(f);return lA.copy(p).subtract(g).magnitude()}class dA{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;m(this,"_map",new Map),m(this,"_array",void 0),m(this,"_length",void 0),this._array=new Array(t),this._length=t}get length(){return this._length}set length(t){this._length=t,t>this._array.length&&(this._array.length=t)}get values(){return this._array}get(t){return dt(t<this._array.length),this._array[t]}set(t,e){dt(t>=0),t>=this.length&&(this.length=t+1),this._map.has(this._array[t])&&this._map.delete(this._array[t]),this._array[t]=e,this._map.set(e,t)}delete(t){const e=this._map.get(t);e>=0&&(this._array.splice(e,1),this._map.delete(t),this.length--)}peek(){return this._array[this._length-1]}push(t){if(!this._map.has(t)){const e=this.length++;this._array[e]=t,this._map.set(t,e)}}pop(){const t=this._array[--this.length];return this._map.delete(t),t}reserve(t){dt(t>=0),t>this._array.length&&(this._array.length=t)}resize(t){dt(t>=0),this.length=t}trim(t){null==t&&(t=this.length),this._array.length=t}reset(){this._array=[],this._map=new Map,this._length=0}find(t){return this._map.has(t)}}const fA={loadSiblings:!1,skipLevelOfDetail:!1,maximumScreenSpaceError:2,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class pA{traversalFinished(t){return!0}constructor(t){m(this,"options",void 0),m(this,"root",null),m(this,"selectedTiles",{}),m(this,"requestedTiles",{}),m(this,"emptyTiles",{}),m(this,"lastUpdate",(new Date).getTime()),m(this,"updateDebounceTime",1e3),m(this,"_traversalStack",new dA),m(this,"_emptyTraversalStack",new dA),m(this,"_frameNumber",null),this.options={...fA,...t}}traverse(t,e,n){this.root=t,this.options={...this.options,...n},this.reset(),this.updateTile(t,e),this._frameNumber=e.frameNumber,this.executeTraversal(t,e)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(t,e){const n=this._traversalStack;for(t._selectionDepth=1,n.push(t);n.length>0;){const t=n.pop();let i=!1;this.canTraverse(t,e)&&(this.updateChildTiles(t,e),i=this.updateAndPushChildren(t,e,n,t.hasRenderContent?t._selectionDepth+1:t._selectionDepth));const r=t.parent,s=Boolean(!r||r._shouldRefine),o=!i;t.hasRenderContent?t.refine===W_.ADD?(this.loadTile(t,e),this.selectTile(t,e)):t.refine===W_.REPLACE&&(this.loadTile(t,e),o&&this.selectTile(t,e)):(this.emptyTiles[t.id]=t,this.loadTile(t,e),o&&this.selectTile(t,e)),this.touchTile(t,e),t._shouldRefine=i&&s}const i=(new Date).getTime();(this.traversalFinished(e)||i-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=i,this.options.onTraversalEnd(e))}updateChildTiles(t,e){const n=t.children;for(const t of n)this.updateTile(t,e)}updateAndPushChildren(t,e,n,i){const{loadSiblings:r,skipLevelOfDetail:s}=this.options,o=t.children;o.sort(this.compareDistanceToCamera.bind(this));const a=t.refine===W_.REPLACE&&t.hasRenderContent&&!s;let l=!1,c=!0;for(const t of o)if(t._selectionDepth=i,t.isVisibleAndInRequestVolume?(n.find(t)&&n.delete(t),n.push(t),l=!0):(a||r)&&(this.loadTile(t,e),this.touchTile(t,e)),a){let n;if(n=!!t._inRequestVolume&&(t.hasRenderContent?t.contentAvailable:this.executeEmptyTraversal(t,e)),c=c&&n,!c)return!1}return l||(c=!1),c}updateTile(t,e){this.updateTileVisibility(t,e)}selectTile(t,e){this.shouldSelectTile(t)&&(t._selectedFrame=e.frameNumber,this.selectedTiles[t.id]=t)}loadTile(t,e){this.shouldLoadTile(t)&&(t._requestedFrame=e.frameNumber,t._priority=t._getPriority(),this.requestedTiles[t.id]=t)}touchTile(t,e){t.tileset._cache.touch(t),t._touchedFrame=e.frameNumber}canTraverse(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return!!t.hasChildren&&(t.hasTilesetContent?!t.contentExpired:!(!i&&!t.isVisibleAndInRequestVolume)&&this.shouldRefine(t,e,n))}shouldLoadTile(t){return t.hasUnloadedContent||t.contentExpired}shouldSelectTile(t){return t.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=t._screenSpaceError;return n&&(i=t.getScreenSpaceError(e,!0)),i>this.options.maximumScreenSpaceError}updateTileVisibility(t,e){const n=[];if(this.options.viewportTraversersMap)for(const t in this.options.viewportTraversersMap)this.options.viewportTraversersMap[t]===e.viewport.id&&n.push(t);else n.push(e.viewport.id);t.updateVisibility(e,n)}compareDistanceToCamera(t,e){return t._distanceToCamera-e._distanceToCamera}anyChildrenVisible(t,e){let n=!1;for(const i of t.children)i.updateVisibility(e),n=n||i.isVisibleAndInRequestVolume;return n}executeEmptyTraversal(t,e){let n=!0;const i=this._emptyTraversalStack;for(i.push(t);i.length>0&&n;){const t=i.pop();if(this.updateTile(t,e),t.isVisibleAndInRequestVolume||this.loadTile(t,e),this.touchTile(t,e),!t.hasRenderContent&&this.canTraverse(t,e,!1,!0)){const e=t.children;for(const t of e)i.find(t)&&i.delete(t),i.push(t)}else t.contentAvailable||t.hasEmptyContent||(n=!1)}return n}}const gA=new In;class mA{constructor(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";m(this,"tileset",void 0),m(this,"header",void 0),m(this,"id",void 0),m(this,"url",void 0),m(this,"parent",void 0),m(this,"refine",void 0),m(this,"type",void 0),m(this,"contentUrl",void 0),m(this,"lodMetricType","geometricError"),m(this,"lodMetricValue",0),m(this,"boundingVolume",null),m(this,"content",null),m(this,"contentState",0),m(this,"gpuMemoryUsageInBytes",0),m(this,"children",[]),m(this,"depth",0),m(this,"viewportIds",[]),m(this,"transform",new ri),m(this,"extensions",null),m(this,"implicitTiling",null),m(this,"userData",{}),m(this,"computedTransform",void 0),m(this,"hasEmptyContent",!1),m(this,"hasTilesetContent",!1),m(this,"traverser",new pA({})),m(this,"_cacheNode",null),m(this,"_frameNumber",null),m(this,"_expireDate",null),m(this,"_expiredContent",null),m(this,"_boundingBox",void 0),m(this,"_distanceToCamera",0),m(this,"_screenSpaceError",0),m(this,"_visibilityPlaneMask",void 0),m(this,"_visible",void 0),m(this,"_contentBoundingVolume",void 0),m(this,"_viewerRequestVolume",void 0),m(this,"_initialTransform",new ri),m(this,"_priority",0),m(this,"_selectedFrame",0),m(this,"_requestedFrame",0),m(this,"_selectionDepth",0),m(this,"_touchedFrame",0),m(this,"_centerZDepth",0),m(this,"_shouldRefine",!1),m(this,"_stackLength",0),m(this,"_visitedFrame",0),m(this,"_inRequestVolume",!1),m(this,"_lodJudge",null),this.header=e,this.tileset=t,this.id=i||e.id,this.url=e.url,this.parent=n,this.refine=this._getRefine(e.refine),this.type=e.type,this.contentUrl=e.contentUrl,this._initializeLodMetric(e),this._initializeTransforms(e),this._initializeBoundingVolumes(e),this._initializeContent(e),this._initializeRenderingState(e),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return null===this.header}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return 3===this.contentState||this.hasEmptyContent}get contentAvailable(){return Boolean(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return 0===this.contentState}get contentExpired(){return 4===this.contentState}get contentFailed(){return 5===this.contentState}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=function(t,e){if(t.box)return function(t){const e=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]],{halfAxes:n}=t,i=new In(n.getColumn(0)),r=new In(n.getColumn(1)),s=new In(n.getColumn(2));for(let n=0;n<2;n++){for(let n=0;n<2;n++){for(let n=0;n<2;n++)Y_.copy(t.center),Y_.add(i),Y_.add(r),Y_.add(s),iA(e,Y_),s.negate();r.negate()}i.negate()}return e}(e);if(t.region){const[e,n,i,r,s,o]=t.region;return[[sn(e),sn(n),s],[sn(i),sn(r),o]]}if(t.sphere)return function(t){const e=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]],{center:n,radius:i}=t,r=qb.WGS84.scaleToGeodeticSurface(n,Y_);let s;s=r?qb.WGS84.geodeticSurfaceNormal(r):new In(0,0,1);let o=new In(s[2],-s[1],0);o.len()>0?o.normalize():o=new In(0,1,0);const a=o.clone().cross(s);for(const t of[o,a,s]){Z_.copy(t).scale(i);for(let t=0;t<2;t++)Y_.copy(n),Y_.add(Z_),iA(e,Y_),Z_.negate()}return e}(e);throw new Error("Unkown boundingVolume type")}(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(t,e){switch(this.tileset.type){case q_:return hA(this,t);case K_:return function(t,e,n){const i=t.tileset,r=t.parent&&t.parent.lodMetricValue||t.lodMetricValue,s=n?r:t.lodMetricValue;if(0===s)return 0;const o=Math.max(t._distanceToCamera,1e-7),{height:a,sseDenominator:l}=e,{viewDistanceScale:c}=i.options;let u=s*a*(c||1)/(o*l);return u-=function(t,e){if(t.dynamicScreenSpaceError&&t.dynamicScreenSpaceErrorComputedDensity){const n=t.dynamicScreenSpaceErrorComputedDensity,i=t.dynamicScreenSpaceErrorFactor,r=function(t,e){const n=t*e;return 1-Math.exp(-n*n)}(e,n)*i;return r}return 0}(i,o),u}(this,t,e);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const t=this.tileset._traverser,{skipLevelOfDetail:e}=t.options,n=this.refine===W_.ADD||e;if(n&&!this.isVisible&&void 0!==this._visible)return-1;if(this.tileset._frameNumber-this._touchedFrame>=1)return-1;if(0===this.contentState)return-1;const i=this.parent,r=!i||n&&0!==this._screenSpaceError&&!i.hasTilesetContent?this._screenSpaceError:i._screenSpaceError,s=t.root?t.root._screenSpaceError:0;return Math.max(s-r,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=1;const t=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!t)return this.contentState=0,!1;try{const t=this.tileset.getTileUrl(this.contentUrl),e=this.tileset.loader,n={...this.tileset.loadOptions,[e.id]:{...this.tileset.loadOptions[e.id],isTileset:"json"===this.type,...this._getLoaderSpecificOptions(e.id)}};return this.content=await qe(t,e,n),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=3,this._onContentLoaded(),!0}catch(t){throw this.contentState=5,t}finally{t.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=0,!0}updateVisibility(t,e){if(this._frameNumber===t.frameNumber)return;const n=this.parent,i=n?n._visibilityPlaneMask:b_.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const t=n?n.computedTransform:this.tileset.modelMatrix;this._updateTransform(t)}this._distanceToCamera=this.distanceToTile(t),this._screenSpaceError=this.getScreenSpaceError(t,!1),this._visibilityPlaneMask=this.visibility(t,i),this._visible=this._visibilityPlaneMask!==b_.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(t),this._frameNumber=t.frameNumber,this.viewportIds=e}visibility(t,e){const{cullingVolume:n}=t,{boundingVolume:i}=this;return n.computeVisibilityWithPlaneMask(i,e)}contentVisibility(){return!0}distanceToTile(t){const e=this.boundingVolume;return Math.sqrt(Math.max(e.distanceSquaredTo(t.camera.position),0))}cameraSpaceZDepth(t){let{camera:e}=t;const n=this.boundingVolume;return gA.subVectors(n.center,e.position),e.direction.dot(gA)}insideViewerRequestVolume(t){const e=this._viewerRequestVolume;return!e||e.distanceSquaredTo(t.camera.position)<=0}updateExpiration(){if(null!=this._expireDate&&this.contentReady&&!this.hasEmptyContent){const t=Date.now();Date.lessThan(this._expireDate,t)&&(this.contentState=4,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(t){"lodMetricType"in t?this.lodMetricType=t.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in t?this.lodMetricValue=t.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(t){this.transform=t.transform?new ri(t.transform):new ri;const e=this.parent,n=this.tileset,i=e&&e.computedTransform?e.computedTransform.clone():n.modelMatrix.clone();this.computedTransform=new ri(i).multiplyRight(this.transform);const r=e&&e._initialTransform?e._initialTransform.clone():new ri;this._initialTransform=new ri(r).multiplyRight(this.transform)}_initializeBoundingVolumes(t){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(t)}_initializeContent(t){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=0,this.hasTilesetContent=!1,t.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(t){this.depth=t.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=b_.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(t){return t||this.parent&&this.parent.refine||W_.REPLACE}_isTileset(){return-1!==this.contentUrl.indexOf(".json")}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(t){this.boundingVolume=eA(t.boundingVolume,this.computedTransform,this.boundingVolume);const e=t.content;e&&(e.boundingVolume&&(this._contentBoundingVolume=eA(e.boundingVolume,this.computedTransform,this._contentBoundingVolume)),t.viewerRequestVolume&&(this._viewerRequestVolume=eA(t.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(){const t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ri).clone().multiplyRight(this.transform);!t.equals(this.computedTransform)&&(this.computedTransform=t,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(t){return"i3s"===t?{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1}:{assetGltfUpAxis:(e=this.tileset.tileset).asset&&e.asset.gltfUpAxis||"Y"};var e}}class vA extends pA{compareDistanceToCamera(t,e){return 0===e._distanceToCamera&&0===t._distanceToCamera?e._centerZDepth-t._centerZDepth:e._distanceToCamera-t._distanceToCamera}updateTileVisibility(t,e){if(super.updateTileVisibility(t,e),!t.isVisibleAndInRequestVolume)return;const n=t.children.length>0;if(t.hasTilesetContent&&n){const n=t.children[0];return this.updateTileVisibility(n,e),void(t._visible=n._visible)}if(this.meetsScreenSpaceErrorEarly(t,e))return void(t._visible=!1);const i=t.refine===W_.REPLACE,r=1===t._optimChildrenWithinParent;i&&r&&n&&!this.anyChildrenVisible(t,e)&&(t._visible=!1)}meetsScreenSpaceErrorEarly(t,e){const{parent:n}=t;return!(!n||n.hasTilesetContent||n.refine!==W_.ADD||this.shouldRefine(t,e,!0))}}class yA{constructor(){m(this,"frameNumberMap",new Map)}register(t,e){const n=this.frameNumberMap.get(t)||new Map,i=n.get(e)||0;n.set(e,i+1),this.frameNumberMap.set(t,n)}deregister(t,e){const n=this.frameNumberMap.get(t);if(!n)return;const i=n.get(e)||1;n.set(e,i-1)}isZero(t,e){var n;return 0===((null===(n=this.frameNumberMap.get(t))||void 0===n?void 0:n.get(e))||0)}}class bA{constructor(){m(this,"_statusMap",void 0),m(this,"pendingTilesRegister",new yA),this._statusMap={}}add(t,e,n,i){if(!this._statusMap[e]){const{frameNumber:r,viewport:{id:s}}=i;this._statusMap[e]={request:t,callback:n,key:e,frameState:i,status:"REQUESTED"},this.pendingTilesRegister.register(s,r),t().then((t=>{this._statusMap[e].status="COMPLETED";const{frameNumber:n,viewport:{id:r}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(r,n),this._statusMap[e].callback(t,i)})).catch((t=>{this._statusMap[e].status="ERROR";const{frameNumber:i,viewport:{id:r}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(r,i),n(t)}))}}update(t,e){if(this._statusMap[t]){const{frameNumber:n,viewport:{id:i}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(i,n);const{frameNumber:r,viewport:{id:s}}=e;this.pendingTilesRegister.register(s,r),this._statusMap[t].frameState=e}}find(t){return this._statusMap[t]}hasPendingTiles(t,e){return!this.pendingTilesRegister.isZero(t,e)}}class _A extends pA{constructor(t){super(t),m(this,"_tileManager",void 0),this._tileManager=new bA}traversalFinished(t){return!this._tileManager.hasPendingTiles(t.viewport.id,this._frameNumber||0)}shouldRefine(t,e){return t._lodJudge=function(t,e){if(0===t.lodMetricValue||isNaN(t.lodMetricValue))return"DIG";const n=2*hA(t,e);return n<2?"OUT":!t.header.children||n<=t.lodMetricValue?"DRAW":t.header.children?"DIG":"OUT"}(t,e),"DIG"===t._lodJudge}updateChildTiles(t,e){const n=t.header.children||[],i=t.children,r=t.tileset;for(const s of n){const n="".concat(s.id,"-").concat(e.viewport.id),o=i&&i.find((t=>t.id===n));if(o)o&&this.updateTile(o,e);else{let i=()=>this._loadTile(s.id,r);this._tileManager.find(n)?this._tileManager.update(n,e):(r.tileset.nodePages&&(i=()=>r.tileset.nodePagesTile.formTileFromNodePages(s.id)),this._tileManager.add(i,n,(e=>this._onTileLoad(e,t,n)),e))}}return!1}async _loadTile(t,e){const{loader:n}=e,i=e.getTileUrl("".concat(e.url,"/nodes/").concat(t)),r={...e.loadOptions,i3s:{...e.loadOptions.i3s,isTileHeader:!0}};return await qe(i,n,r)}_onTileLoad(t,e,n){const i=new mA(e.tileset,t,e,n);e.children.push(i);const r=this._tileManager.find(i.id).frameState;this.updateTile(i,r),this._frameNumber===r.frameNumber&&(this.traversalFinished(r)||(new Date).getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(i,r)}}const AA={description:"",ellipsoid:qb.WGS84,modelMatrix:new ri,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:t=>t,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},wA="Tiles In Tileset(s)",CA="Tiles In Memory",EA="Tiles In View",xA="Tiles To Render",TA="Tiles Loaded",SA="Tiles Loading",BA="Tiles Unloaded",PA="Failed Tile Loads",MA="Points/Vertices",IA="Tile Memory Use";class LA{constructor(t,e){m(this,"options",void 0),m(this,"loadOptions",void 0),m(this,"type",void 0),m(this,"tileset",void 0),m(this,"loader",void 0),m(this,"url",void 0),m(this,"basePath",void 0),m(this,"modelMatrix",void 0),m(this,"ellipsoid",void 0),m(this,"lodMetricType",void 0),m(this,"lodMetricValue",void 0),m(this,"refine",void 0),m(this,"root",null),m(this,"roots",{}),m(this,"asset",{}),m(this,"description",""),m(this,"properties",void 0),m(this,"extras",null),m(this,"attributions",{}),m(this,"credits",{}),m(this,"stats",void 0),m(this,"contentFormats",{draco:!1,meshopt:!1,dds:!1,ktx2:!1}),m(this,"cartographicCenter",null),m(this,"cartesianCenter",null),m(this,"zoom",1),m(this,"boundingVolume",null),m(this,"dynamicScreenSpaceErrorComputedDensity",0),m(this,"maximumMemoryUsage",32),m(this,"gpuMemoryUsageInBytes",0),m(this,"_frameNumber",0),m(this,"_queryParams",{}),m(this,"_extensionsUsed",[]),m(this,"_tiles",{}),m(this,"_pendingCount",0),m(this,"selectedTiles",[]),m(this,"traverseCounter",0),m(this,"geometricError",0),m(this,"lastUpdatedVieports",null),m(this,"_requestedTiles",[]),m(this,"_emptyTiles",[]),m(this,"frameStateData",{}),m(this,"_traverser",void 0),m(this,"_cache",new e_),m(this,"_requestScheduler",void 0),m(this,"updatePromise",null),m(this,"tilesetInitializationPromise",void 0),this.options={...AA,...e},this.tileset=t,this.loader=t.loader,this.type=t.type,this.url=t.url,this.basePath=t.basePath||Re(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=t.lodMetricType,this.lodMetricValue=t.lodMetricValue,this.refine=t.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new Zb({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.stats=new Qb({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(t)}destroy(){this._destroy()}isLoaded(){return 0===this._pendingCount&&0!==this._frameNumber&&0===this._requestedTiles.length}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(t){this.options={...this.options,...t}}setOptions(t){this.options={...this.options,...t}}getTileUrl(t){return t.startsWith("data:")?t:"".concat(t).concat(t.includes("?")?"&":"?").concat(this.queryParams)}hasExtension(t){return Boolean(this._extensionsUsed.indexOf(t)>-1)}update(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.tilesetInitializationPromise.then((()=>{!t&&this.lastUpdatedVieports?t=this.lastUpdatedVieports:this.lastUpdatedVieports=t,t&&this.doUpdate(t)}))}async selectTiles(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return await this.tilesetInitializationPromise,t&&(this.lastUpdatedVieports=t),this.updatePromise||(this.updatePromise=new Promise((t=>{setTimeout((()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),t(this._frameNumber),this.updatePromise=null}),this.options.debounceTime)}))),this.updatePromise}doUpdate(t){if("loadTiles"in this.options&&!this.options.loadTiles)return;if(this.traverseCounter>0)return;const e=t instanceof Array?t:[t];this._cache.reset(),this._frameNumber++,this.traverseCounter=e.length;const n=[];for(const t of e){const e=t.id;this._needTraverse(e)?n.push(e):this.traverseCounter--}for(const t of e){const e=t.id;if(this.roots[e]||(this.roots[e]=this._initializeTileHeaders(this.tileset,null)),!n.includes(e))continue;const i=U_(t,this._frameNumber);this._traverser.traverse(this.roots[e],i,this.options)}}_needTraverse(t){let e=t;return this.options.viewportTraversersMap&&(e=this.options.viewportTraversersMap[t]),e===t}_onTraversalEnd(t){const e=t.viewport.id;this.frameStateData[e]||(this.frameStateData[e]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const n=this.frameStateData[e],i=Object.values(this._traverser.selectedTiles),[r,s]=function(t,e,n){if(0===n||t.length<=n)return[t,[]];const i=[],{longitude:r,latitude:s}=e.viewport;for(const[e,n]of t.entries()){const[t,o]=n.header.mbs,a=Math.abs(r-t),l=Math.abs(s-o),c=Math.sqrt(l*l+a*a);i.push([e,c])}const o=i.sort(((t,e)=>t[1]-e[1])),a=[];for(let e=0;e<n;e++)a.push(t[o[e][0]]);const l=[];for(let e=n;e<o.length;e++)l.push(t[o[e][0]]);return[a,l]}(i,t,this.options.maximumTilesSelected);n.selectedTiles=r;for(const t of s)t.unselect();n._requestedTiles=Object.values(this._traverser.requestedTiles),n._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,this.traverseCounter>0||this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const t in this.frameStateData){const e=this.frameStateData[t];this.selectedTiles=this.selectedTiles.concat(e.selectedTiles),this._requestedTiles=this._requestedTiles.concat(e._requestedTiles),this._emptyTiles=this._emptyTiles.concat(e._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const t of this.selectedTiles)this._tiles[t.id]=t;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(t,e){if(t.length!==e.length)return!0;const n=new Set(t.map((t=>t.id))),i=new Set(e.map((t=>t.id)));let r=t.filter((t=>!i.has(t.id))).length>0;return r=r||e.filter((t=>!n.has(t.id))).length>0,r}_loadTiles(){for(const t of this._requestedTiles)t.contentUnloaded&&this._loadTile(t)}_unloadTiles(){this._cache.unloadTiles(this,((t,e)=>t._unloadTile(e)))}_updateStats(){let t=0,e=0;for(const n of this.selectedTiles)n.contentAvailable&&n.content&&(t++,n.content.pointCount?e+=n.content.pointCount:e+=n.content.vertexCount);this.stats.get(EA).count=this.selectedTiles.length,this.stats.get(xA).count=t,this.stats.get(MA).count=e}async _initializeTileSet(t){this.type===q_&&(this.calculateViewPropsI3S(),t.root=await t.root),this.root=this._initializeTileHeaders(t,null),this.type===K_&&(this._initializeTiles3DTileset(t),this.calculateViewPropsTiles3D()),this.type===q_&&this._initializeI3STileset()}calculateViewPropsI3S(){var t;const e=this.tileset.fullExtent;if(e){const{xmin:t,xmax:n,ymin:i,ymax:r,zmin:s,zmax:o}=e;return this.cartographicCenter=new In(t+(n-t)/2,i+(r-i)/2,s+(o-s)/2),this.cartesianCenter=qb.WGS84.cartographicToCartesian(this.cartographicCenter,new In),void(this.zoom=H_(e,this.cartographicCenter,this.cartesianCenter))}const n=null===(t=this.tileset.store)||void 0===t?void 0:t.extent;if(n){const[t,e,i,r]=n;return this.cartographicCenter=new In(t+(i-t)/2,e+(r-e)/2,0),this.cartesianCenter=qb.WGS84.cartographicToCartesian(this.cartographicCenter,new In),void(this.zoom=function(t,e,n){const[i,r,s,o]=t;return H_({xmin:i,xmax:s,ymin:r,ymax:o,zmin:0,zmax:0},e,n)}(n,this.cartographicCenter,this.cartesianCenter))}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new In,this.zoom=1}calculateViewPropsTiles3D(){const t=this.root,{center:e}=t.boundingVolume;if(!e)return console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new In,void(this.zoom=1);0!==e[0]||0!==e[1]||0!==e[2]?this.cartographicCenter=qb.WGS84.cartesianToCartographic(e,new In):this.cartographicCenter=new In(0,0,-qb.WGS84.radii[0]),this.cartesianCenter=e,this.zoom=function(t,e){if(t instanceof d_){const{halfAxes:n}=t,i=function(t){t.getColumn(0,V_);const e=t.getColumn(1),n=t.getColumn(2);return V_.add(e).add(n).len()}(n);return Math.log2(j_/(i+e[2]))}if(t instanceof r_){const{radius:n}=t;return Math.log2(j_/(n+e[2]))}if(t.width&&t.height){const{width:e,height:n}=t;return(Math.log2(6378137/e)+Math.log2(6378137/n))/2}return 1}(t.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(wA),this.stats.get(SA),this.stats.get(CA),this.stats.get(EA),this.stats.get(xA),this.stats.get(TA),this.stats.get(BA),this.stats.get(PA),this.stats.get(MA),this.stats.get(IA,"memory")}_initializeTileHeaders(t,e){const n=new mA(this,t.root,e);if(e&&(e.children.push(n),n.depth=e.depth+1),this.type===K_){const t=[];for(t.push(n);t.length>0;){const e=t.pop();this.stats.get(wA).incrementCount();const n=e.header.children||[];for(const r of n){var i;const n=new mA(this,r,e);if(null!==(i=n.contentUrl)&&void 0!==i&&i.includes("?session=")){const t=new URL(n.contentUrl).searchParams.get("session");t&&(this._queryParams.session=t)}e.children.push(n),n.depth=e.depth+1,t.push(n)}}}return n}_initializeTraverser(){let t;switch(this.type){case K_:t=vA;break;case q_:t=_A;break;default:t=pA}return new t({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(t){this._destroySubtree(t)}async _loadTile(t){let e;try{this._onStartTileLoading(),e=await t.loadContent()}catch(e){this._onTileLoadError(t,e instanceof Error?e:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(t,e)}}_onTileLoadError(t,e){this.stats.get(PA).incrementCount();const n=e.message||e.toString(),i=t.url;console.error("A 3D tile failed to load: ".concat(t.url," ").concat(n)),this.options.onTileError(t,n,i)}_onTileLoad(t,e){if(e){if(this.type===q_){var n,i;const t=(null===(n=this.tileset)||void 0===n||null===(i=n.nodePagesTile)||void 0===i?void 0:i.nodesInNodePages)||0;this.stats.get(wA).reset(),this.stats.get(wA).addCount(t)}t&&t.content&&function(t,e){dt(t),dt(e);const{rtcCenter:n,gltfUpAxis:i}=e,{computedTransform:r,boundingVolume:{center:s}}=t;let o=new ri(r);switch(n&&o.translate(n),i){case"Z":default:break;case"Y":const t=(new ri).rotateX(Math.PI/2);o=o.multiplyRight(t);break;case"X":const e=(new ri).rotateY(-Math.PI/2);o=o.multiplyRight(e)}e.isQuantized&&o.translate(e.quantizedVolumeOffset).scale(e.quantizedVolumeScale);const a=new In(s);e.cartesianModelMatrix=o,e.cartesianOrigin=a;const l=qb.WGS84.cartesianToCartographic(a,new In),c=qb.WGS84.eastNorthUpToFixedFrame(a).invert();e.cartographicModelMatrix=c.multiplyRight(o),e.cartographicOrigin=l,e.coordinateSystem||(e.modelMatrix=e.cartographicModelMatrix)}(t,t.content),this.updateContentTypes(t),this._addTileToCache(t),this.options.onTileLoad(t)}}updateContentTypes(t){if(this.type===q_)switch(t.header.isDracoGeometry&&(this.contentFormats.draco=!0),t.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0}else if(this.type===K_){var e;const{extensionsRemoved:n=[]}=(null===(e=t.content)||void 0===e?void 0:e.gltf)||{};n.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),n.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),n.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(SA).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(SA).decrementCount()}_addTileToCache(t){this._cache.add(this,t,(e=>e._updateCacheStats(t)))}_updateCacheStats(t){this.stats.get(TA).incrementCount(),this.stats.get(CA).incrementCount(),this.gpuMemoryUsageInBytes+=t.gpuMemoryUsageInBytes||0,this.stats.get(IA).count=this.gpuMemoryUsageInBytes}_unloadTile(t){this.gpuMemoryUsageInBytes-=t.gpuMemoryUsageInBytes||0,this.stats.get(CA).decrementCount(),this.stats.get(BA).incrementCount(),this.stats.get(IA).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(t),t.unloadContent()}_destroy(){const t=[];for(this.root&&t.push(this.root);t.length>0;){const e=t.pop();for(const n of e.children)t.push(n);this._destroyTile(e)}this.root=null}_destroySubtree(t){const e=t,n=[];for(n.push(e);n.length>0;){t=n.pop();for(const e of t.children)n.push(e);t!==e&&this._destroyTile(t)}e.children=[]}_destroyTile(t){this._cache.unloadTile(this,t),this._unloadTile(t),t.destroy()}_initializeTiles3DTileset(t){if(t.queryString){const e=new URLSearchParams(t.queryString),n=Object.fromEntries(e.entries());this._queryParams={...this._queryParams,...n}}if(this.asset=t.asset,!this.asset)throw new Error("Tileset must have an asset property.");if("0.0"!==this.asset.version&&"1.0"!==this.asset.version)throw new Error("The tileset must be 3D Tiles version 0.0 or 1.0.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=t.properties,this.geometricError=t.geometricError,this._extensionsUsed=t.extensionsUsed||[],this.extras=t.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const OA="3.4.14",RA={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"};function FA(t,e,n){dt(t instanceof ArrayBuffer);const i=new TextDecoder("utf8"),r=new Uint8Array(t,e,n);return i.decode(r)}Object.keys(RA);const kA={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},DA={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,...kA},NA={[kA.DOUBLE]:Float64Array,[kA.FLOAT]:Float32Array,[kA.UNSIGNED_SHORT]:Uint16Array,[kA.UNSIGNED_INT]:Uint32Array,[kA.UNSIGNED_BYTE]:Uint8Array,[kA.BYTE]:Int8Array,[kA.SHORT]:Int16Array,[kA.INT]:Int32Array},UA={DOUBLE:kA.DOUBLE,FLOAT:kA.FLOAT,UNSIGNED_SHORT:kA.UNSIGNED_SHORT,UNSIGNED_INT:kA.UNSIGNED_INT,UNSIGNED_BYTE:kA.UNSIGNED_BYTE,BYTE:kA.BYTE,SHORT:kA.SHORT,INT:kA.INT},zA="Failed to convert GL type";class GA{static fromTypedArray(t){t=ArrayBuffer.isView(t)?t.constructor:t;for(const e in NA)if(NA[e]===t)return e;throw new Error(zA)}static fromName(t){const e=UA[t];if(!e)throw new Error(zA);return e}static getArrayType(t){switch(t){case kA.UNSIGNED_SHORT_5_6_5:case kA.UNSIGNED_SHORT_4_4_4_4:case kA.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const e=NA[t];if(!e)throw new Error(zA);return e}}static getByteSize(t){return GA.getArrayType(t).BYTES_PER_ELEMENT}static validate(t){return Boolean(GA.getArrayType(t))}static createTypedArray(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;return void 0===i&&(i=(e.byteLength-n)/GA.getByteSize(t)),new(GA.getArrayType(t))(e,n,i)}}class jA{constructor(t,e){m(this,"json",void 0),m(this,"buffer",void 0),m(this,"featuresLength",0),m(this,"_cachedTypedArrays",{}),this.json=t,this.buffer=e}getExtension(t){return this.json.extensions&&this.json.extensions[t]}hasProperty(t){return Boolean(this.json[t])}getGlobalProperty(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:DA.UNSIGNED_INT,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const i=this.json[t];return i&&Number.isFinite(i.byteOffset)?this._getTypedArrayFromBinary(t,e,n,1,i.byteOffset):i}getPropertyArray(t,e,n){const i=this.json[t];return i&&Number.isFinite(i.byteOffset)?("componentType"in i&&(e=GA.fromName(i.componentType)),this._getTypedArrayFromBinary(t,e,n,this.featuresLength,i.byteOffset)):this._getTypedArrayFromArray(t,e,i)}getProperty(t,e,n,i,r){const s=this.json[t];if(!s)return s;const o=this.getPropertyArray(t,e,n);if(1===n)return o[i];for(let t=0;t<n;++t)r[t]=o[n*i+t];return r}_getTypedArrayFromBinary(t,e,n,i,r){const s=this._cachedTypedArrays;let o=s[t];return o||(o=GA.createTypedArray(e,this.buffer.buffer,this.buffer.byteOffset+r,i*n),s[t]=o),o}_getTypedArrayFromArray(t,e,n){const i=this._cachedTypedArrays;let r=i[t];return r||(r=GA.createTypedArray(e,n),i[t]=r),r}}const VA={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},HA={SCALAR:(t,e)=>t[e],VEC2:(t,e)=>[t[2*e+0],t[2*e+1]],VEC3:(t,e)=>[t[3*e+0],t[3*e+1],t[3*e+2]],VEC4:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT2:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT3:(t,e)=>[t[9*e+0],t[9*e+1],t[9*e+2],t[9*e+3],t[9*e+4],t[9*e+5],t[9*e+6],t[9*e+7],t[9*e+8]],MAT4:(t,e)=>[t[16*e+0],t[16*e+1],t[16*e+2],t[16*e+3],t[16*e+4],t[16*e+5],t[16*e+6],t[16*e+7],t[16*e+8],t[16*e+9],t[16*e+10],t[16*e+11],t[16*e+12],t[16*e+13],t[16*e+14],t[16*e+15]]},WA={SCALAR:(t,e,n)=>{e[n]=t},VEC2:(t,e,n)=>{e[2*n+0]=t[0],e[2*n+1]=t[1]},VEC3:(t,e,n)=>{e[3*n+0]=t[0],e[3*n+1]=t[1],e[3*n+2]=t[2]},VEC4:(t,e,n)=>{e[4*n+0]=t[0],e[4*n+1]=t[1],e[4*n+2]=t[2],e[4*n+3]=t[3]},MAT2:(t,e,n)=>{e[4*n+0]=t[0],e[4*n+1]=t[1],e[4*n+2]=t[2],e[4*n+3]=t[3]},MAT3:(t,e,n)=>{e[9*n+0]=t[0],e[9*n+1]=t[1],e[9*n+2]=t[2],e[9*n+3]=t[3],e[9*n+4]=t[4],e[9*n+5]=t[5],e[9*n+6]=t[6],e[9*n+7]=t[7],e[9*n+8]=t[8],e[9*n+9]=t[9]},MAT4:(t,e,n)=>{e[16*n+0]=t[0],e[16*n+1]=t[1],e[16*n+2]=t[2],e[16*n+3]=t[3],e[16*n+4]=t[4],e[16*n+5]=t[5],e[16*n+6]=t[6],e[16*n+7]=t[7],e[16*n+8]=t[8],e[16*n+9]=t[9],e[16*n+10]=t[10],e[16*n+11]=t[11],e[16*n+12]=t[12],e[16*n+13]=t[13],e[16*n+14]=t[14],e[16*n+15]=t[15]}},JA=t=>void 0!==t;function qA(t,e,n){if(!t)return;const i=t.parentCounts;return t.parentIds?n(t,e):i>0?function(t,e,n){const i=t.classIds,r=t.parentCounts,s=t.parentIds,o=t.parentIndexes,a=i.length,l=scratchVisited;l.length=Math.max(l.length,a);const c=++marker,u=scratchStack;for(u.length=0,u.push(e);u.length>0;){if(l[e=u.pop()]===c)continue;l[e]=c;const i=n(t,e);if(JA(i))return i;const a=r[e],h=o[e];for(let t=0;t<a;++t){const n=s[h+t];n!==e&&u.push(n)}}return null}(t,e,n):function(t,e,n){let i=!0;for(;i;){const r=n(t,e);if(JA(r))return r;const s=t.parentIds[e];i=s!==e,e=s}throw new Error("traverseHierarchySingleParent")}(t,e,n)}function KA(t,e,n){const i=t.parentCounts,r=t.parentIds,s=t.parentIndexes,o=t.classIds.length;if(!JA(r))return;assert(e<o,"Parent index ".concat(e," exceeds the total number of instances: ").concat(o)),assert(-1===n.indexOf(e),"Circular dependency detected in the batch table hierarchy."),n.push(e);const a=JA(i)?i[e]:1,l=JA(i)?s[e]:e;for(let i=0;i<a;++i){const s=r[l+i];s!==e&&KA(t,s,n)}n.pop(e)}function XA(t){return null!=t}const QA=(t,e)=>t,YA={HIERARCHY:!0,extensions:!0,extras:!0};class ZA{constructor(t,e,n){var i;let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};m(this,"json",void 0),m(this,"binary",void 0),m(this,"featureCount",void 0),m(this,"_extensions",void 0),m(this,"_properties",void 0),m(this,"_binaryProperties",void 0),m(this,"_hierarchy",void 0),dt(n>=0),this.json=t||{},this.binary=e,this.featureCount=n,this._extensions=(null===(i=this.json)||void 0===i?void 0:i.extensions)||{},this._properties={};for(const t in this.json)YA[t]||(this._properties[t]=this.json[t]);this._binaryProperties=this._initializeBinaryProperties(),r["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=function(t,e,n){if(!e)return null;let i=t.getExtension("3DTILES_batch_table_hierarchy");const r=e.HIERARCHY;return r&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),e.extensions=e.extensions||{},e.extensions["3DTILES_batch_table_hierarchy"]=r,i=r),i?function(t,e){let n,i,r;const s=t.instancesLength,o=t.classes;let a,l=t.classIds,c=t.parentCounts,u=t.parentIds,h=s;if(JA(l.byteOffset)&&(l.componentType=defaultValue(l.componentType,GL.UNSIGNED_SHORT),l.type=AttributeType.SCALAR,r=getBinaryAccessor(l),l=r.createArrayBufferView(e.buffer,e.byteOffset+l.byteOffset,s)),JA(c))for(JA(c.byteOffset)&&(c.componentType=defaultValue(c.componentType,GL.UNSIGNED_SHORT),c.type=AttributeType.SCALAR,r=getBinaryAccessor(c),c=r.createArrayBufferView(e.buffer,e.byteOffset+c.byteOffset,s)),a=new Uint16Array(s),h=0,n=0;n<s;++n)a[n]=h,h+=c[n];JA(u)&&JA(u.byteOffset)&&(u.componentType=defaultValue(u.componentType,GL.UNSIGNED_SHORT),u.type=AttributeType.SCALAR,r=getBinaryAccessor(u),u=r.createArrayBufferView(e.buffer,e.byteOffset+u.byteOffset,h));const d=o.length;for(n=0;n<d;++n){const t=o[n].length,i=o[n].instances,r=getBinaryProperties(t,i,e);o[n].instances=combine(r,i)}const f=new Array(d).fill(0),p=new Uint16Array(s);for(n=0;n<s;++n)i=l[n],p[n]=f[i],++f[i];const g={classes:o,classIds:l,classIndexes:p,parentCounts:c,parentIndexes:a,parentIds:u};return function(t){const e=t.classIds.length;for(let n=0;n<e;++n)KA(t,n,stack)}(g),g}(i,n):null}(this,this.json,this.binary))}getExtension(t){return this.json&&this.json.extensions&&this.json.extensions[t]}memorySizeInBytes(){return 0}isClass(t,e){return this._checkBatchId(t),dt("string"==typeof e,e),!!this._hierarchy&&XA(qA(this._hierarchy,t,((t,n)=>{const i=t.classIds[n];return t.classes[i].name===e})))}isExactClass(t,e){return dt("string"==typeof e,e),this.getExactClassName(t)===e}getExactClassName(t){if(this._checkBatchId(t),this._hierarchy){const e=this._hierarchy.classIds[t];return this._hierarchy.classes[e].name}}hasProperty(t,e){return this._checkBatchId(t),dt("string"==typeof e,e),XA(this._properties[e])||this._hasPropertyInHierarchy(t,e)}getPropertyNames(t,e){this._checkBatchId(t),(e=XA(e)?e:[]).length=0;const n=Object.keys(this._properties);return e.push(...n),this._hierarchy&&this._getPropertyNamesInHierarchy(t,e),e}getProperty(t,e){if(this._checkBatchId(t),dt("string"==typeof e,e),this._binaryProperties){const n=this._binaryProperties[e];if(XA(n))return this._getBinaryProperty(n,t)}const n=this._properties[e];if(XA(n))return QA(n[t]);if(this._hierarchy){const n=this._getHierarchyProperty(t,e);if(XA(n))return n}}setProperty(t,e,n){const i=this.featureCount;if(this._checkBatchId(t),dt("string"==typeof e,e),this._binaryProperties){const i=this._binaryProperties[e];if(i)return void this._setBinaryProperty(i,t,n)}if(this._hierarchy&&this._setHierarchyProperty(this,t,e,n))return;let r=this._properties[e];XA(r)||(this._properties[e]=new Array(i),r=this._properties[e]),r[t]=QA(n)}_checkBatchId(t){if(!(t>=0&&t<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(t,e){return t.unpack(t.typedArray,e)}_setBinaryProperty(t,e,n){t.pack(n,t.typedArray,e)}_initializeBinaryProperties(){let t=null;for(const e in this._properties){const n=this._properties[e],i=this._initializeBinaryProperty(e,n);i&&(t=t||{},t[e]=i)}return t}_initializeBinaryProperty(t,e){if("byteOffset"in e){const n=e;dt(this.binary,"Property ".concat(t," requires a batch table binary.")),dt(n.type,"Property ".concat(t," requires a type."));const i=function(t,e,n,i){const{componentType:r}=t;dt(t.componentType);const s="string"==typeof r?GA.fromName(r):r,o=VA[t.type],a=HA[t.type],l=WA[t.type];return n+=t.byteOffset,{values:GA.createTypedArray(s,e,n,o*i),type:s,size:o,unpacker:a,packer:l}}(n,this.binary.buffer,0|this.binary.byteOffset,this.featureCount);return{typedArray:i.values,componentCount:i.size,unpack:i.unpacker,pack:i.packer}}return null}_hasPropertyInHierarchy(t,e){if(!this._hierarchy)return!1;const n=qA(this._hierarchy,t,((t,n)=>{const i=t.classIds[n];return XA(t.classes[i].instances[e])}));return XA(n)}_getPropertyNamesInHierarchy(t,e){qA(this._hierarchy,t,((t,n)=>{const i=t.classIds[n],r=t.classes[i].instances;for(const t in r)r.hasOwnProperty(t)&&-1===e.indexOf(t)&&e.push(t)}))}_getHierarchyProperty(t,e){return qA(this._hierarchy,t,((t,n)=>{const i=t.classIds[n],r=t.classes[i],s=t.classIndexes[n],o=r.instances[e];return XA(o)?XA(o.typedArray)?this._getBinaryProperty(o,s):QA(o[s]):null}))}_setHierarchyProperty(t,e,n,i){const r=qA(this._hierarchy,e,((t,r)=>{const s=t.classIds[r],o=t.classes[s],a=t.classIndexes[r],l=o.instances[n];return!!XA(l)&&(dt(r===e,'Inherited property "'.concat(n,'" is read-only.')),XA(l.typedArray)?this._setBinaryProperty(l,a,i):l[a]=QA(i),!0)}));return XA(r)}}const $A=4;function tw(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i=new DataView(e);if(t.magic=i.getUint32(n,!0),n+=$A,t.version=i.getUint32(n,!0),n+=$A,t.byteLength=i.getUint32(n,!0),n+=$A,1!==t.version)throw new Error("3D Tile Version ".concat(t.version," not supported"));return n}const ew=4,nw="b3dm tile in legacy format.";function iw(t,e,n){const i=new DataView(e);let r;t.header=t.header||{};let s=i.getUint32(n,!0);n+=ew;let o=i.getUint32(n,!0);n+=ew;let a=i.getUint32(n,!0);n+=ew;let l=i.getUint32(n,!0);return n+=ew,a>=570425344?(n-=2*ew,r=s,a=o,l=0,s=0,o=0,console.warn(nw)):l>=570425344&&(n-=ew,r=a,a=s,l=o,s=0,o=0,console.warn(nw)),t.header.featureTableJsonByteLength=s,t.header.featureTableBinaryByteLength=o,t.header.batchTableJsonByteLength=a,t.header.batchTableBinaryByteLength=l,t.header.batchLength=r,n}function rw(t,e,n,i){return n=function(t,e,n,i){const{featureTableJsonByteLength:r,featureTableBinaryByteLength:s,batchLength:o}=t.header;if(t.featureTableJson={BATCH_LENGTH:o||0},r>0){const i=FA(e,n,r);t.featureTableJson=JSON.parse(i)}return n+=r,t.featureTableBinary=new Uint8Array(e,n,s),n+=s}(t,e,n),n=function(t,e,n,i){const{batchTableJsonByteLength:r,batchTableBinaryByteLength:s}=t.header;if(r>0){const i=FA(e,n,r);t.batchTableJson=JSON.parse(i),n+=r,s>0&&(t.batchTableBinary=new Uint8Array(e,n,s),t.batchTableBinary=new Uint8Array(t.batchTableBinary),n+=s)}return n}(t,e,n),n}function sw(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];const n=t>>11&31,i=t>>5&63,r=31&t;return e[0]=n<<3,e[1]=i<<2,e[2]=r<<3,e}function ow(t,e,n){if(!(e||t&&t.batchIds&&n))return null;const{batchIds:i,isRGB565:r,pointCount:s}=t;if(i&&n){const t=new Uint8ClampedArray(3*s);for(let e=0;e<s;e++){const r=i[e],s=n.getProperty(r,"dimensions").map((t=>255*t));t[3*e]=s[0],t[3*e+1]=s[1],t[3*e+2]=s[2]}return{type:DA.UNSIGNED_BYTE,value:t,size:3,normalized:!0}}if(r){const t=new Uint8ClampedArray(3*s);for(let n=0;n<s;n++){const i=sw(e[n]);t[3*n]=i[0],t[3*n+1]=i[1],t[3*n+2]=i[2]}return{type:DA.UNSIGNED_BYTE,value:t,size:3,normalized:!0}}return e&&e.length===3*s?{type:DA.UNSIGNED_BYTE,value:e,size:3,normalized:!0}:{type:DA.UNSIGNED_BYTE,value:e,size:4,normalized:!0}}class aw extends pn{constructor(t=0,e=0){super(2),en(t)&&1===arguments.length?this.copy(t):($e.debug&&(hn(t),hn(e)),this[0]=t,this[1]=e)}set(t,e){return this[0]=t,this[1]=e,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this.check()}fromObject(t){return $e.debug&&(hn(t.x),hn(t.y)),this[0]=t.x,this[1]=t.y,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return Qn(this,this,t),this.check()}transformAsVector(t){return Tn(this,this,t),this.check()}transformByMatrix3(t){return Xn(this,this,t),this.check()}transformByMatrix2x3(t){return function(t,e,n){var i=e[0],r=e[1];t[0]=n[0]*i+n[2]*r+n[4],t[1]=n[1]*i+n[3]*r+n[5]}(this,this,t),this.check()}transformByMatrix2(t){return function(t,e,n){var i=e[0],r=e[1];t[0]=n[0]*i+n[2]*r,t[1]=n[1]*i+n[3]*r}(this,this,t),this.check()}}function lw(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:255;return on(t,0,e)/e*2-1}function cw(t){return t<0?-1:1}function uw(t,e,n){return function(t,e,n,i){if(function(t,e){if(!t)throw new Error("math.gl assertion failed. ".concat(void 0))}(i),t<0||t>n||e<0||e>n)throw new Error("x and y must be unsigned normalized integers between 0 and ".concat(n));if(i.x=lw(t,n),i.y=lw(e,n),i.z=1-(Math.abs(i.x)+Math.abs(i.y)),i.z<0){const t=i.x;i.x=(1-Math.abs(i.y))*cw(t),i.y=(1-Math.abs(t))*cw(i.y)}return i.normalize()}(t,e,255,n)}new aw,new In,new aw,new aw,new Uint8Array(1);const hw=new In;async function dw(t,e,n,i,r){n=rw(t,e,n=iw(t,e,n=tw(t,e,n))),function(t){t.attributes={positions:null,colors:null,normals:null,batchIds:null},t.isQuantized=!1,t.isTranslucent=!1,t.isRGB565=!1,t.isOctEncoded16P=!1}(t);const{featureTable:s,batchTable:o}=function(t){const e=new jA(t.featureTableJson,t.featureTableBinary),n=e.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(n))throw new Error("POINTS_LENGTH must be defined");e.featuresLength=n,t.featuresLength=n,t.pointsLength=n,t.pointCount=n,t.rtcCenter=e.getGlobalProperty("RTC_CENTER",DA.FLOAT,3);const i=function(t,e){let n=null;if(!t.batchIds&&e.hasProperty("BATCH_ID")&&(t.batchIds=e.getPropertyArray("BATCH_ID",DA.UNSIGNED_SHORT,1),t.batchIds)){const i=e.getGlobalProperty("BATCH_LENGTH");if(!i)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:r,batchTableBinary:s}=t;n=new ZA(r,s,i)}return n}(t,e);return{featureTable:e,batchTable:i}}(t);return await async function(t,e,n,i,r){let s,o,a;const l=t.batchTableJson&&t.batchTableJson.extensions&&t.batchTableJson.extensions["3DTILES_draco_point_compression"];l&&(a=l.properties);const c=e.getExtension("3DTILES_draco_point_compression");if(c){o=c.properties;const e=c.byteOffset,n=c.byteLength;if(!o||!Number.isFinite(e)||!n)throw new Error("Draco properties, byteOffset, and byteLength must be defined");s=t.featureTableBinary.slice(e,e+n),t.hasPositions=Number.isFinite(o.POSITION),t.hasColors=Number.isFinite(o.RGB)||Number.isFinite(o.RGBA),t.hasNormals=Number.isFinite(o.NORMAL),t.hasBatchIds=Number.isFinite(o.BATCH_ID),t.isTranslucent=Number.isFinite(o.RGBA)}if(!s)return!0;const u={buffer:s,properties:{...o,...a},featureTableProperties:o,batchTableProperties:a,dequantizeInShader:!1};return await async function(t,e,n,i){const{parse:r}=i,s={...n,draco:{...n.draco,extraAttributes:e.batchTableProperties||{}}};delete s["3d-tiles"];const o=await r(e.buffer,Xv,s),a=o.attributes.POSITION&&o.attributes.POSITION.value,l=o.attributes.COLOR_0&&o.attributes.COLOR_0.value,c=o.attributes.NORMAL&&o.attributes.NORMAL.value,u=o.attributes.BATCH_ID&&o.attributes.BATCH_ID.value,h=a&&o.attributes.POSITION.value.quantization,d=c&&o.attributes.NORMAL.value.quantization;if(h){const e=o.POSITION.data.quantization,n=e.range;t.quantizedVolumeScale=new In(n,n,n),t.quantizedVolumeOffset=new In(e.minValues),t.quantizedRange=(1<<e.quantizationBits)-1,t.isQuantizedDraco=!0}d&&(t.octEncodedRange=(1<<o.NORMAL.data.quantization.quantizationBits)-1,t.isOctEncodedDraco=!0);const f={};if(e.batchTableProperties)for(const t of Object.keys(e.batchTableProperties))o.attributes[t]&&o.attributes[t].value&&(f[t.toLowerCase()]=o.attributes[t].value);t.attributes={positions:a,colors:ow(t,l,void 0),normals:c,batchIds:u,...f}}(t,u,i,r)}(t,s,0,i,r),function(t,e,n){if(!t.attributes.positions)if(e.hasProperty("POSITION"))t.attributes.positions=e.getPropertyArray("POSITION",DA.FLOAT,3);else if(e.hasProperty("POSITION_QUANTIZED")){const i=e.getPropertyArray("POSITION_QUANTIZED",DA.UNSIGNED_SHORT,3);if(t.isQuantized=!0,t.quantizedRange=65535,t.quantizedVolumeScale=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",DA.FLOAT,3),!t.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(t.quantizedVolumeOffset=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",DA.FLOAT,3),!t.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");t.attributes.positions=function(t,e,n){return t.isQuantized?n["3d-tiles"]&&n["3d-tiles"].decodeQuantizedPositions?(t.isQuantized=!1,function(t,e){const n=new In,i=new Float32Array(3*t.pointCount);for(let r=0;r<t.pointCount;r++)n.set(e[3*r],e[3*r+1],e[3*r+2]).scale(1/t.quantizedRange).multiply(t.quantizedVolumeScale).add(t.quantizedVolumeOffset).toArray(i,3*r);return i}(t,e)):{type:DA.UNSIGNED_SHORT,value:e,size:3,normalized:!0}:e}(t,i,n)}if(!t.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}(t,s,i),function(t,e,n){if(!t.attributes.colors){let i=null;e.hasProperty("RGBA")?(i=e.getPropertyArray("RGBA",DA.UNSIGNED_BYTE,4),t.isTranslucent=!0):e.hasProperty("RGB")?i=e.getPropertyArray("RGB",DA.UNSIGNED_BYTE,3):e.hasProperty("RGB565")&&(i=e.getPropertyArray("RGB565",DA.UNSIGNED_SHORT,1),t.isRGB565=!0),t.attributes.colors=ow(t,i,n)}e.hasProperty("CONSTANT_RGBA")&&(t.constantRGBA=e.getGlobalProperty("CONSTANT_RGBA",DA.UNSIGNED_BYTE,4))}(t,s,o),function(t,e){if(!t.attributes.normals){let n=null;e.hasProperty("NORMAL")?n=e.getPropertyArray("NORMAL",DA.FLOAT,3):e.hasProperty("NORMAL_OCT16P")&&(n=e.getPropertyArray("NORMAL_OCT16P",DA.UNSIGNED_BYTE,2),t.isOctEncoded16P=!0),t.attributes.normals=function(t,e){if(!e)return null;if(t.isOctEncoded16P){const n=new Float32Array(3*t.pointsLength);for(let i=0;i<t.pointsLength;i++)uw(e[2*i],e[2*i+1],hw),hw.toArray(n,3*i);return{type:DA.FLOAT,size:2,value:n}}return{type:DA.FLOAT,size:2,value:e}}(t,n)}}(t,s),n}const fw={URI:0,EMBEDDED:1};function pw(t,e,n,i){t.rotateYtoZ=!0;const r=t.byteOffset+t.byteLength-n;if(0===r)throw new Error("glTF byte length must be greater than 0.");return t.gltfUpAxis=i["3d-tiles"]&&i["3d-tiles"].assetGltfUpAxis?i["3d-tiles"].assetGltfUpAxis:"Y",t.gltfArrayBuffer=xe(e,n,r),t.gltfByteOffset=0,t.gltfByteLength=r,n%4==0||console.warn("".concat(t.type,": embedded glb is not aligned to a 4-byte boundary.")),t.byteOffset+t.byteLength}async function gw(t,e,n,i){const r=n["3d-tiles"]||{};if(function(t,e,n){switch(e){case fw.URI:const e=new Uint8Array(t.gltfArrayBuffer,t.gltfByteOffset),n=(new TextDecoder).decode(e);t.gltfUrl=n.replace(/[\s\0]+$/,""),delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength;break;case fw.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}(t,e),r.loadGLTF){const{parse:e,fetch:r}=i;t.gltfUrl&&(t.gltfArrayBuffer=await r(t.gltfUrl,n),t.gltfByteOffset=0),t.gltfArrayBuffer&&(t.gltf=await e(t.gltfArrayBuffer,ub,n,i),t.gpuMemoryUsageInBytes=Vm(t.gltf),delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength)}}async function mw(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};switch(r.byteOffset=e,r.type=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=new DataView(t);return"".concat(String.fromCharCode(n.getUint8(e+0))).concat(String.fromCharCode(n.getUint8(e+1))).concat(String.fromCharCode(n.getUint8(e+2))).concat(String.fromCharCode(n.getUint8(e+3)))}(t,e),r.type){case RA.COMPOSITE:return await async function(t,e,n,i,r,s){n=tw(t,e,n);const o=new DataView(e);for(t.tilesLength=o.getUint32(n,!0),n+=4,t.tiles=[];t.tiles.length<t.tilesLength&&t.byteLength-n>12;){const o={};t.tiles.push(o),n=await s(e,n,i,r,o)}return n}(r,t,e,n,i,mw);case RA.BATCHED_3D_MODEL:return await async function(t,e,n,i,r){var s;n=function(t,e,n,i,r){n=pw(t,e,n=rw(t,e,n=iw(t,e,n=tw(t,e,n))),i);const s=new jA(t.featureTableJson,t.featureTableBinary);return t.rtcCenter=s.getGlobalProperty("RTC_CENTER",DA.FLOAT,3),n}(t,e,n,i),await gw(t,fw.EMBEDDED,i,r);const o=null==t||null===(s=t.gltf)||void 0===s?void 0:s.extensions;return o&&o.CESIUM_RTC&&(t.rtcCenter=o.CESIUM_RTC.center),n}(r,t,e,n,i);case RA.GLTF:return await async function(t,e,n,i){t.rotateYtoZ=!0,t.gltfUpAxis=n["3d-tiles"]&&n["3d-tiles"].assetGltfUpAxis?n["3d-tiles"].assetGltfUpAxis:"Y";const{parse:r}=i;t.gltf=await r(e,ub,n,i),t.gpuMemoryUsageInBytes=Vm(t.gltf)}(r,t,n,i);case RA.INSTANCED_3D_MODEL:return await async function(t,e,n,i,r){return n=function(t,e,n,i,r){if(n=tw(t,e,n),1!==t.version)throw new Error("Instanced 3D Model version ".concat(t.version," is not supported"));n=iw(t,e,n);const s=new DataView(e);if(t.gltfFormat=s.getUint32(n,!0),n=pw(t,e,n=rw(t,e,n+=4),i),0===t.featureTableJsonByteLength)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const o=new jA(t.featureTableJson,t.featureTableBinary),a=o.getGlobalProperty("INSTANCES_LENGTH");if(o.featuresLength=a,!Number.isFinite(a))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");return t.eastNorthUp=o.getGlobalProperty("EAST_NORTH_UP"),t.rtcCenter=o.getGlobalProperty("RTC_CENTER",DA.FLOAT,3),new ZA(t.batchTableJson,t.batchTableBinary,a),function(t,e,n,i){const r=[new Array(i),t._batchTable][0],s=new In,o=new In,a=new In,l=new In,c=new ay,u=new Rg,h=new In,d={},f=new ri,p=[],g=[],m=new In,v=new In;for(let n=0;n<i;n++){let i;if(e.hasProperty("POSITION"))i=e.getProperty("POSITION",DA.FLOAT,3,n,s);else if(e.hasProperty("POSITION_QUANTIZED")){i=e.getProperty("POSITION_QUANTIZED",DA.UNSIGNED_SHORT,3,n,s);const t=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",DA.FLOAT,3,m);if(!t)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const r=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",DA.FLOAT,3,v);if(!r)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const o=65535;for(let e=0;e<3;e++)i[e]=i[e]/o*r[e]+t[e]}if(!i)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");s.copy(i),d.translation=s,t.normalUp=e.getProperty("NORMAL_UP",DA.FLOAT,3,n,p),t.normalRight=e.getProperty("NORMAL_RIGHT",DA.FLOAT,3,n,g);const y=!1;if(t.normalUp){if(!t.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");t.hasCustomOrientation=!0}else{if(t.octNormalUp=e.getProperty("NORMAL_UP_OCT32P",DA.UNSIGNED_SHORT,2,p),t.octNormalRight=e.getProperty("NORMAL_RIGHT_OCT32P",DA.UNSIGNED_SHORT,2,g),t.octNormalUp){if(!t.octNormalRight)throw new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");throw new Error("i3dm: oct-encoded orientation not implemented")}t.eastNorthUp?(qb.WGS84.eastNorthUpToFixedFrame(s,f),f.getRotationMatrix3(c)):c.identity()}y&&(l.copy(o).cross(a).normalize(),c.setColumn(0,o),c.setColumn(1,a),c.setColumn(2,l)),u.fromMatrix3(c),d.rotation=u,h.set(1,1,1);const b=e.getProperty("SCALE",DA.FLOAT,1,n);Number.isFinite(b)&&h.multiplyByScalar(b);const _=e.getProperty("SCALE_NON_UNIFORM",DA.FLOAT,3,n,p);_&&h.scale(_),d.scale=h;let A=e.getProperty("BATCH_ID",DA.UNSIGNED_SHORT,1,n);void 0===A&&(A=n);const w=(new ri).fromQuaternion(d.rotation);f.identity(),f.translate(d.translation),f.multiplyRight(w),f.scale(d.scale);const C=f.clone();r[n]={modelMatrix:C,batchId:A}}t.instances=r}(t,o,0,a),n}(t,e,n,i),await gw(t,t.gltfFormat,i,r),n}(r,t,e,n,i);case RA.POINT_CLOUD:return await dw(r,t,e,n,i);default:throw new Error("3DTileLoader: unknown type ".concat(r.type))}}async function vw(t,e,n,i){const r=t[e].bufferView,s=t.bufferViews[r],o=t.buffers[s.buffer];if(null==i||!i.url||!i.fetch)throw new Error("Url is not provided");if(!i.fetch)throw new Error("fetch is not provided");if(o.uri){const t=function(t,e){if(e.startsWith("http")){const n=new URL(t,e);return decodeURI(n.toString())}const n="http://".concat(e),i=new URL(t,n);return"/".concat(i.host).concat(i.pathname)}(o.uri,null==i?void 0:i.url),e=await i.fetch(t),n=await e.arrayBuffer();return new Uint8Array(n,s.byteOffset,s.byteLength)}return new Uint8Array(n,s.byteOffset,s.byteLength)}function yw(t){const e=new DataView(t);return e.getUint32(0,!0)+2**32*e.getUint32(4,!0)}const bw={id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:OA,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:async function(t,e,n){if(1952609651!==new Uint32Array(t.slice(0,4))[0])throw new Error("Wrong subtree file magic number");if(1!==new Uint32Array(t.slice(4,8))[0])throw new Error("Wrong subtree file verson, must be 1");const i=yw(t.slice(8,16)),r=new Uint8Array(t,24,i),s=new TextDecoder("utf8").decode(r),o=JSON.parse(s),a=yw(t.slice(16,24));let l=new ArrayBuffer(0);return a&&(l=t.slice(24+i)),"bufferView"in o.tileAvailability&&(o.tileAvailability.explicitBitstream=await vw(o,"tileAvailability",l,n)),"bufferView"in o.contentAvailability&&(o.contentAvailability.explicitBitstream=await vw(o,"contentAvailability",l,n)),"bufferView"in o.childSubtreeAvailability&&(o.childSubtreeAvailability.explicitBitstream=await vw(o,"childSubtreeAvailability",l,n)),o},options:{}};var _w=null;try{_w=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(vh){}function Aw(t,e,n){this.low=0|t,this.high=0|e,this.unsigned=!!n}function ww(t){return!0===(t&&t.__isLong__)}function Cw(t){var e=Math.clz32(t&-t);return t?31-e:e}Aw.prototype.__isLong__,Object.defineProperty(Aw.prototype,"__isLong__",{value:!0}),Aw.isLong=ww;var Ew={},xw={};function Tw(t,e){var n,i,r;return e?(r=0<=(t>>>=0)&&t<256)&&(i=xw[t])?i:(n=Bw(t,0,!0),r&&(xw[t]=n),n):(r=-128<=(t|=0)&&t<128)&&(i=Ew[t])?i:(n=Bw(t,t<0?-1:0,!1),r&&(Ew[t]=n),n)}function Sw(t,e){if(isNaN(t))return e?Dw:kw;if(e){if(t<0)return Dw;if(t>=Ow)return jw}else{if(t<=-Rw)return Vw;if(t+1>=Rw)return Gw}return t<0?Sw(-t,e).neg():Bw(t%Lw|0,t/Lw|0,e)}function Bw(t,e,n){return new Aw(t,e,n)}Aw.fromInt=Tw,Aw.fromNumber=Sw,Aw.fromBits=Bw;var Pw=Math.pow;function Mw(t,e,n){if(0===t.length)throw Error("empty string");if("number"==typeof e?(n=e,e=!1):e=!!e,"NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return e?Dw:kw;if((n=n||10)<2||36<n)throw RangeError("radix");var i;if((i=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===i)return Mw(t.substring(1),e,n).neg();for(var r=Sw(Pw(n,8)),s=kw,o=0;o<t.length;o+=8){var a=Math.min(8,t.length-o),l=parseInt(t.substring(o,o+a),n);if(a<8){var c=Sw(Pw(n,a));s=s.mul(c).add(Sw(l))}else s=(s=s.mul(r)).add(Sw(l))}return s.unsigned=e,s}function Iw(t,e){return"number"==typeof t?Sw(t,e):"string"==typeof t?Mw(t,e):Bw(t.low,t.high,"boolean"==typeof e?e:t.unsigned)}Aw.fromString=Mw,Aw.fromValue=Iw;var Lw=4294967296,Ow=Lw*Lw,Rw=Ow/2,Fw=Tw(1<<24),kw=Tw(0);Aw.ZERO=kw;var Dw=Tw(0,!0);Aw.UZERO=Dw;var Nw=Tw(1);Aw.ONE=Nw;var Uw=Tw(1,!0);Aw.UONE=Uw;var zw=Tw(-1);Aw.NEG_ONE=zw;var Gw=Bw(-1,2147483647,!1);Aw.MAX_VALUE=Gw;var jw=Bw(-1,-1,!0);Aw.MAX_UNSIGNED_VALUE=jw;var Vw=Bw(0,-2147483648,!1);Aw.MIN_VALUE=Vw;var Hw=Aw.prototype;Hw.toInt=function(){return this.unsigned?this.low>>>0:this.low},Hw.toNumber=function(){return this.unsigned?(this.high>>>0)*Lw+(this.low>>>0):this.high*Lw+(this.low>>>0)},Hw.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(Vw)){var e=Sw(t),n=this.div(e),i=n.mul(e).sub(this);return n.toString(t)+i.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var r=Sw(Pw(t,6),this.unsigned),s=this,o="";;){var a=s.div(r),l=(s.sub(a.mul(r)).toInt()>>>0).toString(t);if((s=a).isZero())return l+o;for(;l.length<6;)l="0"+l;o=""+l+o}},Hw.getHighBits=function(){return this.high},Hw.getHighBitsUnsigned=function(){return this.high>>>0},Hw.getLowBits=function(){return this.low},Hw.getLowBitsUnsigned=function(){return this.low>>>0},Hw.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Vw)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;e>0&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},Hw.isZero=function(){return 0===this.high&&0===this.low},Hw.eqz=Hw.isZero,Hw.isNegative=function(){return!this.unsigned&&this.high<0},Hw.isPositive=function(){return this.unsigned||this.high>=0},Hw.isOdd=function(){return 1==(1&this.low)},Hw.isEven=function(){return 0==(1&this.low)},Hw.equals=function(t){return ww(t)||(t=Iw(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&this.high===t.high&&this.low===t.low},Hw.eq=Hw.equals,Hw.notEquals=function(t){return!this.eq(t)},Hw.neq=Hw.notEquals,Hw.ne=Hw.notEquals,Hw.lessThan=function(t){return this.comp(t)<0},Hw.lt=Hw.lessThan,Hw.lessThanOrEqual=function(t){return this.comp(t)<=0},Hw.lte=Hw.lessThanOrEqual,Hw.le=Hw.lessThanOrEqual,Hw.greaterThan=function(t){return this.comp(t)>0},Hw.gt=Hw.greaterThan,Hw.greaterThanOrEqual=function(t){return this.comp(t)>=0},Hw.gte=Hw.greaterThanOrEqual,Hw.ge=Hw.greaterThanOrEqual,Hw.compare=function(t){if(ww(t)||(t=Iw(t)),this.eq(t))return 0;var e=this.isNegative(),n=t.isNegative();return e&&!n?-1:!e&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},Hw.comp=Hw.compare,Hw.negate=function(){return!this.unsigned&&this.eq(Vw)?Vw:this.not().add(Nw)},Hw.neg=Hw.negate,Hw.add=function(t){ww(t)||(t=Iw(t));var e=this.high>>>16,n=65535&this.high,i=this.low>>>16,r=65535&this.low,s=t.high>>>16,o=65535&t.high,a=t.low>>>16,l=0,c=0,u=0,h=0;return u+=(h+=r+(65535&t.low))>>>16,c+=(u+=i+a)>>>16,l+=(c+=n+o)>>>16,l+=e+s,Bw((u&=65535)<<16|(h&=65535),(l&=65535)<<16|(c&=65535),this.unsigned)},Hw.subtract=function(t){return ww(t)||(t=Iw(t)),this.add(t.neg())},Hw.sub=Hw.subtract,Hw.multiply=function(t){if(this.isZero())return this;if(ww(t)||(t=Iw(t)),_w)return Bw(_w.mul(this.low,this.high,t.low,t.high),_w.get_high(),this.unsigned);if(t.isZero())return this.unsigned?Dw:kw;if(this.eq(Vw))return t.isOdd()?Vw:kw;if(t.eq(Vw))return this.isOdd()?Vw:kw;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(Fw)&&t.lt(Fw))return Sw(this.toNumber()*t.toNumber(),this.unsigned);var e=this.high>>>16,n=65535&this.high,i=this.low>>>16,r=65535&this.low,s=t.high>>>16,o=65535&t.high,a=t.low>>>16,l=65535&t.low,c=0,u=0,h=0,d=0;return h+=(d+=r*l)>>>16,u+=(h+=i*l)>>>16,h&=65535,u+=(h+=r*a)>>>16,c+=(u+=n*l)>>>16,u&=65535,c+=(u+=i*a)>>>16,u&=65535,c+=(u+=r*o)>>>16,c+=e*l+n*a+i*o+r*s,Bw((h&=65535)<<16|(d&=65535),(c&=65535)<<16|(u&=65535),this.unsigned)},Hw.mul=Hw.multiply,Hw.divide=function(t){if(ww(t)||(t=Iw(t)),t.isZero())throw Error("division by zero");var e,n,i;if(_w)return this.unsigned||-2147483648!==this.high||-1!==t.low||-1!==t.high?Bw((this.unsigned?_w.div_u:_w.div_s)(this.low,this.high,t.low,t.high),_w.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?Dw:kw;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return Dw;if(t.gt(this.shru(1)))return Uw;i=Dw}else{if(this.eq(Vw))return t.eq(Nw)||t.eq(zw)?Vw:t.eq(Vw)?Nw:(e=this.shr(1).div(t).shl(1)).eq(kw)?t.isNegative()?Nw:zw:(n=this.sub(t.mul(e)),i=e.add(n.div(t)));if(t.eq(Vw))return this.unsigned?Dw:kw;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();i=kw}for(n=this;n.gte(t);){e=Math.max(1,Math.floor(n.toNumber()/t.toNumber()));for(var r=Math.ceil(Math.log(e)/Math.LN2),s=r<=48?1:Pw(2,r-48),o=Sw(e),a=o.mul(t);a.isNegative()||a.gt(n);)a=(o=Sw(e-=s,this.unsigned)).mul(t);o.isZero()&&(o=Nw),i=i.add(o),n=n.sub(a)}return i},Hw.div=Hw.divide,Hw.modulo=function(t){return ww(t)||(t=Iw(t)),_w?Bw((this.unsigned?_w.rem_u:_w.rem_s)(this.low,this.high,t.low,t.high),_w.get_high(),this.unsigned):this.sub(this.div(t).mul(t))},Hw.mod=Hw.modulo,Hw.rem=Hw.modulo,Hw.not=function(){return Bw(~this.low,~this.high,this.unsigned)},Hw.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},Hw.clz=Hw.countLeadingZeros,Hw.countTrailingZeros=function(){return this.low?Cw(this.low):Cw(this.high)+32},Hw.ctz=Hw.countTrailingZeros,Hw.and=function(t){return ww(t)||(t=Iw(t)),Bw(this.low&t.low,this.high&t.high,this.unsigned)},Hw.or=function(t){return ww(t)||(t=Iw(t)),Bw(this.low|t.low,this.high|t.high,this.unsigned)},Hw.xor=function(t){return ww(t)||(t=Iw(t)),Bw(this.low^t.low,this.high^t.high,this.unsigned)},Hw.shiftLeft=function(t){return ww(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?Bw(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):Bw(0,this.low<<t-32,this.unsigned)},Hw.shl=Hw.shiftLeft,Hw.shiftRight=function(t){return ww(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?Bw(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):Bw(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},Hw.shr=Hw.shiftRight,Hw.shiftRightUnsigned=function(t){return ww(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?Bw(this.low>>>t|this.high<<32-t,this.high>>>t,this.unsigned):Bw(32===t?this.high:this.high>>>t-32,0,this.unsigned)},Hw.shru=Hw.shiftRightUnsigned,Hw.shr_u=Hw.shiftRightUnsigned,Hw.rotateLeft=function(t){var e;return ww(t)&&(t=t.toInt()),0==(t&=63)?this:32===t?Bw(this.high,this.low,this.unsigned):t<32?(e=32-t,Bw(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned)):(e=32-(t-=32),Bw(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned))},Hw.rotl=Hw.rotateLeft,Hw.rotateRight=function(t){var e;return ww(t)&&(t=t.toInt()),0==(t&=63)?this:32===t?Bw(this.high,this.low,this.unsigned):t<32?(e=32-t,Bw(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned)):(e=32-(t-=32),Bw(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned))},Hw.rotr=Hw.rotateRight,Hw.toSigned=function(){return this.unsigned?Bw(this.low,this.high,!1):this},Hw.toUnsigned=function(){return this.unsigned?this:Bw(this.low,this.high,!0)},Hw.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},Hw.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},Hw.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,e>>>24,e>>>16&255,e>>>8&255,255&e]},Aw.fromBytes=function(t,e,n){return n?Aw.fromBytesLE(t,e):Aw.fromBytesBE(t,e)},Aw.fromBytesLE=function(t,e){return new Aw(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)},Aw.fromBytesBE=function(t,e){return new Aw(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)};const Ww=Aw,Jw=16;function qw(t){"X"===t&&(t="");const e=t.padEnd(Jw,"0");return Ww.fromString(e,!0,16)}const Kw=3,Xw=61,Qw=180/Math.PI;function Yw(t,e,n){const i=1<<e;return[(t[0]+n[0])/i,(t[1]+n[1])/i]}function Zw(t){return t>=.5?1/3*(4*t*t-1):1/3*(1-4*(1-t)*(1-t))}function $w(t){return[Zw(t[0]),Zw(t[1])]}function tC(t,e){let[n,i]=e;switch(t){case 0:return[1,n,i];case 1:return[-n,1,i];case 2:return[-n,-i,1];case 3:return[-1,-i,-n];case 4:return[i,-1,-n];case 5:return[i,n,-1];default:throw new Error("Invalid face")}}function eC(t){let[e,n,i]=t;const r=Math.atan2(i,Math.sqrt(e*e+n*n));return[Math.atan2(n,e)*Qw,r*Qw]}function nC(t,e,n,i){if(0===i){1===n&&(e[0]=t-1-e[0],e[1]=t-1-e[1]);const i=e[0];e[0]=e[1],e[1]=i}}function iC(t){const e=function(t){if(t.indexOf("/")>0)return t;return function(t){if(t.isZero())return"";let e=t.toString(2);for(;e.length<Kw+Xw;)e="0"+e;const n=e.lastIndexOf("1"),i=e.substring(0,3),r=e.substring(3,n),s=r.length/2,o=Ww.fromString(i,!0,2).toString(10);let a="";if(0!==s)for(a=Ww.fromString(r,!0,2).toString(4);a.length<s;)a="0"+a;return"".concat(o,"/").concat(a)}(qw(t))}(t),n=function(t){if(0===t.length)throw new Error("Invalid Hilbert quad key ".concat(t));const e=t.split("/"),n=parseInt(e[0],10),i=e[1],r=i.length;let s=0;const o=[0,0];for(let t=r-1;t>=0;t--){s=r-t;const e=i[t];let n=0,a=0;"1"===e?a=1:"2"===e?(n=1,a=1):"3"===e&&(n=1);const l=Math.pow(2,s-1);nC(l,o,n,a),o[0]+=l*n,o[1]+=l*a}if(n%2==1){const t=o[0];o[0]=o[1],o[1]=t}return{face:n,ij:o,level:s}}(e);return n}const rC=100;function sC(t){const{face:e,ij:n,level:i}=t,r=[[0,0],[0,1],[1,1],[1,0],[0,0]],s=Math.max(1,Math.ceil(rC*Math.pow(2,-i))),o=new Float64Array(4*s*2+2);let a=0,l=0;for(let t=0;t<4;t++){const c=r[t].slice(0),u=r[t+1],h=(u[0]-c[0])/s,d=(u[1]-c[1])/s;for(let t=0;t<s;t++){c[0]+=h,c[1]+=d;const t=eC(tC(e,$w(Yw(n,i,c))));Math.abs(t[1])>89.999&&(t[0]=l);const r=t[0]-l;t[0]+=r>180?-360:r<-180?360:0,o[a++]=t[0],o[a++]=t[1],l=t[0]}}return o[a++]=o[0],o[a++]=o[1],o}function oC(t){if(t.length%2!=0)throw new Error("Invalid corners");const e=[],n=[];for(let i=0;i<t.length;i+=2)e.push(t[i]),n.push(t[i+1]);return e.sort(((t,e)=>t-e)),n.sort(((t,e)=>t-e)),{west:e[0],east:e[e.length-1],north:n[n.length-1],south:n[0]}}function aC(t){const e=t.token,n={minimumHeight:t.minimumHeight,maximumHeight:t.maximumHeight},i=function(t,e){const n=(null==e?void 0:e.minimumHeight)||0,i=(null==e?void 0:e.maximumHeight)||0,r=function(t){let e;if(2===t.face||5===t.face){let n=null,i=0;for(let e=0;e<4;e++){const r=sC(iC("".concat(t.face,"/").concat(e)));null==n&&(n=new Float64Array(4*r.length)),n.set(r,i),i+=r.length}e=oC(n)}else e=oC(sC(t));return e}(iC(t)),s=r.west,o=r.south,a=r.east,l=r.north,c=[];return c.push(new In(s,l,n)),c.push(new In(a,l,n)),c.push(new In(a,o,n)),c.push(new In(s,o,n)),c.push(new In(s,l,i)),c.push(new In(a,l,i)),c.push(new In(a,o,i)),c.push(new In(s,o,i)),c}(e,n),r=function(t){const e=$w(Yw(t.ij,t.level,[.5,.5]));return eC(tC(t.face,e))}(iC(e)),s=r[0],o=r[1],a=qb.WGS84.cartographicToCartesian([s,o,n.maximumHeight]),l=new In(a[0],a[1],a[2]);i.push(l);const c=function(t,e=new d_){if(!t||0===t.length)return e.halfAxes=new ay([0,0,0,0,0,0,0,0,0]),e.center=new In,e;const n=t.length,i=new In(0,0,0);for(const e of t)i.add(e);const r=1/n;i.multiplyByScalar(r);let s=0,o=0,a=0,l=0,c=0,u=0;for(const e of t){const t=P_.copy(e).subtract(i);s+=t.x*t.x,o+=t.x*t.y,a+=t.x*t.z,l+=t.y*t.y,c+=t.y*t.z,u+=t.z*t.z}s*=r,o*=r,a*=r,l*=r,c*=r,u*=r;const h=R_;h[0]=s,h[1]=o,h[2]=a,h[3]=o,h[4]=l,h[5]=c,h[6]=a,h[7]=c,h[8]=u;const{unitary:d}=function(t,e={}){const n=xb.EPSILON20;let i=0,r=0;const s=A_,o=w_;s.identity(),o.copy(t);const a=n*function(t){let e=0;for(let n=0;n<9;++n){const i=t[n];e+=i*i}return Math.sqrt(e)}(o);for(;r<10&&S_(o)>a;)B_(o,C_),E_.copy(C_).transpose(),o.multiplyRight(C_),o.multiplyLeft(E_),s.multiplyRight(C_),++i>2&&(++r,i=0);return e.unitary=s.toTarget(e.unitary),e.diagonal=o.toTarget(e.diagonal),e}(h,F_),f=e.halfAxes.copy(d);let p=f.getColumn(0,I_),g=f.getColumn(1,L_),m=f.getColumn(2,O_),v=-Number.MAX_VALUE,y=-Number.MAX_VALUE,b=-Number.MAX_VALUE,_=Number.MAX_VALUE,A=Number.MAX_VALUE,w=Number.MAX_VALUE;for(const e of t)P_.copy(e),v=Math.max(P_.dot(p),v),y=Math.max(P_.dot(g),y),b=Math.max(P_.dot(m),b),_=Math.min(P_.dot(p),_),A=Math.min(P_.dot(g),A),w=Math.min(P_.dot(m),w);p=p.multiplyByScalar(.5*(_+v)),g=g.multiplyByScalar(.5*(A+y)),m=m.multiplyByScalar(.5*(w+b)),e.center.copy(p).add(g).add(m);const C=M_.set(v-_,y-A,b-w).multiplyByScalar(.5),E=new ay([C[0],0,0,0,C[1],0,0,0,C[2]]);return e.halfAxes.multiplyRight(E),e}(i);return[...c.center,...c.halfAxes]}const lC={QUADTREE:4,OCTREE:8};function cC(t,e,n){if(null!=t&&t.box){const i=function(t,e){const n=function(t){return t.and(t.not().add(1))}(t).shiftRightUnsigned(2);return t.add(Ww.fromNumber(2*e+1-4).multiply(n))}(qw(t.s2VolumeInfo.token),e),r=function(t){if(t.isZero())return"X";let e=t.countTrailingZeros();e=(e-e%4)/4;const n=e;e*=4;const i=t.shiftRightUnsigned(e).toString(16).replace(/0+$/,"");return Array(17-n-i.length).join("0")+i}(i),s={...t.s2VolumeInfo};if(s.token=r,"OCTREE"===n){const e=t.s2VolumeInfo,n=e.maximumHeight-e.minimumHeight,i=n/2,r=e.minimumHeight+n/2;e.minimumHeight=r-i,e.maximumHeight=r+i}return{box:aC(s),s2VolumeInfo:s}}}async function uC(t){const{options:e,parentData:n={mortonIndex:0,x:0,y:0,z:0},childIndex:i=0,globalData:r={level:0,mortonIndex:0,x:0,y:0,z:0},s2VolumeBox:s}=t;let{subtree:o,level:a=0}=t;const{subdivisionScheme:l,subtreeLevels:c,maximumLevel:u,contentUrlTemplate:h,subtreesUriTemplate:d,basePath:f}=e,p={children:[],lodMetricValue:0,contentUrl:""},g=lC[l],m=1&i,v=i>>1&1,y=i>>2&1,b=(g**a-1)/(g-1);let _=fC(n.mortonIndex,i),A=b+_,w=fC(n.x,m),C=fC(n.y,v),E=fC(n.z,y),x=!1;a+1>c&&(x=hC(o.childSubtreeAvailability,_));const T=fC(r.x,w),S=fC(r.y,C),B=fC(r.z,E),P=a+r.level;if(x){const t=pC("".concat(f,"/").concat(d),P,T,S,B);o=await qe(t,bw),r.mortonIndex=_,r.x=w,r.y=C,r.z=E,r.level=a,_=0,A=0,w=0,C=0,E=0,a=0}if(!hC(o.tileAvailability,A)||a>u)return p;hC(o.contentAvailability,A)&&(p.contentUrl=pC(h,P,T,S,B));const M=a+1,I={mortonIndex:_,x:w,y:C,z:E};for(let t=0;t<g;t++){const n=cC(s,t,l),i=await uC({subtree:o,options:e,parentData:I,childIndex:t,level:M,globalData:r,s2VolumeBox:n});if(i.contentUrl||i.children.length){const t=dC(i,P+1,{childTileX:w,childTileY:C,childTileZ:E},e,s);p.children.push(t)}}return p}function hC(t,e){return"constant"in t?Boolean(t.constant):!!t.explicitBitstream&&function(t,e){const n=t%8;return 1==(e[Math.floor(t/8)]>>n&1)}(e,t.explicitBitstream)}function dC(t,e,n,i,r){const{basePath:s,refine:o,getRefine:a,lodMetricType:l,getTileType:c,rootLodMetricValue:u,rootBoundingVolume:h}=i,d=t.contentUrl&&t.contentUrl.replace("".concat(s,"/"),""),f=u/2**e,p=function(t,e,n){if(e.region){const{childTileX:i,childTileY:r,childTileZ:s}=n,[o,a,l,c,u,h]=e.region,d=2**t,f=(l-o)/d,p=(c-a)/d,g=(h-u)/d,[m,v]=[o+f*i,o+f*(i+1)],[y,b]=[a+p*r,a+p*(r+1)],[_,A]=[u+g*s,u+g*(s+1)];return{region:[m,y,v,b,_,A]}}if(e.box)return e;throw new Error("Unsupported bounding volume type ".concat(e))}(e,null!=r&&r.box?{box:r.box}:h,n);return{children:t.children,contentUrl:t.contentUrl,content:{uri:d},id:t.contentUrl,refine:a(o),type:c(t),lodMetricType:l,lodMetricValue:f,geometricError:f,transform:t.transform,boundingVolume:p}}function fC(t,e){return parseInt(t.toString(2)+e.toString(2),2)}function pC(t,e,n,i,r){const s=function(t){const e={};for(const n in t)e["{".concat(n,"}")]=t[n];return e}({level:e,x:n,y:i,z:r});return t.replace(/{level}|{x}|{y}|{z}/gi,(t=>s[t]))}function gC(t){if(!t.contentUrl)return J_.EMPTY;const e=t.contentUrl.split("?")[0].split(".").pop();switch(e){case"pnts":return J_.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return J_.SCENEGRAPH;default:return e}}function mC(t){switch(t){case"REPLACE":case"replace":return W_.REPLACE;case"ADD":case"add":return W_.ADD;default:return t}}function vC(t,e){if(/^[a-z][0-9a-z+.-]*:/i.test(e)){const n=new URL(t,"".concat(e,"/"));return decodeURI(n.toString())}return t.startsWith("/")?t:"".concat(e,"/").concat(t)}function yC(t,e){if(!t)return null;if(t.content){const n=t.content.uri||t.content.url;t.contentUrl=vC(n,e.basePath)}return t.id=t.contentUrl,t.lodMetricType=X_,t.lodMetricValue=t.geometricError,t.transformMatrix=t.transform,t.type=gC(t),t.refine=mC(t.refine),t}async function bC(t,e,n,i){var r,s;const o=e.basePath,{subdivisionScheme:a,maximumLevel:l,subtreeLevels:c,subtrees:{uri:u}}=n,h=vC(pC(u,0,0,0,0),o),d=await qe(h,bw,i),f=vC(t.content.uri,o),p=null==e||null===(r=e.root)||void 0===r?void 0:r.refine,g=t.geometricError,m=null===(s=t.boundingVolume.extensions)||void 0===s?void 0:s["3DTILES_bounding_volume_S2"];if(m){const e={box:aC(m),s2VolumeInfo:m};t.boundingVolume=e}const v=t.boundingVolume,y={contentUrlTemplate:f,subtreesUriTemplate:u,subdivisionScheme:a,subtreeLevels:c,maximumLevel:l,refine:p,basePath:o,lodMetricType:X_,rootLodMetricValue:g,rootBoundingVolume:v,getTileType:gC,getRefine:mC};return await async function(t,e,n){if(!t)return null;t.lodMetricType=X_,t.lodMetricValue=t.geometricError,t.transformMatrix=t.transform;const{children:i,contentUrl:r}=await uC({subtree:e,options:n,s2VolumeBox:t});return r&&(t.contentUrl=r,t.content={uri:r.replace("".concat(n.basePath,"/"),"")}),t.refine=mC(t.refine),t.type=gC(t),t.children=i,t.id=t.contentUrl,t}(t,d,y)}function _C(t){var e;return(null==t||null===(e=t.extensions)||void 0===e?void 0:e["3DTILES_implicit_tiling"])||(null==t?void 0:t.implicitTiling)}const AC={id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:OA,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:async function(t,e,n){const i=e["3d-tiles"]||{};let r;return r="auto"===i.isTileset?n.url&&-1!==n.url.indexOf(".json"):i.isTileset,t=r?await async function(t,e,n){var i;const r=JSON.parse((new TextDecoder).decode(t));return r.loader=e.loader||AC,r.url=n.url,r.queryString=n.queryString,r.basePath=Re(r.url),r.root=await async function(t,e){const n=t.basePath;let i;const r=_C(null==t?void 0:t.root);i=r&&t.root?await bC(t.root,t,r,e):yC(t.root,t);const s=[];for(s.push(i);s.length>0;){const i=(s.pop()||{}).children||[];for(let r of i){const i=_C(r);i?r=await bC(r,t,i,e):yC(r,{basePath:n}),s.push(r)}}return i}(r,e),r.type=K_,r.lodMetricType=X_,r.lodMetricValue=(null===(i=r.root)||void 0===i?void 0:i.lodMetricValue)||0,r}(t,e,n):await async function(t,e,n){const i={content:{featureIds:null}};return await mw(t,0,e,n,i.content),i.content}(t,e,n),t},options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}},wC=[0],CC={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:AC,onTilesetLoad:{type:"function",value:t=>{}},onTileLoad:{type:"function",value:t=>{}},onTileUnload:{type:"function",value:t=>{}},onTileError:{type:"function",value:(t,e,n)=>{}},_getMeshColor:{type:"function",value:t=>[255,255,255]}};class EC extends hf{constructor(...t){super(...t),m(this,"state",void 0)}initializeState(){"onTileLoadFail"in this.props&&q.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){const{tileset3d:t}=this.state;return null!==t&&t.isLoaded()}shouldUpdateState({changeFlags:t}){return t.somethingChanged}updateState({props:t,oldProps:e,changeFlags:n}){if(t.data&&t.data!==e.data&&this._loadTileset(t.data),n.viewportChanged){const{activeViewports:t}=this.state;Object.keys(t).length&&(this._updateTileset(t),this.state.lastUpdatedViewports=t,this.state.activeViewports={})}if(n.propsChanged){const{layerMap:t}=this.state;for(const e in t)t[e].needsUpdate=!0}}activateViewport(t){const{activeViewports:e,lastUpdatedViewports:n}=this.state;this.internalState.viewport=t,e[t.id]=t;const i=null==n?void 0:n[t.id];i&&t.equals(i)||(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo({info:t,sourceLayer:e}){const n=e&&e.props.tile;return t.picked&&(t.object=n),t.sourceTile=n,t}filterSubLayer({layer:t,viewport:e}){const{tile:n}=t.props,{id:i}=e;return n.selected&&n.viewportIds.includes(i)}_updateAutoHighlight(t){const e=t.sourceTile,n=this.state.layerMap[null==e?void 0:e.id];n&&n.layer&&n.layer.updateAutoHighlight(t)}async _loadTileset(t){const{loadOptions:e={}}=this.props;let n=this.props.loader||this.props.loaders;Array.isArray(n)&&(n=n[0]);const i={loadOptions:{...e}};let r=t;if(n.preload){const s=await n.preload(t,e);s.url&&(r=s.url),s.headers&&(i.loadOptions.fetch={...i.loadOptions.fetch,headers:s.headers}),Object.assign(i,s)}const s=await qe(r,n,i.loadOptions),o=new LA(s,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...i});this.setState({tileset3d:o,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(o)}_onTileLoad(t){const{lastUpdatedViewports:e}=this.state;this.props.onTileLoad(t),this._updateTileset(e),this.setNeedsUpdate()}_onTileUnload(t){delete this.state.layerMap[t.id],this.props.onTileUnload(t)}_updateTileset(t){if(!t)return;const{tileset3d:e}=this.state,{timeline:n}=this.context,i=Object.keys(t).length;n&&i&&e&&e.selectTiles(Object.values(t)).then((t=>{this.state.frameNumber!==t&&this.setState({frameNumber:t})}))}_getSubLayer(t,e){if(!t.content)return null;switch(t.type){case J_.POINTCLOUD:return this._makePointCloudLayer(t,e);case J_.SCENEGRAPH:return this._make3DModelLayer(t);case J_.MESH:return this._makeSimpleMeshLayer(t,e);default:throw new Error("Tile3DLayer: Failed to render layer of type ".concat(t.content.type))}}_makePointCloudLayer(t,e){const{attributes:n,pointCount:i,constantRGBA:r,cartographicOrigin:s,modelMatrix:o}=t.content,{positions:a,normals:l,colors:c}=n;if(!a)return null;const u=e&&e.props.data||{header:{vertexCount:i},attributes:{POSITION:a,NORMAL:l,COLOR_0:c}},{pointSize:h,getPointColor:d}=this.props;return new(this.getSubLayerClass("pointcloud",pg))({pointSize:h},this.getSubLayerProps({id:"pointcloud"}),{id:"".concat(this.id,"-pointcloud-").concat(t.id),tile:t,data:u,coordinateSystem:Li.METER_OFFSETS,coordinateOrigin:s,modelMatrix:o,getColor:r||d,_offset:0})}_make3DModelLayer(t){const{gltf:e,instances:n,cartographicOrigin:i,modelMatrix:r}=t.content;return new(this.getSubLayerClass("scenegraph",_b))({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:"".concat(this.id,"-scenegraph-").concat(t.id),tile:t,data:n||wC,scenegraph:e,coordinateSystem:Li.METER_OFFSETS,coordinateOrigin:i,modelMatrix:r,getTransformMatrix:t=>t.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(t,e){const n=t.content,{attributes:i,indices:r,modelMatrix:s,cartographicOrigin:o,coordinateSystem:a=Li.METER_OFFSETS,material:l,featureIds:c}=n,{_getMeshColor:u}=this.props,h=e&&e.props.mesh||new vf({drawMode:4,attributes:xC(i),indices:r});return new(this.getSubLayerClass("mesh",Eb))(this.getSubLayerProps({id:"mesh"}),{id:"".concat(this.id,"-mesh-").concat(t.id),tile:t,mesh:h,data:wC,getColor:u(t),pbrMaterial:l,modelMatrix:s,coordinateOrigin:o,coordinateSystem:a,featureIds:c,_offset:0})}renderLayers(){const{tileset3d:t,layerMap:e}=this.state;return t?t.tiles.map((t=>{const n=e[t.id]=e[t.id]||{tile:t};let{layer:i}=n;return t.selected&&(i?n.needsUpdate&&(i=this._getSubLayer(t,i),n.needsUpdate=!1):i=this._getSubLayer(t)),n.layer=i,i})).filter(Boolean):null}}function xC(t){const e={};return e.positions={...t.positions,value:new Float32Array(t.positions.value)},t.normals&&(e.normals=t.normals),t.texCoords&&(e.texCoords=t.texCoords),t.colors&&(e.colors=t.colors),t.uvRegions&&(e.uvRegions=t.uvRegions),e}m(EC,"defaultProps",CC),m(EC,"layerName","Tile3DLayer");class TC{static get componentName(){return Object.prototype.hasOwnProperty.call(this,"extensionName")?this.extensionName:""}constructor(t){m(this,"opts",void 0),t&&(this.opts=t)}equals(t){return this===t||this.constructor===t.constructor&&tl(this.opts,t.opts,1)}getShaders(t){return null}getSubLayerProps(t){const{defaultProps:e}=t.constructor,n={updateTriggers:{}};for(const t in e)if(t in this.props){const i=e[t],r=this.props[t];n[t]=r,i&&"accessor"===i.type&&(n.updateTriggers[t]=this.props.updateTriggers[t],"function"==typeof r&&(n[t]=this.getSubLayerAccessor(r)))}return n}initializeState(t,e){}updateState(t,e){}onNeedsRedraw(t){}getNeedsPickingBuffer(t){return!1}draw(t,e){}finalizeState(t,e){}}m(TC,"defaultProps",{}),m(TC,"extensionName","LayerExtension");const SC={name:"fill-pattern",vs:"\n#ifdef NON_INSTANCED_MODEL\n  #define FILL_PATTERN_FRAME_ATTRIB fillPatternFrames\n  #define FILL_PATTERN_SCALE_ATTRIB fillPatternScales\n  #define FILL_PATTERN_OFFSET_ATTRIB fillPatternOffsets\n#else\n  #define FILL_PATTERN_FRAME_ATTRIB instanceFillPatternFrames\n  #define FILL_PATTERN_SCALE_ATTRIB instanceFillPatternScales\n  #define FILL_PATTERN_OFFSET_ATTRIB instanceFillPatternOffsets\n#endif\n\nattribute vec4 FILL_PATTERN_FRAME_ATTRIB;\nattribute float FILL_PATTERN_SCALE_ATTRIB;\nattribute vec2 FILL_PATTERN_OFFSET_ATTRIB;\n\nuniform bool fill_patternEnabled;\nuniform vec2 fill_patternTextureSize;\n\nvarying vec2 fill_uv;\nvarying vec4 fill_patternBounds;\nvarying vec4 fill_patternPlacement;\n",fs:"\nuniform bool fill_patternEnabled;\nuniform bool fill_patternMask;\nuniform sampler2D fill_patternTexture;\nuniform vec2 fill_uvCoordinateOrigin;\nuniform vec2 fill_uvCoordinateOrigin64Low;\n\nvarying vec4 fill_patternBounds;\nvarying vec4 fill_patternPlacement;\nvarying vec2 fill_uv;\n\nconst float FILL_UV_SCALE = 512.0 / 40000000.0;\n",inject:{"vs:DECKGL_FILTER_GL_POSITION":"\n    fill_uv = geometry.position.xy;\n  ","vs:DECKGL_FILTER_COLOR":"\n    if (fill_patternEnabled) {\n      fill_patternBounds = FILL_PATTERN_FRAME_ATTRIB / vec4(fill_patternTextureSize, fill_patternTextureSize);\n      fill_patternPlacement.xy = FILL_PATTERN_OFFSET_ATTRIB;\n      fill_patternPlacement.zw = FILL_PATTERN_SCALE_ATTRIB * FILL_PATTERN_FRAME_ATTRIB.zw;\n    }\n  ","fs:DECKGL_FILTER_COLOR":"\n    if (fill_patternEnabled) {\n      vec2 scale = FILL_UV_SCALE * fill_patternPlacement.zw;\n      vec2 patternUV = mod(mod(fill_uvCoordinateOrigin, scale) + fill_uvCoordinateOrigin64Low + fill_uv, scale) / scale;\n      patternUV = mod(fill_patternPlacement.xy + patternUV, 1.0);\n\n      vec2 texCoords = fill_patternBounds.xy + fill_patternBounds.zw * patternUV;\n\n      vec4 patternColor = texture2D(fill_patternTexture, texCoords);\n      color.a *= patternColor.a;\n      if (!fill_patternMask) {\n        color.rgb = patternColor.rgb;\n      }\n    }\n  "},dependencies:[Xa],getUniforms:function(t,e){if(!t)return{};if("fillPatternTexture"in t){const{fillPatternTexture:e}=t;return{fill_patternTexture:e,fill_patternTextureSize:[e.width,e.height]}}if("viewport"in t){const{fillPatternMask:n=!0,fillPatternEnabled:i=!0}=t,{project_uCommonOrigin:r}=e,s=[Rn(r[0]),Rn(r[1])];return{fill_uvCoordinateOrigin:r.slice(0,2),fill_uvCoordinateOrigin64Low:s,fill_patternMask:n,fill_patternEnabled:i}}return{}}};class BC extends TC{constructor({pattern:t=!1}={}){super({pattern:t})}isEnabled(t){return null!==t.getAttributeManager()&&!("pathTesselator"in t.state)}getShaders(t){return t.isEnabled(this)?{modules:[t.opts.pattern&&SC].filter(Boolean)}:null}initializeState(t,e){if(!e.isEnabled(this))return;const n=this.getAttributeManager();e.opts.pattern&&n.add({fillPatternFrames:{size:4,accessor:"getFillPattern",transform:e.getPatternFrame.bind(this),shaderAttributes:{fillPatternFrames:{divisor:0},instanceFillPatternFrames:{divisor:1}}},fillPatternScales:{size:1,accessor:"getFillPatternScale",defaultValue:1,shaderAttributes:{fillPatternScales:{divisor:0},instanceFillPatternScales:{divisor:1}}},fillPatternOffsets:{size:2,accessor:"getFillPatternOffset",shaderAttributes:{fillPatternOffsets:{divisor:0},instanceFillPatternOffsets:{divisor:1}}}}),this.setState({emptyTexture:new Eo(this.context.gl,{data:new Uint8Array(4),width:1,height:1})})}updateState({props:t,oldProps:e},n){n.isEnabled(this)&&t.fillPatternMapping&&t.fillPatternMapping!==e.fillPatternMapping&&this.getAttributeManager().invalidate("getFillPattern")}draw(t,e){if(!e.isEnabled(this))return;const{fillPatternAtlas:n}=this.props;this.setModuleParameters({fillPatternTexture:n||this.state.emptyTexture})}finalizeState(){const{emptyTexture:t}=this.state;null==t||t.delete()}getPatternFrame(t){const{fillPatternMapping:e}=this.getCurrentLayer().props,n=e&&e[t];return n?[n.x,n.y,n.width,n.height]:[0,0,0,0]}}m(BC,"defaultProps",{fillPatternEnabled:!0,fillPatternAtlas:{type:"image",value:null,async:!0,parameters:{10241:9729}},fillPatternMapping:{type:"object",value:{},async:!0},fillPatternMask:!0,getFillPattern:{type:"accessor",value:t=>t.pattern},getFillPatternScale:{type:"accessor",value:1},getFillPatternOffset:{type:"accessor",value:[0,0]}}),m(BC,"extensionName","FillStyleExtension");const PC={NONE:0,WRITE_HEIGHT_MAP:1,USE_HEIGHT_MAP:2,USE_COVER:3,USE_COVER_ONLY:4,SKIP:5},MC=Object.keys(PC).map((t=>"const float TERRAIN_MODE_".concat(t," = ").concat(PC[t],".0;"))).join("\n"),IC={name:"terrain",dependencies:[Xa],inject:{"vs:#decl":"\nuniform float terrain_mode;\nuniform sampler2D terrain_map;\nuniform vec4 terrain_bounds;\nvarying vec3 commonPos;\n".concat(MC,"\n    "),"vs:#main-start":"\nif (terrain_mode == TERRAIN_MODE_SKIP) {\n  gl_Position = vec4(0.0);\n  return;\n}\n","vs:DECKGL_FILTER_GL_POSITION":"\ncommonPos = geometry.position.xyz;\nif (terrain_mode == TERRAIN_MODE_WRITE_HEIGHT_MAP) {\n  vec2 texCoords = (commonPos.xy - terrain_bounds.xy) / terrain_bounds.zw;\n  position = vec4(texCoords * 2.0 - 1.0, 0.0, 1.0);\n  commonPos.z += project_uCommonOrigin.z;\n}\nif (terrain_mode == TERRAIN_MODE_USE_HEIGHT_MAP) {\n  vec3 anchor = geometry.worldPosition;\n  anchor.z = 0.0;\n  vec3 anchorCommon = project_position(anchor);\n  vec2 texCoords = (anchorCommon.xy - terrain_bounds.xy) / terrain_bounds.zw;\n  if (texCoords.x >= 0.0 && texCoords.y >= 0.0 && texCoords.x <= 1.0 && texCoords.y <= 1.0) {\n    float terrainZ = texture2D(terrain_map, texCoords).r;\n    geometry.position.z += terrainZ;\n    position = project_common_position_to_clipspace(geometry.position);\n  }\n}\n    ","fs:#decl":"\nuniform float terrain_mode;\nuniform sampler2D terrain_map;\nuniform vec4 terrain_bounds;\nvarying vec3 commonPos;\n".concat(MC,"\n    "),"fs:#main-start":"\nif (terrain_mode == TERRAIN_MODE_WRITE_HEIGHT_MAP) {\n  gl_FragColor = vec4(commonPos.z, 0.0, 0.0, 1.0);\n  return;\n}\n    ","fs:DECKGL_FILTER_COLOR":"\nif ((terrain_mode == TERRAIN_MODE_USE_COVER) || (terrain_mode == TERRAIN_MODE_USE_COVER_ONLY)) {\n  vec2 texCoords = (commonPos.xy - terrain_bounds.xy) / terrain_bounds.zw;\n  vec4 pixel = texture2D(terrain_map, texCoords);\n  if (terrain_mode == TERRAIN_MODE_USE_COVER_ONLY) {\n    color = pixel;\n  } else {\n    // pixel is premultiplied\n    color = pixel + color * (1.0 - pixel.a);\n  }\n  return;\n}\n    "},getUniforms:(t={},e)=>{if("dummyHeightMap"in t){const{drawToTerrainHeightMap:n,heightMap:i,heightMapBounds:r,dummyHeightMap:s,terrainCover:o,useTerrainHeightMap:a,terrainSkipRender:l}=t,{project_uCommonOrigin:c}=e;let u=l?PC.SKIP:PC.NONE,h=s,d=null;if(n)u=PC.WRITE_HEIGHT_MAP,d=r;else if(a&&i)u=PC.USE_HEIGHT_MAP,h=i,d=r;else if(o){const e=t.pickingActive;h=e?o.getPickingFramebuffer():o.getRenderFramebuffer(),e&&(u=PC.SKIP),h?(u=u===PC.SKIP?PC.USE_COVER_ONLY:PC.USE_COVER,d=o.bounds):h=s}return{terrain_mode:u,terrain_map:h,terrain_bounds:d?[d[0]-c[0],d[1]-c[1],d[2]-d[0],d[3]-d[1]]:[0,0,0,0]}}return null}};function LC(t,e){return new Ko(t,{id:e.id,attachments:{36064:new Eo(t,{...e.float&&{format:Zr(t)?34836:6408,type:5126},mipmaps:!1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}})}})}const OC=(new ri).lookAt({eye:[0,0,1]});function RC({width:t,height:e,near:n,far:i,padding:r}){let s=-t/2,o=t/2,a=-e/2,l=e/2;if(r){const{left:n=0,right:i=0,top:c=0,bottom:u=0}=r,h=on((n+t-i)/2,0,t)-t/2,d=on((c+e-u)/2,0,e)-e/2;s-=h,o-=h,a+=d,l+=d}return(new ri).ortho({left:s,right:o,bottom:a,top:l,near:n,far:i})}class FC extends zi{constructor(t){const{width:e,height:n,near:i=.1,far:r=1e3,zoom:s=0,target:o=[0,0,0],padding:a=null,flipY:l=!0}=t,c=Array.isArray(s)?s[0]:s,u=Array.isArray(s)?s[1]:s,h=Math.min(c,u),d=Math.pow(2,h);let f;if(c!==u){const t=Math.pow(2,c),e=Math.pow(2,u);f={unitsPerMeter:[t/d,e/d,1],metersPerUnit:[d/t,d/e,1]}}super({...t,longitude:void 0,position:o,viewMatrix:OC.clone().scale([d,d*(l?-1:1),d]),projectionMatrix:RC({width:e||1,height:n||1,padding:a,near:i,far:r}),zoom:h,distanceScales:f})}projectFlat([t,e]){const{unitsPerMeter:n}=this.distanceScales;return[t*n[0],e*n[1]]}unprojectFlat([t,e]){const{metersPerUnit:n}=this.distanceScales;return[t*n[0],e*n[1]]}panByPosition(t,e){const n=Pi(e,this.pixelUnprojectionMatrix),i=Jn([],this.projectFlat(t),qn([],n)),r=Jn([],this.center,i);return{target:this.unprojectFlat(r)}}}function kC(t,e){const n=[1/0,1/0,-1/0,-1/0];for(const i of t){const t=i.getBounds();if(t){const r=i.projectPosition(t[0],{viewport:e,autoOffset:!1}),s=i.projectPosition(t[1],{viewport:e,autoOffset:!1});n[0]=Math.min(n[0],r[0]),n[1]=Math.min(n[1],r[1]),n[2]=Math.max(n[2],s[0]),n[3]=Math.max(n[3],s[1])}}return Number.isFinite(n[0])?n:null}function DC(t){const{bounds:e,viewport:n,border:i=0}=t,{isGeospatial:r}=n;if(e[2]<=e[0]||e[3]<=e[1])return null;const s=n.unprojectPosition([(e[0]+e[2])/2,(e[1]+e[3])/2,0]);let{width:o,height:a,zoom:l}=t;if(void 0===l){o-=2*i,a-=2*i;const t=Math.min(o/(e[2]-e[0]),a/(e[3]-e[1]));l=Math.min(Math.log2(t),20)}else if(!o||!a){const t=2**l;o=Math.round(Math.abs(e[2]-e[0])*t),a=Math.round(Math.abs(e[3]-e[1])*t);const n=2048-2*i;if(o>n||a>n){const t=n/Math.max(o,a);o=Math.round(o*t),a=Math.round(a*t),l+=Math.log2(t)}}return r?new al({id:n.id,x:i,y:i,width:o,height:a,longitude:s[0],latitude:s[1],zoom:l,orthographic:!0}):new FC({id:n.id,x:i,y:i,width:o,height:a,target:s,zoom:l,flipY:!1})}function NC(t,e,n){if(!t)return[0,0,1,1];const i=function(t,e){let n;if(e&&2===e.length){const[i,r]=e,s=t.getBounds({z:i}),o=t.getBounds({z:r});n=[Math.min(s[0],o[0]),Math.min(s[1],o[1]),Math.max(s[2],o[2]),Math.max(s[3],o[3])]}else n=t.getBounds();const i=t.projectPosition(n.slice(0,2)),r=t.projectPosition(n.slice(2,4));return[i[0],i[1],r[0],r[1]]}(e,n),r=function(t){const e=t[2]-t[0],n=t[3]-t[1],i=(t[0]+t[2])/2,r=(t[1]+t[3])/2;return[i-e,r-n,i+e,r+n]}(i);return t[2]-t[0]<=r[2]-r[0]&&t[3]-t[1]<=r[3]-r[1]?t:[Math.max(t[0],r[0]),Math.max(t[1],r[1]),Math.min(t[2],r[2]),Math.min(t[3],r[3])]}class UC{constructor(t){m(this,"isDirty",!0),m(this,"targetLayer",void 0),m(this,"renderViewport",null),m(this,"bounds",null),m(this,"fbo",void 0),m(this,"pickingFbo",void 0),m(this,"layers",[]),m(this,"tile",void 0),m(this,"targetBounds",null),m(this,"targetBoundsCommon",null),this.targetLayer=t,this.tile=zC(t)}get id(){return this.targetLayer.id}get isActive(){return Boolean(this.targetLayer.getCurrentLayer())}shouldUpdate({targetLayer:t,viewport:e,layers:n,layerNeedsRedraw:i}){t&&(this.targetLayer=t);const r=!!e&&this._updateViewport(e);let s=!!n&&this._updateLayers(n);if(i)for(const t of this.layers)if(i[t]){s=!0;break}return s||r}_updateLayers(t){let e=!1;if((t=this.tile?function(t,e){return e.filter((e=>{const n=zC(e);return!n||(i=t.boundingBox,r=n.boundingBox,!(!i||!r)&&i[0][0]<r[1][0]&&r[0][0]<i[1][0]&&i[0][1]<r[1][1]&&r[0][1]<i[1][1]);var i,r}))}(this.tile,t):t).length!==this.layers.length)e=!0;else for(let n=0;n<t.length;n++)if(t[n].id!==this.layers[n]){e=!0;break}return e&&(this.layers=t.map((t=>t.id))),e}_updateViewport(t){const e=this.targetLayer;let n=!1;if(this.tile&&"boundingBox"in this.tile){if(!this.targetBounds){n=!0,this.targetBounds=this.tile.boundingBox;const e=t.projectPosition(this.targetBounds[0]),i=t.projectPosition(this.targetBounds[1]);this.targetBoundsCommon=[e[0],e[1],i[0],i[1]]}}else this.targetBounds!==e.getBounds()&&(n=!0,this.targetBounds=e.getBounds(),this.targetBoundsCommon=kC([e],t));if(!this.targetBoundsCommon)return!1;const i=Math.ceil(t.zoom+.5);if(this.tile)this.bounds=this.targetBoundsCommon;else{var r;const e=null===(r=this.renderViewport)||void 0===r?void 0:r.zoom;n=n||i!==e;const s=NC(this.targetBoundsCommon,t),o=this.bounds;n=n||!o||s.some(((t,e)=>t!==o[e])),this.bounds=s}return n&&(this.renderViewport=DC({bounds:this.bounds,zoom:i,viewport:t})),n}getRenderFramebuffer(){return this.renderViewport&&0!==this.layers.length?(this.fbo||(this.fbo=LC(this.targetLayer.context.gl,{id:this.id})),this.fbo):null}getPickingFramebuffer(){return!this.renderViewport||0===this.layers.length&&!this.targetLayer.props.pickable?null:(this.pickingFbo||(this.pickingFbo=LC(this.targetLayer.context.gl,{id:"".concat(this.id,"-picking")})),this.pickingFbo)}filterLayers(t){return t.filter((({id:t})=>this.layers.includes(t)))}delete(){const{fbo:t,pickingFbo:e}=this;t&&(t.texture.delete(),t.delete()),e&&(e.texture.delete(),e.delete())}}function zC(t){for(;t;){const{tile:e}=t.props;if(e)return e;t=t.parent}return null}class GC extends zl{getRenderableLayers(t,e){const{layers:n}=e,i=[],r=this._getDrawLayerParams(t,e,!0);for(let t=0;t<n.length;t++){const e=n[t];!e.isComposite&&r[t].shouldDrawLayer&&i.push(e)}return i}renderHeightMap(t,e){const n=t.getRenderFramebuffer(),i=t.renderViewport;n&&i&&(n.resize(i),Ls(this.gl,{clearColor:[0,0,0,0],blend:!0,blendFunc:[1,1],blendEquation:32776,depthTest:!1},(()=>this.render({...e,target:n,pass:"terrain-height-map",layers:e.layers,viewports:[i],effects:[]}))))}renderTerrainCover(t,e){const n=t.getRenderFramebuffer(),i=t.renderViewport;if(!n||!i)return;const r=t.filterLayers(e.layers);n.resize(i),Ls(this.gl,{clearColor:[0,0,0,0],depthTest:!1},(()=>this.render({...e,target:n,pass:"terrain-cover-".concat(t.id),layers:r,effects:[],viewports:[i]})))}}class jC extends nc{constructor(...t){super(...t),m(this,"drawParameters",{})}getRenderableLayers(t,e){const{layers:n}=e,i=[];this.drawParameters={},this._resetColorEncoder(e.pickZ);const r=this._getDrawLayerParams(t,e);for(let t=0;t<n.length;t++){const e=n[t];!e.isComposite&&r[t].shouldDrawLayer&&(i.push(e),this.drawParameters[e.id]=r[t].layerParameters)}return i}renderTerrainCover(t,e){const n=t.getPickingFramebuffer(),i=t.renderViewport;if(!n||!i)return;const r=t.filterLayers(e.layers),s=t.targetLayer;s.props.pickable&&r.unshift(s),n.resize(i),Ls(this.gl,{depthTest:!1},(()=>this.render({...e,pickingFBO:n,pass:"terrain-cover-picking-".concat(t.id),layers:r,effects:[],viewports:[i],cullRect:void 0,deviceRect:i,pickZ:!1})))}getLayerParameters(t,e,n){if(this.drawParameters[t.id])return this.drawParameters[t.id];const i=super.getLayerParameters(t,e,n);return i.blend=!0,i}}class VC{static isSupported(t){return Ko.isSupported(t,{colorBufferFloat:!0})}constructor(t){m(this,"renderViewport",null),m(this,"bounds",null),m(this,"fbo",void 0),m(this,"gl",void 0),m(this,"layers",[]),m(this,"layersBounds",[]),m(this,"layersBoundsCommon",null),m(this,"lastViewport",null),this.gl=t}getRenderFramebuffer(){return this.renderViewport?(this.fbo||(this.fbo=LC(this.gl,{id:"height-map",float:!0})),this.fbo):null}shouldUpdate({layers:t,viewport:e}){const n=t.length!==this.layers.length||t.some(((t,e)=>t!==this.layers[e]||t.props.transitions||t.getBounds()!==this.layersBounds[e]));n&&(this.layers=t,this.layersBounds=t.map((t=>t.getBounds())),this.layersBoundsCommon=kC(t,e));const i=!this.lastViewport||!e.equals(this.lastViewport);if(this.layersBoundsCommon){if(n||i){const t=NC(this.layersBoundsCommon,e);if(t[2]<=t[0]||t[3]<=t[1])return this.renderViewport=null,!1;this.bounds=t,this.lastViewport=e;const n=e.scale,i=(t[2]-t[0])*n,r=(t[3]-t[1])*n;return this.renderViewport=i>0||r>0?DC({bounds:[e.center[0]-1,e.center[1]-1,e.center[0]+1,e.center[1]+1],zoom:e.zoom,width:Math.min(i,2048),height:Math.min(r,2048),viewport:e}):null,!0}}else this.renderViewport=null;return!1}delete(){this.fbo&&(this.fbo.color.delete(),this.fbo.delete())}}class HC{constructor(){m(this,"id","terrain-effect"),m(this,"props",null),m(this,"useInPicking",!0),m(this,"isPicking",!1),m(this,"isDrapingEnabled",!1),m(this,"dummyHeightMap",void 0),m(this,"heightMap",void 0),m(this,"terrainPass",void 0),m(this,"terrainPickingPass",void 0),m(this,"terrainCovers",new Map)}initialize(t){this.dummyHeightMap=new Eo(t,{width:1,height:1,data:new Uint8Array([0,0,0,0])}),this.terrainPass=new GC(t,{id:"terrain"}),this.terrainPickingPass=new jC(t,{id:"terrain-picking"}),VC.isSupported(t)?this.heightMap=new VC(t):q.warn("Terrain offset mode is not supported by this browser")(),La.getDefaultProgramManager(t).addDefaultModule(IC)}preRender(t,e){if(!this.dummyHeightMap){this.initialize(t);for(const t of e.layers)t.props.operation.includes("terrain")&&t.setChangeFlags({extensionsChanged:!0})}if(e.pickZ)return void(this.isDrapingEnabled=!1);const{viewports:n,isPicking:i=!1}=e;this.isPicking=i,this.isDrapingEnabled=!0;const r=n[0],s=(i?this.terrainPickingPass:this.terrainPass).getRenderableLayers(r,e),o=s.filter((t=>t.props.operation.includes("terrain")));if(0===o.length)return;if(!i){const t=s.filter((t=>"offset"===t.state.terrainDrawMode));t.length>0&&this._updateHeightMap(o,r,e)}const a=s.filter((t=>"drape"===t.state.terrainDrawMode));this._updateTerrainCovers(o,a,r,e)}getModuleParameters(t){var e,n;const{terrainDrawMode:i}=t.state;return{heightMap:null===(e=this.heightMap)||void 0===e?void 0:e.getRenderFramebuffer(),heightMapBounds:null===(n=this.heightMap)||void 0===n?void 0:n.bounds,dummyHeightMap:this.dummyHeightMap,terrainCover:this.isDrapingEnabled?this.terrainCovers.get(t.id):null,useTerrainHeightMap:"offset"===i,terrainSkipRender:"drape"===i||!t.props.operation.includes("draw")}}cleanup(){this.dummyHeightMap&&(this.dummyHeightMap.delete(),this.dummyHeightMap=void 0),this.heightMap&&(this.heightMap.delete(),this.heightMap=void 0);for(const t of this.terrainCovers.values())t.delete();this.terrainCovers.clear()}_updateHeightMap(t,e,n){this.heightMap&&this.heightMap.shouldUpdate({layers:t,viewport:e})&&this.terrainPass.renderHeightMap(this.heightMap,{...n,layers:t,moduleParameters:{heightMapBounds:this.heightMap.bounds,dummyHeightMap:this.dummyHeightMap,devicePixelRatio:1,drawToTerrainHeightMap:!0}})}_updateTerrainCovers(t,e,n,i){const r={};for(const t of e)t.state.terrainCoverNeedsRedraw&&(r[t.id]=!0,t.state.terrainCoverNeedsRedraw=!1);for(const t of this.terrainCovers.values())t.isDirty=t.isDirty||t.shouldUpdate({layerNeedsRedraw:r});for(const r of t)this._updateTerrainCover(r,e,n,i);this.isPicking||this._pruneTerrainCovers()}_updateTerrainCover(t,e,n,i){const r=this.isPicking?this.terrainPickingPass:this.terrainPass;let s=this.terrainCovers.get(t.id);s||(s=new UC(t),this.terrainCovers.set(t.id,s));try{const o=s.shouldUpdate({targetLayer:t,viewport:n,layers:e});(this.isPicking||s.isDirty||o)&&(r.renderTerrainCover(s,{...i,layers:e,moduleParameters:{dummyHeightMap:this.dummyHeightMap,terrainSkipRender:!1,devicePixelRatio:1}}),s.isDirty=!1)}catch(e){t.raiseError(e,"Error rendering terrain cover ".concat(s.id))}}_pruneTerrainCovers(){const t=[];for(const[e,n]of this.terrainCovers)n.isActive||t.push(e);for(const e of t)this.terrainCovers.delete(e)}}class WC extends TC{getShaders(){return{modules:[IC]}}initializeState(){var t;null===(t=this.context.deck)||void 0===t||t._addDefaultEffect(new HC)}updateState(t){const{props:e,oldProps:n}=t;if(this.state.terrainDrawMode&&e.terrainDrawMode===n.terrainDrawMode&&e.extruded===n.extruded)return;let{terrainDrawMode:i}=e;if(!i){var r;const t=this.props.extruded,e=null===(r=this.getAttributeManager())||void 0===r?void 0:r.attributes;i=t||e&&"instancePositions"in e?"offset":"drape"}this.setState({terrainDrawMode:i})}onNeedsRedraw(){const t=this.state;"drape"===t.terrainDrawMode&&(t.terrainCoverNeedsRedraw=!0)}}m(WC,"defaultProps",{terrainDrawMode:void 0}),m(WC,"extensionName","TerrainExtension"),Math.PI,Math.PI,globalThis.mathgl=globalThis.mathgl||{config:{EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1}};const JC=globalThis.mathgl.config;function qC(t,{precision:e=JC.precision}={}){return t=function(t){return Math.round(t/JC.EPSILON)*JC.EPSILON}(t),"".concat(parseFloat(t.toPrecision(e)))}function KC(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function XC(t,e,n){const i=JC.EPSILON;n&&(JC.EPSILON=n);try{if(t===e)return!0;if(KC(t)&&KC(e)){if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(!XC(t[n],e[n]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):"number"==typeof t&&"number"==typeof e&&Math.abs(t-e)<=JC.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))}finally{JC.EPSILON=i}}class QC extends(function(t){function e(){var e=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(e,Object.getPrototypeOf(this)),e}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}(Array)){clone(){return(new this.constructor).copy(this)}fromArray(t,e=0){for(let n=0;n<this.ELEMENTS;++n)this[n]=t[n+e];return this.check()}toArray(t=[],e=0){for(let n=0;n<this.ELEMENTS;++n)t[e+n]=this[n];return t}toObject(t){return t}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}to(t){return t===this?this:KC(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(JC)}formatString(t){let e="";for(let n=0;n<this.ELEMENTS;++n)e+=(n>0?", ":"")+qC(this[n],t);return"".concat(t.printTypes?this.constructor.name:"","[").concat(e,"]")}equals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(!XC(this[e],t[e]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,e,n){if(void 0===n)return this.lerp(this,t,e);for(let i=0;i<this.ELEMENTS;++i){const r=t[i],s="number"==typeof e?e:e[i];this[i]=r+n*(s-r)}return this.check()}min(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}max(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}clamp(t,e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t[n]),e[n]);return this.check()}add(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]+=e[t];return this.check()}subtract(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]-=e[t];return this.check()}scale(t){if("number"==typeof t)for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;else for(let e=0;e<this.ELEMENTS&&e<t.length;++e)this[e]*=t[e];return this.check()}multiplyByScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}check(){if(JC.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let t=this.length===this.ELEMENTS;for(let e=0;e<this.ELEMENTS;++e)t=t&&Number.isFinite(this[e]);return t}sub(t){return this.subtract(t)}setScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}addScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}divideScalar(t){return this.multiplyByScalar(1/t)}clampScalar(t,e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t),e);return this.check()}get elements(){return this}}function YC(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(JSON.stringify(t)));return t}function ZC(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}class $C extends QC{get x(){return this[0]}set x(t){this[0]=YC(t)}get y(){return this[1]}set y(t){this[1]=YC(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let e=0;for(let n=0;n<this.ELEMENTS;++n){const i=this[n]-t[n];e+=i*i}return YC(e)}dot(t){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*t[n];return YC(e)}normalize(){const t=this.magnitude();if(0!==t)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}multiply(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]*=e[t];return this.check()}divide(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e[t];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return ZC(t>=0&&t<this.ELEMENTS,"index is out of range"),YC(this[t])}setComponent(t,e){return ZC(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=e,this.check()}addVectors(t,e){return this.copy(t).add(e)}subVectors(t,e){return this.copy(t).subtract(e)}multiplyVectors(t,e){return this.copy(t).multiply(e)}addScaledVector(t,e){return this.add(new this.constructor(t).multiplyScalar(e))}}let tE="undefined"!=typeof Float32Array?Float32Array:Array;Math.random,Math.PI,function(){const t=new tE(3);tE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0)}();const eE=[0,0,0];let nE;class iE extends $C{static get ZERO(){return nE||(nE=new iE(0,0,0),Object.freeze(nE)),nE}constructor(t=0,e=0,n=0){super(-0,-0,-0),1===arguments.length&&KC(t)?this.copy(t):(JC.debug&&(YC(t),YC(e),YC(n)),this[0]=t,this[1]=e,this[2]=n)}set(t,e,n){return this[0]=t,this[1]=e,this[2]=n,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return JC.debug&&(YC(t.x),YC(t.y),YC(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=YC(t)}angle(t){return function(t,e){const n=t[0],i=t[1],r=t[2],s=e[0],o=e[1],a=e[2],l=Math.sqrt((n*n+i*i+r*r)*(s*s+o*o+a*a)),c=l&&function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}(t,e)/l;return Math.acos(Math.min(Math.max(c,-1),1))}(this,t)}cross(t){return function(t,e,n){const i=e[0],r=e[1],s=e[2],o=n[0],a=n[1],l=n[2];t[0]=r*l-s*a,t[1]=s*o-i*l,t[2]=i*a-r*o}(this,this,t),this.check()}rotateX({radians:t,origin:e=eE}){return function(t,e,n,i){const r=[],s=[];r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],s[0]=r[0],s[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),s[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2]}(this,this,e,t),this.check()}rotateY({radians:t,origin:e=eE}){return function(t,e,n,i){const r=[],s=[];r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],s[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),s[1]=r[1],s[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2]}(this,this,e,t),this.check()}rotateZ({radians:t,origin:e=eE}){return function(t,e,n,i){const r=[],s=[];r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],s[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),s[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),s[2]=r[2],t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2]}(this,this,e,t),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return function(t,e,n){const i=e[0],r=e[1],s=e[2];let o=n[3]*i+n[7]*r+n[11]*s+n[15];o=o||1,t[0]=(n[0]*i+n[4]*r+n[8]*s+n[12])/o,t[1]=(n[1]*i+n[5]*r+n[9]*s+n[13])/o,t[2]=(n[2]*i+n[6]*r+n[10]*s+n[14])/o}(this,this,t),this.check()}transformAsVector(t){return function(t,e,n){const i=e[0],r=e[1],s=e[2],o=n[3]*i+n[7]*r+n[11]*s||1;t[0]=(n[0]*i+n[4]*r+n[8]*s)/o,t[1]=(n[1]*i+n[5]*r+n[9]*s)/o,t[2]=(n[2]*i+n[6]*r+n[10]*s)/o}(this,this,t),this.check()}transformByMatrix3(t){return function(t,e,n){const i=e[0],r=e[1],s=e[2];t[0]=i*n[0]+r*n[3]+s*n[6],t[1]=i*n[1]+r*n[4]+s*n[7],t[2]=i*n[2]+r*n[5]+s*n[8]}(this,this,t),this.check()}transformByMatrix2(t){return function(t,e,n){const i=e[0],r=e[1];t[0]=n[0]*i+n[2]*r,t[1]=n[1]*i+n[3]*r,t[2]=e[2]}(this,this,t),this.check()}transformByQuaternion(t){return function(t,e,n){const i=n[0],r=n[1],s=n[2],o=n[3],a=e[0],l=e[1],c=e[2];let u=r*c-s*l,h=s*a-i*c,d=i*l-r*a,f=r*d-s*h,p=s*u-i*d,g=i*h-r*u;const m=2*o;u*=m,h*=m,d*=m,f*=2,p*=2,g*=2,t[0]=a+u+f,t[1]=l+h+p,t[2]=c+d+g}(this,this,t),this.check()}}var rE=["t1","t2","t3","t4"],sE=["https://storage.googleapis.com/g3-open-resource/PLATEAU/tokyo/13101_chiyoda-ku_notexture_2/13101_chiyoda-ku_notexture/tileset.json","https://storage.googleapis.com/g3-open-resource/PLATEAU/tokyo/13102_chuo-ku_notexture_2/13102_chuo-ku_notexture/tileset.json","https://storage.googleapis.com/g3-open-resource/PLATEAU/tokyo/13103_minato-ku_notexture_2/13103_minato-ku_notexture/tileset.json"];function oE(t){var e=t.visible,n=[],i=new ug({id:"geojson-layer",data:"./data/area.geojson",pickable:!1,stroked:!1,filled:!0,getFillColor:[255,255,255,120],getLineColor:[0,0,0,255],getLineWidth:1,fillPatternMask:!1,fillPatternAtlas:"./img/pattern.png",fillPatternMapping:"./data/pattern.json",getFillPattern:function(t,e){var n=e.index;return rE[n%4]},getFillPatternScale:.1,getFillPatternOffset:[0,0],extensions:[new BC({pattern:!0})]});n.push(i);var r=new ug({id:"over-layer",data:"./data/area.geojson",pickable:!1,stroked:!1,filled:!0,getFillColor:[255,255,255,120],getLineColor:[0,0,0,255],getLineWidth:1,fillPatternMask:!1,fillPatternAtlas:"./img/pattern.png",fillPatternMapping:"./data/pattern.json",getFillPattern:function(t,e){var n=e.index;return rE[n%4]},getFillPatternScale:.1,getFillPatternOffset:[0,0],extensions:[new BC({pattern:!0}),new WC]});return e&&n.push(r),sE.forEach((function(t,e){var i=new EC({id:"tile-3d-layer"+e,data:t,onTileLoad:function(t){t.content.cartographicOrigin=new iE(t.content.cartographicOrigin.x,t.content.cartographicOrigin.y,t.content.cartographicOrigin.z-40)},operation:"terrain+draw"});n.push(i)})),n}var aE=new Ol({color:[255,255,255],intensity:1.5}),lE=new class extends Nl{constructor(t){super(t),m(this,"timestamp",void 0),this.timestamp=t.timestamp}getProjectedLight({layer:t}){const{viewport:e}=t.context;if(e.resolution&&e.resolution>0){const[t,e,n]=wh(this.timestamp,0,0);this.direction=[t,-n,e]}else{const{latitude:t,longitude:n}=e;this.direction=wh(this.timestamp,t,n)}return this}}({timestamp:Date.UTC(2019,7,1,12),color:[255,255,255],intensity:3}),cE={longitude:139.74487099091527,latitude:35.653933837879194,zoom:17,pitch:75.88225812885756,bearing:10.702702702702704};const uE=function(){var t=p((0,h.useState)(!0),2),e=t[0],n=t[1],i=function(t){return uh((function(){return new Uu(t)})).setProps(t),null},r=p((0,h.useState)((function(){var t=new Yl({ambientLight:aE,dirLight:lE});return t.shadowColor=[0,0,0,.5],[t]})),1)[0];return h.createElement("div",null,h.createElement(dh,{initialViewState:cE,mapStyle:"mapbox://styles/mapbox/dark-v9",style:{width:"100vw",height:"100vh"},mapboxAccessToken:"pk.eyJ1Ijoic2hpbWl6dSIsImEiOiJjbGZwbDg3YnUwYWV2M3FubDdvN3pqcDhxIn0.WfKF0oFWPFqS6xn0Mm0Yow",onClick:function(t){return console.log(t)}},h.createElement(i,{effects:r,layers:oE({visible:e})})),h.createElement("fieldset",null,h.createElement("legend",null,"Controller"),h.createElement("label",null,h.createElement("input",{type:"checkbox",defaultChecked:e,onClick:function(t){n(t.target.checked)}}),"OverLaey")))};function hE(){return h.createElement(uE,null)}var dE=document.getElementById("app");(0,d.s)(dE).render(h.createElement(hE,{tab:"home"}))})()})();
//# sourceMappingURL=app.js.map